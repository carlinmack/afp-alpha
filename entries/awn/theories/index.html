<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Session AWN - Archive of Formal Proofs</title><meta name=description content="A collection of proof libraries, examples, and larger scientific developments, mechanically checked in the theorem prover Isabelle."><meta property="og:title" content="Session AWN"><meta property="og:description" content><meta property="og:type" content="article"><meta property="og:url" content="/entries/awn/theories/"><meta property="og:image" content="/images/afp.png"><meta property="article:section" content="theories"><meta property="og:site_name" content="Archive of Formal Proofs"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="/images/afp.png"><meta name=twitter:title content="Session AWN"><meta name=twitter:description content><link rel=stylesheet type=text/css href=/css/front.min.css><link rel=stylesheet type=text/css href=/css/isabelle.css><link rel=icon href=/images/favicon.ico type=image/icon><script src=/js/flexsearch.min.js></script><script src=/js/banner.js></script><script src=/js/header-search.js></script></head><body class=mathjax_ignore><aside><div><div><a href=/><img src=/images/afp.png alt="Logo of the Archive of Formal Proofs" class=logo></a><ul><li><a href=/entries/awn>Return to entry</a></li></ul><hr><ul><li><a href=#Lib>Lib</a><ul><li><a href=#Lib-TT_True>TT_True</a></li><li><a href=#Lib-in_set_tl>in_set_tl</a></li><li><a href=#Lib-nat_le_eq_or_lt>nat_le_eq_or_lt</a></li><li><a href=#Lib-disjoint_commute>disjoint_commute</a></li></ul></li><li><a href=#TransitionSystems>TransitionSystems</a></li><li><a href=#Invariants>Invariants</a><ul><li><a href=#Invariants-reachable_pair_induct>reachable_pair_induct</a></li><li><a href=#Invariants-reachable_weakenE>reachable_weakenE</a></li><li><a href=#Invariants-reachable_weaken_TT>reachable_weaken_TT</a></li><li><a href=#Invariants-init_empty_reachable_empty>init_empty_reachable_empty</a></li><li><a href=#Invariants-invariantI>invariantI</a></li><li><a href=#Invariants-invariant_pairI>invariant_pairI</a></li><li><a href=#Invariants-invariant_arbitraryI>invariant_arbitraryI</a></li><li><a href=#Invariants-invariantD>invariantD</a></li><li><a href=#Invariants-invariant_initE>invariant_initE</a></li><li><a href=#Invariants-invariant_weakenE>invariant_weakenE</a></li><li><a href=#Invariants-invariant_restrict_inD>invariant_restrict_inD</a></li><li><a href=#Invariants-step_invariant_true>step_invariant_true</a></li><li><a href=#Invariants-step_invariantI>step_invariantI</a></li><li><a href=#Invariants-step_invariantD>step_invariantD</a></li><li><a href=#Invariants-step_invariantE>step_invariantE</a></li><li><a href=#Invariants-step_invariant_pairI>step_invariant_pairI</a></li><li><a href=#Invariants-step_invariant_arbitraryI>step_invariant_arbitraryI</a></li><li><a href=#Invariants-step_invariant_weakenE>step_invariant_weakenE</a></li><li><a href=#Invariants-step_invariant_weaken_with_invariantE>step_invariant_weaken_with_invariantE</a></li><li><a href=#Invariants-step_to_invariantI>step_to_invariantI</a></li></ul></li><li><a href=#OInvariants>OInvariants</a><ul><li><a href=#OInvariants-oreachable_local%27>oreachable_local'</a></li><li><a href=#OInvariants-oreachable_other%27>oreachable_other'</a></li><li><a href=#OInvariants-oreachable_pair_induct>oreachable_pair_induct</a></li><li><a href=#OInvariants-oreachable_weakenE>oreachable_weakenE</a></li><li><a href=#OInvariants-act_simp>act_simp</a></li><li><a href=#OInvariants-reachable_in_oreachable>reachable_in_oreachable</a></li><li><a href=#OInvariants-oinvariantI>oinvariantI</a></li><li><a href=#OInvariants-oinvariant_oreachableI>oinvariant_oreachableI</a></li><li><a href=#OInvariants-oinvariant_pairI>oinvariant_pairI</a></li><li><a href=#OInvariants-oinvariantD>oinvariantD</a></li><li><a href=#OInvariants-oinvariant_initD>oinvariant_initD</a></li><li><a href=#OInvariants-oinvariant_weakenE>oinvariant_weakenE</a></li><li><a href=#OInvariants-oinvariant_weakenD>oinvariant_weakenD</a></li><li><a href=#OInvariants-close_open_invariant>close_open_invariant</a></li><li><a href=#OInvariants-local_stepsI>local_stepsI</a></li><li><a href=#OInvariants-local_stepsE>local_stepsE</a></li><li><a href=#OInvariants-other_stepsI>other_stepsI</a></li><li><a href=#OInvariants-other_stepsE>other_stepsE</a></li><li><a href=#OInvariants-subreachableI>subreachableI</a></li><li><a href=#OInvariants-subreachableE>subreachableE</a></li><li><a href=#OInvariants-subreachableE_pair>subreachableE_pair</a></li><li><a href=#OInvariants-subreachable_otherE>subreachable_otherE</a></li><li><a href=#OInvariants-open_closed_invariant>open_closed_invariant</a></li><li><a href=#OInvariants-oinvariant_anyact>oinvariant_anyact</a></li><li><a href=#OInvariants-ostep_invariant_def%27>ostep_invariant_def'</a></li><li><a href=#OInvariants-ostep_invariantI>ostep_invariantI</a></li><li><a href=#OInvariants-ostep_invariantD>ostep_invariantD</a></li><li><a href=#OInvariants-ostep_invariantE>ostep_invariantE</a></li><li><a href=#OInvariants-ostep_invariant_weakenE>ostep_invariant_weakenE</a></li><li><a href=#OInvariants-ostep_invariant_weaken_with_invariantE>ostep_invariant_weaken_with_invariantE</a></li><li><a href=#OInvariants-ostep_to_invariantI>ostep_to_invariantI</a></li><li><a href=#OInvariants-open_closed_step_invariant>open_closed_step_invariant</a></li><li><a href=#OInvariants-oinvariant_step_anyact>oinvariant_step_anyact</a></li><li><a href=#OInvariants-otherwithI>otherwithI</a></li><li><a href=#OInvariants-otherwithE>otherwithE</a></li><li><a href=#OInvariants-otherwith_actionD>otherwith_actionD</a></li><li><a href=#OInvariants-otherwith_syncD>otherwith_syncD</a></li><li><a href=#OInvariants-otherwithEI>otherwithEI</a></li><li><a href=#OInvariants-all_but>all_but</a></li><li><a href=#OInvariants-all_but_eq>all_but_eq</a></li><li><a href=#OInvariants-otherI>otherI</a></li><li><a href=#OInvariants-otherE>otherE</a></li><li><a href=#OInvariants-other_localD>other_localD</a></li><li><a href=#OInvariants-other_otherD>other_otherD</a></li><li><a href=#OInvariants-other_bothE>other_bothE</a></li><li><a href=#OInvariants-weaken_local>weaken_local</a></li><li><a href=#OInvariants-globalsimp>globalsimp</a></li><li><a href=#OInvariants-globalasimp>globalasimp</a></li></ul></li><li><a href=#AWN>AWN</a><ul><li><a href=#AWN-not_call_simps>not_call_simps</a></li><li><a href=#AWN-not_choice_simps>not_choice_simps</a></li><li><a href=#AWN-seqp_congs>seqp_congs</a></li><li><a href=#AWN-subterms_refl>subterms_refl</a></li><li><a href=#AWN-subterms_trans>subterms_trans</a></li><li><a href=#AWN-root_in_subterms>root_in_subterms</a></li><li><a href=#AWN-deriv_in_subterms>deriv_in_subterms</a></li><li><a href=#AWN-recvmsg_simps>recvmsg_simps</a></li><li><a href=#AWN-recvmsgTT>recvmsgTT</a></li><li><a href=#AWN-recvmsgE>recvmsgE</a></li><li><a href=#AWN-anycast_simps>anycast_simps</a></li><li><a href=#AWN-orecvmsg_simps>orecvmsg_simps</a></li><li><a href=#AWN-orecvmsgEI>orecvmsgEI</a></li><li><a href=#AWN-orecvmsg_stateless_recvmsg>orecvmsg_stateless_recvmsg</a></li><li><a href=#AWN-orecvmsg_recv_weaken>orecvmsg_recv_weaken</a></li><li><a href=#AWN-orecvmsg_recvmsg>orecvmsg_recvmsg</a></li><li><a href=#AWN-sendmsg_simps>sendmsg_simps</a></li><li><a href=#AWN-arrivemsg_simps>arrivemsg_simps</a></li><li><a href=#AWN-arrivemsgTT>arrivemsgTT</a></li><li><a href=#AWN-oarrivemsg_simps>oarrivemsg_simps</a></li><li><a href=#AWN-oarrivemsg_True>oarrivemsg_True</a></li><li><a href=#AWN-castmsg_simps>castmsg_simps</a></li><li><a href=#AWN-net_tree_ips_commute>net_tree_ips_commute</a></li><li><a href=#AWN-wf_net_tree_children>wf_net_tree_children</a></li><li><a href=#AWN-not_in_netmap>not_in_netmap</a></li><li><a href=#AWN-netmap_none_not_in_net_ips>netmap_none_not_in_net_ips</a></li><li><a href=#AWN-net_ips_is_dom_netmap>net_ips_is_dom_netmap</a></li><li><a href=#AWN-in_netmap>in_netmap</a></li><li><a href=#AWN-netmap_subnets_same>netmap_subnets_same</a></li><li><a href=#AWN-netmap_subnets_samef>netmap_subnets_samef</a></li><li><a href=#AWN-netmap_add_disjoint>netmap_add_disjoint</a></li><li><a href=#AWN-netmap_add_disjoint2>netmap_add_disjoint2</a></li><li><a href=#AWN-net_ips_netmap_subnet>net_ips_netmap_subnet</a></li><li><a href=#AWN-inclosed_simps>inclosed_simps</a></li><li><a href=#AWN-netmask_def%27>netmask_def'</a></li><li><a href=#AWN-dom_fst_netgmap>dom_fst_netgmap</a></li><li><a href=#AWN-netgmap_pair_dom>netgmap_pair_dom</a></li><li><a href=#AWN-net_ips_netgmap>net_ips_netgmap</a></li><li><a href=#AWN-some_the_fst_netgmap>some_the_fst_netgmap</a></li><li><a href=#AWN-fst_netgmap_none>fst_netgmap_none</a></li><li><a href=#AWN-fst_netgmap_subnet>fst_netgmap_subnet</a></li><li><a href=#AWN-snd_netgmap_subnet>snd_netgmap_subnet</a></li><li><a href=#AWN-fst_netgmap_not_none>fst_netgmap_not_none</a></li><li><a href=#AWN-netgmap_netgmap_not_rhs>netgmap_netgmap_not_rhs</a></li><li><a href=#AWN-netgmap_netgmap_rhs>netgmap_netgmap_rhs</a></li><li><a href=#AWN-netgmap_netmask_subnets>netgmap_netmask_subnets</a></li><li><a href=#AWN-netgmap_netmask_subnets%27>netgmap_netmask_subnets'</a></li><li><a href=#AWN-netgmap_subnet_split1>netgmap_subnet_split1</a></li><li><a href=#AWN-netgmap_subnet_split2>netgmap_subnet_split2</a></li><li><a href=#AWN-netmap_fst_netgmap_rel>netmap_fst_netgmap_rel</a></li><li><a href=#AWN-netmap_is_fst_netgmap>netmap_is_fst_netgmap</a></li><li><a href=#AWN-netmap_is_fst_netgmap%27>netmap_is_fst_netgmap'</a></li><li><a href=#AWN-fst_netgmap_pair_fst>fst_netgmap_pair_fst</a></li><li><a href=#AWN-fst_netgmap_netlift>fst_netgmap_netlift</a></li><li><a href=#AWN-snd_netgmap_netliftl>snd_netgmap_netliftl</a></li><li><a href=#AWN-netgmap_netlift_netliftl>netgmap_netlift_netliftl</a></li></ul></li><li><a href=#AWN_SOS>AWN_SOS</a><ul><li><a href=#AWN_SOS-seqp_broadcastTE>seqp_broadcastTE</a></li><li><a href=#AWN_SOS-seqp_groupcastTE>seqp_groupcastTE</a></li><li><a href=#AWN_SOS-seqp_unicastTE>seqp_unicastTE</a></li><li><a href=#AWN_SOS-seqp_sendTE>seqp_sendTE</a></li><li><a href=#AWN_SOS-seqp_deliverTE>seqp_deliverTE</a></li><li><a href=#AWN_SOS-seqp_receiveTE>seqp_receiveTE</a></li><li><a href=#AWN_SOS-seqp_assignTE>seqp_assignTE</a></li><li><a href=#AWN_SOS-seqp_guardTE>seqp_guardTE</a></li><li><a href=#AWN_SOS-par_broadcastTE>par_broadcastTE</a></li><li><a href=#AWN_SOS-par_groupcastTE>par_groupcastTE</a></li><li><a href=#AWN_SOS-par_unicastTE>par_unicastTE</a></li><li><a href=#AWN_SOS-par_notunicastTE>par_notunicastTE</a></li><li><a href=#AWN_SOS-par_sendTE>par_sendTE</a></li><li><a href=#AWN_SOS-par_deliverTE>par_deliverTE</a></li><li><a href=#AWN_SOS-par_receiveTE>par_receiveTE</a></li><li><a href=#AWN_SOS-parp_sos_cases>parp_sos_cases</a></li><li><a href=#AWN_SOS-trans_par_comp>trans_par_comp</a></li><li><a href=#AWN_SOS-init_par_comp>init_par_comp</a></li><li><a href=#AWN_SOS-node_sos_never_newpkt>node_sos_never_newpkt</a></li><li><a href=#AWN_SOS-arrives_or_not>arrives_or_not</a></li><li><a href=#AWN_SOS-trans_node_comp>trans_node_comp</a></li><li><a href=#AWN_SOS-init_node_comp>init_node_comp</a></li><li><a href=#AWN_SOS-trans_par_node_comp>trans_par_node_comp</a></li><li><a href=#AWN_SOS-snd_par_node_comp>snd_par_node_comp</a></li><li><a href=#AWN_SOS-node_sos_dest_is_net_state>node_sos_dest_is_net_state</a></li><li><a href=#AWN_SOS-node_sos_dest>node_sos_dest</a></li><li><a href=#AWN_SOS-node_sos_states>node_sos_states</a></li><li><a href=#AWN_SOS-node_sos_cases>node_sos_cases</a></li><li><a href=#AWN_SOS-pnet_sos_never_newpkt>pnet_sos_never_newpkt</a></li><li><a href=#AWN_SOS-pnet_node_init>pnet_node_init</a></li><li><a href=#AWN_SOS-pnet_node_init%27>pnet_node_init'</a></li><li><a href=#AWN_SOS-pnet_node_trans>pnet_node_trans</a></li><li><a href=#AWN_SOS-pnet_never_newpkt%27>pnet_never_newpkt'</a></li><li><a href=#AWN_SOS-pnet_never_newpkt>pnet_never_newpkt</a></li><li><a href=#AWN_SOS-complete_no_cast>complete_no_cast</a></li><li><a href=#AWN_SOS-complete_no_arrive>complete_no_arrive</a></li></ul></li><li><a href=#AWN_Cterms>AWN_Cterms</a><ul><li><a href=#AWN_Cterms-microstep_choiceD>microstep_choiceD</a></li><li><a href=#AWN_Cterms-microstep_choiceE>microstep_choiceE</a></li><li><a href=#AWN_Cterms-microstep_callD>microstep_callD</a></li><li><a href=#AWN_Cterms-microstep_callE>microstep_callE</a></li><li><a href=#AWN_Cterms-no_microstep_guard>no_microstep_guard</a></li><li><a href=#AWN_Cterms-no_microstep_assign>no_microstep_assign</a></li><li><a href=#AWN_Cterms-no_microstep_unicast>no_microstep_unicast</a></li><li><a href=#AWN_Cterms-no_microstep_broadcast>no_microstep_broadcast</a></li><li><a href=#AWN_Cterms-no_microstep_groupcast>no_microstep_groupcast</a></li><li><a href=#AWN_Cterms-no_microstep_send>no_microstep_send</a></li><li><a href=#AWN_Cterms-no_microstep_deliver>no_microstep_deliver</a></li><li><a href=#AWN_Cterms-no_microstep_receive>no_microstep_receive</a></li><li><a href=#AWN_Cterms-microstep_call_or_choice>microstep_call_or_choice</a></li><li><a href=#AWN_Cterms-wellformed_defP>wellformed_defP</a></li><li><a href=#AWN_Cterms-wellformed_induct>wellformed_induct</a></li><li><a href=#AWN_Cterms-stermsl_nobigger>stermsl_nobigger</a></li><li><a href=#AWN_Cterms-stermsl_no_choice>stermsl_no_choice</a></li><li><a href=#AWN_Cterms-stermsl_choice_disj>stermsl_choice_disj</a></li><li><a href=#AWN_Cterms-stermsl_in_branch>stermsl_in_branch</a></li><li><a href=#AWN_Cterms-stermsl_commute>stermsl_commute</a></li><li><a href=#AWN_Cterms-stermsl_not_empty>stermsl_not_empty</a></li><li><a href=#AWN_Cterms-stermsl_idem>stermsl_idem</a></li><li><a href=#AWN_Cterms-stermsl_in_wfpf>stermsl_in_wfpf</a></li><li><a href=#AWN_Cterms-nocall_stermsl_max>nocall_stermsl_max</a></li><li><a href=#AWN_Cterms-sterms_dom_basic>sterms_dom_basic</a></li><li><a href=#AWN_Cterms-sterms_termination>sterms_termination</a></li><li><a href=#AWN_Cterms-sterms_reflD>sterms_reflD</a></li><li><a href=#AWN_Cterms-sterms_choice_disj>sterms_choice_disj</a></li><li><a href=#AWN_Cterms-sterms_no_choice>sterms_no_choice</a></li><li><a href=#AWN_Cterms-sterms_not_choice>sterms_not_choice</a></li><li><a href=#AWN_Cterms-sterms_no_call>sterms_no_call</a></li><li><a href=#AWN_Cterms-sterms_not_call>sterms_not_call</a></li><li><a href=#AWN_Cterms-sterms_in_branch>sterms_in_branch</a></li><li><a href=#AWN_Cterms-sterms_commute>sterms_commute</a></li><li><a href=#AWN_Cterms-sterms_not_empty>sterms_not_empty</a></li><li><a href=#AWN_Cterms-sterms_sterms>sterms_sterms</a></li><li><a href=#AWN_Cterms-sterms_stermsl>sterms_stermsl</a></li><li><a href=#AWN_Cterms-stermsl_sterms>stermsl_sterms</a></li><li><a href=#AWN_Cterms-sterms_stermsl_heads>sterms_stermsl_heads</a></li><li><a href=#AWN_Cterms-sterms_subterms>sterms_subterms</a></li><li><a href=#AWN_Cterms-no_microsteps_sterms_refl>no_microsteps_sterms_refl</a></li><li><a href=#AWN_Cterms-sterms_maximal>sterms_maximal</a></li><li><a href=#AWN_Cterms-microstep_rtranscl_equal>microstep_rtranscl_equal</a></li><li><a href=#AWN_Cterms-microstep_rtranscl_singleton>microstep_rtranscl_singleton</a></li><li><a href=#AWN_Cterms-dterms_dom_basic>dterms_dom_basic</a></li><li><a href=#AWN_Cterms-dterms_termination>dterms_termination</a></li><li><a href=#AWN_Cterms-sterms_after_dterms>sterms_after_dterms</a></li><li><a href=#AWN_Cterms-sterms_before_dterms>sterms_before_dterms</a></li><li><a href=#AWN_Cterms-dterms_choice_disj>dterms_choice_disj</a></li><li><a href=#AWN_Cterms-dterms_in_branch>dterms_in_branch</a></li><li><a href=#AWN_Cterms-dterms_no_choice>dterms_no_choice</a></li><li><a href=#AWN_Cterms-dterms_not_choice>dterms_not_choice</a></li><li><a href=#AWN_Cterms-dterms_no_call>dterms_no_call</a></li><li><a href=#AWN_Cterms-dterms_not_call>dterms_not_call</a></li><li><a href=#AWN_Cterms-dterms_subterms>dterms_subterms</a></li><li><a href=#AWN_Cterms-cterms_not_choice>cterms_not_choice</a></li><li><a href=#AWN_Cterms-cterms_no_choice>cterms_no_choice</a></li><li><a href=#AWN_Cterms-cterms_not_call>cterms_not_call</a></li><li><a href=#AWN_Cterms-cterms_no_call>cterms_no_call</a></li><li><a href=#AWN_Cterms-sterms_cterms>sterms_cterms</a></li><li><a href=#AWN_Cterms-dterms_cterms>dterms_cterms</a></li><li><a href=#AWN_Cterms-derivs_in_cterms>derivs_in_cterms</a></li><li><a href=#AWN_Cterms-ctermsl_refl>ctermsl_refl</a></li><li><a href=#AWN_Cterms-ctermsl_subterms>ctermsl_subterms</a></li><li><a href=#AWN_Cterms-ctermsl_trans>ctermsl_trans</a></li><li><a href=#AWN_Cterms-ctermsl_ex_trans>ctermsl_ex_trans</a></li><li><a href=#AWN_Cterms-call_ctermsl_empty>call_ctermsl_empty</a></li><li><a href=#AWN_Cterms-stermsl_ctermsl_choice1>stermsl_ctermsl_choice1</a></li><li><a href=#AWN_Cterms-stermsl_ctermsl_choice2>stermsl_ctermsl_choice2</a></li><li><a href=#AWN_Cterms-stermsl_ctermsl>stermsl_ctermsl</a></li><li><a href=#AWN_Cterms-stermsl_after_ctermsl>stermsl_after_ctermsl</a></li><li><a href=#AWN_Cterms-stermsl_before_ctermsl>stermsl_before_ctermsl</a></li><li><a href=#AWN_Cterms-ctermsl_no_choice>ctermsl_no_choice</a></li><li><a href=#AWN_Cterms-ctermsl_ex_stermsl>ctermsl_ex_stermsl</a></li><li><a href=#AWN_Cterms-dterms_ctermsl>dterms_ctermsl</a></li><li><a href=#AWN_Cterms-ctermsl_cterms>ctermsl_cterms</a></li><li><a href=#AWN_Cterms-stermsl_after_dtermsl>stermsl_after_dtermsl</a></li><li><a href=#AWN_Cterms-stermsl_before_dtermsl>stermsl_before_dtermsl</a></li><li><a href=#AWN_Cterms-dtermsl_no_choice>dtermsl_no_choice</a></li><li><a href=#AWN_Cterms-dtermsl_choice_disj>dtermsl_choice_disj</a></li><li><a href=#AWN_Cterms-dtermsl_in_branch>dtermsl_in_branch</a></li><li><a href=#AWN_Cterms-ctermsl_dtermsl>ctermsl_dtermsl</a></li><li><a href=#AWN_Cterms-dtermsl_dterms>dtermsl_dterms</a></li><li><a href=#AWN_Cterms-ctermsl_stermsl_or_dtermsl>ctermsl_stermsl_or_dtermsl</a></li><li><a href=#AWN_Cterms-dtermsl_add_stermsl_beforeD>dtermsl_add_stermsl_beforeD</a></li><li><a href=#AWN_Cterms-call_dtermsl_empty>call_dtermsl_empty</a></li><li><a href=#AWN_Cterms-ctermsE>ctermsE</a></li><li><a href=#AWN_Cterms-subterms_in_cterms>subterms_in_cterms</a></li><li><a href=#AWN_Cterms-subterms_stermsl_ctermsl>subterms_stermsl_ctermsl</a></li><li><a href=#AWN_Cterms-subterms_sterms_cterms>subterms_sterms_cterms</a></li><li><a href=#AWN_Cterms-subterms_sterms_in_cterms>subterms_sterms_in_cterms</a></li></ul></li><li><a href=#AWN_Labels>AWN_Labels</a><ul><li><a href=#AWN_Labels-labels_dom_basic>labels_dom_basic</a></li><li><a href=#AWN_Labels-labels_termination>labels_termination</a></li><li><a href=#AWN_Labels-labels_not_empty>labels_not_empty</a></li><li><a href=#AWN_Labels-has_label>has_label</a></li><li><a href=#AWN_Labels-singleton_labels>singleton_labels</a></li><li><a href=#AWN_Labels-in_labels_singletons>in_labels_singletons</a></li><li><a href=#AWN_Labels-simple_labelsI>simple_labelsI</a></li><li><a href=#AWN_Labels-simple_labels_in_sterms>simple_labels_in_sterms</a></li><li><a href=#AWN_Labels-labels_in_sterms>labels_in_sterms</a></li><li><a href=#AWN_Labels-labels_sterms_labels>labels_sterms_labels</a></li></ul></li><li><a href=#Inv_Cterms>Inv_Cterms</a><ul><li><a href=#Inv_Cterms-has_ctermsl>has_ctermsl</a></li></ul></li><li><a href=#AWN_SOS_Labels>AWN_SOS_Labels</a><ul><li><a href=#AWN_SOS_Labels-elimder_guard>elimder_guard</a></li><li><a href=#AWN_SOS_Labels-elimder_assign>elimder_assign</a></li><li><a href=#AWN_SOS_Labels-elimder_ucast>elimder_ucast</a></li><li><a href=#AWN_SOS_Labels-elimder_bcast>elimder_bcast</a></li><li><a href=#AWN_SOS_Labels-elimder_gcast>elimder_gcast</a></li><li><a href=#AWN_SOS_Labels-elimder_send>elimder_send</a></li><li><a href=#AWN_SOS_Labels-elimder_deliver>elimder_deliver</a></li><li><a href=#AWN_SOS_Labels-elimder_receive>elimder_receive</a></li></ul></li><li><a href=#Pnet>Pnet</a><ul><li><a href=#Pnet-pnet_maintains_dom>pnet_maintains_dom</a></li><li><a href=#Pnet-pnet_net_ips_net_tree_ips>pnet_net_ips_net_tree_ips</a></li><li><a href=#Pnet-pnet_init_net_ips_net_tree_ips>pnet_init_net_ips_net_tree_ips</a></li><li><a href=#Pnet-pnet_init_in_net_ips_in_net_tree_ips>pnet_init_in_net_ips_in_net_tree_ips</a></li><li><a href=#Pnet-pnet_init_in_net_tree_ips_in_net_ips>pnet_init_in_net_tree_ips_in_net_ips</a></li><li><a href=#Pnet-pnet_init_not_in_net_tree_ips_not_in_net_ips>pnet_init_not_in_net_tree_ips_not_in_net_ips</a></li><li><a href=#Pnet-net_node_reachable_is_node>net_node_reachable_is_node</a></li><li><a href=#Pnet-partial_net_preserves_subnets>partial_net_preserves_subnets</a></li><li><a href=#Pnet-net_par_reachable_is_subnet>net_par_reachable_is_subnet</a></li><li><a href=#Pnet-reachable_par_subnet_induct>reachable_par_subnet_induct</a></li><li><a href=#Pnet-subnet_reachable>subnet_reachable</a></li><li><a href=#Pnet-delivered_to_node>delivered_to_node</a></li><li><a href=#Pnet-delivered_to_net_ips>delivered_to_net_ips</a></li><li><a href=#Pnet-wf_net_tree_net_ips_disjoint>wf_net_tree_net_ips_disjoint</a></li><li><a href=#Pnet-init_mapstate_Some_aodv_init>init_mapstate_Some_aodv_init</a></li><li><a href=#Pnet-reachable_connect_netmap>reachable_connect_netmap</a></li><li><a href=#Pnet-reachable_disconnect_netmap>reachable_disconnect_netmap</a></li><li><a href=#Pnet-pnet_tau_single_node>pnet_tau_single_node</a></li><li><a href=#Pnet-pnet_deliver_single_node>pnet_deliver_single_node</a></li></ul></li><li><a href=#Closed>Closed</a><ul><li><a href=#Closed-complete_net_preserves_subnets>complete_net_preserves_subnets</a></li><li><a href=#Closed-complete_net_reachable_is_subnet>complete_net_reachable_is_subnet</a></li><li><a href=#Closed-closed_reachable_par_subnet_induct>closed_reachable_par_subnet_induct</a></li><li><a href=#Closed-reachable_closed_reachable_pnet>reachable_closed_reachable_pnet</a></li><li><a href=#Closed-closed_node_net_state>closed_node_net_state</a></li><li><a href=#Closed-closed_subnet_net_state>closed_subnet_net_state</a></li><li><a href=#Closed-closed_imp_pnet_trans>closed_imp_pnet_trans</a></li><li><a href=#Closed-reachable_not_in_net_tree_ips>reachable_not_in_net_tree_ips</a></li><li><a href=#Closed-closed_pnet_aodv_init>closed_pnet_aodv_init</a></li></ul></li><li><a href=#OAWN_SOS>OAWN_SOS</a><ul><li><a href=#OAWN_SOS-oseq_broadcastTE>oseq_broadcastTE</a></li><li><a href=#OAWN_SOS-oseq_groupcastTE>oseq_groupcastTE</a></li><li><a href=#OAWN_SOS-oseq_unicastTE>oseq_unicastTE</a></li><li><a href=#OAWN_SOS-oseq_sendTE>oseq_sendTE</a></li><li><a href=#OAWN_SOS-oseq_deliverTE>oseq_deliverTE</a></li><li><a href=#OAWN_SOS-oseq_receiveTE>oseq_receiveTE</a></li><li><a href=#OAWN_SOS-oseq_assignTE>oseq_assignTE</a></li><li><a href=#OAWN_SOS-oseq_guardTE>oseq_guardTE</a></li><li><a href=#OAWN_SOS-opar_broadcastTE>opar_broadcastTE</a></li><li><a href=#OAWN_SOS-opar_groupcastTE>opar_groupcastTE</a></li><li><a href=#OAWN_SOS-opar_unicastTE>opar_unicastTE</a></li><li><a href=#OAWN_SOS-opar_notunicastTE>opar_notunicastTE</a></li><li><a href=#OAWN_SOS-opar_sendTE>opar_sendTE</a></li><li><a href=#OAWN_SOS-opar_deliverTE>opar_deliverTE</a></li><li><a href=#OAWN_SOS-opar_receiveTE>opar_receiveTE</a></li><li><a href=#OAWN_SOS-oparp_sos_cases>oparp_sos_cases</a></li><li><a href=#OAWN_SOS-extgsimp>extgsimp</a></li><li><a href=#OAWN_SOS-extg_range_prod>extg_range_prod</a></li><li><a href=#OAWN_SOS-opar_comp_def%27>opar_comp_def'</a></li><li><a href=#OAWN_SOS-trans_opar_comp>trans_opar_comp</a></li><li><a href=#OAWN_SOS-init_opar_comp>init_opar_comp</a></li><li><a href=#OAWN_SOS-oarrives_or_not>oarrives_or_not</a></li><li><a href=#OAWN_SOS-trans_onode_comp>trans_onode_comp</a></li><li><a href=#OAWN_SOS-init_onode_comp>init_onode_comp</a></li><li><a href=#OAWN_SOS-fst_par_onode_comp>fst_par_onode_comp</a></li><li><a href=#OAWN_SOS-init_par_onode_comp>init_par_onode_comp</a></li><li><a href=#OAWN_SOS-onode_sos_dest_is_net_state>onode_sos_dest_is_net_state</a></li><li><a href=#OAWN_SOS-onode_sos_dest_is_net_state%27>onode_sos_dest_is_net_state'</a></li><li><a href=#OAWN_SOS-onode_sos_dest_is_net_state%27%27>onode_sos_dest_is_net_state''</a></li><li><a href=#OAWN_SOS-onode_sos_src_is_net_state>onode_sos_src_is_net_state</a></li><li><a href=#OAWN_SOS-onode_sos_net_states>onode_sos_net_states</a></li><li><a href=#OAWN_SOS-node_sos_cases>node_sos_cases</a></li><li><a href=#OAWN_SOS-opnet_node_init>opnet_node_init</a></li><li><a href=#OAWN_SOS-opnet_node_init%27>opnet_node_init'</a></li><li><a href=#OAWN_SOS-opnet_node_trans>opnet_node_trans</a></li><li><a href=#OAWN_SOS-ocomplete_no_cast>ocomplete_no_cast</a></li><li><a href=#OAWN_SOS-ocomplete_no_arrive>ocomplete_no_arrive</a></li><li><a href=#OAWN_SOS-ocomplete_no_change>ocomplete_no_change</a></li><li><a href=#OAWN_SOS-ocomplete_transE>ocomplete_transE</a></li></ul></li><li><a href=#OAWN_SOS_Labels>OAWN_SOS_Labels</a><ul><li><a href=#OAWN_SOS_Labels-oelimder_guard>oelimder_guard</a></li><li><a href=#OAWN_SOS_Labels-oelimder_assign>oelimder_assign</a></li><li><a href=#OAWN_SOS_Labels-oelimder_ucast>oelimder_ucast</a></li><li><a href=#OAWN_SOS_Labels-oelimder_bcast>oelimder_bcast</a></li><li><a href=#OAWN_SOS_Labels-oelimder_gcast>oelimder_gcast</a></li><li><a href=#OAWN_SOS_Labels-oelimder_send>oelimder_send</a></li><li><a href=#OAWN_SOS_Labels-oelimder_deliver>oelimder_deliver</a></li><li><a href=#OAWN_SOS_Labels-oelimder_receive>oelimder_receive</a></li></ul></li><li><a href=#OPnet>OPnet</a><ul><li><a href=#OPnet-opnet_maintains_dom>opnet_maintains_dom</a></li><li><a href=#OPnet-opnet_net_ips_net_tree_ips>opnet_net_ips_net_tree_ips</a></li><li><a href=#OPnet-opnet_net_ips_net_tree_ips_init>opnet_net_ips_net_tree_ips_init</a></li><li><a href=#OPnet-opartial_net_preserves_subnets>opartial_net_preserves_subnets</a></li><li><a href=#OPnet-net_par_oreachable_is_subnet>net_par_oreachable_is_subnet</a></li></ul></li><li><a href=#ONode_Lifting>ONode_Lifting</a><ul><li><a href=#ONode_Lifting-node_net_state%27>node_net_state'</a></li><li><a href=#ONode_Lifting-node_net_state>node_net_state</a></li><li><a href=#ONode_Lifting-node_net_state_trans>node_net_state_trans</a></li><li><a href=#ONode_Lifting-nodemap_induct%27>nodemap_induct'</a></li><li><a href=#ONode_Lifting-nodemap_induct>nodemap_induct</a></li><li><a href=#ONode_Lifting-node_addressD>node_addressD</a></li><li><a href=#ONode_Lifting-node_proc_reachable>node_proc_reachable</a></li><li><a href=#ONode_Lifting-node_proc_reachable_statelessassm>node_proc_reachable_statelessassm</a></li><li><a href=#ONode_Lifting-node_lift>node_lift</a></li><li><a href=#ONode_Lifting-node_lift_step>node_lift_step</a></li><li><a href=#ONode_Lifting-node_lift_step_statelessassm>node_lift_step_statelessassm</a></li><li><a href=#ONode_Lifting-node_lift_anycast>node_lift_anycast</a></li><li><a href=#ONode_Lifting-node_lift_anycast_statelessassm>node_lift_anycast_statelessassm</a></li><li><a href=#ONode_Lifting-node_local_deliver>node_local_deliver</a></li><li><a href=#ONode_Lifting-node_tau_deliver_unchanged>node_tau_deliver_unchanged</a></li></ul></li><li><a href=#OPnet_Lifting>OPnet_Lifting</a><ul><li><a href=#OPnet_Lifting-oreachable_par_subnet_induct>oreachable_par_subnet_induct</a></li><li><a href=#OPnet_Lifting-other_net_tree_ips_par_left>other_net_tree_ips_par_left</a></li><li><a href=#OPnet_Lifting-other_net_tree_ips_par_right>other_net_tree_ips_par_right</a></li><li><a href=#OPnet_Lifting-ostep_arrive_invariantD>ostep_arrive_invariantD</a></li><li><a href=#OPnet_Lifting-opnet_sync_action_subnet_oreachable>opnet_sync_action_subnet_oreachable</a></li><li><a href=#OPnet_Lifting-subnet_oreachable_true_true>subnet_oreachable_true_true</a></li><li><a href=#OPnet_Lifting-lift_opnet_sync_action>lift_opnet_sync_action</a></li></ul></li><li><a href=#OClosed_Lifting>OClosed_Lifting</a><ul><li><a href=#OClosed_Lifting-trans_fst_oclosed_fst1>trans_fst_oclosed_fst1</a></li><li><a href=#OClosed_Lifting-trans_fst_oclosed_fst2>trans_fst_oclosed_fst2</a></li><li><a href=#OClosed_Lifting-trans_fst_oclosed_fst3>trans_fst_oclosed_fst3</a></li><li><a href=#OClosed_Lifting-oclosed_oreachable_inclosed>oclosed_oreachable_inclosed</a></li><li><a href=#OClosed_Lifting-oclosed_oreachable_oreachable>oclosed_oreachable_oreachable</a></li><li><a href=#OClosed_Lifting-inclosed_closed>inclosed_closed</a></li></ul></li><li><a href=#AWN_Invariants>AWN_Invariants</a><ul><li><a href=#AWN_Invariants-control_withinI>control_withinI</a></li><li><a href=#AWN_Invariants-control_withinD>control_withinD</a></li><li><a href=#AWN_Invariants-control_within_topI>control_within_topI</a></li><li><a href=#AWN_Invariants-seqp_sos_subterms>seqp_sos_subterms</a></li><li><a href=#AWN_Invariants-reachable_subterms>reachable_subterms</a></li><li><a href=#AWN_Invariants-onlI>onlI</a></li><li><a href=#AWN_Invariants-onlD>onlD</a></li><li><a href=#AWN_Invariants-onl_invariantI>onl_invariantI</a></li><li><a href=#AWN_Invariants-onl_invariantD>onl_invariantD</a></li><li><a href=#AWN_Invariants-onl_invariant_initD>onl_invariant_initD</a></li><li><a href=#AWN_Invariants-onl_invariant_sterms>onl_invariant_sterms</a></li><li><a href=#AWN_Invariants-onl_invariant_sterms_weaken>onl_invariant_sterms_weaken</a></li><li><a href=#AWN_Invariants-onl_invariant_sterms_TT>onl_invariant_sterms_TT</a></li><li><a href=#AWN_Invariants-trans_from_sterms>trans_from_sterms</a></li><li><a href=#AWN_Invariants-trans_from_sterms%27>trans_from_sterms'</a></li><li><a href=#AWN_Invariants-trans_to_dterms>trans_to_dterms</a></li><li><a href=#AWN_Invariants-seq_invariant_ctermI>seq_invariant_ctermI</a></li><li><a href=#AWN_Invariants-seq_invariant_ctermsI>seq_invariant_ctermsI</a></li><li><a href=#AWN_Invariants-onllI>onllI</a></li><li><a href=#AWN_Invariants-onllIl>onllIl</a></li><li><a href=#AWN_Invariants-onllD>onllD</a></li><li><a href=#AWN_Invariants-onl_weaken>onl_weaken</a></li><li><a href=#AWN_Invariants-onll_weaken>onll_weaken</a></li><li><a href=#AWN_Invariants-onll_weaken%27>onll_weaken'</a></li><li><a href=#AWN_Invariants-onll_step_invariantI>onll_step_invariantI</a></li><li><a href=#AWN_Invariants-onll_step_invariantE>onll_step_invariantE</a></li><li><a href=#AWN_Invariants-onll_step_invariantD>onll_step_invariantD</a></li><li><a href=#AWN_Invariants-onll_step_to_invariantI>onll_step_to_invariantI</a></li><li><a href=#AWN_Invariants-onll_step_invariant_sterms>onll_step_invariant_sterms</a></li><li><a href=#AWN_Invariants-seq_step_invariant_sterms>seq_step_invariant_sterms</a></li><li><a href=#AWN_Invariants-seq_step_invariant_sterms_weaken>seq_step_invariant_sterms_weaken</a></li><li><a href=#AWN_Invariants-seq_step_invariant_sterms_TT>seq_step_invariant_sterms_TT</a></li><li><a href=#AWN_Invariants-onll_step_invariant_any_sterms>onll_step_invariant_any_sterms</a></li><li><a href=#AWN_Invariants-seq_step_invariant_ctermI>seq_step_invariant_ctermI</a></li><li><a href=#AWN_Invariants-seq_step_invariant_ctermsI>seq_step_invariant_ctermsI</a></li></ul></li><li><a href=#OAWN_Invariants>OAWN_Invariants</a><ul><li><a href=#OAWN_Invariants-oseqp_sos_subterms>oseqp_sos_subterms</a></li><li><a href=#OAWN_Invariants-oreachable_subterms>oreachable_subterms</a></li><li><a href=#OAWN_Invariants-onl_oinvariantI>onl_oinvariantI</a></li><li><a href=#OAWN_Invariants-global_oinvariantI>global_oinvariantI</a></li><li><a href=#OAWN_Invariants-onl_oinvariantD>onl_oinvariantD</a></li><li><a href=#OAWN_Invariants-onl_oinvariant_weakenD>onl_oinvariant_weakenD</a></li><li><a href=#OAWN_Invariants-onl_oinvariant_initD>onl_oinvariant_initD</a></li><li><a href=#OAWN_Invariants-onl_oinvariant_sterms>onl_oinvariant_sterms</a></li><li><a href=#OAWN_Invariants-onl_oinvariant_sterms_weaken>onl_oinvariant_sterms_weaken</a></li><li><a href=#OAWN_Invariants-otrans_from_sterms>otrans_from_sterms</a></li><li><a href=#OAWN_Invariants-otrans_from_sterms%27>otrans_from_sterms'</a></li><li><a href=#OAWN_Invariants-otrans_to_dterms>otrans_to_dterms</a></li><li><a href=#OAWN_Invariants-oseq_invariant_ctermI>oseq_invariant_ctermI</a></li><li><a href=#OAWN_Invariants-oseq_invariant_ctermsI>oseq_invariant_ctermsI</a></li><li><a href=#OAWN_Invariants-onll_ostep_invariantI>onll_ostep_invariantI</a></li><li><a href=#OAWN_Invariants-onll_ostep_invariantE>onll_ostep_invariantE</a></li><li><a href=#OAWN_Invariants-onll_ostep_invariantD>onll_ostep_invariantD</a></li><li><a href=#OAWN_Invariants-onll_ostep_invariant_weakenD>onll_ostep_invariant_weakenD</a></li><li><a href=#OAWN_Invariants-onll_ostep_to_invariantI>onll_ostep_to_invariantI</a></li><li><a href=#OAWN_Invariants-onll_ostep_invariant_sterms>onll_ostep_invariant_sterms</a></li><li><a href=#OAWN_Invariants-oseq_step_invariant_sterms>oseq_step_invariant_sterms</a></li><li><a href=#OAWN_Invariants-oseq_step_invariant_sterms_weaken>oseq_step_invariant_sterms_weaken</a></li><li><a href=#OAWN_Invariants-onll_ostep_invariant_any_sterms>onll_ostep_invariant_any_sterms</a></li><li><a href=#OAWN_Invariants-oseq_step_invariant_ctermI>oseq_step_invariant_ctermI</a></li><li><a href=#OAWN_Invariants-oseq_step_invariant_ctermsI>oseq_step_invariant_ctermsI</a></li><li><a href=#OAWN_Invariants-open_seqp_action>open_seqp_action</a></li></ul></li><li><a href=#OAWN_Convert>OAWN_Convert</a><ul><li><a href=#OAWN_Convert-initialiI>initialiI</a></li><li><a href=#OAWN_Convert-open_from_initialiD>open_from_initialiD</a></li><li><a href=#OAWN_Convert-closed_from_initialiD>closed_from_initialiD</a></li><li><a href=#OAWN_Convert-seqlI>seqlI</a></li><li><a href=#OAWN_Convert-same_seql>same_seql</a></li><li><a href=#OAWN_Convert-seqlsimp>seqlsimp</a></li><li><a href=#OAWN_Convert-other_steps_resp_local>other_steps_resp_local</a></li><li><a href=#OAWN_Convert-seql_onl_swap>seql_onl_swap</a></li><li><a href=#OAWN_Convert-oseqp_sos_resp_local_steps>oseqp_sos_resp_local_steps</a></li><li><a href=#OAWN_Convert-oseqp_sos_subreachable>oseqp_sos_subreachable</a></li><li><a href=#OAWN_Convert-oseq_step_is_seq_step>oseq_step_is_seq_step</a></li><li><a href=#OAWN_Convert-reachable_oseq_seqp_sos>reachable_oseq_seqp_sos</a></li><li><a href=#OAWN_Convert-reachable_oseq_seqp_sos%27>reachable_oseq_seqp_sos'</a></li><li><a href=#OAWN_Convert-same_seqll>same_seqll</a></li><li><a href=#OAWN_Convert-seqllI>seqllI</a></li><li><a href=#OAWN_Convert-seqllD>seqllD</a></li><li><a href=#OAWN_Convert-seqllsimp>seqllsimp</a></li><li><a href=#OAWN_Convert-seqll_onll_swap>seqll_onll_swap</a></li></ul></li><li><a href=#Qmsg>Qmsg</a><ul><li><a href=#Qmsg-%cf%83>σ</a></li><li><a href=#Qmsg-%cf%83>σ</a></li><li><a href=#Qmsg-qmsg_wf>qmsg_wf</a></li><li><a href=#Qmsg-qmsg_control_within>qmsg_control_within</a></li><li><a href=#Qmsg-qmsg_simple_labels>qmsg_simple_labels</a></li><li><a href=#Qmsg-qmsg_trans>qmsg_trans</a></li><li><a href=#Qmsg-%cf%83>σ</a></li><li><a href=#Qmsg-qmsg_proc_cases>qmsg_proc_cases</a></li></ul></li><li><a href=#Qmsg_Lifting>Qmsg_Lifting</a><ul><li><a href=#Qmsg_Lifting-oseq_no_change_on_send>oseq_no_change_on_send</a></li><li><a href=#Qmsg_Lifting-qmsg_no_change_on_send_or_receive>qmsg_no_change_on_send_or_receive</a></li><li><a href=#Qmsg_Lifting-qmsg_msgs_not_empty>qmsg_msgs_not_empty</a></li><li><a href=#Qmsg_Lifting-qmsg_send_from_queue>qmsg_send_from_queue</a></li><li><a href=#Qmsg_Lifting-qmsg_queue_contents>qmsg_queue_contents</a></li><li><a href=#Qmsg_Lifting-qmsg_send_receive_or_tau>qmsg_send_receive_or_tau</a></li><li><a href=#Qmsg_Lifting-par_qmsg_oreachable>par_qmsg_oreachable</a></li><li><a href=#Qmsg_Lifting-par_qmsg_oreachable_statelessassm>par_qmsg_oreachable_statelessassm</a></li><li><a href=#Qmsg_Lifting-lift_into_qmsg>lift_into_qmsg</a></li><li><a href=#Qmsg_Lifting-lift_step_into_qmsg>lift_step_into_qmsg</a></li><li><a href=#Qmsg_Lifting-lift_step_into_qmsg_statelessassm>lift_step_into_qmsg_statelessassm</a></li></ul></li><li><a href=#OClosed_Transfer>OClosed_Transfer</a><ul><li><a href=#OClosed_Transfer-init_pnet_p_NodeS>init_pnet_p_NodeS</a></li><li><a href=#OClosed_Transfer-init_pnet_p_SubnetS>init_pnet_p_SubnetS</a></li><li><a href=#OClosed_Transfer-init_pnet_fst_sr_netgmap>init_pnet_fst_sr_netgmap</a></li><li><a href=#OClosed_Transfer-init_lifted>init_lifted</a></li><li><a href=#OClosed_Transfer-init_pnet_opnet>init_pnet_opnet</a></li><li><a href=#OClosed_Transfer-transfer_connect>transfer_connect</a></li><li><a href=#OClosed_Transfer-transfer_disconnect>transfer_disconnect</a></li><li><a href=#OClosed_Transfer-transfer_tau>transfer_tau</a></li><li><a href=#OClosed_Transfer-transfer_deliver>transfer_deliver</a></li><li><a href=#OClosed_Transfer-transfer_arrive%27>transfer_arrive'</a></li><li><a href=#OClosed_Transfer-transfer_arrive>transfer_arrive</a></li><li><a href=#OClosed_Transfer-transfer_cast>transfer_cast</a></li><li><a href=#OClosed_Transfer-transfer_pnet_action>transfer_pnet_action</a></li><li><a href=#OClosed_Transfer-transfer_action_pnet_closed>transfer_action_pnet_closed</a></li><li><a href=#OClosed_Transfer-transfer_action>transfer_action</a></li><li><a href=#OClosed_Transfer-pnet_reachable_transfer%27>pnet_reachable_transfer'</a></li><li><a href=#OClosed_Transfer-initmissing_def%27>initmissing_def'</a></li><li><a href=#OClosed_Transfer-netmask_initmissing_netgmap>netmask_initmissing_netgmap</a></li><li><a href=#OClosed_Transfer-snd_initmissing>snd_initmissing</a></li><li><a href=#OClosed_Transfer-initmnissing_snd_netgmap>initmnissing_snd_netgmap</a></li><li><a href=#OClosed_Transfer-in_net_ips_fst_init_missing>in_net_ips_fst_init_missing</a></li><li><a href=#OClosed_Transfer-not_in_net_ips_fst_init_missing>not_in_net_ips_fst_init_missing</a></li><li><a href=#OClosed_Transfer-initmissing_oreachable_netmask>initmissing_oreachable_netmask</a></li><li><a href=#OClosed_Transfer-pnet_reachable_transfer>pnet_reachable_transfer</a></li><li><a href=#OClosed_Transfer-netglobalsimp>netglobalsimp</a></li><li><a href=#OClosed_Transfer-netglobalE>netglobalE</a></li><li><a href=#OClosed_Transfer-netglobal_weakenE>netglobal_weakenE</a></li><li><a href=#OClosed_Transfer-close_opnet>close_opnet</a></li></ul></li><li><a href=#AWN_Main>AWN_Main</a></li><li><a href=#Toy>Toy</a><ul><li><a href=#Toy-pkt_simp>pkt_simp</a></li><li><a href=#Toy-not_eq_newpkt_pkt>not_eq_newpkt_pkt</a></li><li><a href=#Toy-some_neq_not_eq>some_neq_not_eq</a></li><li><a href=#Toy-clear_locals_but_not_globals>clear_locals_but_not_globals</a></li><li><a href=#Toy-is_msg_inv_id>is_msg_inv_id</a></li><li><a href=#Toy-is_msg_inv_sid>is_msg_inv_sid</a></li><li><a href=#Toy-is_msg_inv_no>is_msg_inv_no</a></li><li><a href=#Toy-is_msg_inv_nhid>is_msg_inv_nhid</a></li><li><a href=#Toy-is_msg_inv_msg>is_msg_inv_msg</a></li><li><a href=#Toy-%ce%93>Γ</a></li><li><a href=#Toy-toy_proc_cases>toy_proc_cases</a></li><li><a href=#Toy-toy_trans>toy_trans</a></li><li><a href=#Toy-toy_control_within>toy_control_within</a></li><li><a href=#Toy-toy_wf>toy_wf</a></li><li><a href=#Toy-toy_ex_label>toy_ex_label</a></li><li><a href=#Toy-toy_ex_labelE>toy_ex_labelE</a></li><li><a href=#Toy-toy_simple_labels>toy_simple_labels</a></li><li><a href=#Toy-%cf%83>σ</a></li><li><a href=#Toy-initiali_toy>initiali_toy</a></li><li><a href=#Toy-oaodv_control_within>oaodv_control_within</a></li><li><a href=#Toy-%cf%83>σ</a></li><li><a href=#Toy-otoy_trans>otoy_trans</a></li><li><a href=#Toy-msg_sender_simps>msg_sender_simps</a></li><li><a href=#Toy-msg_okI>msg_okI</a></li><li><a href=#Toy-msg_ok_Pkt>msg_ok_Pkt</a></li><li><a href=#Toy-msg_ok_pkt>msg_ok_pkt</a></li><li><a href=#Toy-msg_ok_Newpkt>msg_ok_Newpkt</a></li><li><a href=#Toy-msg_ok_newpkt>msg_ok_newpkt</a></li><li><a href=#Toy-seq_no_leq_num>seq_no_leq_num</a></li><li><a href=#Toy-seq_nos_incs>seq_nos_incs</a></li><li><a href=#Toy-seq_nos_incs%27>seq_nos_incs'</a></li><li><a href=#Toy-sender_ip_valid>sender_ip_valid</a></li><li><a href=#Toy-id_constant>id_constant</a></li><li><a href=#Toy-nhid_eq_id>nhid_eq_id</a></li><li><a href=#Toy-seq_msg_ok>seq_msg_ok</a></li><li><a href=#Toy-nhid_eq_i>nhid_eq_i</a></li><li><a href=#Toy-nos_incD>nos_incD</a></li><li><a href=#Toy-nos_inc_simp>nos_inc_simp</a></li><li><a href=#Toy-all_nos_inc>all_nos_inc</a></li><li><a href=#Toy-oreceived_msg_inv>oreceived_msg_inv</a></li><li><a href=#Toy-msg_ok_other_nos_inc>msg_ok_other_nos_inc</a></li><li><a href=#Toy-msg_ok_no_leq_no>msg_ok_no_leq_no</a></li><li><a href=#Toy-oreceived_msg_ok>oreceived_msg_ok</a></li><li><a href=#Toy-is_pkt_handler_num_leq_no>is_pkt_handler_num_leq_no</a></li><li><a href=#Toy-oseq_bigger_than_next>oseq_bigger_than_next</a></li><li><a href=#Toy-anycast_weakenE>anycast_weakenE</a></li><li><a href=#Toy-oseq_msg_ok>oseq_msg_ok</a></li><li><a href=#Toy-opar_bigger_than_next>opar_bigger_than_next</a></li><li><a href=#Toy-onode_bigger_than_next>onode_bigger_than_next</a></li><li><a href=#Toy-node_local_nos_inc>node_local_nos_inc</a></li><li><a href=#Toy-opnet_bigger_than_next>opnet_bigger_than_next</a></li><li><a href=#Toy-ocnet_bigger_than_next>ocnet_bigger_than_next</a></li><li><a href=#Toy-not_in_net_ips_fst_init_missing>not_in_net_ips_fst_init_missing</a></li><li><a href=#Toy-fst_initmissing_netgmap_pair_fst>fst_initmissing_netgmap_pair_fst</a></li><li><a href=#Toy-fst_initmissing_netgmap_default_toy_init_netlift>fst_initmissing_netgmap_default_toy_init_netlift</a></li><li><a href=#Toy-bigger_than_next>bigger_than_next</a></li></ul></li><li><a href=#AWN_Term_Graph>AWN_Term_Graph</a></li></ul></div><ul><li><a href=https://www.isa-afp.org/browser_info/current/AFP/AWN/outline.pdf>Proof
outline</a></li><li><a href=https://www.isa-afp.org/browser_info/current/AFP/AWN/document.pdf>Proof
document</a></li><li><a href=https://www.isa-afp.org/browser_info/current/AFP/AWN/session_graph.pdf>Theory dependencies</a></li></ul></div></aside><div class="content theories"><header><form action=/%20search><div class=form-container><input id=searchInput type=search size=31 maxlength=255 aria-label="Search the AFP" list=autocomplete><button id=searchButton type=button><img src=/images/search.svg alt=Search></button>
<datalist id=autocomplete></datalist></div></form><h1><span class=first>S</span>ession <span class=first>A</span><span class=first>W</span><span class=first>N</span></h1><div></div></header><div id=banner data-id=0><p>This is an unofficial reimagining of the <a href=https://isa-afp.org target=_blank rel="noreferrer noopener">Archive of Formal Proofs</a></p><button style=display:none id=close title=close><svg viewBox="0 0 6.718 6.718" aria-hidden="true" focusable="false"><rect transform="rotate(45)" x="4" y="-4" width="1.5" height="8"/><rect transform="rotate(45)" x=".75" y="-.75" width="8" height="1.5"/></svg></button></div><div><main><div id=Lib><div class=head><h1>Theory Lib</h1></div><pre class=source><span class=comment1>(*  Title:       Lib.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Generic functions and lemmas"</span></span>

<span class=keyword1><span class=command>theory</span></span> Lib
<span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>TT</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>TT</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span>"</span></span>

<span class=keyword1 id=Lib-TT_True><span class=command>lemma</span></span> TT_True <span class=main>[</span><span class=operator>intro</span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"TT <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> TT_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Lib-in_set_tl><span class=command>lemma</span></span> in_set_tl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> set <span class=main>(</span>tl <span class=free>xs</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>x</span> <span class=main>∈</span> set <span class=free>xs</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Nil_tl insert_iff list.collapse set_simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id=Lib-nat_le_eq_or_lt><span class=command>lemma</span></span> nat_le_eq_or_lt <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> <span class=free>y</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> eq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>x</span> <span class=free>y</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> lt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&lt;</span> <span class=free>y</span> <span class=main>⟹</span> <span class=free>P</span> <span class=free>x</span> <span class=free>y</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>x</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> nat_less_le <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Lib-disjoint_commute><span class=command>lemma</span></span> disjoint_commute<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=main>∩</span> <span class=free>B</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>B</span> <span class=main>∩</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>default</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span> option<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>default</span> <span class=free><span class=bound><span class=entity>df</span></span></span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=bound>i</span> <span class=keyword1>of</span> None <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>df</span></span></span> <span class=bound>i</span> <span class=main>|</span> Some <span class=bound>s</span> <span class=main>⇒</span> <span class=bound>s</span><span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=TransitionSystems><div class=head><h1>Theory TransitionSystems</h1></div><pre class=source><span class=comment1>(*  Title:       TransitionSystems.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Transition systems (automata)"</span></span>

<span class=keyword1><span class=command>theory</span></span> TransitionSystems
<span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>×</span> <span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'s</span>"</span></span>

<span class=keyword1><span class=command>record</span></span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> automaton <span class=main>=</span>
  init <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> set"</span></span>
  trans <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition set"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=Invariants><div class=head><h1>Theory Invariants</h1></div><pre class=source><span class=comment1>(*  Title:       Invariants.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Reachability and Invariance"</span></span>

<span class=keyword1><span class=command>theory</span></span> Invariants
<span class=keyword2><span class=keyword>imports</span></span> <a href=Lib.html>Lib</a> <a href=TransitionSystems.html>TransitionSystems</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=plain_text>Reachability</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  A state is `reachable' under <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> if either it is the initial state, or it is the
  destination of a transition whose action satisfies <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> from a reachable state.
  The `standard' definition of reachability is recovered by setting <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>I</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> to <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>TT</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.
›</span></span>

<span class=keyword1><span class=command>inductive_set</span></span> <span class=entity>reachable</span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>A</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> automaton"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=entity>I</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    reachable_init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>∈</span> init <span class=free>A</span> <span class=main>⟹</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>∈</span> <span class=free>reachable</span> <span class=free>A</span> <span class=free>I</span>"</span></span>
  <span class=main>|</span> reachable_step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>∈</span> <span class=free>reachable</span> <span class=free>A</span> <span class=free>I</span><span class=main>;</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span> <span class=free>I</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=main>∈</span> <span class=free>reachable</span> <span class=free>A</span> <span class=free>I</span>"</span></span>

<span class=keyword1><span class=command>inductive_cases</span></span> reachable_icases<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>

<span class=keyword1 id=Invariants-reachable_pair_induct><span class=command>lemma</span></span> reachable_pair_induct <span class=main>[</span><span class=operator>consumes</span><span class=main>,</span> <span class=operator>case_names</span> init step<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span><span class=main>.</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>ξ</span> <span class=bound>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span> <span class=bound>ξ'</span> <span class=bound>p'</span> <span class=bound>a</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span> <span class=free>P</span> <span class=bound>ξ</span> <span class=bound>p</span><span class=main>;</span>
                            <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span> <span class=free>I</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>ξ'</span> <span class=bound>p'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>ξ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>ξ</span></span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>ξ</span> <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>ξ'</span> <span class=skolem>p'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span><span class=main>.</span> <span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>ξ</span> <span class=bound>p</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ξ</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
                              <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> prod.collapse<span class=main>)</span>
    <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> IH <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>ξ</span> <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>ξ'</span> <span class=skolem>p'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Invariants-reachable_weakenE><span class=command>lemma</span></span> reachable_weakenE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> PQ<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span><span class=main>.</span> <span class=free>P</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>Q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>Q</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>P</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>Q</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> PQ<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>Q</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>Q</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Invariants-reachable_weaken_TT><span class=command>lemma</span></span> reachable_weaken_TT <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=free>A</span> TT"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>simp</span>

<span class=keyword1 id=Invariants-init_empty_reachable_empty><span class=command>lemma</span></span> init_empty_reachable_empty<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"init <span class=free>A</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"reachable <span class=free>A</span> <span class=free>I</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"reachable <span class=free>A</span> <span class=free>I</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> reachable.induct<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹init <span class=free>A</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=plain_text>Invariance</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>invariant</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> automaton <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
  <span class=main>(</span><span class=quoted>"_ <span class=keyword1>⊫</span> <span class=keyword3>(1</span><span class=keyword1>'(</span>_ <span class=keyword1>→')</span><span class=keyword3>/ </span>_<span class=keyword3>)</span>"</span> <span class=main>[</span>100<span class=main>,</span> 0<span class=main>,</span> 9<span class=main>]</span> 8<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main><span class=free>⊫</span></span> <span class=main><span class=free>(</span></span><span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main><span class=free>→)</span></span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>s</span><span class=main>∈</span>reachable <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>I</span></span></span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>s</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span>
  <span class=entity>any_invariant</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> automaton <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
  <span class=main>(</span><span class=quoted>"_ <span class=keyword1>⊫</span> _"</span> <span class=main>[</span>100<span class=main>,</span> 9<span class=main>]</span> 8<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main><span class=free>⊫</span></span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span> <span class=main>≡</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>⊫</span> <span class=main>(</span>TT <span class=main>→)</span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Invariants-invariantI><span class=command>lemma</span></span> invariantI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>a</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span> <span class=free>P</span> <span class=bound>s</span><span class=main>;</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span> <span class=free>I</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> invariant_def
  <span class=keyword1><span class=command>proof</span></span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Invariants-invariant_pairI><span class=command>lemma</span></span> invariant_pairI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span><span class=main>.</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span> <span class=bound>ξ'</span> <span class=bound>p'</span> <span class=bound>a</span><span class=main>.</span>
                   <span class=main>⟦</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span> <span class=free>I</span> <span class=bound>a</span> <span class=main>⟧</span>
                   <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Invariants-invariant_arbitraryI><span class=command>lemma</span></span> invariant_arbitraryI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> invariant_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Invariants-invariantD><span class=command>lemma</span></span> invariantD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> invariant_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Invariants-invariant_initE><span class=command>lemma</span></span> invariant_initE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> invP<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> init <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> invP <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Invariants-invariant_weakenE><span class=command>lemma</span></span> invariant_weakenE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>T</span> <span class=free>σ</span> <span class=free>P</span> <span class=free>Q</span>
  <span class=keyword2><span class=keyword>assumes</span></span> invP<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>PI</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> PQ<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=free>P</span> <span class=bound>s</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>s</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> QIPI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span><span class=main>.</span> <span class=free>QI</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>PI</span> <span class=bound>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span>       <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>QI</span> <span class=main>→)</span> <span class=free>Q</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> invP <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> PQ<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>QI</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>QI</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>QI</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>PI</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> QIPI<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>QI</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> QIPI <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>PI</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>PI</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>PI</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> invP <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s'</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=skolem>s'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> PQ<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>step_invariant</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> automaton <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
  <span class=main>(</span><span class=quoted>"_ <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=keyword3>(1</span><span class=keyword1>'(</span>_ <span class=keyword1>→')</span><span class=keyword3>/ </span>_<span class=keyword3>)</span>"</span> <span class=main>[</span>100<span class=main>,</span> 0<span class=main>,</span> 0<span class=main>]</span> 8<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>A</span></span></span> <span class=keyword1><span class=free>⊫<span class=hidden>⇩</span><sub>A</sub></span></span> <span class=main><span class=free>(</span></span><span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main><span class=free>→)</span></span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>a</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=bound>a</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>∀</span><span class=bound>s</span><span class=main>∈</span>reachable <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>I</span></span></span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>s'</span><span class=main>.</span><span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>⟶</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Invariants-invariant_restrict_inD><span class=command>lemma</span></span> invariant_restrict_inD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span>TT <span class=main>→)</span> <span class=free>P</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>QI</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>abbreviation</span></span>
  <span class=entity>any_step_invariant</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> automaton <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
  <span class=main>(</span><span class=quoted>"_ <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> _"</span> <span class=main>[</span>100<span class=main>,</span> 9<span class=main>]</span> 8<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>A</span></span></span> <span class=keyword1><span class=free>⊫<span class=hidden>⇩</span><sub>A</sub></span></span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span> <span class=main>≡</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>A</span></span></span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>TT <span class=main>→)</span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Invariants-step_invariant_true><span class=command>lemma</span></span> step_invariant_true<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>.</span> True<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> step_invariant_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Invariants-step_invariantI><span class=command>lemma</span></span> step_invariantI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>a</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>s</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>∈</span>trans <span class=free>A</span><span class=main>;</span> <span class=free>I</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> step_invariant_def
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Invariants-step_invariantD><span class=command>lemma</span></span> step_invariantD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=free>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> step_invariant_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Invariants-step_invariantE><span class=command>lemma</span></span> step_invariantE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>T</span> <span class=free>σ</span> <span class=free>P</span> <span class=free>I</span> <span class=free>s</span> <span class=free>a</span> <span class=free>s'</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>Q</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Invariants-step_invariant_pairI><span class=command>lemma</span></span> step_invariant_pairI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span> <span class=bound>ξ'</span> <span class=bound>p'</span> <span class=bound>a</span><span class=main>.</span>
              <span class=main>⟦</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span> <span class=free>I</span> <span class=bound>a</span> <span class=main>⟧</span>
                                                       <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Invariants-step_invariant_arbitraryI><span class=command>lemma</span></span> step_invariant_arbitraryI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span> <span class=bound>a</span> <span class=bound>ξ'</span> <span class=bound>p'</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span> <span class=free>I</span> <span class=bound>a</span> <span class=main>⟧</span>
           <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Invariants-step_invariant_weakenE><span class=command>lemma</span></span> step_invariant_weakenE <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>T</span> <span class=free>σ</span> <span class=free>P</span> <span class=free>Q</span>
  <span class=keyword2><span class=keyword>assumes</span></span> invP<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>PI</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> PQ<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>t</span><span class=main>.</span> <span class=free>P</span> <span class=bound>t</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>t</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> QIPI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span><span class=main>.</span> <span class=free>QI</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>PI</span> <span class=bound>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span>       <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>QI</span> <span class=main>→)</span> <span class=free>Q</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>QI</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>QI</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>QI</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>PI</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> QIPI<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>QI</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>PI</span>"</span></span> <span class=keyword1><span class=command>using</span></span> QIPI <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> invP <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>PI</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> PQ<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Invariants-step_invariant_weaken_with_invariantE><span class=command>lemma</span></span> step_invariant_weaken_with_invariantE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> pinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> qinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>Q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> wr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>a</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>P</span> <span class=bound>s</span><span class=main>;</span> <span class=free>P</span> <span class=bound>s'</span><span class=main>;</span> <span class=free>Q</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>;</span> <span class=free>I</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>R</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>R</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> pinv <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s'</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>from</span></span> pinv <span class=keyword2><span class=keyword>and</span></span> sr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>from</span></span> qinv sr tr <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>s</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>s'</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> wr<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Invariants-step_to_invariantI><span class=command>lemma</span></span> step_to_invariantI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> sinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>Q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span><span class=main>.</span>
                   <span class=main>⟦</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                     <span class=free>P</span> <span class=bound>s</span><span class=main>;</span>
                     <span class=free>Q</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>;</span>
                     <span class=free>I</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span> <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>s'</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s'</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>from</span></span> sinv <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>∈</span>trans <span class=free>A</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>s</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s'</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=OInvariants><div class=head><h1>Theory OInvariants</h1></div><pre class=source><span class=comment1>(*  Title:       OInvariants.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Open reachability and invariance"</span></span>

<span class=keyword1><span class=command>theory</span></span> OInvariants
<span class=keyword2><span class=keyword>imports</span></span> <a href=Invariants.html>Invariants</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Open reachability"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  By convention, the states of an open automaton are pairs. The first component is considered
  to be the global state and the second is the local state.

  A state is `open reachable' under <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>S</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>U</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> if it is the initial state, or it
  is the destination of a transition---where the global components satisfy <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>S</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>---from an
  open reachable state, or it is the destination of an interleaved environment step where the
  global components satisfy <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>U</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.
›</span></span>

<span class=keyword1><span class=command>inductive_set</span></span> <span class=entity>oreachable</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> automaton
      <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span>
      <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'g</span> <span class=main>⇒</span> bool<span class=main>)</span>
      <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>A</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> automaton"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=entity>S</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=entity>U</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'g</span> <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    oreachable_init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>∈</span> init <span class=free>A</span> <span class=main>⟹</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>∈</span> <span class=free>oreachable</span> <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
  <span class=main>|</span> oreachable_local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>∈</span> <span class=free>oreachable</span> <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span> <span class=free>S</span> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>⟧</span>
                        <span class=main>⟹</span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=main>∈</span> <span class=free>oreachable</span> <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
  <span class=main>|</span> oreachable_other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>∈</span> <span class=free>oreachable</span> <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span> <span class=free>U</span> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=main>⟧</span>
                        <span class=main>⟹</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> snd <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>oreachable</span> <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>

<span class=keyword1 id="OInvariants-oreachable_local'"><span class=command>lemma</span></span> oreachable_local' <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> fst_conv oreachable.oreachable_local<span class=main>)</span>

<span class=keyword1 id="OInvariants-oreachable_other'"><span class=command>lemma</span></span> oreachable_other' <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>U</span> <span class=free>σ</span> <span class=free>σ'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span>fst <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>)</span> <span class=free>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_other<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-oreachable_pair_induct><span class=command>lemma</span></span> oreachable_pair_induct <span class=main>[</span><span class=operator>consumes</span><span class=main>,</span> <span class=operator>case_names</span> init other local<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span> <span class=bound>σ'</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>p</span><span class=main>;</span> <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ'</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span> <span class=bound>σ'</span> <span class=bound>p'</span> <span class=bound>a</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>p</span><span class=main>;</span>
                            <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span> <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ'</span> <span class=bound>p'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>σ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>σ</span></span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span> <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>σ'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=skolem>σ'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span><span class=main>.</span> <span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>p</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
                              <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> surjective_pairing<span class=main>)</span>
    <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> IH <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span> <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span> <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span> <span class=main>(</span>snd <span class=skolem>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>p'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span><span class=main>.</span> <span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>p</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
                              <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> surjective_pairing<span class=main>)</span>
    <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> IH <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span> <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>a</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span> <span class=skolem>p'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> assms<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-oreachable_weakenE><span class=command>lemma</span></span> oreachable_weakenE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>PS</span> <span class=free>PU</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> PSQS<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span><span class=main>.</span> <span class=free>PS</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>QS</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> PUQU<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span>   <span class=free>PU</span> <span class=bound>s</span> <span class=bound>s'</span>   <span class=main>⟹</span> <span class=free>QU</span> <span class=bound>s</span> <span class=bound>s'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>PS</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>PS</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>QS</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> PSQS<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>g'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>PU</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=skolem>g'</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>PU</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=skolem>g'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>QU</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=skolem>g'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> PUQU<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>g'</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>act</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>act</span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free><span class=bound><span class=entity>I</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OInvariants-act_simp><span class=command>lemma</span></span> act_simp <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"act <span class=free>I</span> <span class=free>s</span> <span class=free>s'</span> <span class=free>a</span> <span class=main>=</span> <span class=free>I</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> act_def <span class=keyword1><span class=command>..</span></span>

<span class=keyword1 id=OInvariants-reachable_in_oreachable><span class=command>lemma</span></span> reachable_in_oreachable <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>s</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span>act <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> act_def <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_local<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Open Invariance"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>oinvariant</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> automaton
      <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'g</span> <span class=main>⇒</span> bool<span class=main>)</span>
      <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
  <span class=main>(</span><span class=quoted>"_ <span class=keyword1>⊨</span> <span class=keyword3>(1</span><span class=keyword1>'(</span><span class=keyword3>(1</span>_<span class=keyword3>)</span><span class=keyword1>,</span><span class=keyword3>/ </span><span class=keyword3>(1</span>_<span class=keyword3>)</span> <span class=keyword1>→')</span><span class=keyword3>/ </span>_<span class=keyword3>)</span>"</span> <span class=main>[</span>100<span class=main>,</span> 0<span class=main>,</span> 0<span class=main>,</span> 9<span class=main>]</span> 8<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main><span class=free>⊨</span></span> <span class=main><span class=free>(</span></span><span class=free><span class=bound><span class=entity>S</span></span></span><span class=main><span class=free>,</span></span> <span class=free><span class=bound><span class=entity>U</span></span></span> <span class=main><span class=free>→)</span></span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>s</span><span class=main>∈</span>oreachable <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=free><span class=bound><span class=entity>U</span></span></span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>s</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OInvariants-oinvariantI><span class=command>lemma</span></span> oinvariantI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>T</span> <span class=free>TI</span> <span class=free>S</span> <span class=free>U</span> <span class=free>P</span>
  <span class=keyword2><span class=keyword>assumes</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>g</span> <span class=bound>g'</span> <span class=bound>l</span><span class=main>.</span>
                  <span class=main>⟦</span> <span class=main>(</span><span class=bound>g</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=bound>g</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span> <span class=free>U</span> <span class=bound>g</span> <span class=bound>g'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>g'</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>a</span> <span class=bound>s'</span><span class=main>.</span>
                  <span class=main>⟦</span> <span class=bound>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span> <span class=free>P</span> <span class=bound>s</span><span class=main>;</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span> <span class=free>S</span> <span class=main>(</span>fst <span class=bound>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=bound>s'</span><span class=main>)</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> oinvariant_def
  <span class=keyword1><span class=command>proof</span></span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=skolem>a</span>"</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> local<span class=main>)</span>
     <span class=keyword1><span class=command>next</span></span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>g'</span>
       <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=skolem>g'</span>"</span></span>
         <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>g'</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span>"</span></span>
           <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> other <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> g<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"fst <span class=skolem><span class=skolem><span class=skolem>s</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-oinvariant_oreachableI><span class=command>lemma</span></span> oinvariant_oreachableI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> oinvariant_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OInvariants-oinvariant_pairI><span class=command>lemma</span></span> oinvariant_pairI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span> <span class=bound>σ'</span> <span class=bound>p'</span> <span class=bound>a</span><span class=main>.</span>
                   <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                     <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>p</span><span class=main>.</span>
                  <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>;</span> <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oinvariantI<span class=main>)</span>
     <span class=main>(</span><span class=operator>clarsimp</span> <span class=main><span class=keyword3>|</span></span> <span class=operator>erule</span> init <span class=main><span class=keyword3>|</span></span> <span class=operator>erule</span><span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> local <span class=main><span class=keyword3>|</span></span> <span class=operator>erule</span><span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> other<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=OInvariants-oinvariantD><span class=command>lemma</span></span> oinvariantD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> oinvariant_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>

<span class=keyword1 id=OInvariants-oinvariant_initD><span class=command>lemma</span></span> oinvariant_initD <span class=main>[</span><span class=operator>dest</span><span class=main>,</span> <span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> invP<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> init <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> invP <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-oinvariant_weakenE><span class=command>lemma</span></span> oinvariant_weakenE <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> invP<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>PS</span><span class=main>,</span> <span class=free>PU</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> PQ<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=free>P</span> <span class=bound>s</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>s</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> QSPS<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span><span class=main>.</span> <span class=free>QS</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>PS</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> QUPU<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span>   <span class=free>QU</span> <span class=bound>s</span> <span class=bound>s'</span>   <span class=main>⟹</span> <span class=free>PU</span> <span class=bound>s</span> <span class=bound>s'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span>       <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>QS</span><span class=main>,</span> <span class=free>QU</span> <span class=main>→)</span> <span class=free>Q</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> invP <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> PQ<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>σ'</span> <span class=skolem>p'</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>QS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>PS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> QSPS<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> QSPS QUPU <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>PS</span> <span class=free>PU</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>PS</span> <span class=free>PU</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>PS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> invP <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> PQ<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>QU</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>QU</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>PU</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> QUPU<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> QSPS QUPU <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>PS</span> <span class=free>PU</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>PS</span> <span class=free>PU</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>PU</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> invP <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> PQ<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-oinvariant_weakenD><span class=command>lemma</span></span> oinvariant_weakenD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S'</span><span class=main>,</span> <span class=free>U'</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weakenS<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span><span class=main>.</span> <span class=free>S</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>S'</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weakenU<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=free>U</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=main>⟹</span> <span class=free>U'</span> <span class=bound>s</span> <span class=bound>s'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S'</span> <span class=free>U'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_weakenE<span class=main>)</span>
         <span class=main>(</span><span class=operator>erule</span> weakenS<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> weakenU<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S'</span><span class=main>,</span> <span class=free>U'</span> <span class=main>→)</span> <span class=free>P</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-close_open_invariant><span class=command>lemma</span></span> close_open_invariant<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> oinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span>act <span class=free>I</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> oinv <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>ξ'</span> <span class=skolem>p'</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span>act <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> oinv <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>local_steps</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s1</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l1</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'a</span> <span class=main>×</span> <span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s2</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l2</span><span class=main>)</span> set <span class=main>⇒</span> <span class=tfree>'i</span> set <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>local_steps</span> <span class=free><span class=bound><span class=entity>T</span></span></span> <span class=free><span class=bound><span class=entity>J</span></span></span> <span class=main>≡</span>
   <span class=main>(</span><span class=main>∀</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>s</span> <span class=bound>a</span> <span class=bound>σ'</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>T</span></span></span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>J</span></span></span><span class=main>.</span> <span class=bound>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>j</span><span class=main>)</span>
   <span class=main>⟶</span> <span class=main>(</span><span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>J</span></span></span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=bound>ζ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>T</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OInvariants-local_stepsI><span class=command>lemma</span></span> local_stepsI <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>s</span> <span class=bound>a</span> <span class=bound>σ'</span> <span class=bound>ζ'</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>⟧</span>
                               <span class=main>⟹</span> <span class=main>(</span><span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=bound>ζ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"local_steps <span class=free>T</span> <span class=free>J</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> local_steps_def <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>

<span class=keyword1 id=OInvariants-local_stepsE><span class=command>lemma</span></span> local_stepsE <span class=main>[</span><span class=operator>elim</span><span class=main>,</span> <span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"local_steps <span class=free>T</span> <span class=free>J</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=free>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=free>ζ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> local_steps_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>other_steps</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'i</span> set <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>other_steps</span> <span class=free><span class=bound><span class=entity>U</span></span></span> <span class=free><span class=bound><span class=entity>J</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>σ</span> <span class=bound>σ'</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>U</span></span></span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>J</span></span></span><span class=main>.</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>j</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OInvariants-other_stepsI><span class=command>lemma</span></span> other_stepsI <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>j</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>;</span> <span class=bound>j</span> <span class=main>∈</span> <span class=free>J</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>j</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"other_steps <span class=free>U</span> <span class=free>J</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> other_steps_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OInvariants-other_stepsE><span class=command>lemma</span></span> other_stepsE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"other_steps <span class=free>U</span> <span class=free>J</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=free>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> other_steps_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>subreachable</span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>subreachable</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>U</span></span></span> <span class=free><span class=bound><span class=entity>J</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>I</span><span class=main>.</span> <span class=main>∀</span><span class=bound>s</span> <span class=main>∈</span> oreachable <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>(</span><span class=main>λ</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=bound>I</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>U</span></span></span><span class=main>.</span>
                                  <span class=main>(</span><span class=main>∃</span><span class=bound>σ</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>J</span></span></span><span class=main>.</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=bound>s</span><span class=main>)</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=bound>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=bound>I</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OInvariants-subreachableI><span class=command>lemma</span></span> subreachableI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"local_steps <span class=main>(</span>trans <span class=free>A</span><span class=main>)</span> <span class=free>J</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"other_steps <span class=free>U</span> <span class=free>J</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"subreachable <span class=free>A</span> <span class=free>U</span> <span class=free>J</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> subreachable_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>I</span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=skolem>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>σ</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>fst <span class=skolem>s</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule</span> reachable_init<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>I</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>fst <span class=skolem>s</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>,</span> snd <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹local_steps <span class=main>(</span>trans <span class=free>A</span><span class=main>)</span> <span class=free>J</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
                                                 <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ζ'</span><span class=main>,</span> snd <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> local_stepsE<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span>›</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ζ'</span><span class=main>,</span> snd <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>I</span> <span class=skolem>a</span>›</span></span>
       <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ζ'</span><span class=main>,</span> snd <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span>"</span></span> <span class=keyword1><span class=command>..</span></span>

      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=bound>j</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>σ'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=skolem>σ'</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹other_steps <span class=free>U</span> <span class=free>J</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> other_stepsE<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span>›</span></span>
       <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>=</span> fst <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=skolem>I</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-subreachableE><span class=command>lemma</span></span> subreachableE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"subreachable <span class=free>A</span> <span class=free>U</span> <span class=free>J</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=free>s</span><span class=main>)</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> subreachable_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OInvariants-subreachableE_pair><span class=command>lemma</span></span> subreachableE_pair <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"subreachable <span class=free>A</span> <span class=free>U</span> <span class=free>J</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>ζ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> subreachable_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> fst_conv snd_conv<span class=main>)</span>

<span class=keyword1 id=OInvariants-subreachable_otherE><span class=command>lemma</span></span> subreachable_otherE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"subreachable <span class=free>A</span> <span class=free>U</span> <span class=free>J</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=free>I</span><span class=main>)</span> <span class=free>U</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>U</span> <span class=free>σ</span> <span class=free>σ'</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> oreachable_other'<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹subreachable <span class=free>A</span> <span class=free>U</span> <span class=free>J</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-open_closed_invariant><span class=command>lemma</span></span> open_closed_invariant<span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>J</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"subreachable <span class=free>A</span> <span class=free>U</span> <span class=free>J</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> localp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>s</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>j</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span>act <span class=free>I</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> act_def<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> oreachable_local<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹subreachable <span class=free>A</span> <span class=free>U</span> <span class=free>J</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ'</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> subreachableE<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=skolem>s'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=bound>j</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> localp prod.collapse<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>g</span> <span class=skolem>g'</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> or<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>g</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>g</span> <span class=skolem>g'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>g</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹subreachable <span class=free>A</span> <span class=free>U</span> <span class=free>J</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> or <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>U</span> <span class=skolem>g</span> <span class=skolem>g'</span>›</span></span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>gg'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>gg'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>g'</span> <span class=bound>j</span>"</span></span>
                   <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>gg'</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> subreachable_otherE<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>gg'</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>gg'</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>gg'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>g'</span> <span class=bound>j</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>g'</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> localp<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-oinvariant_anyact><span class=command>lemma</span></span> oinvariant_anyact<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span>act TT<span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>                             
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>ostep_invariant</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> automaton
      <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'g</span> <span class=main>⇒</span> <span class=tfree>'g</span> <span class=main>⇒</span> bool<span class=main>)</span>
      <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
  <span class=main>(</span><span class=quoted>"_ <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=keyword3>(1</span><span class=keyword1>'(</span><span class=keyword3>(1</span>_<span class=keyword3>)</span><span class=keyword1>,</span><span class=keyword3>/ </span><span class=keyword3>(1</span>_<span class=keyword3>)</span> <span class=keyword1>→')</span><span class=keyword3>/ </span>_<span class=keyword3>)</span>"</span> <span class=main>[</span>100<span class=main>,</span> 0<span class=main>,</span> 0<span class=main>,</span> 9<span class=main>]</span> 8<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>A</span></span></span> <span class=keyword1><span class=free>⊨<span class=hidden>⇩</span><sub>A</sub></span></span> <span class=main><span class=free>(</span></span><span class=free><span class=bound><span class=entity>S</span></span></span><span class=main><span class=free>,</span></span> <span class=free><span class=bound><span class=entity>U</span></span></span> <span class=main><span class=free>→)</span></span> <span class=free><span class=bound><span class=entity>P</span></span></span><span class=main>)</span> <span class=main>=</span>
     <span class=main>(</span><span class=main>∀</span><span class=bound>s</span><span class=main>∈</span>oreachable <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=free><span class=bound><span class=entity>U</span></span></span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>a</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>S</span></span></span> <span class=main>(</span>fst <span class=bound>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=bound>s'</span><span class=main>)</span> <span class=bound>a</span> <span class=main>⟶</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id="OInvariants-ostep_invariant_def'"><span class=command>lemma</span></span> ostep_invariant_def'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span><span class=bound>s</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>.</span>
                           <span class=main>(</span><span class=main>∀</span><span class=bound>a</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span> <span class=main>∧</span> <span class=free>S</span> <span class=main>(</span>fst <span class=bound>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=bound>s'</span><span class=main>)</span> <span class=bound>a</span> <span class=main>⟶</span> <span class=free>P</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ostep_invariant_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OInvariants-ostep_invariantI><span class=command>lemma</span></span> ostep_invariantI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>s</span> <span class=bound>a</span> <span class=bound>σ'</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span> <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span> <span class=main>⟧</span>
                             <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ostep_invariant_def
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OInvariants-ostep_invariantD><span class=command>lemma</span></span> ostep_invariantD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> ostep_invariant_def' <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>

<span class=keyword1 id=OInvariants-ostep_invariantE><span class=command>lemma</span></span> ostep_invariantE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>Q</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OInvariants-ostep_invariant_weakenE><span class=command>lemma</span></span> ostep_invariant_weakenE <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> invP<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>PS</span><span class=main>,</span> <span class=free>PU</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> PQ<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>t</span><span class=main>.</span> <span class=free>P</span> <span class=bound>t</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>t</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> QSPS<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>.</span> <span class=free>QS</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>PS</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> QUPU<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span><span class=main>.</span>   <span class=free>QU</span> <span class=bound>σ</span> <span class=bound>σ'</span>   <span class=main>⟹</span> <span class=free>PU</span> <span class=bound>σ</span> <span class=bound>σ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span>       <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>QS</span><span class=main>,</span> <span class=free>QU</span> <span class=main>→)</span> <span class=free>Q</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>σ'</span> <span class=skolem>s'</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>QS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>QS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>PS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> QSPS<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>QS</span> <span class=free>QU</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>PS</span> <span class=free>PU</span>"</span></span> <span class=keyword1><span class=command>using</span></span> QSPS QUPU <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> invP <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>PS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> PQ<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-ostep_invariant_weaken_with_invariantE><span class=command>lemma</span></span> ostep_invariant_weaken_with_invariantE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> pinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> qinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>Q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> wr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>s</span> <span class=bound>a</span> <span class=bound>σ'</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>;</span> <span class=free>Q</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span> <span class=main>⟧</span>
                              <span class=main>⟹</span> <span class=free>R</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>R</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> pinv <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>from</span></span> pinv <span class=keyword2><span class=keyword>and</span></span> sr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>from</span></span> qinv sr tr <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> wr<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-ostep_to_invariantI><span class=command>lemma</span></span> ostep_to_invariantI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> sinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>Q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>s</span> <span class=bound>σ'</span> <span class=bound>s'</span> <span class=bound>a</span><span class=main>.</span>
                    <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                      <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>;</span>
                      <span class=free>Q</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
                      <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>s</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span> <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span> <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>σ'</span> <span class=skolem>s'</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>from</span></span> sinv <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> local<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-open_closed_step_invariant><span class=command>lemma</span></span> open_closed_step_invariant<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"local_steps <span class=main>(</span>trans <span class=free>A</span><span class=main>)</span> <span class=free>J</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"other_steps <span class=free>U</span> <span class=free>J</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> localp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>a</span> <span class=bound>σ'</span> <span class=bound>ζ'</span> <span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span>
                   <span class=main>⟦</span> <span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>ζ</span> <span class=bound>j</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>ζ'</span> <span class=bound>j</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>⟧</span>
                   <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=bound>ζ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>act <span class=free>I</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> or<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span>act <span class=free>I</span><span class=main>)</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"act <span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹act <span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹local_steps <span class=main>(</span>trans <span class=free>A</span><span class=main>)</span> <span class=free>J</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹other_steps <span class=free>U</span> <span class=free>J</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"subreachable <span class=free>A</span> <span class=free>U</span> <span class=free>J</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> or <span class=keyword1><span class=command>unfolding</span></span> act_def
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> subreachableE_pair<span class=main>)</span>

     <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹local_steps <span class=main>(</span>trans <span class=free>A</span><span class=main>)</span> <span class=free>J</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> tr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span>
       <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span>"</span></span>
                   <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ζ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>›</span></span>
                          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ζ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span>
                          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ζ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=free>J</span><span class=main>.</span> <span class=skolem>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> localp<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OInvariants-oinvariant_step_anyact><span class=command>lemma</span></span> oinvariant_step_anyact<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>act TT<span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Standard assumption predicates "</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹otherwith›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>otherwith</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'s</span> <span class=main>⇒</span> bool<span class=main>)</span>
                          <span class=main>⇒</span> <span class=tfree>'i</span> set
                          <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool<span class=main>)</span>
                          <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>otherwith</span> <span class=free><span class=bound><span class=entity>Q</span></span></span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span><span class=main>∉</span><span class=free><span class=bound><span class=entity>I</span></span></span> <span class=main>⟶</span> <span class=free><span class=bound><span class=entity>Q</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span>"</span></span>

<span class=keyword1 id=OInvariants-otherwithI><span class=command>lemma</span></span> otherwithI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span><span class=free>I</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sync<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>σ</span> <span class=free>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>Q</span> <span class=free>I</span> <span class=free>P</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> otherwith_def <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OInvariants-otherwithE><span class=command>lemma</span></span> otherwithE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>Q</span> <span class=free>I</span> <span class=free>P</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>P</span> <span class=free>σ</span> <span class=free>a</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span><span class=free>I</span> <span class=main>⟶</span> <span class=free>Q</span> <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>R</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> otherwith_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OInvariants-otherwith_actionD><span class=command>lemma</span></span> otherwith_actionD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>Q</span> <span class=free>I</span> <span class=free>P</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>σ</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OInvariants-otherwith_syncD><span class=command>lemma</span></span> otherwith_syncD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>Q</span> <span class=free>I</span> <span class=free>P</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span><span class=free>I</span> <span class=main>⟶</span> <span class=free>Q</span> <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OInvariants-otherwithEI><span class=command>lemma</span></span> otherwithEI <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>P</span> <span class=free>I</span> <span class=free>PO</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>a</span><span class=main>.</span> <span class=free>PO</span> <span class=bound>σ</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>QO</span> <span class=bound>σ</span> <span class=bound>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>P</span> <span class=free>I</span> <span class=free>QO</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> otherwith_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id=OInvariants-all_but><span class=command>lemma</span></span> all_but<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=free>i</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1 id=OInvariants-all_but_eq><span class=command>lemma</span></span> all_but_eq <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=free>i</span> <span class=main>⟶</span> <span class=free>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ'</span> <span class=bound>j</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>σ</span> <span class=main>=</span> <span class=free>σ'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹other›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>other</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'s</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'i</span> set <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>other</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>i</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>I</span></span></span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>i</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>i</span> <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>i</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OInvariants-otherI><span class=command>lemma</span></span> otherI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span><span class=main>∈</span><span class=free>I</span> <span class=main>⟹</span> <span class=free>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span><span class=free>I</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"other <span class=free>P</span> <span class=free>I</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> other_def <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>

<span class=keyword1 id=OInvariants-otherE><span class=command>lemma</span></span> otherE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"other <span class=free>P</span> <span class=free>I</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>∀</span><span class=bound>i</span><span class=main>∈</span><span class=free>I</span><span class=main>.</span> <span class=free>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span><span class=free>I</span> <span class=main>⟶</span> <span class=free>P</span> <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>R</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> other_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OInvariants-other_localD><span class=command>lemma</span></span> other_localD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"other <span class=free>P</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=main>⟹</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OInvariants-other_otherD><span class=command>lemma</span></span> other_otherD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"other <span class=free>P</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=free>P</span> <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OInvariants-other_bothE><span class=command>lemma</span></span> other_bothE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"other <span class=free>P</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=free>P</span> <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OInvariants-weaken_local><span class=command>lemma</span></span> weaken_local <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"other <span class=free>P</span> <span class=free>I</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> PQ<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>ξ'</span><span class=main>.</span> <span class=free>P</span> <span class=bound>ξ</span> <span class=bound>ξ'</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>ξ</span> <span class=bound>ξ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"other <span class=free>Q</span> <span class=free>I</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> other_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>global</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>nat <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span>nat <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'local</span> <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>global</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>σ</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OInvariants-globalsimp><span class=command>lemma</span></span> globalsimp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"global <span class=free>P</span> <span class=free>s</span> <span class=main>=</span> <span class=free>P</span> <span class=main>(</span>fst <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> global_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>globala</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>nat <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'action</span><span class=main>)</span> transition <span class=main>⇒</span> bool<span class=main>)</span>
                       <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>nat <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'local</span><span class=main>,</span> <span class=tfree>'action</span><span class=main>)</span> transition <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>globala</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OInvariants-globalasimp><span class=command>lemma</span></span> globalasimp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"globala <span class=free>P</span> <span class=free>s</span> <span class=main>=</span> <span class=free>P</span> <span class=main>(</span>fst <span class=main>(</span>fst <span class=free>s</span><span class=main>)</span><span class=main>,</span> fst <span class=main>(</span>snd <span class=free>s</span><span class=main>)</span><span class=main>,</span> fst <span class=main>(</span>snd <span class=main>(</span>snd <span class=free>s</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> globala_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=AWN><div class=head><h1>Theory AWN</h1></div><pre class=source><span class=comment1>(*  Title:       AWN.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Terms of the Algebra for Wireless Networks"</span></span>

<span class=keyword1><span class=command>theory</span></span> AWN
<span class=keyword2><span class=keyword>imports</span></span> <a href=Lib.html>Lib</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Sequential Processes"</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> ip <span class=main>=</span> <span class=quoted>nat</span>
<span class=keyword1><span class=command>type_synonym</span></span> data <span class=main>=</span> <span class=quoted>nat</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Most of AWN is independent of the type of messages, but the closed layer turns
  newpkt actions into the arrival of newpkt messages. We use a type class to maintain
  some abstraction (and independence from the definition of particular protocols).
›</span></span>

<span class=keyword1><span class=command>class</span></span> msg <span class=main>=</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free><span class=free><span class=free>newpkt</span></span></span> <span class=main>::</span> <span class=quoted><span class=quoted>"data <span class=main>×</span> ip <span class=main>⇒</span> <span class=tfree>'a</span>"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=free><span class=free><span class=free>eq_newpkt</span></span></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> <span class=main>⇒</span> bool"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> eq_newpkt_eq <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>eq_newpkt</span> <span class=main>(</span><span class=free>newpkt</span> <span class=main>(</span><span class=free>d</span><span class=main>,</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Sequential process terms abstract over the types of data states (<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>typ</span></span> <span class=quoted><span class=tfree><span class=quoted><span class=tfree>'s</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>),
  messages (<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>typ</span></span> <span class=quoted><span class=tfree><span class=quoted><span class=tfree>'m</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>), process names (<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>typ</span></span> <span class=quoted><span class=tfree><span class=quoted><span class=tfree>'p</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>),and labels (<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>typ</span></span> <span class=quoted><span class=tfree><span class=quoted><span class=tfree>'l</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>).
›</span></span>

<span class=keyword1><span class=command>datatype</span></span> <span class=main>(</span>dead <span class=tfree>'s</span><span class=main>,</span> dead <span class=tfree>'m</span><span class=main>,</span> dead <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>=</span>
    GUARD <span class=quoted><span class=quoted>"<span class=tfree>'l</span>"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'s</span> set"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>
  <span class=main>|</span> ASSIGN <span class=quoted><span class=quoted>"<span class=tfree>'l</span>"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'s</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>
  <span class=main>|</span> CHOICE <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>
  <span class=main>|</span> UCAST <span class=quoted><span class=quoted>"<span class=tfree>'l</span>"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> ip"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'m</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>
  <span class=main>|</span> BCAST <span class=quoted><span class=quoted>"<span class=tfree>'l</span>"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'m</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>
  <span class=main>|</span> GCAST <span class=quoted><span class=quoted>"<span class=tfree>'l</span>"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> ip set"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'m</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>
  <span class=main>|</span> SEND <span class=quoted><span class=quoted>"<span class=tfree>'l</span>"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'m</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>
  <span class=main>|</span> DELIVER <span class=quoted><span class=quoted>"<span class=tfree>'l</span>"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> data"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>
  <span class=main>|</span> RECEIVE <span class=quoted><span class=quoted>"<span class=tfree>'l</span>"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'m</span> <span class=main>⇒</span> <span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'s</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>
  <span class=main>|</span> CALL <span class=tfree><span class=quoted><span class=tfree>'p</span></span></span>
  <span class=keyword2><span class=keyword>for</span></span> map<span class=main>:</span> labelmap

<span class=keyword1><span class=command>syntax</span></span>
  <span class=quoted>"_guard"</span>    <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(‹unbreakable›</span><span class=keyword1>⟨</span>_<span class=keyword1>⟩</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>
  <span class=quoted>"_lguard"</span>   <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword1>{</span>_<span class=keyword1>}</span><span class=keyword3>(‹unbreakable›</span><span class=keyword1>⟨</span>_<span class=keyword1>⟩</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>
  <span class=quoted>"_ifguard"</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span>pttrn<span class=main>,</span> bool<span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(‹unbreakable›</span><span class=keyword1>⟨</span>_<span class=keyword1>.</span> _<span class=keyword1>⟩</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>

  <span class=quoted>"_bassign"</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span>pttrn<span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(‹unbreakable›</span><span class=keyword1>⟦</span>_<span class=keyword1>.</span> _<span class=keyword1>⟧</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>
  <span class=quoted>"_lbassign"</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span> pttrn<span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword1>{</span>_<span class=keyword1>}</span><span class=keyword3>(‹unbreakable›</span><span class=keyword1>⟦</span>_<span class=keyword1>.</span> _<span class=keyword1>⟧</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>

  <span class=quoted>"_assign"</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span><span class=keyword3>(‹unbreakable›</span><span class=keyword1>⟦</span>_<span class=keyword1>⟧</span><span class=keyword3>)</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>
  <span class=quoted>"_lassign"</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span><span class=keyword1>{</span>_<span class=keyword1>}</span><span class=keyword3>(‹unbreakable›</span><span class=keyword1>⟦</span>_<span class=keyword1>⟧</span><span class=keyword3>)</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>

  <span class=quoted>"_unicast"</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>unicast'(</span><span class=keyword3>(1</span><span class=keyword3>(3</span>_<span class=keyword3>)</span><span class=keyword1>,</span><span class=keyword3>/ </span><span class=keyword3>(3</span>_<span class=keyword3>)</span><span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>//</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword3>/ </span><span class=keyword3>(2</span><span class=keyword1>▹</span> _<span class=keyword3>)</span><span class=keyword3>)</span>"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>
  <span class=quoted>"_lunicast"</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp<span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>{</span>_<span class=keyword1>}unicast'(</span><span class=keyword3>(1</span><span class=keyword3>(3</span>_<span class=keyword3>)</span><span class=keyword1>,</span><span class=keyword3>/ </span><span class=keyword3>(3</span>_<span class=keyword3>)</span><span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>//</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword3>/ </span><span class=keyword3>(2</span><span class=keyword1>▹</span> _<span class=keyword3>)</span><span class=keyword3>)</span>"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>

  <span class=quoted>"_bcast"</span>    <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>broadcast'(</span><span class=keyword3>(1</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>
  <span class=quoted>"_lbcast"</span>   <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>{</span>_<span class=keyword1>}broadcast'(</span><span class=keyword3>(1</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>

  <span class=quoted>"_gcast"</span>    <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>groupcast'(</span><span class=keyword3>(1</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword1>,</span><span class=keyword3>/ </span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>
  <span class=quoted>"_lgcast"</span>   <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>{</span>_<span class=keyword1>}groupcast'(</span><span class=keyword3>(1</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword1>,</span><span class=keyword3>/ </span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>

  <span class=quoted>"_send"</span>     <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>send'(</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>
  <span class=quoted>"_lsend"</span>    <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>{</span>_<span class=keyword1>}send'(</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>

  <span class=quoted>"_deliver"</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>deliver'(</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>
  <span class=quoted>"_ldeliver"</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>{</span>_<span class=keyword1>}deliver'(</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>

  <span class=quoted>"_receive"</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span>  <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> unit<span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>receive'(</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>
  <span class=quoted>"_lreceive"</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=tfree>'a</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp"</span></span>
                 <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>{</span>_<span class=keyword1>}receive'(</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword1>')</span> <span class=keyword1>.</span><span class=keyword3>)</span><span class=keyword3>//</span>_"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 60<span class=main>]</span> 60<span class=main>)</span>

<span class=keyword1><span class=command>translations</span></span>
  <span class=quoted>"_guard <span class=free>f</span> <span class=free>p</span>"</span>     <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> GUARD <span class=main>()</span> <span class=free>f</span> <span class=free>p</span>"</span>
  <span class=quoted>"_lguard <span class=free>l</span> <span class=free>f</span> <span class=free>p</span>"</span>  <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> GUARD <span class=free>l</span> <span class=free>f</span> <span class=free>p</span>"</span>
  <span class=quoted>"_ifguard <span class=free>ξ</span> <span class=free>e</span> <span class=free>p</span>"</span> <span class=main>⇀</span> <span class=quoted>"<span class=keyword1>CONST</span> GUARD <span class=main>()</span> <span class=main>(</span><span class=main>λ</span><span class=free>ξ</span><span class=main>.</span> <span class=keyword1>if</span> <span class=free>e</span> <span class=keyword1>then</span> <span class=main>{</span><span class=free>ξ</span><span class=main>}</span> <span class=keyword1>else</span> <span class=main>{}</span><span class=main>)</span> <span class=free>p</span>"</span>

  <span class=quoted>"_assign <span class=free>f</span> <span class=free>p</span>"</span>    <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> ASSIGN <span class=main>()</span> <span class=free>f</span> <span class=free>p</span>"</span>
  <span class=quoted>"_lassign <span class=free>l</span> <span class=free>f</span> <span class=free>p</span>"</span> <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> ASSIGN <span class=free>l</span> <span class=free>f</span> <span class=free>p</span>"</span>

  <span class=quoted>"_bassign <span class=free>ξ</span> <span class=free>e</span> <span class=free>p</span>"</span>    <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> ASSIGN <span class=main>()</span> <span class=main>(</span><span class=main>λ</span><span class=free>ξ</span><span class=main>.</span> <span class=free>e</span><span class=main>)</span> <span class=free>p</span>"</span>
  <span class=quoted>"_lbassign <span class=free>l</span> <span class=free>ξ</span> <span class=free>e</span> <span class=free>p</span>"</span> <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> ASSIGN <span class=free>l</span> <span class=main>(</span><span class=main>λ</span><span class=free>ξ</span><span class=main>.</span> <span class=free>e</span><span class=main>)</span> <span class=free>p</span>"</span>

  <span class=quoted>"_unicast <span class=free>fip</span> <span class=free>fmsg</span> <span class=free>p</span> <span class=free>q</span>"</span>    <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> UCAST <span class=main>()</span> <span class=free>fip</span> <span class=free>fmsg</span> <span class=free>p</span> <span class=free>q</span>"</span>
  <span class=quoted>"_lunicast <span class=free>l</span> <span class=free>fip</span> <span class=free>fmsg</span> <span class=free>p</span> <span class=free>q</span>"</span> <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> UCAST <span class=free>l</span> <span class=free>fip</span> <span class=free>fmsg</span> <span class=free>p</span> <span class=free>q</span>"</span>

  <span class=quoted>"_bcast <span class=free>fmsg</span> <span class=free>p</span>"</span>    <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> BCAST <span class=main>()</span> <span class=free>fmsg</span> <span class=free>p</span>"</span>
  <span class=quoted>"_lbcast <span class=free>l</span> <span class=free>fmsg</span> <span class=free>p</span>"</span> <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> BCAST <span class=free>l</span> <span class=free>fmsg</span> <span class=free>p</span>"</span>

  <span class=quoted>"_gcast <span class=free>fipset</span> <span class=free>fmsg</span> <span class=free>p</span>"</span>    <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> GCAST <span class=main>()</span> <span class=free>fipset</span> <span class=free>fmsg</span> <span class=free>p</span>"</span>
  <span class=quoted>"_lgcast <span class=free>l</span> <span class=free>fipset</span> <span class=free>fmsg</span> <span class=free>p</span>"</span> <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> GCAST <span class=free>l</span> <span class=free>fipset</span> <span class=free>fmsg</span> <span class=free>p</span>"</span>

  <span class=quoted>"_send <span class=free>fmsg</span> <span class=free>p</span>"</span>    <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> SEND <span class=main>()</span> <span class=free>fmsg</span> <span class=free>p</span>"</span>
  <span class=quoted>"_lsend <span class=free>l</span> <span class=free>fmsg</span> <span class=free>p</span>"</span> <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> SEND <span class=free>l</span> <span class=free>fmsg</span> <span class=free>p</span>"</span>

  <span class=quoted>"_deliver <span class=free>fdata</span> <span class=free>p</span>"</span>    <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> DELIVER <span class=main>()</span> <span class=free>fdata</span> <span class=free>p</span>"</span>
  <span class=quoted>"_ldeliver <span class=free>l</span> <span class=free>fdata</span> <span class=free>p</span>"</span> <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> DELIVER <span class=free>l</span> <span class=free>fdata</span> <span class=free>p</span>"</span>

  <span class=quoted>"_receive <span class=free>fmsg</span> <span class=free>p</span>"</span>    <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> RECEIVE <span class=main>()</span> <span class=free>fmsg</span> <span class=free>p</span>"</span>
  <span class=quoted>"_lreceive <span class=free>l</span> <span class=free>fmsg</span> <span class=free>p</span>"</span> <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> RECEIVE <span class=free>l</span> <span class=free>fmsg</span> <span class=free>p</span>"</span>

<span class=keyword1><span class=command>notation</span></span> <span class=quoted>"CHOICE"</span> <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword3>//</span><span class=keyword1>⊕</span><span class=keyword3>//</span><span class=keyword3>(</span>_<span class=keyword3>)</span><span class=keyword3>)</span>"</span> <span class=main>[</span>56<span class=main>,</span> 55<span class=main>]</span> 55<span class=main>)</span>
     <span class=keyword2><span class=keyword>and</span></span> <span class=quoted>"CALL"</span>   <span class=main>(</span><span class=quoted>"<span class=keyword3>(3</span><span class=keyword1>call'(</span><span class=keyword3>(3</span>_<span class=keyword3>)</span><span class=keyword1>')</span><span class=keyword3>)</span>"</span> <span class=main>[</span>0<span class=main>]</span> 60<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>not_call</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>not_call</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>pn</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>≠</span> <span class=keyword1>call(</span><span class=bound>pn</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=AWN-not_call_simps><span class=command>lemma</span></span> not_call_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fg</span> <span class=bound>p</span><span class=main>.</span>         not_call <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟨</span><span class=bound>fg</span><span class=main>⟩</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fa</span> <span class=bound>p</span><span class=main>.</span>         not_call <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟦</span><span class=bound>fa</span><span class=main>⟧</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p1</span> <span class=bound>p2</span><span class=main>.</span>          not_call <span class=main>(</span><span class=bound>p1</span> <span class=main>⊕</span> <span class=bound>p2</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fip</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> not_call <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}unicast(</span><span class=bound>fip</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>▹</span> <span class=bound>q</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       not_call <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}broadcast(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fips</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>  not_call <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}groupcast(</span><span class=bound>fips</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       not_call <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}send(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fdata</span> <span class=bound>p</span><span class=main>.</span>      not_call <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}deliver(</span><span class=bound>fdata</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       not_call <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}receive(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>pn</span><span class=main>.</span>         <span class=main>¬</span><span class=main>(</span>not_call <span class=main>(</span><span class=keyword1>call(</span><span class=bound>pn</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> not_call_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>not_choice</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>not_choice</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>p1</span> <span class=bound>p2</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>≠</span> <span class=bound>p1</span> <span class=main>⊕</span> <span class=bound>p2</span>"</span></span>

<span class=keyword1 id=AWN-not_choice_simps><span class=command>lemma</span></span> not_choice_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fg</span> <span class=bound>p</span><span class=main>.</span>         not_choice <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟨</span><span class=bound>fg</span><span class=main>⟩</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fa</span> <span class=bound>p</span><span class=main>.</span>         not_choice <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟦</span><span class=bound>fa</span><span class=main>⟧</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p1</span> <span class=bound>p2</span><span class=main>.</span>        <span class=main>¬</span><span class=main>(</span>not_choice <span class=main>(</span><span class=bound>p1</span> <span class=main>⊕</span> <span class=bound>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fip</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> not_choice <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}unicast(</span><span class=bound>fip</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>▹</span> <span class=bound>q</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       not_choice <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}broadcast(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fips</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>  not_choice <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}groupcast(</span><span class=bound>fips</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       not_choice <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}send(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fdata</span> <span class=bound>p</span><span class=main>.</span>      not_choice <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}deliver(</span><span class=bound>fdata</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       not_choice <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}receive(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>pn</span><span class=main>.</span>           not_choice <span class=main>(</span><span class=keyword1>call(</span><span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> not_choice_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN-seqp_congs><span class=command>lemma</span></span> seqp_congs<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fg</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟨</span><span class=bound>fg</span><span class=main>⟩</span> <span class=bound>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟨</span><span class=bound>fg</span><span class=main>⟩</span> <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fa</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟦</span><span class=bound>fa</span><span class=main>⟧</span> <span class=bound>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟦</span><span class=bound>fa</span><span class=main>⟧</span> <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p1</span> <span class=bound>p2</span><span class=main>.</span> <span class=bound>p1</span> <span class=main>⊕</span> <span class=bound>p2</span> <span class=main>=</span> <span class=bound>p1</span> <span class=main>⊕</span> <span class=bound>p2</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fip</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}unicast(</span><span class=bound>fip</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>▹</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}unicast(</span><span class=bound>fip</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>▹</span> <span class=bound>q</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}broadcast(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}broadcast(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fips</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}groupcast(</span><span class=bound>fips</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}groupcast(</span><span class=bound>fips</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}send(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}send(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fdata</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}deliver(</span><span class=bound>fdata</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}deliver(</span><span class=bound>fdata</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}receive(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}receive(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>pn</span><span class=main>.</span> <span class=keyword1>call(</span><span class=bound>pn</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>call(</span><span class=bound>pn</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Remove data expressions from process terms.›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>seqp_skeleton</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>⇒</span> <span class=main>(</span>unit<span class=main>,</span> unit<span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>seqp_skeleton</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                 <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>{</span><span class=main>()</span><span class=main>}</span><span class=main>⟩</span> <span class=main>(</span><span class=free>seqp_skeleton</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>seqp_skeleton</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                 <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>()</span><span class=main>⟧</span> <span class=main>(</span><span class=free>seqp_skeleton</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>seqp_skeleton</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span>                   <span class=main>=</span> <span class=main>(</span><span class=free>seqp_skeleton</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>⊕</span> <span class=main>(</span><span class=free>seqp_skeleton</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>seqp_skeleton</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>0</span><span class=main>,</span> <span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>()</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=free>seqp_skeleton</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>▹</span> <span class=main>(</span><span class=free>seqp_skeleton</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>seqp_skeleton</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>      <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>()</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=free>seqp_skeleton</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>seqp_skeleton</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>   <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>{}</span><span class=main>,</span> <span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>()</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=free>seqp_skeleton</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>seqp_skeleton</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>           <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>()</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=free>seqp_skeleton</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>seqp_skeleton</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>        <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>0</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=free>seqp_skeleton</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>seqp_skeleton</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>        <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>()</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=free>seqp_skeleton</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>seqp_skeleton</span> <span class=main>(</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span>                <span class=main>=</span> <span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Calculate the subterms of a term.›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>subterms</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>subterms</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>fg</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>fg</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>}</span> <span class=main>∪</span> <span class=free>subterms</span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subterms</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=free><span class=bound><span class=entity>fa</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=free><span class=bound><span class=entity>fa</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>}</span> <span class=main>∪</span> <span class=free>subterms</span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subterms</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>}</span> <span class=main>∪</span> <span class=free>subterms</span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∪</span> <span class=free>subterms</span> <span class=free><span class=bound><span class=entity>p2</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subterms</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>fip</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span> <span class=main>=</span>
       <span class=main>{</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>fip</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>}</span> <span class=main>∪</span> <span class=free>subterms</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>∪</span> <span class=free>subterms</span> <span class=free><span class=bound><span class=entity>q</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subterms</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>}</span> <span class=main>∪</span> <span class=free>subterms</span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subterms</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=free><span class=bound><span class=entity>fips</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=free><span class=bound><span class=entity>fips</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>}</span> <span class=main>∪</span> <span class=free>subterms</span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subterms</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>}</span> <span class=main>∪</span> <span class=free>subterms</span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subterms</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=free><span class=bound><span class=entity>fdata</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=free><span class=bound><span class=entity>fdata</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>}</span> <span class=main>∪</span> <span class=free>subterms</span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subterms</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>}</span> <span class=main>∪</span> <span class=free>subterms</span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>subterms</span> <span class=main>(</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=AWN-subterms_refl><span class=command>lemma</span></span> subterms_refl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> subterms <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN-subterms_trans><span class=command>lemma</span></span> subterms_trans <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> subterms <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> subterms <span class=free>q</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> subterms <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN-root_in_subterms><span class=command>lemma</span></span> root_in_subterms <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
   <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>pn</span><span class=main>.</span> <span class=main>∃</span><span class=bound>pn'</span><span class=main>.</span> <span class=bound>Γ</span> <span class=bound>pn</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=bound>Γ</span> <span class=bound>pn'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>pn</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=AWN-deriv_in_subterms><span class=command>lemma</span></span> deriv_in_subterms <span class=main>[</span><span class=operator>elim</span><span class=main>,</span> <span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>f</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟨</span><span class=bound>f</span><span class=main>⟩</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span> <span class=main>⟹</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fa</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟦</span><span class=bound>fa</span><span class=main>⟧</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span> <span class=main>⟹</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p1</span> <span class=bound>p2</span> <span class=bound>p</span><span class=main>.</span> <span class=bound>p1</span> <span class=main>⊕</span> <span class=bound>p2</span> <span class=main>∈</span> subterms <span class=bound>p</span> <span class=main>⟹</span> <span class=bound>p1</span> <span class=main>∈</span> subterms <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p1</span> <span class=bound>p2</span> <span class=bound>p</span><span class=main>.</span> <span class=bound>p1</span> <span class=main>⊕</span> <span class=bound>p2</span> <span class=main>∈</span> subterms <span class=bound>p</span> <span class=main>⟹</span> <span class=bound>p2</span> <span class=main>∈</span> subterms <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fip</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span> <span class=bound>r</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}unicast(</span><span class=bound>fip</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>q</span> <span class=main>▹</span> <span class=bound>r</span> <span class=main>∈</span> subterms <span class=bound>p</span> <span class=main>⟹</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fip</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span> <span class=bound>r</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}unicast(</span><span class=bound>fip</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>q</span> <span class=main>▹</span> <span class=bound>r</span> <span class=main>∈</span> subterms <span class=bound>p</span> <span class=main>⟹</span> <span class=bound>r</span> <span class=main>∈</span> subterms <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}broadcast(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span> <span class=main>⟹</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fips</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}groupcast(</span><span class=bound>fips</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span> <span class=main>⟹</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}send(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span> <span class=main>⟹</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fdata</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}deliver(</span><span class=bound>fdata</span><span class=main>)</span><span class=main>.</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span> <span class=main>⟹</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}receive(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span> <span class=main>⟹</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=bound>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Actions"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  There are two sorts of <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>τ›</span></span></span></span> actions in AWN: one at the level of individual processes
  (within nodes), and one at the network level (outside nodes). We define a class so that
  we can ignore this distinction whenever it is not critical.
›</span></span>

<span class=keyword1><span class=command>class</span></span> tau <span class=main>=</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free><span class=free><span class=free>tau</span></span></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span>"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1>τ</span></span></span>"</span><span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>"Sequential Actions (and related predicates)"</span></span>

<span class=keyword1><span class=command>datatype</span></span> <span class=tfree>'m</span> seq_action <span class=main>=</span>
    broadcast <span class=tfree><span class=quoted><span class=tfree>'m</span></span></span>
  <span class=main>|</span> groupcast <span class=quoted><span class=quoted>"ip set"</span></span> <span class=tfree><span class=quoted><span class=tfree>'m</span></span></span>
  <span class=main>|</span> unicast <span class=quoted>ip</span> <span class=tfree><span class=quoted><span class=tfree>'m</span></span></span>
  <span class=main>|</span> notunicast <span class=quoted>ip</span>           <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>¬unicast</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class=main>[</span>1000<span class=main>]</span> 60<span class=main>)</span>
  <span class=main>|</span> send <span class=tfree><span class=quoted><span class=tfree>'m</span></span></span>
  <span class=main>|</span> deliver <span class=quoted>data</span>
  <span class=main>|</span> receive <span class=tfree><span class=quoted><span class=tfree>'m</span></span></span>
  <span class=main>|</span> seq_tau                 <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>τ<span class=hidden>⇩</span><sub>s</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class=main>)</span>

<span class=keyword1><span class=command>instantiation</span></span> <span class=quoted>"seq_action"</span> <span class=main>::</span> <span class=main>(</span><span class=quoted>type</span><span class=main>)</span> <span class=quoted>tau</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>definition</span></span> step_seq_tau <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>τ</span> <span class=main>≡</span> <span class=keyword1>τ<span class=hidden>⇩</span><sub>s</sub></span>"</span></span>
<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>..</span></span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>recvmsg</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'m</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'m</span> seq_action <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>recvmsg</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span> receive <span class=bound>m</span> <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>m</span>
                             <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> True"</span></span>

<span class=keyword1 id=AWN-recvmsg_simps><span class=command>lemma</span></span> recvmsg_simps<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     recvmsg <span class=free>P</span> <span class=main>(</span>broadcast <span class=bound>m</span><span class=main>)</span>     <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ips</span> <span class=bound>m</span><span class=main>.</span> recvmsg <span class=free>P</span> <span class=main>(</span>groupcast <span class=bound>ips</span> <span class=bound>m</span><span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ip</span> <span class=bound>m</span><span class=main>.</span>  recvmsg <span class=free>P</span> <span class=main>(</span>unicast <span class=bound>ip</span> <span class=bound>m</span><span class=main>)</span>    <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ip</span><span class=main>.</span>    recvmsg <span class=free>P</span> <span class=main>(</span>notunicast <span class=bound>ip</span><span class=main>)</span>   <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     recvmsg <span class=free>P</span> <span class=main>(</span>send <span class=bound>m</span><span class=main>)</span>          <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>d</span><span class=main>.</span>     recvmsg <span class=free>P</span> <span class=main>(</span>deliver <span class=bound>d</span><span class=main>)</span>       <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     recvmsg <span class=free>P</span> <span class=main>(</span>receive <span class=bound>m</span><span class=main>)</span>       <span class=main>=</span> <span class=free>P</span> <span class=bound>m</span>"</span></span>
  <span class=quoted><span class=quoted>"        recvmsg <span class=free>P</span> <span class=keyword1>τ<span class=hidden>⇩</span><sub>s</sub></span>                 <span class=main>=</span> True"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> recvmsg_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN-recvmsgTT><span class=command>lemma</span></span> recvmsgTT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"recvmsg TT <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN-recvmsgE><span class=command>lemma</span></span> recvmsgE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"recvmsg <span class=main>(</span><span class=free>R</span> <span class=free>σ</span><span class=main>)</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free>R</span> <span class=free>σ</span> <span class=bound>m</span> <span class=main>⟹</span> <span class=free>R</span> <span class=free>σ'</span> <span class=bound>m</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"recvmsg <span class=main>(</span><span class=free>R</span> <span class=free>σ'</span><span class=main>)</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>anycast</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'m</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'m</span> seq_action <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>anycast</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span> broadcast <span class=bound>m</span> <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>m</span>
                             <span class=main>|</span> groupcast <span class=main><span class=bound>_</span></span> <span class=bound>m</span> <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>m</span>
                             <span class=main>|</span> unicast <span class=main><span class=bound>_</span></span> <span class=bound>m</span> <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>m</span>
                             <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> True"</span></span>

<span class=keyword1 id=AWN-anycast_simps><span class=command>lemma</span></span> anycast_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     anycast <span class=free>P</span> <span class=main>(</span>broadcast <span class=bound>m</span><span class=main>)</span>     <span class=main>=</span> <span class=free>P</span> <span class=bound>m</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ips</span> <span class=bound>m</span><span class=main>.</span> anycast <span class=free>P</span> <span class=main>(</span>groupcast <span class=bound>ips</span> <span class=bound>m</span><span class=main>)</span> <span class=main>=</span> <span class=free>P</span> <span class=bound>m</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ip</span> <span class=bound>m</span><span class=main>.</span>  anycast <span class=free>P</span> <span class=main>(</span>unicast <span class=bound>ip</span> <span class=bound>m</span><span class=main>)</span>    <span class=main>=</span> <span class=free>P</span> <span class=bound>m</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ip</span><span class=main>.</span>    anycast <span class=free>P</span> <span class=main>(</span>notunicast <span class=bound>ip</span><span class=main>)</span>   <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     anycast <span class=free>P</span> <span class=main>(</span>send <span class=bound>m</span><span class=main>)</span>          <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>d</span><span class=main>.</span>     anycast <span class=free>P</span> <span class=main>(</span>deliver <span class=bound>d</span><span class=main>)</span>       <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     anycast <span class=free>P</span> <span class=main>(</span>receive <span class=bound>m</span><span class=main>)</span>       <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"        anycast <span class=free>P</span> <span class=keyword1>τ<span class=hidden>⇩</span><sub>s</sub></span>                 <span class=main>=</span> True"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> anycast_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>orecvmsg</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'m</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'m</span> seq_action <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>orecvmsg</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span> receive <span class=bound>m</span> <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>m</span>
                                         <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> True<span class=main>)</span>"</span></span>

<span class=keyword1 id=AWN-orecvmsg_simps><span class=command>lemma</span></span> orecvmsg_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     orecvmsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span>broadcast <span class=bound>m</span><span class=main>)</span>     <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ips</span> <span class=bound>m</span><span class=main>.</span> orecvmsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span>groupcast <span class=bound>ips</span> <span class=bound>m</span><span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ip</span> <span class=bound>m</span><span class=main>.</span>  orecvmsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span>unicast <span class=bound>ip</span> <span class=bound>m</span><span class=main>)</span>    <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ip</span><span class=main>.</span>    orecvmsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span>notunicast <span class=bound>ip</span><span class=main>)</span>   <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     orecvmsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span>send <span class=bound>m</span><span class=main>)</span>          <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>d</span><span class=main>.</span>     orecvmsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span>deliver <span class=bound>d</span><span class=main>)</span>       <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     orecvmsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span>receive <span class=bound>m</span><span class=main>)</span>       <span class=main>=</span> <span class=free>P</span> <span class=free>σ</span> <span class=bound>m</span>"</span></span>
  <span class=quoted><span class=quoted>"         orecvmsg <span class=free>P</span> <span class=free>σ</span> <span class=keyword1>τ<span class=hidden>⇩</span><sub>s</sub></span>                <span class=main>=</span> True"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> orecvmsg_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN-orecvmsgEI><span class=command>lemma</span></span> orecvmsgEI <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> orecvmsg <span class=free>P</span> <span class=free>σ</span> <span class=free>a</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>σ</span> <span class=bound>a</span><span class=main>.</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>σ</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> orecvmsg <span class=free>Q</span> <span class=free>σ</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN-orecvmsg_stateless_recvmsg><span class=command>lemma</span></span> orecvmsg_stateless_recvmsg <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>P</span><span class=main>)</span> <span class=free>σ</span> <span class=free>a</span> <span class=main>⟹</span> recvmsg <span class=free>P</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN-orecvmsg_recv_weaken><span class=command>lemma</span></span> orecvmsg_recv_weaken <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> orecvmsg <span class=free>P</span> <span class=free>σ</span> <span class=free>a</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>σ</span> <span class=bound>a</span><span class=main>.</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> recvmsg <span class=free>Q</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN-orecvmsg_recvmsg><span class=command>lemma</span></span> orecvmsg_recvmsg <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"orecvmsg <span class=free>P</span> <span class=free>σ</span> <span class=free>a</span> <span class=main>⟹</span> recvmsg <span class=main>(</span><span class=free>P</span> <span class=free>σ</span><span class=main>)</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>sendmsg</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'m</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'m</span> seq_action <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>sendmsg</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span> send <span class=bound>m</span> <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>m</span> <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> True"</span></span>

<span class=keyword1 id=AWN-sendmsg_simps><span class=command>lemma</span></span> sendmsg_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     sendmsg <span class=free>P</span> <span class=main>(</span>broadcast <span class=bound>m</span><span class=main>)</span>     <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ips</span> <span class=bound>m</span><span class=main>.</span> sendmsg <span class=free>P</span> <span class=main>(</span>groupcast <span class=bound>ips</span> <span class=bound>m</span><span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ip</span> <span class=bound>m</span><span class=main>.</span>  sendmsg <span class=free>P</span> <span class=main>(</span>unicast <span class=bound>ip</span> <span class=bound>m</span><span class=main>)</span>    <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ip</span><span class=main>.</span>    sendmsg <span class=free>P</span> <span class=main>(</span>notunicast <span class=bound>ip</span><span class=main>)</span>   <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     sendmsg <span class=free>P</span> <span class=main>(</span>send <span class=bound>m</span><span class=main>)</span>          <span class=main>=</span> <span class=free>P</span> <span class=bound>m</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>d</span><span class=main>.</span>     sendmsg <span class=free>P</span> <span class=main>(</span>deliver <span class=bound>d</span><span class=main>)</span>       <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>     sendmsg <span class=free>P</span> <span class=main>(</span>receive <span class=bound>m</span><span class=main>)</span>       <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"        sendmsg <span class=free>P</span> <span class=keyword1>τ<span class=hidden>⇩</span><sub>s</sub></span>                 <span class=main>=</span> True"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> sendmsg_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>type_synonym</span></span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=tfree>'p</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>"Node Actions (and related predicates)"</span></span>

<span class=keyword1><span class=command>datatype</span></span> <span class=tfree>'m</span> node_action <span class=main>=</span>
    node_cast <span class=quoted><span class=quoted>"ip set"</span></span> <span class=tfree><span class=quoted><span class=tfree>'m</span></span></span>             <span class=main>(</span><span class=quoted>"_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>:*cast'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>       <span class=main>[</span>200<span class=main>,</span> 200<span class=main>]</span> 200<span class=main>)</span>                                                 
  <span class=main>|</span> node_deliver <span class=quoted>ip</span> <span class=quoted>data</span>              <span class=main>(</span><span class=quoted>"_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>:deliver'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>     <span class=main>[</span>200<span class=main>,</span> 200<span class=main>]</span> 200<span class=main>)</span>
  <span class=main>|</span> node_arrive <span class=quoted><span class=quoted>"ip set"</span></span> <span class=quoted><span class=quoted>"ip set"</span></span> <span class=tfree><span class=quoted><span class=tfree>'m</span></span></span>  <span class=main>(</span><span class=quoted>"_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>¬</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>:arrive'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>    <span class=main>[</span>200<span class=main>,</span> 200<span class=main>,</span> 200<span class=main>]</span> 200<span class=main>)</span>
  <span class=main>|</span> node_connect <span class=quoted>ip</span> <span class=quoted>ip</span>                <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>connect'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>    <span class=main>[</span>200<span class=main>,</span> 200<span class=main>]</span> 200<span class=main>)</span>
  <span class=main>|</span> node_disconnect <span class=quoted>ip</span> <span class=quoted>ip</span>             <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>disconnect'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class=main>[</span>200<span class=main>,</span> 200<span class=main>]</span> 200<span class=main>)</span>
  <span class=main>|</span> node_newpkt <span class=quoted>ip</span> <span class=quoted>data</span> <span class=quoted>ip</span>            <span class=main>(</span><span class=quoted>"_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>:newpkt'(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>,</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>')</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>   <span class=main>[</span>200<span class=main>,</span> 200<span class=main>,</span> 200<span class=main>]</span> 200<span class=main>)</span>
  <span class=main>|</span> node_tau                          <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>τ<span class=hidden>⇩</span><sub>n</sub></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class=main>)</span>

<span class=keyword1><span class=command>instantiation</span></span> <span class=quoted>"node_action"</span> <span class=main>::</span> <span class=main>(</span><span class=quoted>type</span><span class=main>)</span> <span class=quoted>tau</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>definition</span></span> step_node_tau <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>τ</span> <span class=main>≡</span> <span class=keyword1>τ<span class=hidden>⇩</span><sub>n</sub></span>"</span></span>
<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>..</span></span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>arrivemsg</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ip <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'m</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'m</span> node_action <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>arrivemsg</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span> node_arrive <span class=bound>ii</span> <span class=bound>ni</span> <span class=bound>m</span> <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=bound>ii</span> <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>}</span> <span class=main>⟶</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>m</span><span class=main>)</span><span class=main>)</span>
                                  <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> True"</span></span>

<span class=keyword1 id=AWN-arrivemsg_simps><span class=command>lemma</span></span> arrivemsg_simps<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>R</span> <span class=bound>m</span><span class=main>.</span>       arrivemsg <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=bound>R</span><span class=keyword1>:*cast(</span><span class=bound>m</span><span class=main>)</span><span class=main>)</span>         <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>d</span> <span class=bound>m</span><span class=main>.</span>       arrivemsg <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=bound>d</span><span class=keyword1>:deliver(</span><span class=bound>m</span><span class=main>)</span><span class=main>)</span>       <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>ii</span> <span class=bound>ni</span> <span class=bound>m</span><span class=main>.</span> arrivemsg <span class=bound>i</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ii</span><span class=main>¬</span><span class=bound>ni</span><span class=keyword1>:arrive(</span><span class=bound>m</span><span class=main>)</span><span class=main>)</span>    <span class=main>=</span> <span class=main>(</span><span class=bound>ii</span> <span class=main>=</span> <span class=main>{</span><span class=bound>i</span><span class=main>}</span> <span class=main>⟶</span> <span class=free>P</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i1</span> <span class=bound>i2</span><span class=main>.</span>     arrivemsg <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=keyword1>connect(</span><span class=bound>i1</span><span class=main>,</span> <span class=bound>i2</span><span class=main>)</span><span class=main>)</span>    <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i1</span> <span class=bound>i2</span><span class=main>.</span>     arrivemsg <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=keyword1>disconnect(</span><span class=bound>i1</span><span class=main>,</span> <span class=bound>i2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span> <span class=bound>d</span> <span class=bound>di</span><span class=main>.</span> arrivemsg <span class=bound>i</span> <span class=free>P</span> <span class=main>(</span><span class=bound>i'</span><span class=keyword1>:newpkt(</span><span class=bound>d</span><span class=main>,</span> <span class=bound>di</span><span class=main>)</span><span class=main>)</span>   <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"             arrivemsg <span class=free>i</span> <span class=free>P</span> <span class=keyword1>τ<span class=hidden>⇩</span><sub>n</sub></span>                   <span class=main>=</span> True"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> arrivemsg_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN-arrivemsgTT><span class=command>lemma</span></span> arrivemsgTT <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"arrivemsg <span class=free>i</span> TT <span class=main>=</span> TT"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> arrivemsg_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> node_action.split<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>oarrivemsg</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'m</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'m</span> node_action <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>oarrivemsg</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span> node_arrive <span class=bound>ii</span> <span class=bound>ni</span> <span class=bound>m</span> <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>m</span> <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> True"</span></span>

<span class=keyword1 id=AWN-oarrivemsg_simps><span class=command>lemma</span></span> oarrivemsg_simps<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>R</span> <span class=bound>m</span><span class=main>.</span>       oarrivemsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span><span class=bound>R</span><span class=keyword1>:*cast(</span><span class=bound>m</span><span class=main>)</span><span class=main>)</span>         <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>d</span> <span class=bound>m</span><span class=main>.</span>       oarrivemsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span><span class=bound>d</span><span class=keyword1>:deliver(</span><span class=bound>m</span><span class=main>)</span><span class=main>)</span>       <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>ii</span> <span class=bound>ni</span> <span class=bound>m</span><span class=main>.</span> oarrivemsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span><span class=bound>ii</span><span class=main>¬</span><span class=bound>ni</span><span class=keyword1>:arrive(</span><span class=bound>m</span><span class=main>)</span><span class=main>)</span>    <span class=main>=</span> <span class=free>P</span> <span class=free>σ</span> <span class=bound>m</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i1</span> <span class=bound>i2</span><span class=main>.</span>     oarrivemsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span><span class=keyword1>connect(</span><span class=bound>i1</span><span class=main>,</span> <span class=bound>i2</span><span class=main>)</span><span class=main>)</span>    <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i1</span> <span class=bound>i2</span><span class=main>.</span>     oarrivemsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span><span class=keyword1>disconnect(</span><span class=bound>i1</span><span class=main>,</span> <span class=bound>i2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span> <span class=bound>d</span> <span class=bound>di</span><span class=main>.</span> oarrivemsg <span class=free>P</span> <span class=free>σ</span> <span class=main>(</span><span class=bound>i'</span><span class=keyword1>:newpkt(</span><span class=bound>d</span><span class=main>,</span> <span class=bound>di</span><span class=main>)</span><span class=main>)</span>   <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"             oarrivemsg <span class=free>P</span> <span class=free>σ</span> <span class=keyword1>τ<span class=hidden>⇩</span><sub>n</sub></span>                   <span class=main>=</span> True"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> oarrivemsg_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN-oarrivemsg_True><span class=command>lemma</span></span> oarrivemsg_True <span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"oarrivemsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=free>σ</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>castmsg</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'m</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'m</span> node_action <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>castmsg</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=keyword1>of</span> <span class=main><span class=bound>_</span></span><span class=keyword1>:*cast(</span><span class=bound>m</span><span class=main>)</span> <span class=main>⇒</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=bound>m</span>
                              <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> True"</span></span>

<span class=keyword1 id=AWN-castmsg_simps><span class=command>lemma</span></span> castmsg_simps<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>R</span> <span class=bound>m</span><span class=main>.</span>       castmsg <span class=free>P</span> <span class=main>(</span><span class=bound>R</span><span class=keyword1>:*cast(</span><span class=bound>m</span><span class=main>)</span><span class=main>)</span>         <span class=main>=</span> <span class=free>P</span> <span class=bound>m</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>d</span> <span class=bound>m</span><span class=main>.</span>       castmsg <span class=free>P</span> <span class=main>(</span><span class=bound>d</span><span class=keyword1>:deliver(</span><span class=bound>m</span><span class=main>)</span><span class=main>)</span>       <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>ii</span> <span class=bound>ni</span> <span class=bound>m</span><span class=main>.</span> castmsg <span class=free>P</span> <span class=main>(</span><span class=bound>ii</span><span class=main>¬</span><span class=bound>ni</span><span class=keyword1>:arrive(</span><span class=bound>m</span><span class=main>)</span><span class=main>)</span>    <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i1</span> <span class=bound>i2</span><span class=main>.</span>     castmsg <span class=free>P</span> <span class=main>(</span><span class=keyword1>connect(</span><span class=bound>i1</span><span class=main>,</span> <span class=bound>i2</span><span class=main>)</span><span class=main>)</span>    <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i1</span> <span class=bound>i2</span><span class=main>.</span>     castmsg <span class=free>P</span> <span class=main>(</span><span class=keyword1>disconnect(</span><span class=bound>i1</span><span class=main>,</span> <span class=bound>i2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span> <span class=bound>d</span> <span class=bound>di</span><span class=main>.</span> castmsg <span class=free>P</span> <span class=main>(</span><span class=bound>i'</span><span class=keyword1>:newpkt(</span><span class=bound>d</span><span class=main>,</span> <span class=bound>di</span><span class=main>)</span><span class=main>)</span>   <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"             castmsg <span class=free>P</span> <span class=keyword1>τ<span class=hidden>⇩</span><sub>n</sub></span>                   <span class=main>=</span> True"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> castmsg_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Networks"</span></span>

<span class=keyword1><span class=command>datatype</span></span> net_tree <span class=main>=</span>
    Node <span class=quoted>ip</span> <span class=quoted><span class=quoted>"ip set"</span></span>          <span class=main>(</span><span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>⟨</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>⟩</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class=main>)</span>
  <span class=main>|</span> Subnet <span class=quoted>net_tree</span> <span class=quoted>net_tree</span>  <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>∥</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 90<span class=main>)</span>

<span class=keyword1><span class=command>declare</span></span> net_tree.induct <span class=main>[</span><span class=main>[</span><span class=operator>induct</span> <span class=quasi_keyword>del</span><span class=main>]</span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> net_tree_induct <span class=main>[</span><span class=operator>induct</span> <span class=quasi_keyword>type</span><span class=main><span class=main>:</span></span> net_tree<span class=main>]</span> <span class=main>=</span> net_tree.induct <span class=main>[</span><span class=operator>rename_abs</span> i R p1 p2<span class=main>]</span>

<span class=keyword1><span class=command>datatype</span></span> <span class=tfree>'s</span> net_state <span class=main>=</span>
    NodeS <span class=quoted>ip</span> <span class=tfree><span class=quoted><span class=tfree>'s</span></span></span> <span class=quoted><span class=quoted>"ip set"</span></span>
  <span class=main>|</span> SubnetS <span class=quoted><span class=quoted>"<span class=tfree>'s</span> net_state"</span></span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> net_state"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>net_ips</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> net_state <span class=main>⇒</span> ip set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>net_ips</span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>}</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>net_ips</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>n1</span></span></span> <span class=free><span class=bound><span class=entity>n2</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>net_ips</span> <span class=free><span class=bound><span class=entity>n1</span></span></span> <span class=main>∪</span> <span class=free>net_ips</span> <span class=free><span class=bound><span class=entity>n2</span></span></span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>net_tree_ips</span> <span class=main>::</span> <span class=quoted><span class=quoted>"net_tree <span class=main>⇒</span> ip set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>net_tree_ips</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∥</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>net_tree_ips</span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∪</span> <span class=free>net_tree_ips</span> <span class=free><span class=bound><span class=entity>p2</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>net_tree_ips</span> <span class=main>(</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>⟩</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1 id=AWN-net_tree_ips_commute><span class=command>lemma</span></span> net_tree_ips_commute<span class=main>:</span>
  <span class=quoted><span class=quoted>"net_tree_ips <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span> <span class=main>=</span> net_tree_ips <span class=main>(</span><span class=free>p2</span> <span class=main>∥</span> <span class=free>p1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule</span> Un_commute<span class=main>)</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>wf_net_tree</span> <span class=main>::</span> <span class=quoted><span class=quoted>"net_tree <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
   <span class=quoted><span class=quoted>"<span class=free>wf_net_tree</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∥</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>net_tree_ips <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∩</span> net_tree_ips <span class=free><span class=bound><span class=entity>p2</span></span></span> <span class=main>=</span> <span class=main>{}</span>
                             <span class=main>∧</span> <span class=free>wf_net_tree</span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∧</span> <span class=free>wf_net_tree</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span>"</span></span>
 <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>wf_net_tree</span> <span class=main>(</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>⟩</span><span class=main>)</span> <span class=main>=</span> True"</span></span>

<span class=keyword1 id=AWN-wf_net_tree_children><span class=command>lemma</span></span> wf_net_tree_children <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>p1</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>p2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>netmap</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> net_state <span class=main>⇒</span> ip <span class=main>⇒</span> <span class=tfree>'s</span> option"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>netmap</span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=free><span class=bound><span class=entity>R<span class=hidden>⇩</span><sub>i</sub></span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>↦</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>netmap</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>netmap</span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>++</span> <span class=free>netmap</span> <span class=free><span class=bound><span class=entity>t</span></span></span>"</span></span>

<span class=keyword1 id=AWN-not_in_netmap><span class=command>lemma</span></span> not_in_netmap <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_ips <span class=free>ns</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>ns</span> <span class=free>i</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ns</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN-netmap_none_not_in_net_ips><span class=command>lemma</span></span> netmap_none_not_in_net_ips<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>ns</span> <span class=free>i</span> <span class=main>=</span> None"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∉</span>net_ips <span class=free>ns</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>ns</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN-net_ips_is_dom_netmap><span class=command>lemma</span></span> net_ips_is_dom_netmap<span class=main>:</span> <span class=quoted><span class=quoted>"net_ips <span class=free>s</span> <span class=main>=</span> dom<span class=main>(</span>netmap <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>p</span> <span class=main>::</span> <span class=tfree><span class=quoted><span class=tfree>'s</span></span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"net_ips <span class=main>(</span>NodeS <span class=skolem>i</span> <span class=skolem>p</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span> <span class=main>=</span> dom <span class=main>(</span>netmap <span class=main>(</span>NodeS <span class=skolem>i</span> <span class=skolem>p</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s1</span> <span class=skolem>s2</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> net_state"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1</span> <span class=main>=</span> dom <span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2</span> <span class=main>=</span> dom <span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"net_ips <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> dom <span class=main>(</span>netmap <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN-in_netmap><span class=command>lemma</span></span> in_netmap <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>ns</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>ns</span> <span class=free>i</span> <span class=main>≠</span> None"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>

<span class=keyword1 id=AWN-netmap_subnets_same><span class=command>lemma</span></span> netmap_subnets_same<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>s1</span> <span class=free>i</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>s2</span> <span class=free>i</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netmap <span class=main>(</span>SubnetS <span class=free>s1</span> <span class=free>s2</span><span class=main>)</span> <span class=free>i</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> map_add_dom_app_simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> map_add_dom_app_simps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id=AWN-netmap_subnets_samef><span class=command>lemma</span></span> netmap_subnets_samef<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>s1</span> <span class=main>=</span> <span class=free>f</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>s2</span> <span class=main>=</span> <span class=free>f</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netmap <span class=main>(</span>SubnetS <span class=free>s1</span> <span class=free>s2</span><span class=main>)</span> <span class=main>=</span> <span class=free>f</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> map_add_le_mapI map_le_antisym map_le_map_add map_le_refl<span class=main>)</span>

<span class=keyword1 id=AWN-netmap_add_disjoint><span class=command>lemma</span></span> netmap_add_disjoint <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=free>s1</span> <span class=main>∪</span> net_ips <span class=free>s2</span><span class=main>.</span> the <span class=main>(</span><span class=main>(</span>netmap <span class=free>s1</span> <span class=main>++</span> netmap <span class=free>s2</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s1</span> <span class=main>∩</span> net_ips <span class=free>s2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=free>s1</span><span class=main>.</span> the <span class=main>(</span>netmap <span class=free>s1</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_ips <span class=free>s1</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> dom<span class=main>(</span>netmap <span class=free>s1</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> dom<span class=main>(</span>netmap <span class=free>s2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>netmap <span class=free>s1</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>=</span> the <span class=main>(</span><span class=main>(</span>netmap <span class=free>s1</span> <span class=main>++</span> netmap <span class=free>s2</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_add_dom_app_simps<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=free>s1</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>netmap <span class=free>s1</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=skolem>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN-netmap_add_disjoint2><span class=command>lemma</span></span> netmap_add_disjoint2 <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=free>s1</span> <span class=main>∪</span> net_ips <span class=free>s2</span><span class=main>.</span> the <span class=main>(</span><span class=main>(</span>netmap <span class=free>s1</span> <span class=main>++</span> netmap <span class=free>s2</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=free>s2</span><span class=main>.</span> the <span class=main>(</span>netmap <span class=free>s2</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
                 <span class=main>(</span><span class=operator>metis</span> Un_iff map_add_dom_app_simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id=AWN-net_ips_netmap_subnet><span class=command>lemma</span></span> net_ips_netmap_subnet <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s1</span> <span class=main>∩</span> net_ips <span class=free>s2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=main>(</span>SubnetS <span class=free>s1</span> <span class=free>s2</span><span class=main>)</span><span class=main>.</span> the <span class=main>(</span>netmap <span class=main>(</span>SubnetS <span class=free>s1</span> <span class=free>s2</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=free>s1</span><span class=main>.</span> the <span class=main>(</span>netmap <span class=free>s1</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=free>s2</span><span class=main>.</span> the <span class=main>(</span>netmap <span class=free>s2</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=free>s1</span> <span class=main>∪</span> net_ips <span class=free>s2</span><span class=main>.</span> the <span class=main>(</span><span class=main>(</span>netmap <span class=free>s1</span> <span class=main>++</span> netmap <span class=free>s2</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=free>s1</span><span class=main>.</span> the <span class=main>(</span>netmap <span class=free>s1</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> netmap_add_disjoint<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=free>s1</span> <span class=main>∪</span> net_ips <span class=free>s2</span><span class=main>.</span> the <span class=main>(</span><span class=main>(</span>netmap <span class=free>s1</span> <span class=main>++</span> netmap <span class=free>s2</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=free>s2</span><span class=main>.</span> the <span class=main>(</span>netmap <span class=free>s2</span> <span class=bound>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span> netmap_add_disjoint2<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>inoclosed</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'m</span><span class=main>::</span>msg node_action <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>inoclosed</span> <span class=main><span class=bound><span class=entity>_</span></span></span> <span class=main>(</span>node_arrive <span class=free><span class=bound><span class=entity>ii</span></span></span> <span class=free><span class=bound><span class=entity>ni</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span> <span class=main>=</span> eq_newpkt <span class=free><span class=bound><span class=entity>m</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>inoclosed</span> <span class=main><span class=bound><span class=entity>_</span></span></span> <span class=main>(</span>node_newpkt <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>d</span></span></span> <span class=free><span class=bound><span class=entity>di</span></span></span><span class=main>)</span>  <span class=main>=</span> False"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>inoclosed</span> <span class=main><span class=bound><span class=entity>_</span></span></span> <span class=main><span class=bound><span class=entity>_</span></span></span> <span class=main>=</span> True"</span></span>

<span class=keyword1 id=AWN-inclosed_simps><span class=command>lemma</span></span> inclosed_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ii</span> <span class=bound>ni</span><span class=main>.</span> inoclosed <span class=bound>σ</span> <span class=main>(</span><span class=bound>ii</span><span class=main>¬</span><span class=bound>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>)</span>   <span class=main>=</span> eq_newpkt <span class=free>m</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>d</span> <span class=bound>di</span><span class=main>.</span>  inoclosed <span class=bound>σ</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:newpkt(</span><span class=bound>d</span><span class=main>,</span> <span class=bound>di</span><span class=main>)</span><span class=main>)</span>   <span class=main>=</span> False"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>R</span> <span class=bound>m</span><span class=main>.</span>   inoclosed <span class=bound>σ</span> <span class=main>(</span><span class=bound>R</span><span class=keyword1>:*cast(</span><span class=bound>m</span><span class=main>)</span><span class=main>)</span>        <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>i</span> <span class=bound>d</span><span class=main>.</span>   inoclosed <span class=bound>σ</span> <span class=main>(</span><span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span>      <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>i</span> <span class=bound>i'</span><span class=main>.</span>  inoclosed <span class=bound>σ</span> <span class=main>(</span><span class=keyword1>connect(</span><span class=bound>i</span><span class=main>,</span> <span class=bound>i'</span><span class=main>)</span><span class=main>)</span>    <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>i</span> <span class=bound>i'</span><span class=main>.</span>  inoclosed <span class=bound>σ</span> <span class=main>(</span><span class=keyword1>disconnect(</span><span class=bound>i</span><span class=main>,</span> <span class=bound>i'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> True"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span><span class=main>.</span>       inoclosed <span class=bound>σ</span> <span class=main>(</span><span class=keyword1>τ</span><span class=main>)</span>                 <span class=main>=</span> True"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>netmask</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ip set <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span> option<span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>netmask</span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>i</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>I</span></span></span> <span class=keyword1>then</span> Some <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=bound>i</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>,</span> snd <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id="AWN-netmask_def'"><span class=command>lemma</span></span> netmask_def' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"netmask <span class=free>I</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>i</span><span class=main>∈</span><span class=free>I</span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=free>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> netmask_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>netgmap</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'s</span> net_state <span class=main>⇒</span> <span class=main>(</span>nat <span class=main>⇒</span> <span class=tfree>'g</span> option<span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>netgmap</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>[</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>↦</span> fst <span class=main>(</span><span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>]</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>(</span>snd <span class=main>(</span><span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>netgmap</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>σ<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>ss</span><span class=main>)</span> <span class=main>=</span> <span class=free>netgmap</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=keyword1>in</span>
                                   <span class=keyword1>let</span> <span class=main>(</span><span class=bound>σ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>,</span> <span class=bound>tt</span><span class=main>)</span> <span class=main>=</span> <span class=free>netgmap</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>2</sub></span></span></span> <span class=keyword1>in</span>
                                   <span class=main>(</span><span class=bound>σ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>++</span> <span class=bound>σ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>,</span> SubnetS <span class=bound>ss</span> <span class=bound>tt</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=AWN-dom_fst_netgmap><span class=command>lemma</span></span> dom_fst_netgmap <span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> net_ips <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>s</span> <span class=skolem>R</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>NodeS <span class=skolem>i</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> net_ips <span class=main>(</span>NodeS <span class=skolem>i</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n1</span> <span class=skolem>n2</span>
    <span class=keyword3><span class=command>assume</span></span> a1<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> net_ips <span class=skolem>n1</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> a2<span class=main>:</span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> net_ips <span class=skolem>n2</span>"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>ζ<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=skolem><span class=skolem>σ<span class=hidden>⇩</span><sub>2</sub></span></span> <span class=skolem><span class=skolem>ζ<span class=hidden>⇩</span><sub>2</sub></span></span> <span class=keyword2><span class=keyword>where</span></span> nm1<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>n1</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=skolem>ζ<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
                        <span class=keyword2><span class=keyword>and</span></span> nm2<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>n2</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>,</span> <span class=skolem>ζ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> surj_pair<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>n1</span> <span class=skolem>n2</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>++</span> <span class=skolem>σ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>,</span> SubnetS <span class=skolem>ζ<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>ζ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>n1</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> dom <span class=main>(</span><span class=skolem>σ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>++</span> <span class=skolem>σ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> a1 a2 nm1 nm2 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span><span class=skolem>σ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>++</span> <span class=skolem>σ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>=</span> net_ips <span class=main>(</span>SubnetS <span class=skolem>n1</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"dom <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>n1</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> net_ips <span class=main>(</span>SubnetS <span class=skolem>n1</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN-netgmap_pair_dom><span class=command>lemma</span></span> netgmap_pair_dom <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>σ</span> <span class=free>ζ</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>n</span> <span class=main>=</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"dom <span class=free>σ</span> <span class=main>=</span> net_ips <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> dom_fst_netgmap surjective_pairing<span class=main>)</span>

<span class=keyword1 id=AWN-net_ips_netgmap><span class=command>lemma</span></span> net_ips_netgmap <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"net_ips <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> net_ips <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s1</span> <span class=skolem>s2</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"net_ips <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> net_ips <span class=skolem>s1</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> net_ips <span class=skolem>s2</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"net_ips <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> net_ips <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN-some_the_fst_netgmap><span class=command>lemma</span></span> some_the_fst_netgmap<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Some <span class=main>(</span>the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> domIff dom_fst_netgmap option.collapse<span class=main>)</span>


<span class=keyword1 id=AWN-fst_netgmap_none><span class=command>lemma</span></span> fst_netgmap_none <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_ips <span class=free>s</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=free>i</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> domIff dom_fst_netgmap<span class=main>)</span>

<span class=keyword1 id=AWN-fst_netgmap_subnet><span class=command>lemma</span></span> fst_netgmap_subnet <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"fst <span class=main>(</span><span class=keyword1>case</span> netgmap <span class=free>sr</span> <span class=free>s1</span> <span class=keyword1>of</span> <span class=main>(</span><span class=bound>σ<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>ss</span><span class=main>)</span> <span class=main>⇒</span>
        <span class=keyword1>case</span> netgmap <span class=free>sr</span> <span class=free>s2</span> <span class=keyword1>of</span> <span class=main>(</span><span class=bound>σ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>,</span> <span class=bound>tt</span><span class=main>)</span> <span class=main>⇒</span>
        <span class=main>(</span><span class=bound>σ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>++</span> <span class=bound>σ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>,</span> SubnetS <span class=bound>ss</span> <span class=bound>tt</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span> <span class=main>++</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>)</span></span> fst_conv netgmap_pair_dom split_conv<span class=main>)</span>

<span class=keyword1 id=AWN-snd_netgmap_subnet><span class=command>lemma</span></span> snd_netgmap_subnet <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"snd <span class=main>(</span><span class=keyword1>case</span> netgmap <span class=free>sr</span> <span class=free>s1</span> <span class=keyword1>of</span> <span class=main>(</span><span class=bound>σ<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=bound>ss</span><span class=main>)</span> <span class=main>⇒</span>
        <span class=keyword1>case</span> netgmap <span class=free>sr</span> <span class=free>s2</span> <span class=keyword1>of</span> <span class=main>(</span><span class=bound>σ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>,</span> <span class=bound>tt</span><span class=main>)</span> <span class=main>⇒</span>
        <span class=main>(</span><span class=bound>σ<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>++</span> <span class=bound>σ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>,</span> SubnetS <span class=bound>ss</span> <span class=bound>tt</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>SubnetS <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>lifting<span class=main><span class=main>,</span></span> no_types<span class=main><span class=main>)</span></span> Pair_inject split_beta' surjective_pairing<span class=main>)</span>

<span class=keyword1 id=AWN-fst_netgmap_not_none><span class=command>lemma</span></span> fst_netgmap_not_none <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=free>i</span> <span class=main>≠</span> None"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>s</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN-netgmap_netgmap_not_rhs><span class=command>lemma</span></span> netgmap_netgmap_not_rhs <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_ips <span class=free>s2</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span> <span class=main>++</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>=</span> <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> dom <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_add_dom_app_simps<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN-netgmap_netgmap_rhs><span class=command>lemma</span></span> netgmap_netgmap_rhs <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>s2</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span> <span class=main>++</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>=</span> <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_add_dom_app_simps<span class=main>)</span>

<span class=keyword1 id=AWN-netgmap_netmask_subnets><span class=command>lemma</span></span> netgmap_netmask_subnets <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=free>s1</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span>
            <span class=main>=</span> fst <span class=main>(</span>netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>n1</span> <span class=main>∥</span> <span class=free>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=free>s1</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>n1</span> <span class=main>∨</span> <span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>n2</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>i</span><span class=main>∉</span>net_tree_ips <span class=free>n1</span> <span class=main>∪</span> net_tree_ips <span class=free>n2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=free>s1</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span>
            <span class=main>=</span> fst <span class=main>(</span>netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>n1</span> <span class=main>∥</span> <span class=free>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=free>s1</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>elim</span> disjE<span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>n1</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span><span class=main>)</span>›</span></span>
           <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s1</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s2</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
             <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>lifting<span class=main><span class=main>,</span></span> mono_tags<span class=main><span class=main>)</span></span> map_add_Some_iff<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>n2</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>lifting<span class=main><span class=main>,</span></span> mono_tags<span class=main><span class=main>)</span></span> fst_conv map_add_find_right<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∉</span>net_tree_ips <span class=free>n1</span> <span class=main>∪</span> net_tree_ips <span class=free>n2</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span><span class=main>)</span>›</span></span>
           <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>lifting<span class=main><span class=main>,</span></span> mono_tags<span class=main><span class=main>)</span></span> fst_conv<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="AWN-netgmap_netmask_subnets'"><span class=command>lemma</span></span> netgmap_netmask_subnets' <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> SubnetS <span class=free>s1</span> <span class=free>s2</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>n1</span> <span class=main>∥</span> <span class=free>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>rule</span> prod_eqI <span class=main><span class=main>[</span></span><span class=operator>OF</span> netgmap_netmask_subnets <span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1-2<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=AWN-netgmap_subnet_split1><span class=command>lemma</span></span> netgmap_subnet_split1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=free>s1</span> <span class=free>s2</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>n1</span> <span class=main>∥</span> <span class=free>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=free>n1</span> <span class=main>∩</span> net_tree_ips <span class=free>n2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s1</span> <span class=main>=</span> net_tree_ips <span class=free>n1</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s2</span> <span class=main>=</span> net_tree_ips <span class=free>n2</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> prod_eqI<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netmask <span class=main>(</span>net_tree_ips <span class=free>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>intro</span> conjI impI<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=free>n1</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>n1</span> <span class=main>∩</span> net_tree_ips <span class=free>n2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∉</span>net_tree_ips <span class=free>n2</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=main>[</span><span class=operator>simplified</span> prod_eq_iff<span class=main>]</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span> <span class=main>++</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span>
                 <span class=main>(</span><span class=keyword1>if</span> <span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>n1</span> <span class=main>∨</span> <span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>n2</span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=free>σ</span> <span class=skolem>i</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∉</span>net_tree_ips <span class=free>n2</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=free>s2</span> <span class=main>=</span> net_tree_ips <span class=free>n2</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span> <span class=main>++</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> dom_fst_netgmap map_add_dom_app_simps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>σ</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=free>n1</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=free>n1</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=free>s1</span> <span class=main>=</span> net_tree_ips <span class=free>n1</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_ips <span class=free>s1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> None"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN-netgmap_subnet_split2><span class=command>lemma</span></span> netgmap_subnet_split2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=free>s1</span> <span class=free>s2</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>n1</span> <span class=main>∥</span> <span class=free>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s1</span> <span class=main>=</span> net_tree_ips <span class=free>n1</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s2</span> <span class=main>=</span> net_tree_ips <span class=free>n2</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> prod_eqI<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netmask <span class=main>(</span>net_tree_ips <span class=free>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>intro</span> conjI impI<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=free>n2</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=main>[</span><span class=operator>simplified</span> prod_eq_iff<span class=main>]</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span> <span class=main>++</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span>
                 <span class=main>(</span><span class=keyword1>if</span> <span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>n1</span> <span class=main>∨</span> <span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>n2</span> <span class=keyword1>then</span> Some <span class=main>(</span><span class=free>σ</span> <span class=skolem>i</span><span class=main>)</span> <span class=keyword1>else</span> None<span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=free>n2</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=free>s2</span> <span class=main>=</span> net_tree_ips <span class=free>n2</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s1</span><span class=main>)</span> <span class=main>++</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> dom_fst_netgmap map_add_dom_app_simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> Some <span class=main>(</span><span class=free>σ</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=free>n2</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=free>n2</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=free>s2</span> <span class=main>=</span> net_tree_ips <span class=free>n2</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_ips <span class=free>s2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s2</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> None"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN-netmap_fst_netgmap_rel><span class=command>lemma</span></span> netmap_fst_netgmap_rel<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> map_option <span class=main>(</span>fst <span class=keyword1>o</span> <span class=free>sr</span><span class=main>)</span> <span class=main>(</span>netmap <span class=free>s</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> map_option <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>(</span>netmap <span class=main>(</span>NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s1</span> <span class=skolem>s2</span>
    <span class=keyword3><span class=command>assume</span></span> a1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> map_option <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> a2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> map_option <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>(</span>netmap <span class=skolem>s2</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> map_option <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>(</span>netmap <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
      <span class=keyword1><span class=command>from</span></span> a1 a2 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"map_option <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span>
                                    <span class=main>=</span> <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span> <span class=main>++</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> fst_conv map_add_dom_app_simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> map_add_dom_app_simps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span>
                  net_ips_is_dom_netmap netgmap_pair_dom<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"map_option <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>(</span>netmap <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN-netmap_is_fst_netgmap><span class=command>lemma</span></span> netmap_is_fst_netgmap<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>s'</span> <span class=main>=</span> netmap <span class=free>s</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> netmap_fst_netgmap_rel<span class=main>)</span>

<span class=keyword1 id="AWN-netmap_is_fst_netgmap'"><span class=command>lemma</span></span> netmap_is_fst_netgmap'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>s'</span> <span class=free>i</span> <span class=main>=</span> netmap <span class=free>s</span> <span class=free>i</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=free>i</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> netmap_fst_netgmap_rel<span class=main>)</span>

<span class=keyword1 id=AWN-fst_netgmap_pair_fst><span class=command>lemma</span></span> fst_netgmap_pair_fst <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=bound>p</span><span class=main>,</span> snd <span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=free>s</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netgmap fst <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>s</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Introduce streamlined alternatives to netgmap to simplify certain property
        statements and thus make them easier to understand and to present.›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>netlift</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'s</span> net_state <span class=main>⇒</span> <span class=main>(</span>nat <span class=main>⇒</span> <span class=tfree>'g</span> option<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>netlift</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>↦</span> fst <span class=main>(</span><span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>netlift</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>netlift</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span> <span class=main>++</span> <span class=main>(</span><span class=free>netlift</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=AWN-fst_netgmap_netlift><span class=command>lemma</span></span> fst_netgmap_netlift<span class=main>:</span>
  <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=main>=</span> netlift <span class=free>sr</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>s</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>netliftl</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'s</span> net_state <span class=main>⇒</span> <span class=tfree>'l</span> net_state"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>netliftl</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>=</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>(</span>snd <span class=main>(</span><span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>R</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>netliftl</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span> <span class=main>=</span> SubnetS <span class=main>(</span><span class=free>netliftl</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>netliftl</span> <span class=free><span class=bound><span class=entity>sr</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=AWN-snd_netgmap_netliftl><span class=command>lemma</span></span> snd_netgmap_netliftl<span class=main>:</span>
  <span class=quoted><span class=quoted>"snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=main>=</span> netliftl <span class=free>sr</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>s</span></span><span class=main>)</span> <span class=operator>simp_all</span>
 
<span class=keyword1 id=AWN-netgmap_netlift_netliftl><span class=command>lemma</span></span> netgmap_netlift_netliftl<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> <span class=main>(</span>netlift <span class=free>sr</span> <span class=free>s</span><span class=main>,</span> netliftl <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fst_netgmap_netlift snd_netgmap_netliftl<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=AWN_SOS><div class=head><h1>Theory AWN_SOS</h1></div><pre class=source><span class=comment1>(*  Title:       AWN_SOS.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Semantics of the Algebra of Wireless Networks"</span></span>

<span class=keyword1><span class=command>theory</span></span> AWN_SOS
<span class=keyword2><span class=keyword>imports</span></span> <a href=TransitionSystems.html>TransitionSystems</a> <a href=AWN.html>AWN</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Table 1: Structural operational semantics for sequential process expressions "</span></span>

<span class=keyword1><span class=command>inductive_set</span></span>
  <span class=entity>seqp_sos</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span> <span class=main>×</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp<span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>Γ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    broadcastT<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>          broadcast <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>)</span><span class=main>,</span>         <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span>
  <span class=main>|</span> groupcastT<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>    groupcast <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span></span></span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span>
  <span class=main>|</span> unicastT<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>,</span>   unicast <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>)</span><span class=main>,</span>    <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span>
  <span class=main>|</span> notunicastT<span class=main>:</span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>,</span>    <span class=keyword1>¬unicast</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>)</span><span class=main>,</span>          <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span>
  <span class=main>|</span> sendT<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>               send <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>)</span><span class=main>,</span>              <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span>
  <span class=main>|</span> deliverT<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>           deliver <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span></span></span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>)</span><span class=main>,</span>          <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span>
  <span class=main>|</span> receiveT<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=free><span class=bound><span class=entity>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>            receive <span class=free><span class=bound><span class=entity>msg</span></span></span><span class=main>,</span>       <span class=main>(</span><span class=free><span class=bound><span class=entity>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span> <span class=free><span class=bound><span class=entity>msg</span></span></span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span>
  <span class=main>|</span> assignT<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=free><span class=bound><span class=entity>u</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>                      <span class=keyword1>τ</span><span class=main>,</span>                        <span class=main>(</span><span class=free><span class=bound><span class=entity>u</span></span></span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span>

  <span class=main>|</span> callT<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free>Γ</span> <span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span> <span class=main>⟧</span> <span class=main>⟹</span>
                 <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span> <span class=comment1>(* TPB: quite different to Table 1 *)</span>

  <span class=main>|</span> choiceT1<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>  <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span>
  <span class=main>|</span> choiceT2<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>  <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span>

  <span class=main>|</span> guardT<span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>ξ'</span></span></span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>g</span></span></span> <span class=free><span class=bound><span class=entity>ξ</span></span></span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>g</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>ξ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>seqp_sos</span> <span class=free>Γ</span>"</span></span>

<span class=keyword1><span class=command>inductive_cases</span></span>
      seqp_callTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=keyword1>call(</span><span class=free>pn</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> seqp_choiceTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>

<span class=keyword1 id=AWN_SOS-seqp_broadcastTE><span class=command>lemma</span></span> seqp_broadcastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}broadcast(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> broadcast <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span> <span class=free>ξ</span><span class=main>)</span><span class=main>;</span> <span class=free>ξ'</span> <span class=main>=</span> <span class=free>ξ</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}broadcast(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> seqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_SOS-seqp_groupcastTE><span class=command>lemma</span></span> seqp_groupcastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}groupcast(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> groupcast <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span> <span class=free>ξ</span><span class=main>)</span> <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span> <span class=free>ξ</span><span class=main>)</span><span class=main>;</span> <span class=free>ξ'</span> <span class=main>=</span> <span class=free>ξ</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}groupcast(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> seqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_SOS-seqp_unicastTE><span class=command>lemma</span></span> seqp_unicastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}unicast(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span> <span class=main>▹</span> <span class=free>q</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>r</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> unicast <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span> <span class=free>ξ</span><span class=main>)</span> <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span> <span class=free>ξ</span><span class=main>)</span><span class=main>;</span> <span class=free>ξ'</span> <span class=main>=</span> <span class=free>ξ</span><span class=main>;</span> <span class=free>r</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> <span class=keyword1>¬unicast</span> <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span> <span class=free>ξ</span><span class=main>)</span><span class=main>;</span> <span class=free>ξ'</span> <span class=main>=</span> <span class=free>ξ</span><span class=main>;</span> <span class=free>r</span> <span class=main>=</span> <span class=free>q</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}unicast(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span> <span class=main><span class=main><span class=main>▹</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>r</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> seqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_SOS-seqp_sendTE><span class=command>lemma</span></span> seqp_sendTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}send(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> send <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span> <span class=free>ξ</span><span class=main>)</span><span class=main>;</span> <span class=free>ξ'</span> <span class=main>=</span> <span class=free>ξ</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}send(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> seqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_SOS-seqp_deliverTE><span class=command>lemma</span></span> seqp_deliverTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}deliver(</span><span class=free>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> deliver <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span> <span class=free>ξ</span><span class=main>)</span><span class=main>;</span> <span class=free>ξ'</span> <span class=main>=</span> <span class=free>ξ</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}deliver(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> seqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_SOS-seqp_receiveTE><span class=command>lemma</span></span> seqp_receiveTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}receive(</span><span class=free>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span>
    <span class=main>⋀</span><span class=bound>msg</span><span class=main>.</span> <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> receive <span class=bound>msg</span><span class=main>;</span> <span class=free>ξ'</span> <span class=main>=</span> <span class=free>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span> <span class=bound>msg</span> <span class=free>ξ</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}receive(</span></span></span><span class=free><span class=free><span class=free>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> seqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_SOS-seqp_assignTE><span class=command>lemma</span></span> seqp_assignTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟦</span><span class=free>u</span><span class=main>⟧</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span> <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>;</span> <span class=free>ξ'</span> <span class=main>=</span> <span class=free>u</span> <span class=free>ξ</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=main><span class=main><span class=main>}</span></span></span><span class=main><span class=main><span class=main>⟦</span></span></span><span class=free><span class=free><span class=free>u</span></span></span><span class=main><span class=main><span class=main>⟧</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> seqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_SOS-seqp_guardTE><span class=command>lemma</span></span> seqp_guardTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟨</span><span class=free>g</span><span class=main>⟩</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span> <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>;</span> <span class=free>ξ'</span> <span class=main>∈</span> <span class=free>g</span> <span class=free>ξ</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=main><span class=main><span class=main>}</span></span></span><span class=main><span class=main><span class=main>⟨</span></span></span><span class=free><span class=free><span class=free>g</span></span></span><span class=main><span class=main><span class=main>⟩</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>ξ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> seqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> seqpTEs <span class=main>=</span>
  seqp_broadcastTE
  seqp_groupcastTE
  seqp_unicastTE
  seqp_sendTE
  seqp_deliverTE
  seqp_receiveTE
  seqp_assignTE
  seqp_callTE
  seqp_choiceTE
  seqp_guardTE

<span class=keyword1><span class=command>declare</span></span> seqp_sos.intros <span class=main>[</span><span class=operator>intro</span><span class=main>]</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Table 2: Structural operational semantics for parallel process expressions "</span></span>

<span class=keyword1><span class=command>inductive_set</span></span>
  <span class=entity>parp_sos</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s1</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set
                    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s2</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set
                    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s1</span> <span class=main>×</span> <span class=tfree>'s2</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>S</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s1</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=entity>T</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s2</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    parleft<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≠</span> receive <span class=bound>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>parp_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>
  <span class=main>|</span> parright<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≠</span> send <span class=bound>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>parp_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>
  <span class=main>|</span> parboth<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> receive <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> send <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span>
               <span class=main>⟹</span><span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>parp_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

<span class=keyword1 id=AWN_SOS-par_broadcastTE><span class=command>lemma</span></span> par_broadcastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>,</span> broadcast <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> parp_sos <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> broadcast <span class=free>m</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> broadcast <span class=free>m</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> broadcast <span class=free><span class=free><span class=free>m</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> parp_sos <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_SOS-par_groupcastTE><span class=command>lemma</span></span> par_groupcastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>,</span> groupcast <span class=free>ips</span> <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> parp_sos <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> groupcast <span class=free>ips</span> <span class=free>m</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> groupcast <span class=free>ips</span> <span class=free>m</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> groupcast <span class=free><span class=free><span class=free>ips</span></span></span> <span class=free><span class=free><span class=free>m</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> parp_sos <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_SOS-par_unicastTE><span class=command>lemma</span></span> par_unicastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>,</span> unicast <span class=free>i</span> <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> parp_sos <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> unicast <span class=free>i</span> <span class=free>m</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> unicast <span class=free>i</span> <span class=free>m</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> unicast <span class=free><span class=free><span class=free>i</span></span></span> <span class=free><span class=free><span class=free>m</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> parp_sos <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_SOS-par_notunicastTE><span class=command>lemma</span></span> par_notunicastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>,</span> notunicast <span class=free>i</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> parp_sos <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> notunicast <span class=free>i</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> notunicast <span class=free>i</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> notunicast <span class=free><span class=free><span class=free>i</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> parp_sos <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_SOS-par_sendTE><span class=command>lemma</span></span> par_sendTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>,</span> send <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> parp_sos <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> send <span class=free>m</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> send <span class=free><span class=free><span class=free>m</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> parp_sos <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_SOS-par_deliverTE><span class=command>lemma</span></span> par_deliverTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>,</span> deliver <span class=free>d</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> parp_sos <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> deliver <span class=free>d</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> deliver <span class=free>d</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> deliver <span class=free><span class=free><span class=free>d</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> parp_sos <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_SOS-par_receiveTE><span class=command>lemma</span></span> par_receiveTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>,</span> receive <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> parp_sos <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> receive <span class=free>m</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> receive <span class=free><span class=free><span class=free>m</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> parp_sos <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>inductive_cases</span></span> par_tauTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> parp_sos <span class=free>S</span> <span class=free>T</span>"</span></span>

<span class=keyword1><span class=command>lemmas</span></span> parpTEs <span class=main>=</span>
  par_broadcastTE
  par_groupcastTE
  par_unicastTE
  par_notunicastTE
  par_sendTE
  par_deliverTE
  par_receiveTE

<span class=keyword1 id=AWN_SOS-parp_sos_cases><span class=command>lemma</span></span> parp_sos_cases <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> parp_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free>a</span> <span class=main>≠</span> receive <span class=bound>m</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>t</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free>a</span> <span class=main>≠</span> send <span class=bound>m</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> receive <span class=bound>m</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=free>t</span><span class=main>,</span> send <span class=bound>m</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>par_comp</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s1</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton
              <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s2</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton
              <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s1</span> <span class=main>×</span> <span class=tfree>'s2</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton"</span></span>
  <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_ <span class=keyword1>⟨⟨</span> _<span class=keyword3>)</span>"</span> <span class=main>[</span>102<span class=main>,</span> 103<span class=main>]</span> 102<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main><span class=free>⟨⟨</span></span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>≡</span> <span class=main>⦇</span> init <span class=main>=</span> init <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>×</span> init <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> trans <span class=main>=</span> parp_sos <span class=main>(</span>trans <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span> <span class=main>(</span>trans <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span> <span class=main>⦈</span>"</span></span>

<span class=keyword1 id=AWN_SOS-trans_par_comp><span class=command>lemma</span></span> trans_par_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"trans <span class=main>(</span><span class=free>s</span> <span class=main>⟨⟨</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> parp_sos <span class=main>(</span>trans <span class=free>s</span><span class=main>)</span> <span class=main>(</span>trans <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> par_comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_SOS-init_par_comp><span class=command>lemma</span></span> init_par_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"init <span class=main>(</span><span class=free>s</span> <span class=main>⟨⟨</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> init <span class=free>s</span> <span class=main>×</span> init <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> par_comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Table 3: Structural operational semantics for node expressions "</span></span>

<span class=keyword1><span class=command>inductive_set</span></span>
  <span class=entity>node_sos</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>S</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    node_bcast<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> broadcast <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_gcast<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> groupcast <span class=free><span class=bound><span class=entity>D</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>∩</span><span class=free><span class=bound><span class=entity>D</span></span></span><span class=main>)</span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_ucast<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> unicast <span class=free><span class=bound><span class=entity>d</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>∈</span><span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>}</span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_notucast<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>¬unicast</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>∉</span><span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_deliver<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> deliver <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_receive<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> receive <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>}</span><span class=main>¬</span><span class=main>{}</span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_tau<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span>         <span class=main>⟹</span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_arrive<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=main>{}</span><span class=main>¬</span><span class=main>{</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>}</span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span>  NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_connect1<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span>    NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>∪</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>}</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_connect2<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span><span class=main>,</span>    NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>∪</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>}</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_disconnect1<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>-</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>}</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_disconnect2<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>-</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>}</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_connect_other<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≠</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≠</span> <span class=free><span class=bound><span class=entity>i''</span></span></span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i''</span></span></span><span class=main>)</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> node_disconnect_other<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≠</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≠</span> <span class=free><span class=bound><span class=entity>i''</span></span></span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i''</span></span></span><span class=main>)</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>node_sos</span> <span class=free>S</span>"</span></span>

<span class=keyword1><span class=command>inductive_cases</span></span> node_arriveTE<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s'</span> <span class=free>R</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_arriveTE'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=free>H</span><span class=main>¬</span><span class=free>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_castTE<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=free>RM</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_castTE'<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=free>RM</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_deliverTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s'</span> <span class=free>R</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_deliverTE'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_deliverTE''<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>ii</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_tauTE<span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s'</span> <span class=free>R</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_tauTE'<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_connectTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>ii</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_connectTE'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>ii</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_disconnectTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>ii</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> node_disconnectTE'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>ii</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>

<span class=keyword1 id=AWN_SOS-node_sos_never_newpkt><span class=command>lemma</span></span> node_sos_never_newpkt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=free>i</span><span class=keyword1>:newpkt(</span><span class=free>d</span><span class=main>,</span> <span class=free>di</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_SOS-arrives_or_not><span class=command>lemma</span></span> arrives_or_not<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>,</span> <span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> NodeS <span class=free>i'</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ii</span> <span class=main>=</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>∧</span> <span class=free>ni</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=free>ii</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>∧</span> <span class=free>ni</span> <span class=main>=</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>node_comp</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ip <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton <span class=main>⇒</span> ip set
                   <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> automaton"</span></span>
    <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span><span class=keyword1>⟨</span>_ <span class=keyword1>:</span> <span class=keyword3>(</span>_<span class=keyword3>)</span> <span class=keyword1>:</span> _<span class=keyword1>⟩</span><span class=keyword3>)</span>"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 0<span class=main>]</span> 104<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main><span class=free>⟨</span></span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main><span class=free>:</span></span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=main><span class=free>:</span></span> <span class=free><span class=bound><span class=entity>R<span class=hidden>⇩</span><sub>i</sub></span></span></span><span class=main><span class=free>⟩</span></span> <span class=main>≡</span> <span class=main>⦇</span> init <span class=main>=</span> <span class=main>{</span>NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=bound>s</span> <span class=free><span class=bound><span class=entity>R<span class=hidden>⇩</span><sub>i</sub></span></span></span><span class=main>|</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=free><span class=bound><span class=entity>np</span></span></span><span class=main>}</span><span class=main>,</span> trans <span class=main>=</span> node_sos <span class=main>(</span>trans <span class=free><span class=bound><span class=entity>np</span></span></span><span class=main>)</span> <span class=main>⦈</span>"</span></span>

<span class=keyword1 id=AWN_SOS-trans_node_comp><span class=command>lemma</span></span> trans_node_comp<span class=main>:</span>
  <span class=quoted><span class=quoted>"trans <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>np</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>=</span> node_sos <span class=main>(</span>trans <span class=free>np</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> node_comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_SOS-init_node_comp><span class=command>lemma</span></span> init_node_comp<span class=main>:</span>
  <span class=quoted><span class=quoted>"init <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>np</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span>NodeS <span class=free>i</span> <span class=bound>s</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>|</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=free>np</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> node_comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> node_comps <span class=main>=</span> trans_node_comp init_node_comp

<span class=keyword1 id=AWN_SOS-trans_par_node_comp><span class=command>lemma</span></span> trans_par_node_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"trans <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>s</span> <span class=main>⟨⟨</span> <span class=free>t</span> <span class=main>:</span> <span class=free>R</span><span class=main>⟩</span><span class=main>)</span> <span class=main>=</span> node_sos <span class=main>(</span>parp_sos <span class=main>(</span>trans <span class=free>s</span><span class=main>)</span> <span class=main>(</span>trans <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> node_comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_SOS-snd_par_node_comp><span class=command>lemma</span></span> snd_par_node_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"init <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>s</span> <span class=main>⟨⟨</span> <span class=free>t</span> <span class=main>:</span> <span class=free>R</span><span class=main>⟩</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span>NodeS <span class=free>i</span> <span class=bound>st</span> <span class=free>R</span><span class=main>|</span><span class=bound>st</span><span class=main>.</span> <span class=bound>st</span> <span class=main>∈</span> init <span class=free>s</span> <span class=main>×</span> init <span class=free>t</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> node_comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_SOS-node_sos_dest_is_net_state><span class=command>lemma</span></span> node_sos_dest_is_net_state<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>i'</span> <span class=bound>P'</span> <span class=bound>R'</span><span class=main>.</span> <span class=free>s'</span> <span class=main>=</span> NodeS <span class=bound>i'</span> <span class=bound>P'</span> <span class=bound>R'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>induct</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_SOS-node_sos_dest><span class=command>lemma</span></span> node_sos_dest<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>i</span> <span class=free>p</span> <span class=free>R</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>P'</span> <span class=bound>R'</span><span class=main>.</span> <span class=free>s'</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=bound>P'</span> <span class=bound>R'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms assms <span class=main>[</span><span class=operator>THEN</span> node_sos_dest_is_net_state<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span> node_sos.cases<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=AWN_SOS-node_sos_states><span class=command>lemma</span></span> node_sos_states <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ns</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>ns'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>i</span> <span class=free>s</span> <span class=free>R</span> <span class=free>s'</span> <span class=free>R'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>ns</span>  <span class=main>=</span> NodeS <span class=free>i</span> <span class=free>s</span>  <span class=free>R</span>"</span></span>
                        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ns'</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=free>s'</span> <span class=free>R'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main>!</span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>s</span> <span class=bound>R</span> <span class=bound>s'</span> <span class=bound>R'</span><span class=main>.</span> <span class=free>ns</span> <span class=main>=</span> NodeS <span class=bound>i</span> <span class=bound>s</span> <span class=bound>R</span> <span class=main>⟹</span> <span class=free>ns'</span> <span class=main>=</span> NodeS <span class=bound>i</span> <span class=bound>s'</span> <span class=bound>R'</span> <span class=main>⟹</span> <span class=free>thesis</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>ns</span> <span class=main>=</span> NodeS <span class=skolem>i</span> <span class=skolem>s</span> <span class=skolem>R</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>ns</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>ns'</span> <span class=main>=</span> NodeS <span class=skolem>i</span> <span class=skolem>s'</span> <span class=skolem>R'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> node_sos_dest<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=free>thesis</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_SOS-node_sos_cases><span class=command>lemma</span></span> node_sos_cases <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>i</span> <span class=free>p</span> <span class=free>R</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>p'</span> <span class=free>R'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=free>S</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>m</span> <span class=main>.</span>       <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=free>R</span><span class=keyword1>:*cast(</span><span class=bound>m</span><span class=main>)</span><span class=main>;</span>          <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=free>p</span><span class=main>,</span> broadcast <span class=bound>m</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>m</span> <span class=bound>D</span><span class=main>.</span>      <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=main>(</span><span class=free>R</span> <span class=main>∩</span> <span class=bound>D</span><span class=main>)</span><span class=keyword1>:*cast(</span><span class=bound>m</span><span class=main>)</span><span class=main>;</span>    <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=free>p</span><span class=main>,</span> groupcast <span class=bound>D</span> <span class=bound>m</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>d</span> <span class=bound>m</span><span class=main>.</span>      <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=main>{</span><span class=bound>d</span><span class=main>}</span><span class=keyword1>:*cast(</span><span class=bound>m</span><span class=main>)</span><span class=main>;</span>        <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=free>p</span><span class=main>,</span> unicast <span class=bound>d</span> <span class=bound>m</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=bound>d</span> <span class=main>∈</span> <span class=free>R</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>d</span><span class=main>.</span>        <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>;</span>                   <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=free>p</span><span class=main>,</span> <span class=keyword1>¬unicast</span> <span class=bound>d</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=bound>d</span> <span class=main>∉</span> <span class=free>R</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>d</span><span class=main>.</span>        <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>;</span>        <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=free>p</span><span class=main>,</span> deliver <span class=bound>d</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>        <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>¬</span><span class=main>{}</span><span class=keyword1>:arrive(</span><span class=bound>m</span><span class=main>)</span><span class=main>;</span>    <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=free>p</span><span class=main>,</span> receive <span class=bound>m</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span>            <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>;</span>                   <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=free>p</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>        <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=main>{}</span><span class=main>¬</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=keyword1>:arrive(</span><span class=bound>m</span><span class=main>)</span><span class=main>;</span>    <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span><span class=main>.</span>     <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>connect(</span><span class=bound>i</span><span class=main>,</span> <span class=bound>i'</span><span class=main>)</span><span class=main>;</span>      <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span> <span class=main>∪</span> <span class=main>{</span><span class=bound>i'</span><span class=main>}</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span><span class=main>.</span>     <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>connect(</span><span class=bound>i'</span><span class=main>,</span> <span class=bound>i</span><span class=main>)</span><span class=main>;</span>      <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span> <span class=main>∪</span> <span class=main>{</span><span class=bound>i'</span><span class=main>}</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span><span class=main>.</span>     <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>disconnect(</span><span class=bound>i</span><span class=main>,</span> <span class=bound>i'</span><span class=main>)</span><span class=main>;</span>   <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span> <span class=main>-</span> <span class=main>{</span><span class=bound>i'</span><span class=main>}</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span><span class=main>.</span>     <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>disconnect(</span><span class=bound>i'</span><span class=main>,</span> <span class=bound>i</span><span class=main>)</span><span class=main>;</span>   <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span> <span class=main>-</span> <span class=main>{</span><span class=bound>i'</span><span class=main>}</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span> <span class=bound>i''</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>connect(</span><span class=bound>i'</span><span class=main>,</span> <span class=bound>i''</span><span class=main>)</span><span class=main>;</span>    <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span><span class=main>;</span> <span class=bound>i</span> <span class=main>≠</span> <span class=bound>i'</span><span class=main>;</span> <span class=bound>i</span> <span class=main>≠</span> <span class=bound>i''</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span> <span class=bound>i''</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>disconnect(</span><span class=bound>i'</span><span class=main>,</span> <span class=bound>i''</span><span class=main>)</span><span class=main>;</span> <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span><span class=main>;</span> <span class=bound>i</span> <span class=main>≠</span> <span class=bound>i'</span><span class=main>;</span> <span class=bound>i</span> <span class=main>≠</span> <span class=bound>i''</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>erule</span> node_sos.cases<span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Table 4: Structural operational semantics for partial network expressions "</span></span>

<span class=keyword1><span class=command>inductive_set</span></span>
  <span class=entity>pnet_sos</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set
                    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set
                    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>S</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=entity>T</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    pnet_cast1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>¬</span><span class=free><span class=bound><span class=entity>K</span></span></span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>⊆</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>K</span></span></span> <span class=main>∩</span> <span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>pnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> pnet_cast2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>¬</span><span class=free><span class=bound><span class=entity>K</span></span></span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span>  <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>⊆</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>K</span></span></span> <span class=main>∩</span> <span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>pnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> pnet_arrive<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>¬</span><span class=free><span class=bound><span class=entity>K</span></span></span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>H'</span></span></span><span class=main>¬</span><span class=free><span class=bound><span class=entity>K'</span></span></span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span>  <span class=main>(</span><span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>∪</span> <span class=free><span class=bound><span class=entity>H'</span></span></span><span class=main>)</span><span class=main>¬</span><span class=main>(</span><span class=free><span class=bound><span class=entity>K</span></span></span> <span class=main>∪</span> <span class=free><span class=bound><span class=entity>K'</span></span></span><span class=main>)</span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>pnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> pnet_deliver1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span>
      <span class=main>⟹</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>pnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>
  <span class=main>|</span> pnet_deliver2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>pnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> pnet_tau1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>pnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>
  <span class=main>|</span> pnet_tau2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟹</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>pnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> pnet_connect<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>pnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> pnet_disconnect<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>pnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

<span class=keyword1><span class=command>inductive_cases</span></span> partial_castTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>       <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>R</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> partial_arriveTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>H</span><span class=main>¬</span><span class=free>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> partial_deliverTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> partial_tauTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>        <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> partial_connectTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> partial_disconnectTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>

<span class=keyword1 id=AWN_SOS-pnet_sos_never_newpkt><span class=command>lemma</span></span> pnet_sos_never_newpkt<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>st</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>st'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>d</span> <span class=bound>di</span> <span class=bound>a</span> <span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:newpkt(</span><span class=bound>d</span><span class=main>,</span> <span class=bound>di</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>d</span> <span class=bound>di</span> <span class=bound>a</span> <span class=bound>t</span> <span class=bound>t'</span><span class=main>.</span> <span class=main>(</span><span class=bound>t</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟹</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:newpkt(</span><span class=bound>d</span><span class=main>,</span> <span class=bound>di</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=free>i</span><span class=keyword1>:newpkt(</span><span class=free>d</span><span class=main>,</span> <span class=free>di</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>2-3<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>pnet</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>ip <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton<span class=main>)</span>
              <span class=main>⇒</span> net_tree <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> automaton"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>pnet</span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=main>(</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>R<span class=hidden>⇩</span><sub>i</sub></span></span></span><span class=main>⟩</span><span class=main>)</span>  <span class=main>=</span>  <span class=main>⟨</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>:</span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>:</span> <span class=free><span class=bound><span class=entity>R<span class=hidden>⇩</span><sub>i</sub></span></span></span><span class=main>⟩</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>pnet</span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main>∥</span> <span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>⦇</span> init <span class=main>=</span> <span class=main>{</span>SubnetS <span class=bound>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>s<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>|</span><span class=bound>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=bound>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∈</span> init <span class=main>(</span><span class=free>pnet</span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>1</sub></span></span></span><span class=main>)</span>
                                                      <span class=main>∧</span> <span class=bound>s<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∈</span> init <span class=main>(</span><span class=free>pnet</span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span><span class=main>}</span><span class=main>,</span>
                           trans <span class=main>=</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>pnet</span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>1</sub></span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span><span class=free>pnet</span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>⦈</span>"</span></span>

<span class=keyword1 id=AWN_SOS-pnet_node_init><span class=command>lemma</span></span> pnet_node_init <span class=main>[</span><span class=operator>elim</span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=free>i</span><span class=main>;</span> <span class=free>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> <span class=main>{</span> NodeS <span class=free>i</span> <span class=bound>s</span> <span class=free>R</span> <span class=main>|</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comp_def<span class=main>)</span>

<span class=keyword1 id="AWN_SOS-pnet_node_init'"><span class=command>lemma</span></span> pnet_node_init' <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
 <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=free>i</span><span class=main>;</span> <span class=free>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
 <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>ns</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=free>ns</span> <span class=free>R</span>"</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ns</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
   <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comp_def<span class=main>)</span>

<span class=keyword1 id=AWN_SOS-pnet_node_trans><span class=command>lemma</span></span> pnet_node_trans <span class=main>[</span><span class=operator>elim</span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=free>i</span><span class=main>;</span> <span class=free>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> trans_node_comp<span class=main>)</span>

<span class=keyword1 id="AWN_SOS-pnet_never_newpkt'"><span class=command>lemma</span></span> pnet_never_newpkt'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span> <span class=bound>d</span> <span class=bound>di</span><span class=main>.</span> <span class=free>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:newpkt(</span><span class=bound>d</span><span class=main>,</span> <span class=bound>di</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>s'</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n1</span> <span class=skolem>n2</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>a</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>i</span> <span class=bound>d</span> <span class=bound>di</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:newpkt(</span><span class=bound>d</span><span class=main>,</span> <span class=bound>di</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>a</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>i</span> <span class=bound>d</span> <span class=bound>di</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:newpkt(</span><span class=bound>d</span><span class=main>,</span> <span class=bound>di</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span> <span class=bound>d</span> <span class=bound>di</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:newpkt(</span><span class=bound>d</span><span class=main>,</span> <span class=bound>di</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>intro</span> allI<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>d</span> <span class=skolem>di</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=skolem>i</span><span class=keyword1>:newpkt(</span><span class=skolem>d</span><span class=main>,</span> <span class=skolem>di</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_sos_never_newpkt<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> IH1 IH2<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comps<span class=main>)</span>

<span class=keyword1 id=AWN_SOS-pnet_never_newpkt><span class=command>lemma</span></span> pnet_never_newpkt<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=free>i</span><span class=keyword1>:newpkt(</span><span class=free>d</span><span class=main>,</span> <span class=free>di</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span> <span class=bound>d</span> <span class=bound>di</span><span class=main>.</span> <span class=free>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:newpkt(</span><span class=bound>d</span><span class=main>,</span> <span class=bound>di</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_never_newpkt'<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Table 5: Structural operational semantics for complete network expressions "</span></span>

<span class=keyword1><span class=command>inductive_set</span></span>
  <span class=entity>cnet_sos</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=main>(</span><span class=tfree>'m</span><span class=main>::</span>msg<span class=main>)</span> node_action<span class=main>)</span> transition set
                    <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>S</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    cnet_connect<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span>  <span class=main>⟹</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>cnet_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> cnet_disconnect<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span>  <span class=main>⟹</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>cnet_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> cnet_cast<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span>  <span class=main>⟹</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>cnet_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> cnet_tau<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span>  <span class=main>⟹</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>cnet_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> cnet_deliver<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span>  <span class=main>⟹</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>cnet_sos</span> <span class=free>S</span>"</span></span>
  <span class=main>|</span> cnet_newpkt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>}</span><span class=main>¬</span><span class=free><span class=bound><span class=entity>K</span></span></span><span class=keyword1>:arrive(</span>newpkt<span class=main>(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>di</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span>  <span class=main>⟹</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:newpkt(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>di</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>cnet_sos</span> <span class=free>S</span>"</span></span>

<span class=keyword1><span class=command>inductive_cases</span></span> connect_completeTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> cnet_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> disconnect_completeTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> cnet_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> tau_completeTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> cnet_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> deliver_completeTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> cnet_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> newpkt_completeTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:newpkt(</span><span class=free>d</span><span class=main>,</span> <span class=free>di</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> cnet_sos <span class=free>S</span>"</span></span>

<span class=keyword1><span class=command>lemmas</span></span> completeTEs <span class=main>=</span> connect_completeTE
                     disconnect_completeTE
                     tau_completeTE
                     deliver_completeTE
                     newpkt_completeTE

<span class=keyword1 id=AWN_SOS-complete_no_cast><span class=command>lemma</span></span> complete_no_cast <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>R</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∉</span> cnet_sos <span class=free>T</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>R</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> cnet_sos <span class=free>T</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span> <span class=main>≠</span> <span class=free>R</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span>"</span></span>
     <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> cnet_sos.cases<span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_SOS-complete_no_arrive><span class=command>lemma</span></span> complete_no_arrive <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∉</span> cnet_sos <span class=free>T</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> cnet_sos <span class=free>T</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span> <span class=main>≠</span> <span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span>"</span></span>
     <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> cnet_sos.cases<span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>abbreviation</span></span>
  <span class=entity>closed</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span> net_state<span class=main>,</span> <span class=main>(</span><span class=tfree>'m</span><span class=main>::</span>msg<span class=main>)</span> node_action<span class=main>)</span> automaton <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> automaton"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>closed</span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>⦇</span> trans <span class=main>:=</span> cnet_sos <span class=main>(</span>trans <span class=bound>A</span><span class=main>)</span> <span class=main>⦈</span><span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=AWN_Cterms><div class=head><h1>Theory AWN_Cterms</h1></div><pre class=source><span class=comment1>(*  Title:       AWN_Cterms.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Control terms and well-definedness of sequential processes"</span></span>

<span class=keyword1><span class=command>theory</span></span> AWN_Cterms
<span class=keyword2><span class=keyword>imports</span></span> <a href=AWN.html>AWN</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Microsteps "</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  We distinguish microsteps from `external' transitions (observable or not). Here, they are
  a kind of `hypothetical computation', since, unlike <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>τ›</span></span></span></span>-transitions, they do not make
  choices but rather `compute' which choices are possible.
›</span></span>

<span class=keyword1><span class=command>inductive</span></span>
  <span class=entity>microstep</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env
                <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp
                <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp
                <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>for</span></span> <span class=entity>Γ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    microstep_choiceI1 <span class=main>[</span><span class=operator>intro</span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>microstep</span> <span class=free>Γ</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>p1</span></span></span>"</span></span>
  <span class=main>|</span> microstep_choiceI2 <span class=main>[</span><span class=operator>intro</span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>microstep</span> <span class=free>Γ</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>p2</span></span></span>"</span></span>
  <span class=main>|</span> microstep_callI <span class=main>[</span><span class=operator>intro</span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>microstep</span> <span class=free>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>Γ</span> <span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>microstep_rtcl</span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>microstep_rtcl</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>≡</span> <span class=main>(</span>microstep <span class=free><span class=bound><span class=entity>Γ</span></span></span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>*</sup><span class=hidden>⇧</span><sup>*</sup></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>microstep_tcl</span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>microstep_tcl</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=main>≡</span> <span class=main>(</span>microstep <span class=free><span class=bound><span class=entity>Γ</span></span></span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>+</sup><span class=hidden>⇧</span><sup>+</sup></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span>"</span></span>

<span class=keyword1><span class=command>syntax</span></span>
  <span class=quoted>"_microstep"</span>
     <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp<span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env<span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span> bool"</span></span>
     <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword3>)</span> <span class=keyword1>↝⇘</span>_<span class=keyword1>⇙</span> <span class=keyword3>(</span>_<span class=keyword3>)</span>"</span> <span class=main>[</span>61<span class=main>,</span> 0<span class=main>,</span> 61<span class=main>]</span> 50<span class=main>)</span>
  <span class=quoted>"_microstep_rtcl"</span>
     <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp<span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env<span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span> bool"</span></span>
     <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword3>)</span> <span class=keyword1>↝⇘</span>_<span class=keyword1>⇙<span class=hidden>⇧</span><sup>*</sup></span> <span class=keyword3>(</span>_<span class=keyword3>)</span>"</span> <span class=main>[</span>61<span class=main>,</span> 0<span class=main>,</span> 61<span class=main>]</span> 50<span class=main>)</span>
  <span class=quoted>"_microstep_tcl"</span>
     <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>[</span><span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp<span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env<span class=main>,</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp<span class=main>]</span> <span class=main>⇒</span> bool"</span></span>
     <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_<span class=keyword3>)</span> <span class=keyword1>↝⇘</span>_<span class=keyword1>⇙<span class=hidden>⇧</span><sup>+</sup></span> <span class=keyword3>(</span>_<span class=keyword3>)</span>"</span> <span class=main>[</span>61<span class=main>,</span> 0<span class=main>,</span> 61<span class=main>]</span> 50<span class=main>)</span>

<span class=keyword1><span class=command>translations</span></span>
  <span class=quoted>"<span class=free>p1</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>p2</span>"</span>  <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> microstep <span class=free>Γ</span> <span class=free>p1</span> <span class=free>p2</span>"</span>
  <span class=quoted>"<span class=free>p1</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=free>p2</span>"</span> <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> microstep_rtcl <span class=free>Γ</span> <span class=free>p1</span> <span class=free>p2</span>"</span>
  <span class=quoted>"<span class=free>p1</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>+</sup> <span class=free>p2</span>"</span> <span class=main>⇌</span> <span class=quoted>"<span class=keyword1>CONST</span> microstep_tcl <span class=free>Γ</span> <span class=free>p1</span> <span class=free>p2</span>"</span>

<span class=keyword1 id=AWN_Cterms-microstep_choiceD><span class=command>lemma</span></span> microstep_choiceD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>p</span> <span class=main>⟹</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p1</span> <span class=main>∨</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>p1</span></span></span> <span class=main><span class=main><span class=main>⊕</span></span></span> <span class=free><span class=free><span class=free>p2</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> ↝<span class=hidden>⇘</span><sub><span class=free><span class=free><span class=free>Γ</span></span></span></sub><span class=hidden>⇙</span> <span class=free><span class=free><span class=free>p</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-microstep_choiceE><span class=command>lemma</span></span> microstep_choiceE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>p</span><span class=main>;</span>
     <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>p1</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
     <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>p2</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-microstep_callD><span class=command>lemma</span></span> microstep_callD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>call(</span><span class=free>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>p</span> <span class=main>⟹</span> <span class=free>p</span> <span class=main>=</span> <span class=free>Γ</span> <span class=free>pn</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>call(</span></span></span><span class=free><span class=free><span class=free>pn</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> ↝<span class=hidden>⇘</span><sub><span class=free><span class=free><span class=free>Γ</span></span></span></sub><span class=hidden>⇙</span> <span class=free><span class=free><span class=free>p</span></span></span>"</span></span></span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-microstep_callE><span class=command>lemma</span></span> microstep_callE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=keyword1>call(</span><span class=free>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>p</span><span class=main>;</span>  <span class=free>p</span> <span class=main>=</span> <span class=free>Γ</span><span class=main>(</span><span class=free>pn</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-no_microstep_guard><span class=command>lemma</span></span> no_microstep_guard<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>(</span><span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟨</span><span class=free>g</span><span class=main>⟩</span> <span class=free>p</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main>)</span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=main><span class=main><span class=main>}</span></span></span><span class=main><span class=main><span class=main>⟨</span></span></span><span class=free><span class=free><span class=free>g</span></span></span><span class=main><span class=main><span class=main>⟩</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> ↝<span class=hidden>⇘</span><sub><span class=free><span class=free><span class=free>Γ</span></span></span></sub><span class=hidden>⇙</span> <span class=free><span class=free><span class=free>q</span></span></span>"</span></span></span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-no_microstep_assign><span class=command>lemma</span></span> no_microstep_assign<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟦</span><span class=free>f</span><span class=main>⟧</span> <span class=free>p</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main>)</span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=main><span class=main><span class=main>}</span></span></span><span class=main><span class=main><span class=main>⟦</span></span></span><span class=free><span class=free><span class=free>f</span></span></span><span class=main><span class=main><span class=main>⟧</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> ↝<span class=hidden>⇘</span><sub><span class=free><span class=free><span class=free>Γ</span></span></span></sub><span class=hidden>⇙</span> <span class=free><span class=free><span class=free>q</span></span></span>"</span></span></span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-no_microstep_unicast><span class=command>lemma</span></span> no_microstep_unicast<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>(</span><span class=main>{</span><span class=free>l</span><span class=keyword1>}unicast(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span><span class=free>p</span> <span class=main>▹</span> <span class=free>q</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>r</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main>)</span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}unicast(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span><span class=free><span class=free><span class=free>p</span></span></span> <span class=main><span class=main><span class=main>▹</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> ↝<span class=hidden>⇘</span><sub><span class=free><span class=free><span class=free>Γ</span></span></span></sub><span class=hidden>⇙</span> <span class=free><span class=free><span class=free>r</span></span></span>"</span></span></span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-no_microstep_broadcast><span class=command>lemma</span></span> no_microstep_broadcast<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>(</span><span class=main>{</span><span class=free>l</span><span class=keyword1>}broadcast(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span><span class=free>p</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main>)</span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}broadcast(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span><span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> ↝<span class=hidden>⇘</span><sub><span class=free><span class=free><span class=free>Γ</span></span></span></sub><span class=hidden>⇙</span> <span class=free><span class=free><span class=free>q</span></span></span>"</span></span></span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-no_microstep_groupcast><span class=command>lemma</span></span> no_microstep_groupcast<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>(</span><span class=main>{</span><span class=free>l</span><span class=keyword1>}groupcast(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span><span class=free>p</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main>)</span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}groupcast(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span><span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> ↝<span class=hidden>⇘</span><sub><span class=free><span class=free><span class=free>Γ</span></span></span></sub><span class=hidden>⇙</span> <span class=free><span class=free><span class=free>q</span></span></span>"</span></span></span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-no_microstep_send><span class=command>lemma</span></span> no_microstep_send<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>(</span><span class=main>{</span><span class=free>l</span><span class=keyword1>}send(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span><span class=free>p</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main>)</span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}send(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span><span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> ↝<span class=hidden>⇘</span><sub><span class=free><span class=free><span class=free>Γ</span></span></span></sub><span class=hidden>⇙</span> <span class=free><span class=free><span class=free>q</span></span></span>"</span></span></span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-no_microstep_deliver><span class=command>lemma</span></span> no_microstep_deliver<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>(</span><span class=main>{</span><span class=free>l</span><span class=keyword1>}deliver(</span><span class=free>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span><span class=main>)</span><span class=main>.</span><span class=free>p</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main>)</span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}deliver(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span><span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> ↝<span class=hidden>⇘</span><sub><span class=free><span class=free><span class=free>Γ</span></span></span></sub><span class=hidden>⇙</span> <span class=free><span class=free><span class=free>q</span></span></span>"</span></span></span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-no_microstep_receive><span class=command>lemma</span></span> no_microstep_receive<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>(</span><span class=main>{</span><span class=free>l</span><span class=keyword1>}receive(</span><span class=free>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span><span class=free>p</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> notI<span class=main>)</span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}receive(</span></span></span><span class=free><span class=free><span class=free>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span><span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> ↝<span class=hidden>⇘</span><sub><span class=free><span class=free><span class=free>Γ</span></span></span></sub><span class=hidden>⇙</span> <span class=free><span class=free><span class=free>q</span></span></span>"</span></span></span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-microstep_call_or_choice><span class=command>lemma</span></span> microstep_call_or_choice <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>q</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p</span> <span class=main>=</span> <span class=keyword1>call(</span><span class=bound>pn</span><span class=main>)</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>p1</span> <span class=bound>p2</span><span class=main>.</span> <span class=free>p</span> <span class=main>=</span> <span class=bound>p1</span> <span class=main>⊕</span> <span class=bound>p2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span> <span class=main>(</span><span class=operator>metis</span> microstep.simps<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> no_microstep <span class=main>[</span><span class=operator>intro</span><span class=main>,</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span>
  no_microstep_guard
  no_microstep_assign
  no_microstep_unicast
  no_microstep_broadcast
  no_microstep_groupcast
  no_microstep_send
  no_microstep_deliver
  no_microstep_receive

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Wellformed process specifications "</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  A process specification <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Γ›</span></span></span></span> is wellformed if its <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"microstep <span class=free><span class=free>Γ</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> relation is
  free of loops and infinite chains.

  For example, these specifications are not wellformed:
    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>Γ<span class=hidden>⇩</span><sub>1</sub></span></span><span class=main><span class=main>(</span></span><span class=free><span class=free>p1</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>=</span></span> <span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>p1</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>Γ<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main><span class=main>(</span></span><span class=free><span class=free>p1</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>=</span></span> <span class=keyword1><span class=keyword1>send(</span></span><span class=free><span class=free>msg</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>.</span></span><span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>p1</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>⊕</span></span> <span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>p1</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>

    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>Γ<span class=hidden>⇩</span><sub>3</sub></span></span><span class=main><span class=main>(</span></span><span class=free><span class=free>p1</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>=</span></span> <span class=keyword1><span class=keyword1>send(</span></span><span class=free><span class=free>msg</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>.</span></span><span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>p2</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>Γ<span class=hidden>⇩</span><sub>3</sub></span></span><span class=main><span class=main>(</span></span><span class=free><span class=free>p2</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>=</span></span> <span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>p3</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>Γ<span class=hidden>⇩</span><sub>3</sub></span></span><span class=main><span class=main>(</span></span><span class=free><span class=free>p3</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>=</span></span> <span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>p4</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>Γ<span class=hidden>⇩</span><sub>3</sub></span></span><span class=main><span class=main>(</span></span><span class=free><span class=free>p4</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>=</span></span> <span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>p5</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
    \ldots
›</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>wellformed</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>wellformed</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>=</span> wf <span class=main>{</span><span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free><span class=bound><span class=entity>Γ</span></span></span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=AWN_Cterms-wellformed_defP><span class=command>lemma</span></span> wellformed_defP<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span> <span class=main>=</span> wfP <span class=main>(</span><span class=main>λ</span><span class=bound>q</span> <span class=bound>p</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> wellformed_def wfP_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  The induction rule for <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free><span class=free>Γ</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> is stronger than <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> seqp.induct<span class=antiquote><span class=antiquote>}</span></span></span></span> because
  the case for <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>pn</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> can be shown with the assumption on <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>Γ</span></span> <span class=free><span class=free>pn</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.
›</span></span>

<span class=keyword1 id=AWN_Cterms-wellformed_induct><span class=command>lemma</span></span> wellformed_induct
  <span class=main>[</span><span class=operator>consumes</span> 1<span class=main>,</span> <span class=operator>case_names</span> ASSIGN CHOICE CALL GUARD UCAST BCAST GCAST SEND DELIVER RECEIVE<span class=main>,</span>
   <span class=operator>induct</span> <span class=quasi_keyword><span class=quasi_keyword><span class=quasi_keyword>set</span></span></span><span class=main><span class=main><span class=main><span class=main>:</span></span></span></span> wellformed<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> ASSIGN<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>f</span> <span class=bound>p</span><span class=main>.</span>          wellformed <span class=free>Γ</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟦</span><span class=bound>f</span><span class=main>⟧</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> GUARD<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>f</span> <span class=bound>p</span><span class=main>.</span>          wellformed <span class=free>Γ</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟨</span><span class=bound>f</span><span class=main>⟩</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> UCAST<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fip</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> wellformed <span class=free>Γ</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}unicast(</span><span class=bound>fip</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> <span class=main>▹</span> <span class=bound>q</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> BCAST<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       wellformed <span class=free>Γ</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}broadcast(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> GCAST<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fips</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>  wellformed <span class=free>Γ</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}groupcast(</span><span class=bound>fips</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> SEND<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       wellformed <span class=free>Γ</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}send(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> DELIVER<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fdata</span> <span class=bound>p</span><span class=main>.</span>      wellformed <span class=free>Γ</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}deliver(</span><span class=bound>fdata</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> RECEIVE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       wellformed <span class=free>Γ</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>{</span><span class=bound>l</span><span class=keyword1>}receive(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> CHOICE<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p1</span> <span class=bound>p2</span><span class=main>.</span>        <span class=main>⟦</span> wellformed <span class=free>Γ</span><span class=main>;</span> <span class=free>P</span> <span class=bound>p1</span><span class=main>;</span> <span class=free>P</span> <span class=bound>p2</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>p1</span> <span class=main>⊕</span> <span class=bound>p2</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> CALL<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>pn</span><span class=main>.</span>           <span class=main>⟦</span> wellformed <span class=free>Γ</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=keyword1>call(</span><span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> wellformed_defP
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> wfP_induct_rule<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>x</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>q</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>p1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> microstep.intros<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> CHOICE <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pn</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>q</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> microstep.intros<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> CALL <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> assms<span class=main>)</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Start terms (sterms) "</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Formulate sets of local subterms from which an action is directly possible. Since the
  process specification <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>Γ</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> is not considered, only choice terms <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>p1</span></span> <span class=main><span class=main>⊕</span></span> <span class=free><span class=free>p2</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
  are traversed, and not <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>p</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> terms.
›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>stermsl</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span> <span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>stermsl</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free>stermsl</span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∪</span> <span class=free>stermsl</span> <span class=free><span class=bound><span class=entity>p2</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>stermsl</span> <span class=free><span class=bound><span class=entity>p</span></span></span>          <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1 id=AWN_Cterms-stermsl_nobigger><span class=command>lemma</span></span> stermsl_nobigger<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> stermsl <span class=free>p</span> <span class=main>⟹</span> size <span class=free>q</span> <span class=main>≤</span> size <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-stermsl_no_choice><span class=command>lemma</span></span> stermsl_no_choice<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span> <span class=main>∉</span> stermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-stermsl_choice_disj><span class=command>lemma</span></span> stermsl_choice_disj<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>∈</span> stermsl <span class=free>p1</span> <span class=main>∨</span> <span class=free>p</span> <span class=main>∈</span> stermsl <span class=free>p2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_Cterms-stermsl_in_branch><span class=command>lemma</span></span> stermsl_in_branch<span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>p</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span><span class=main>;</span> <span class=free>p</span> <span class=main>∈</span> stermsl <span class=free>p1</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span> <span class=free>p</span> <span class=main>∈</span> stermsl <span class=free>p2</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-stermsl_commute><span class=command>lemma</span></span> stermsl_commute<span class=main>:</span>
  <span class=quoted><span class=quoted>"stermsl <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span> <span class=main>=</span> stermsl <span class=main>(</span><span class=free>p2</span> <span class=main>⊕</span> <span class=free>p1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule</span> Un_commute<span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-stermsl_not_empty><span class=command>lemma</span></span> stermsl_not_empty<span class=main>:</span>
  <span class=quoted><span class=quoted>"stermsl <span class=free>p</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-stermsl_idem><span class=command>lemma</span></span> stermsl_idem <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=bound>q</span><span class=main>∈</span>stermsl <span class=free>p</span><span class=main>.</span> stermsl <span class=bound>q</span><span class=main>)</span> <span class=main>=</span> stermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-stermsl_in_wfpf><span class=command>lemma</span></span> stermsl_in_wfpf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> AA<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊆</span> <span class=main>{</span><span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span> <span class=main>``</span> <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>r</span><span class=main>∈</span>stermsl <span class=free>p</span><span class=main>.</span> <span class=bound>r</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> *
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>r</span><span class=main>∈</span>stermsl <span class=skolem>p1</span><span class=main>.</span> <span class=bound>r</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p2</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>r</span><span class=main>∈</span>stermsl <span class=skolem>p2</span><span class=main>.</span> <span class=bound>r</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> * <span class=keyword2><span class=keyword>and</span></span> AA <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∈</span> <span class=main>{</span><span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span> <span class=main>``</span> <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∨</span> <span class=skolem>p2</span> <span class=main>∈</span> <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>r</span><span class=main>∈</span>stermsl <span class=skolem>p1</span><span class=main>.</span> <span class=bound>r</span> <span class=main>∈</span> <span class=free>A</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>r</span><span class=main>∈</span>stermsl <span class=skolem>p2</span><span class=main>.</span> <span class=bound>r</span> <span class=main>∈</span> <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>∈</span> <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>r</span><span class=main>∈</span>stermsl <span class=skolem>p1</span><span class=main>.</span> <span class=bound>r</span> <span class=main>∈</span> <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span> <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p2</span> <span class=main>∈</span> <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>r</span><span class=main>∈</span>stermsl <span class=skolem>p2</span><span class=main>.</span> <span class=bound>r</span> <span class=main>∈</span> <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span> <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>r</span><span class=main>∈</span>stermsl <span class=skolem>p1</span> <span class=main>∪</span> stermsl <span class=skolem>p2</span><span class=main>.</span> <span class=bound>r</span> <span class=main>∈</span> <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>r</span><span class=main>∈</span>stermsl <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>.</span> <span class=bound>r</span> <span class=main>∈</span> <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span> <span class=keyword3><span class=command>case</span></span> UCAST <span class=keyword1><span class=command>from</span></span> UCAST.prems <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-nocall_stermsl_max><span class=command>lemma</span></span> nocall_stermsl_max<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> stermsl <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>r</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=free>r</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>q</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>theorem</span></span> wf_no_direct_calls<span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Γ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> no_calls<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>pn</span><span class=main>.</span> <span class=main>∀</span><span class=bound>pn'</span><span class=main>.</span> <span class=keyword1>call(</span><span class=bound>pn'</span><span class=main>)</span> <span class=main>∉</span> stermsl<span class=main>(</span><span class=free>Γ</span><span class=main>(</span><span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> wellformed_def wfP_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> wfI_pf<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>A</span>
    <span class=keyword3><span class=command>assume</span></span> ARA<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>⊆</span> <span class=main>{</span><span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span> <span class=main>``</span> <span class=skolem>A</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> hasnext<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span><span class=main>.</span> <span class=bound>p</span> <span class=main>∈</span> <span class=skolem>A</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>q</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span> <span class=main>∧</span> <span class=bound>q</span> <span class=main>∈</span> <span class=skolem>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> Set.equals0I<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> <span class=skolem>A</span>"</span></span> <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"False"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>p</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>l</span> <span class=skolem>f</span> <span class=skolem>p'</span>
        <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=skolem>l</span><span class=main>}</span><span class=main>⟨</span><span class=skolem>f</span><span class=main>⟩</span> <span class=skolem>p'</span> <span class=main>∈</span> <span class=skolem>A</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> hasnext <span class=main>[</span><span class=operator>OF</span> *<span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=main>{</span><span class=skolem>l</span><span class=main>}</span><span class=main>⟨</span><span class=skolem>f</span><span class=main>⟩</span> <span class=skolem>p'</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"False"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
        <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∈</span> <span class=skolem>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>∈</span> <span class=skolem>A</span> <span class=main>⟹</span> False"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p2</span> <span class=main>∈</span> <span class=skolem>A</span> <span class=main>⟹</span> False"</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span> <span class=main>∧</span> <span class=bound>q</span> <span class=main>∈</span> <span class=skolem>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> hasnext <span class=main><span class=main>[</span></span><span class=operator>OF</span> *<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>∈</span> <span class=skolem>A</span> <span class=main>∨</span> <span class=skolem>p2</span> <span class=main>∈</span> <span class=skolem>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"False"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> IH1 IH2<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pn</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span> <span class=main>∈</span> <span class=skolem>A</span>"</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span> <span class=main>∧</span> <span class=bound>q</span> <span class=main>∈</span> <span class=skolem>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> hasnext<span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>Γ</span><span class=main>(</span><span class=skolem>pn</span><span class=main>)</span> <span class=main>∈</span> <span class=skolem>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

        <span class=keyword1><span class=command>with</span></span> ARA <span class=main>[</span><span class=operator>THEN</span> stermsl_in_wfpf<span class=main>]</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span><span class=main>∈</span>stermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>∈</span> <span class=skolem>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"not_call <span class=skolem>q</span>"</span></span> <span class=keyword1><span class=command>using</span></span> no_calls <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>pn</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>unfolding</span></span> not_call_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

        <span class=keyword1><span class=command>from</span></span> hasnext <span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>∈</span> <span class=skolem>A</span>›</span></span><span class=main>]</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=skolem>q'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span>  <span class=quoted><span class=quoted>‹<span class=skolem>q</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹not_call <span class=skolem>q</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=skolem>q</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=skolem>q'</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> nocall_stermsl_max<span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"False"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> hasnext<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Start terms"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  The start terms are those terms, relative to a wellformed process specification <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Γ›</span></span></span></span>,
  from which transitions can occur directly.
›</span></span>

<span class=keyword1><span class=command>function</span></span> <span class=main>(</span>domintros<span class=main>,</span> sequential<span class=main>)</span> <span class=entity>sterms</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp set"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    sterms_choice<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>sterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span>  <span class=main>=</span> <span class=free>sterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∪</span> <span class=free>sterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span>"</span></span>
  <span class=main>|</span> sterms_call<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=free>sterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span>  <span class=main>=</span> <span class=free>sterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> sterms_other<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=free>sterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span>           <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>pat_completeness</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-sterms_dom_basic><span class=command>lemma</span></span> sterms_dom_basic<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_choice <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sterms_dom <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> accpI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"sterms_rel <span class=skolem>y</span> <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> assms <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"sterms_dom <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> sterms_rel.simps<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Cterms-sterms_termination><span class=command>lemma</span></span> sterms_termination<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sterms_dom <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> sterms_rel'<span class=main>:</span>
      <span class=quoted><span class=quoted>"sterms_rel <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>gq</span> <span class=bound>gp</span><span class=main>.</span> <span class=main>(</span><span class=bound>gq</span><span class=main>,</span> <span class=bound>gp</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=bound>Γ</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>Γ'</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=bound>Γ</span> <span class=main>=</span> <span class=bound>Γ'</span> <span class=main>∧</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=bound>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> sterms_rel.simps <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> microstep.cases<span class=main>)</span>

    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> Wellfounded.acc <span class=main>{</span><span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> wellformed_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> wf_acc_iff<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> Wellfounded.acc <span class=main>{</span><span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>..</span></span>

    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> Wellfounded.acc <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=bound>Γ</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>Γ'</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=bound>Γ</span> <span class=main>=</span> <span class=bound>Γ'</span> <span class=main>∧</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=bound>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> acc_induct<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> accI<span class=main>)</span>

    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"sterms_dom <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>unfolding</span></span> sterms_rel' accp_acc_eq <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>declare</span></span> sterms.psimps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> sterms_psimps<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> sterms.psimps <span class=main>[</span><span class=operator>OF</span> sterms_termination<span class=main>]</span>
   <span class=keyword2><span class=keyword>and</span></span> sterms_pinduct <span class=main>=</span> sterms.pinduct <span class=main>[</span><span class=operator>OF</span> sterms_termination<span class=main>]</span>

<span class=keyword1 id=AWN_Cterms-sterms_reflD><span class=command>lemma</span></span> sterms_reflD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_choice <span class=free>p</span>"</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-sterms_choice_disj><span class=command>lemma</span></span> sterms_choice_disj <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p1</span> <span class=main>∨</span> <span class=free>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-sterms_no_choice><span class=command>lemma</span></span> sterms_no_choice <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span> <span class=main>∉</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>induction</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-sterms_not_choice><span class=command>lemma</span></span> sterms_not_choice <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"not_choice <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> not_choice_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> sterms_no_choice<span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-sterms_no_call><span class=command>lemma</span></span> sterms_no_call <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>call(</span><span class=free>pn</span><span class=main>)</span> <span class=main>∉</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>induction</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-sterms_not_call><span class=command>lemma</span></span> sterms_not_call <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> not_call_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> sterms_no_call<span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-sterms_in_branch><span class=command>lemma</span></span> sterms_in_branch<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p1</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p2</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-sterms_commute><span class=command>lemma</span></span> sterms_commute<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span> <span class=main>=</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>p2</span> <span class=main>⊕</span> <span class=free>p1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule</span> Un_commute<span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-sterms_not_empty><span class=command>lemma</span></span> sterms_not_empty<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=free>p</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> sterms_pinduct <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-sterms_sterms><span class=command>lemma</span></span> sterms_sterms <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=bound>x</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> sterms <span class=free>Γ</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>induction</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-sterms_stermsl><span class=command>lemma</span></span> sterms_stermsl<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>ps</span> <span class=main>∈</span> stermsl <span class=free>p</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>ps</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> sterms_pinduct <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-stermsl_sterms><span class=command>lemma</span></span> stermsl_sterms <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> stermsl <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-sterms_stermsl_heads><span class=command>lemma</span></span> sterms_stermsl_heads<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>ps</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ps</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>pn'</span><span class=main>.</span> <span class=free>ps</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> sterms_stermsl<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Cterms-sterms_subterms><span class=command>lemma</span></span> sterms_subterms <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-no_microsteps_sterms_refl><span class=command>lemma</span></span> no_microsteps_sterms_refl<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>q</span><span class=main>.</span> <span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>sterms <span class=free>Γ</span> <span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>p</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∉</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>p</span> <span class=main>=</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pn</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span> <span class=main>∉</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>p</span> <span class=main>=</span> <span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-sterms_maximal><span class=command>lemma</span></span> sterms_maximal <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=free>q</span> <span class=main>=</span> <span class=main>{</span><span class=free>q</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>q</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-microstep_rtranscl_equal><span class=command>lemma</span></span> microstep_rtranscl_equal<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_choice <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=free>q</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> converse_rtranclpE<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=skolem>p'</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1-2<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>=</span> <span class=free>p</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_Cterms-microstep_rtranscl_singleton><span class=command>lemma</span></span> microstep_rtranscl_singleton <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_choice <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=free>p</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p'</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>p'</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>p'</span> <span class=main>∈</span> <span class=main>{</span><span class=free>p</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>microstep <span class=free>Γ</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>*</sup><span class=hidden>⇧</span><sup>*</sup></span> <span class=free>p</span> <span class=skolem>p'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>p'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>p'</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>=</span> <span class=free>p</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> converse_rtranclpE<span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=skolem>q</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹not_call <span class=free>p</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹not_choice <span class=free>p</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted>False</span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>=</span> <span class=free>p</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> <span class=main>{</span><span class=free>p</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> <span class=main>{</span><span class=free>p</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>=</span> <span class=free>p</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹not_call <span class=free>p</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹not_choice <span class=free>p</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>theorem</span></span> sterms_maximal_microstep<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> <span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>q'</span><span class=main>.</span> <span class=bound>q</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q'</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=free>p</span> <span class=main>⊆</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
     <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
     <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>p1</span> <span class=main>⊆</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=skolem>p1</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>p2</span> <span class=main>⊆</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=skolem>p2</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
     <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>p1</span> <span class=main>⊆</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
     <span class=keyword1><span class=command>proof</span></span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p'</span>
       <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p1</span>"</span></span>
       <span class=keyword1><span class=command>with</span></span> IH1 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>p'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
       <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=skolem>p1</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
       <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>p'</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> converse_rtranclp_into_rtranclp<span class=main>)</span>
       <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p1</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>p'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>p'</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
       <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
     <span class=keyword1><span class=command>qed</span></span>
     <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>p2</span> <span class=main>⊆</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
     <span class=keyword1><span class=command>proof</span></span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p'</span>
       <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p2</span>"</span></span>
       <span class=keyword1><span class=command>with</span></span> IH2 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p2</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>p'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>p'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>p'</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
       <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
       <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>p'</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> converse_rtranclp_into_rtranclp<span class=main>)</span>
       <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹sterms <span class=free>Γ</span> <span class=skolem>p'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>p'</span><span class=main>}</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
     <span class=keyword1><span class=command>qed</span></span>
     <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>⊆</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
       <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pn</span>
      <span class=keyword3><span class=command>assume</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span> <span class=main>⊆</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>Γ</span> <span class=skolem>pn</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> <span class=main>⊆</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p'</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>with</span></span> IH <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>Γ</span> <span class=skolem>pn</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>p'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>p'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>p'</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>1<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>Γ</span> <span class=skolem>pn</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>p'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> converse_rtranclp_into_rtranclp<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹sterms <span class=free>Γ</span> <span class=skolem>p'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>p'</span><span class=main>}</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=free>p</span> <span class=main>⊆</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> <span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>q'</span><span class=main>.</span> <span class=bound>q</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q'</span><span class=main>)</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> no_microsteps_sterms_refl<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span> <span class=main>⊆</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
      <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=skolem>p1</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span> <span class=main>⊆</span> sterms <span class=free>Γ</span> <span class=skolem>p1</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=skolem>p2</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span> <span class=main>⊆</span> sterms <span class=free>Γ</span> <span class=skolem>p2</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span> <span class=main>⊆</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> CollectD<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> conjE<span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q'</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>q'</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>q'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>q'</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>+</sup> <span class=skolem>q'</span>"</span></span>          
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rtranclpD sterms_no_choice<span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>q'</span> <span class=main>∨</span> <span class=skolem>p2</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>q'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> tranclpD<span class=main>)</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>q'</span>"</span></span>
          <span class=keyword1><span class=command>with</span></span> IH1 <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹sterms <span class=free>Γ</span> <span class=skolem>q'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>q'</span><span class=main>}</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p2</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>q'</span>"</span></span>
          <span class=keyword1><span class=command>with</span></span> IH2 <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹sterms <span class=free>Γ</span> <span class=skolem>q'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>q'</span><span class=main>}</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pn</span>
      <span class=keyword3><span class=command>assume</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>Γ</span> <span class=skolem>pn</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span> <span class=main>⊆</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span>   <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>}</span><span class=main>}</span> <span class=main>⊆</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>drule</span> CollectD<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> conjE<span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>q'</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>q'</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>q'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>q'</span><span class=main>}</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>+</sup> <span class=skolem>q'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rtranclpD sterms_no_call<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=free>Γ</span> <span class=skolem>pn</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>Γ</span> <span class=skolem>pn</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=skolem>q'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> tranclpD<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹sterms <span class=free>Γ</span> <span class=skolem>q'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>q'</span><span class=main>}</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> IH <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=free>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span><span class=hidden>⇧</span><sup>*</sup> <span class=bound>q</span> <span class=main>∧</span> <span class=main>¬</span><span class=main>(</span><span class=main>∃</span><span class=bound>q'</span><span class=main>.</span> <span class=bound>q</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q'</span><span class=main>)</span><span class=main>}</span> <span class=main>⊆</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> no_microsteps_sterms_refl<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Derivative terms "</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  The derivatives of a term are those <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>sterm</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>s potentially reachable by taking a
  transition, relative to a wellformed process specification <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Γ›</span></span></span></span>. These terms
  overapproximate the reachable sterms, since the truth of guards is not considered.
›</span></span>

<span class=keyword1><span class=command>function</span></span> <span class=main>(</span>domintros<span class=main>)</span> <span class=entity>dterms</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp set"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>g</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                     <span class=main>=</span> sterms <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=free><span class=bound><span class=entity>u</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                     <span class=main>=</span> sterms <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span>                     <span class=main>=</span> <span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∪</span> <span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span>  <span class=main>=</span> sterms <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>∪</span> sterms <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>        <span class=main>=</span> sterms <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>  <span class=main>=</span> sterms <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>              <span class=main>=</span> sterms <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>          <span class=main>=</span> sterms <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=free><span class=bound><span class=entity>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>           <span class=main>=</span> sterms <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span>                     <span class=main>=</span> <span class=free>dterms</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>pat_completeness</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-dterms_dom_basic><span class=command>lemma</span></span> dterms_dom_basic <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_choice <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dterms_dom <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> accpI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"dterms_rel <span class=skolem>y</span> <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> assms <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"dterms_dom <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> dterms_rel.simps<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Cterms-dterms_termination><span class=command>lemma</span></span> dterms_termination<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dterms_dom <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> dterms_rel'<span class=main>:</span> <span class=quoted><span class=quoted>"dterms_rel <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>gq</span> <span class=bound>gp</span><span class=main>.</span> <span class=main>(</span><span class=bound>gq</span><span class=main>,</span> <span class=bound>gp</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=bound>Γ</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>Γ'</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=bound>Γ</span> <span class=main>=</span> <span class=bound>Γ'</span> <span class=main>∧</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=bound>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> dterms_rel.simps <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> microstep.cases<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wellformed<span class=main>(</span><span class=free>Γ</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> Wellfounded.acc <span class=main>{</span><span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> wellformed_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> wf_acc_iff<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> Wellfounded.acc <span class=main>{</span><span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> Wellfounded.acc <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=bound>Γ</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>,</span> <span class=bound>Γ'</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>Γ</span> <span class=main>=</span> <span class=bound>Γ'</span> <span class=main>∧</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=bound>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> acc_induct<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> accI<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"dterms_dom <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> dterms_rel' <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> accp_acc_eq<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemmas</span></span> dterms_psimps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> dterms.psimps <span class=main>[</span><span class=operator>OF</span> dterms_termination<span class=main>]</span>
   <span class=keyword2><span class=keyword>and</span></span> dterms_pinduct <span class=main>=</span> dterms.pinduct <span class=main>[</span><span class=operator>OF</span> dterms_termination<span class=main>]</span>

<span class=keyword1 id=AWN_Cterms-sterms_after_dterms><span class=command>lemma</span></span> sterms_after_dterms <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=bound>x</span><span class=main>∈</span>dterms <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> sterms <span class=free>Γ</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-sterms_before_dterms><span class=command>lemma</span></span> sterms_before_dterms <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=bound>x</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> dterms <span class=free>Γ</span> <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-dterms_choice_disj><span class=command>lemma</span></span> dterms_choice_disj <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p1</span> <span class=main>∨</span> <span class=free>p</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-dterms_in_branch><span class=command>lemma</span></span> dterms_in_branch<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p1</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p2</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-dterms_no_choice><span class=command>lemma</span></span> dterms_no_choice<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span> <span class=main>∉</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>induction</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-dterms_not_choice><span class=command>lemma</span></span> dterms_not_choice <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"not_choice <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> not_choice_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> dterms_no_choice<span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-dterms_no_call><span class=command>lemma</span></span> dterms_no_call<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>call(</span><span class=free>pn</span><span class=main>)</span> <span class=main>∉</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>induction</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-dterms_not_call><span class=command>lemma</span></span> dterms_not_call <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> not_call_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> dterms_no_call<span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-dterms_subterms><span class=command>lemma</span></span> dterms_subterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=skolem>p1</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=skolem>p2</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> * <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> wf <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=skolem>p1</span> <span class=main>∨</span> <span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=skolem>p2</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=skolem>p1</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> IH1<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=skolem>p2</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> IH2<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Note that the converse of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>thm</span></span> dterms_subterms<span class=antiquote><span class=antiquote>}</span></span></span></span> is not true because <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>dterm</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>s are an
  over-approximation; i.e., we cannot show, in general, that guards return a non-empty set
  of post-states.
›</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Control terms "</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  The control terms of a process specification <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>Γ</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> are those subterms from which
  transitions are directly possible. We can omit <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>pn</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> terms, since
  the root terms of all processes are considered, and also <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>p1</span></span> <span class=main><span class=main>⊕</span></span> <span class=free><span class=free>p2</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> terms
  since they effectively combine the transitions of the subterms <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>p1</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>p2</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.

  It will be shown that only the control terms, rather than all subterms, need be
  considered in invariant proofs.
›</span></span>

<span class=keyword1><span class=command>inductive_set</span></span>
  <span class=entity>cterms</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>Γ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    ctermsSI<span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>Γ</span> <span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span> <span class=main>⟹</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>∈</span> <span class=free>cterms</span> <span class=free>Γ</span>"</span></span>
  <span class=main>|</span> ctermsDI<span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free><span class=bound><span class=entity>pp</span></span></span> <span class=main>∈</span> <span class=free>cterms</span> <span class=free>Γ</span><span class=main>;</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free><span class=bound><span class=entity>pp</span></span></span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>∈</span> <span class=free>cterms</span> <span class=free>Γ</span>"</span></span>

<span class=keyword1 id=AWN_Cterms-cterms_not_choice><span class=command>lemma</span></span> cterms_not_choice <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"not_choice <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> CHOICE <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-cterms_no_choice><span class=command>lemma</span></span> cterms_no_choice <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span> <span class=main>∉</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> cterms_not_choice<span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-cterms_not_call><span class=command>lemma</span></span> cterms_not_call <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> CALL <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-cterms_no_call><span class=command>lemma</span></span> cterms_no_call <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>call(</span><span class=free>pn</span><span class=main>)</span> <span class=main>∉</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> cterms_not_call<span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-sterms_cterms><span class=command>lemma</span></span> sterms_cterms <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-dterms_cterms><span class=command>lemma</span></span> dterms_cterms <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-derivs_in_cterms><span class=command>lemma</span></span> derivs_in_cterms <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>f</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟨</span><span class=bound>f</span><span class=main>⟩</span> <span class=bound>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>                            <span class=main>⟹</span> sterms <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>f</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>⟦</span><span class=bound>f</span><span class=main>⟧</span> <span class=bound>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>                           <span class=main>⟹</span> sterms <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fip</span> <span class=bound>fmsg</span> <span class=bound>q</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}unicast(</span><span class=bound>fip</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> <span class=main>▹</span> <span class=bound>q</span> <span class=main>∈</span> cterms <span class=free>Γ</span>
                            <span class=main>⟹</span> sterms <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⊆</span> cterms <span class=free>Γ</span> <span class=main>∧</span> sterms <span class=free>Γ</span> <span class=bound>q</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>      <span class=main>{</span><span class=bound>l</span><span class=keyword1>}broadcast(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>       <span class=main>⟹</span> sterms <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fips</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=bound>l</span><span class=keyword1>}groupcast(</span><span class=bound>fips</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span> <span class=main>⟹</span> sterms <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>      <span class=main>{</span><span class=bound>l</span><span class=keyword1>}send(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>            <span class=main>⟹</span> sterms <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fdata</span> <span class=bound>p</span><span class=main>.</span>     <span class=main>{</span><span class=bound>l</span><span class=keyword1>}deliver(</span><span class=bound>fdata</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>        <span class=main>⟹</span> sterms <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>      <span class=main>{</span><span class=bound>l</span><span class=keyword1>}receive(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>         <span class=main>⟹</span> sterms <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> dterms.psimps<span class=main>)</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Local control terms"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  We introduce a `local' version of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>cterms</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> that does not step through calls and,
  thus, that is defined independently of a process specification <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>Γ</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.
  This allows an alternative, terminating characterisation of cterms as a set of
  subterms. Including <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>pn</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>s in the set makes for a simpler relation with
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"stermsl"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>, even if they must be filtered out for the desired characterisation.
›</span></span>

<span class=keyword1><span class=command>function</span></span>
  <span class=entity>ctermsl</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span> <span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>ctermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>g</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                     <span class=main>=</span> insert <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>g</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>  <span class=main>(</span><span class=free>ctermsl</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ctermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=free><span class=bound><span class=entity>u</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                     <span class=main>=</span> insert <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=free><span class=bound><span class=entity>u</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>  <span class=main>(</span><span class=free>ctermsl</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ctermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span> <span class=main>=</span> insert <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span>
                                                                      <span class=main>(</span><span class=free>ctermsl</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>∪</span> <span class=free>ctermsl</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ctermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>       <span class=main>=</span> insert <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>       <span class=main>(</span><span class=free>ctermsl</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ctermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>  <span class=main>=</span> insert <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free>ctermsl</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ctermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>            <span class=main>=</span> insert <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>            <span class=main>(</span><span class=free>ctermsl</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ctermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>        <span class=main>=</span> insert <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>        <span class=main>(</span><span class=free>ctermsl</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ctermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=free><span class=bound><span class=entity>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>         <span class=main>=</span> insert <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=free><span class=bound><span class=entity>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>         <span class=main>(</span><span class=free>ctermsl</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ctermsl</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span>                    <span class=main>=</span> <span class=free>ctermsl</span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∪</span> <span class=free>ctermsl</span> <span class=free><span class=bound><span class=entity>p2</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>ctermsl</span> <span class=main>(</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span>                   <span class=main>=</span> <span class=main>{</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>pat_completeness</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>termination</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>relation</span> <span class=quoted><span class=quoted>"measure<span class=main>(</span>size<span class=main>)</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> stermsl_nobigger<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> ctermsl_induct <span class=main>=</span>
  ctermsl.induct <span class=main>[</span><span class=operator>case_names</span> GUARD ASSIGN UCAST BCAST GCAST
                             SEND DELIVER RECEIVE CHOICE CALL<span class=main>]</span>

<span class=keyword1 id=AWN_Cterms-ctermsl_refl><span class=command>lemma</span></span> ctermsl_refl <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"not_choice <span class=free>p</span> <span class=main>⟹</span> <span class=free>p</span> <span class=main>∈</span> ctermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-ctermsl_subterms><span class=command>lemma</span></span> ctermsl_subterms<span class=main>:</span>
  <span class=quoted><span class=quoted>"ctermsl <span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>q</span><span class=main>.</span> <span class=bound>q</span> <span class=main>∈</span> subterms <span class=free>p</span> <span class=main>∧</span> not_choice <span class=bound>q</span> <span class=main>}</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>⊆</span> <span class=var>?rhs</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span> <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?rhs</span> <span class=main>⊆</span> <span class=var>?lhs</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Cterms-ctermsl_trans><span class=command>lemma</span></span> ctermsl_trans <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=free>q</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> ctermsl_induct<span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>CHOICE <span class=skolem>p1</span> <span class=skolem>p2</span><span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>q</span> <span class=main>∈</span> ctermsl <span class=skolem>p1</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=free>q</span> <span class=main>∈</span> ctermsl <span class=skolem>p2</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> CHOICE.prems<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=skolem>p1</span> <span class=main>∨</span> <span class=free>r</span> <span class=main>∈</span> ctermsl <span class=skolem>p2</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> disj_forward<span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=skolem>p1</span>"</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=skolem>p1</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=free>q</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> CHOICE.IH<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=skolem>p2</span>"</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=free>q</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> CHOICE.IH<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-ctermsl_ex_trans><span class=command>lemma</span></span> ctermsl_ex_trans <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>q</span> <span class=main>∈</span> ctermsl <span class=free>p</span><span class=main>.</span> <span class=free>r</span> <span class=main>∈</span> ctermsl <span class=bound>q</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-call_ctermsl_empty><span class=command>lemma</span></span> call_ctermsl_empty <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>p</span> <span class=main>∈</span> ctermsl <span class=free>p'</span><span class=main>;</span> not_call <span class=free>p</span> <span class=main>⟧</span> <span class=main>⟹</span> not_call <span class=free>p'</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> not_call_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-stermsl_ctermsl_choice1><span class=command>lemma</span></span> stermsl_ctermsl_choice1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> stermsl <span class=free>p1</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p1</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-stermsl_ctermsl_choice2><span class=command>lemma</span></span> stermsl_ctermsl_choice2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> stermsl <span class=free>p2</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p2</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-stermsl_ctermsl><span class=command>lemma</span></span> stermsl_ctermsl <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> stermsl <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>CHOICE <span class=skolem>p1</span> <span class=skolem>p2</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> stermsl <span class=skolem>p1</span> <span class=main>∨</span> <span class=free>q</span> <span class=main>∈</span> stermsl <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> ctermsl.simps<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span>  <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=free>p</span>"</span></span> <span class=keyword1><span class=command>using</span></span> CHOICE <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-stermsl_after_ctermsl><span class=command>lemma</span></span> stermsl_after_ctermsl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=bound>x</span><span class=main>∈</span>ctermsl <span class=free>p</span><span class=main>.</span> stermsl <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> ctermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-stermsl_before_ctermsl><span class=command>lemma</span></span> stermsl_before_ctermsl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=bound>x</span><span class=main>∈</span>stermsl <span class=free>p</span><span class=main>.</span> ctermsl <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> ctermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-ctermsl_no_choice><span class=command>lemma</span></span> ctermsl_no_choice<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span> <span class=main>∉</span> ctermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-ctermsl_ex_stermsl><span class=command>lemma</span></span> ctermsl_ex_stermsl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=free>p</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>ps</span><span class=main>∈</span>stermsl <span class=free>p</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=bound>ps</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-dterms_ctermsl><span class=command>lemma</span></span> dterms_ctermsl <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=free>p</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1-2<span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> dterms_pinduct <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>Γ</span> <span class=skolem>l</span> <span class=skolem>fg</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=skolem>Γ</span> <span class=main>(</span><span class=main>{</span><span class=skolem>l</span><span class=main>}</span><span class=main>⟨</span><span class=skolem>fg</span><span class=main>⟩</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=skolem>Γ</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> sterms <span class=skolem>Γ</span> <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> stermsl <span class=skolem>p</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=skolem>Γ</span>›</span></span>  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> sterms_stermsl<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=main>{</span><span class=skolem>l</span><span class=main>}</span><span class=main>⟨</span><span class=skolem>fg</span><span class=main>⟩</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> stermsl <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> stermsl_ctermsl<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=main>{</span><span class=skolem>l</span><span class=main>}</span><span class=main>⟨</span><span class=skolem>fg</span><span class=main>⟩</span> <span class=skolem>p</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> stermsl_ctermsl<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>Γ</span> <span class=skolem>p1</span> <span class=skolem>p2</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=skolem>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>q</span> <span class=main>∈</span> dterms <span class=skolem>Γ</span> <span class=skolem>p1</span><span class=main>;</span> wellformed <span class=skolem>Γ</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=skolem>p1</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>q</span> <span class=main>∈</span> dterms <span class=skolem>Γ</span> <span class=skolem>p2</span><span class=main>;</span> wellformed <span class=skolem>Γ</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=skolem>p2</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=skolem>Γ</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>Γ</span> <span class=skolem>pn</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=skolem>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=skolem>Γ</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free>q</span> <span class=main>∈</span> dterms <span class=skolem>Γ</span> <span class=main>(</span><span class=skolem>Γ</span> <span class=skolem>pn</span><span class=main>)</span><span class=main>;</span> wellformed <span class=skolem>Γ</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=skolem>pn</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>metis</span> sterms_stermsl stermsl_ctermsl<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-ctermsl_cterms><span class=command>lemma</span></span> ctermsl_cterms <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=free>p</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> ctermsl.induct<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Local deriviative terms"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  We define local <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>dterm</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>s for use in the theorem that relates <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"cterms"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
  and sets of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"ctermsl"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.
›</span></span>

<span class=keyword1><span class=command>function</span></span> <span class=entity>dtermsl</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp set"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>dtermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>fg</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                     <span class=main>=</span> stermsl <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dtermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=free><span class=bound><span class=entity>fa</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                     <span class=main>=</span> stermsl <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dtermsl</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span>                      <span class=main>=</span> <span class=free>dtermsl</span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∪</span> <span class=free>dtermsl</span> <span class=free><span class=bound><span class=entity>p2</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dtermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>fip</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span>  <span class=main>=</span> stermsl <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>∪</span> stermsl <span class=free><span class=bound><span class=entity>q</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dtermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>         <span class=main>=</span> stermsl <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dtermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=free><span class=bound><span class=entity>fips</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>   <span class=main>=</span> stermsl <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dtermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>               <span class=main>=</span> stermsl <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dtermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=free><span class=bound><span class=entity>fdata</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>           <span class=main>=</span> stermsl <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dtermsl</span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>            <span class=main>=</span> stermsl <span class=free><span class=bound><span class=entity>p</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>dtermsl</span> <span class=main>(</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span>                      <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>pat_completeness</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>termination</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>relation</span> <span class=quoted><span class=quoted>"measure<span class=main>(</span>size<span class=main>)</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> stermsl_nobigger<span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-stermsl_after_dtermsl><span class=command>lemma</span></span> stermsl_after_dtermsl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=bound>x</span><span class=main>∈</span>dtermsl <span class=free>p</span><span class=main>.</span> stermsl <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> dtermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-stermsl_before_dtermsl><span class=command>lemma</span></span> stermsl_before_dtermsl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋃</span><span class=bound>x</span><span class=main>∈</span>stermsl <span class=free>p</span><span class=main>.</span> dtermsl <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> dtermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-dtermsl_no_choice><span class=command>lemma</span></span> dtermsl_no_choice <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span> <span class=main>∉</span> dtermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Cterms-dtermsl_choice_disj><span class=command>lemma</span></span> dtermsl_choice_disj <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> dtermsl <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>p</span> <span class=main>∈</span> dtermsl <span class=free>p1</span> <span class=main>∨</span> <span class=free>p</span> <span class=main>∈</span> dtermsl <span class=free>p2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_Cterms-dtermsl_in_branch><span class=command>lemma</span></span> dtermsl_in_branch <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>p</span> <span class=main>∈</span> dtermsl <span class=main>(</span><span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span><span class=main>;</span> <span class=free>p</span> <span class=main>∈</span> dtermsl <span class=free>p1</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span> <span class=free>p</span> <span class=main>∈</span> dtermsl <span class=free>p2</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-ctermsl_dtermsl><span class=command>lemma</span></span> ctermsl_dtermsl <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dtermsl <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>metis</span> stermsl_ctermsl<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-dtermsl_dterms><span class=command>lemma</span></span> dtermsl_dterms <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dtermsl <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>metis</span> stermsl_sterms<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-ctermsl_stermsl_or_dtermsl><span class=command>lemma</span></span> ctermsl_stermsl_or_dtermsl<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> ctermsl <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> stermsl <span class=free>p</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>p'</span><span class=main>∈</span>dtermsl <span class=free>p</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> ctermsl <span class=bound>p'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ctermsl_ex_stermsl<span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-dtermsl_add_stermsl_beforeD><span class=command>lemma</span></span> dtermsl_add_stermsl_beforeD<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dtermsl <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ps</span><span class=main>∈</span>stermsl <span class=free>p</span><span class=main>.</span> <span class=free>q</span> <span class=main>∈</span> dtermsl <span class=bound>ps</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> <span class=main>(</span><span class=main>⋃</span><span class=bound>x</span><span class=main>∈</span>stermsl <span class=free>p</span><span class=main>.</span> dtermsl <span class=bound>x</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> UN_E<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Cterms-call_dtermsl_empty><span class=command>lemma</span></span> call_dtermsl_empty <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
 <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> dtermsl <span class=free>p</span> <span class=main>⟹</span> not_call <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"More properties of control terms"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  We now show an alternative definition of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"cterms"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> based on sets of local control
  terms. While the original definition has convenient induction and simplification rules,
  useful for proving properties like cterms\_includes\_sterms\_of\_seq\_reachable, this
  definition makes it easier to systematically generate the set of control terms of a
  process specification.
›</span></span>

<span class=keyword1><span class=command>theorem</span></span> cterms_def'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wfg<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cterms <span class=free>Γ</span> <span class=main>=</span> <span class=main>{</span> <span class=bound>p</span> <span class=main>|</span><span class=bound>p</span> <span class=bound>pn</span><span class=main>.</span> <span class=bound>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span> <span class=main>∧</span> not_call <span class=bound>p</span> <span class=main>}</span>"</span></span>
          <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>=</span> <span class=var>?ctermsl_set</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> iffI <span class=main><span class=main>[</span></span><span class=operator>THEN</span> set_eqI<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> <span class=var>?ctermsl_set</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=skolem>p</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span> <span class=skolem>pn</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> wfg
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> sterms_stermsl_heads<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>›</span></span> wfg <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"not_call <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> <span class=var>?ctermsl_set</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pp</span> <span class=skolem>p</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>pp</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>pp</span> <span class=main>∈</span> <span class=var>?ctermsl_set</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=skolem>pp</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=skolem>pp</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> wfg <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> dterms_ctermsl<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=skolem>pp</span>"</span></span>
          <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>pp</span> <span class=main>∈</span> cterms <span class=free>Γ</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> IH <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>pp</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn'</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=skolem>pp</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>qed</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=skolem>pp</span>›</span></span> wfg <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"not_call <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> <span class=var>?ctermsl_set</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> <span class=var>?ctermsl_set</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_call <span class=skolem>p</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>p'</span><span class=main>∈</span>dtermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=bound>p'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ctermsl_stermsl_or_dtermsl<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹not_call <span class=skolem>p</span>›</span></span> wfg <span class=keyword1><span class=command>..</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>p'</span><span class=main>∈</span>dtermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=bound>p'</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=keyword2><span class=keyword>where</span></span> p'1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> dtermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
                       <span class=keyword2><span class=keyword>and</span></span> p'2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=skolem>p'</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>from</span></span> p'2 <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹not_call <span class=skolem>p</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"not_call <span class=skolem>p'</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>from</span></span> p'1 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ps</span></span> <span class=keyword2><span class=keyword>where</span></span> ps1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ps</span> <span class=main>∈</span> stermsl <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
                           <span class=keyword2><span class=keyword>and</span></span> ps2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> dtermsl <span class=skolem>ps</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> dtermsl_add_stermsl_beforeD<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> ps2 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"not_call <span class=skolem>ps</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> ps1 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ps</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>using</span></span> wfg <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p'</span> <span class=main>∈</span> dtermsl <span class=skolem>ps</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹not_call <span class=skolem>p'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>using</span></span> wfg <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>p'</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>using</span></span> wfg <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p</span> <span class=main>∈</span> ctermsl <span class=skolem>p'</span>›</span></span> <span class=quoted><span class=quoted>‹not_call <span class=skolem>p</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>using</span></span> wfg <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Cterms-ctermsE><span class=command>lemma</span></span> ctermsE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>pn</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>unfolding</span></span> cterms_def' <span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>corollary</span></span> cterms_subterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cterms <span class=free>Γ</span> <span class=main>=</span> <span class=main>{</span><span class=bound>p</span><span class=main>|</span><span class=bound>p</span> <span class=bound>pn</span><span class=main>.</span> <span class=bound>p</span><span class=main>∈</span>subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span> <span class=main>∧</span> not_call <span class=bound>p</span> <span class=main>∧</span> not_choice <span class=bound>p</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> cterms_def' <span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> ctermsl_subterms<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-subterms_in_cterms><span class=command>lemma</span></span> subterms_in_cterms <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span><span class=main>∈</span>subterms <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_choice <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> cterms_subterms <span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-subterms_stermsl_ctermsl><span class=command>lemma</span></span> subterms_stermsl_ctermsl<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> subterms <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> stermsl <span class=free>q</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> subterms <span class=skolem>p1</span> <span class=main>⟹</span> <span class=free>r</span> <span class=main>∈</span> stermsl <span class=free>q</span> <span class=main>⟹</span> <span class=free>r</span> <span class=main>∈</span> ctermsl <span class=skolem>p1</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> subterms <span class=skolem>p2</span> <span class=main>⟹</span> <span class=free>r</span> <span class=main>∈</span> stermsl <span class=free>q</span> <span class=main>⟹</span> <span class=free>r</span> <span class=main>∈</span> ctermsl <span class=skolem>p2</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> stermsl <span class=free>q</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> <span class=main>{</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>}</span> <span class=main>∪</span> subterms <span class=skolem>p1</span> <span class=main>∪</span> subterms <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>elim</span> UnE<span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> <span class=main>{</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>∈</span> stermsl <span class=free>q</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> stermsl_ctermsl<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> subterms <span class=skolem>p1</span>"</span></span> <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=skolem>p1</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>∈</span> stermsl <span class=free>q</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> subterms <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>∈</span> ctermsl <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>∈</span> stermsl <span class=free>q</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Cterms-subterms_sterms_cterms><span class=command>lemma</span></span> subterms_sterms_cterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=free>p</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>call(</span><span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> wf <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=free>Γ</span> <span class=skolem>p</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span> <span class=main>⟹</span> sterms <span class=free>Γ</span> <span class=skolem>p1</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span> <span class=main>⟹</span> sterms <span class=free>Γ</span> <span class=skolem>p2</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>p1</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=skolem>p2</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"sterms <span class=free>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>)</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>using</span></span> wf <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> subterms_in_cterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Cterms-subterms_sterms_in_cterms><span class=command>lemma</span></span> subterms_sterms_in_cterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=free>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>q</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> subterms_sterms_cterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=AWN_Labels><div class=head><h1>Theory AWN_Labels</h1></div><pre class=source><span class=comment1>(*  Title:       AWN_Labels.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Labelling sequential processes"</span></span>

<span class=keyword1><span class=command>theory</span></span> AWN_Labels
<span class=keyword2><span class=keyword>imports</span></span> <a href=AWN.html>AWN</a> <a href=AWN_Cterms.html>AWN_Cterms</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Labels "</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Labels serve two main purposes. They allow the substitution of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>sterm</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>s in
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>invariant</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> proofs. They also allow the strengthening (control state dependent)
  of invariants.
›</span></span>

<span class=keyword1><span class=command>function</span></span> <span class=main>(</span>domintros<span class=main>)</span> <span class=entity>labels</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>⇒</span> <span class=tfree>'l</span> set"</span></span>
  <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>fg</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                     <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=free><span class=bound><span class=entity>fa</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                     <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span>                      <span class=main>=</span> <span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∪</span> <span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>fip</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span>  <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>         <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=free><span class=bound><span class=entity>fips</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>   <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>               <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=free><span class=bound><span class=entity>fdata</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>           <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>            <span class=main>=</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span>                      <span class=main>=</span> <span class=free>labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>pat_completeness</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Labels-labels_dom_basic><span class=command>lemma</span></span> labels_dom_basic <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"not_call <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_choice <span class=free>p</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"labels_dom <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> accpI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"labels_rel <span class=skolem>y</span> <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> assms <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"labels_dom <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> labels_rel.simps<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Labels-labels_termination><span class=command>lemma</span></span> labels_termination<span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Γ</span> <span class=free>p</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed<span class=main>(</span><span class=free>Γ</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"labels_dom <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> labels_rel'<span class=main>:</span> <span class=quoted><span class=quoted>"labels_rel <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>gq</span> <span class=bound>gp</span><span class=main>.</span> <span class=main>(</span><span class=bound>gq</span><span class=main>,</span> <span class=bound>gp</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=bound>Γ</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>Γ'</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=bound>Γ</span> <span class=main>=</span> <span class=bound>Γ'</span> <span class=main>∧</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=bound>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> labels_rel.simps <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> microstep.intros <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> microstep.cases<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wellformed<span class=main>(</span><span class=free>Γ</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> Wellfounded.acc <span class=main>{</span><span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> wellformed_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> wf_acc_iff<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> Wellfounded.acc <span class=main>{</span><span class=main>(</span><span class=bound>q</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=free>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> Wellfounded.acc <span class=main>{</span><span class=main>(</span><span class=main>(</span><span class=bound>Γ</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>,</span> <span class=bound>Γ'</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=bound>Γ</span> <span class=main>=</span> <span class=bound>Γ'</span> <span class=main>∧</span> <span class=bound>p</span> ↝<span class=hidden>⇘</span><sub><span class=bound>Γ</span></sub><span class=hidden>⇙</span> <span class=bound>q</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> acc_induct<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> accI<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"labels_dom <span class=main>(</span><span class=free>Γ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> labels_rel' <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> accp_acc_eq<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>declare</span></span> labels.psimps<span class=main>[</span><span class=operator>simp</span><span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> labels_pinduct <span class=main>=</span> labels.pinduct <span class=main>[</span><span class=operator>OF</span> labels_termination<span class=main>]</span>
   <span class=keyword2><span class=keyword>and</span></span> labels_psimps<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> labels.psimps <span class=main>[</span><span class=operator>OF</span> labels_termination<span class=main>]</span>

<span class=keyword1 id=AWN_Labels-labels_not_empty><span class=command>lemma</span></span> labels_not_empty<span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Γ</span> <span class=free>p</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"labels <span class=free>Γ</span> <span class=free>p</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
   <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> labels_pinduct <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=AWN_Labels-has_label><span class=command>lemma</span></span> has_label <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Γ</span> <span class=free>p</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>l</span><span class=main>.</span> <span class=bound>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> labels_not_empty <span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Labels-singleton_labels><span class=command>lemma</span></span> singleton_labels <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>f</span> <span class=bound>p</span><span class=main>.</span>          <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=main>}</span><span class=main>⟨</span><span class=bound>f</span><span class=main>⟩</span> <span class=bound>p</span><span class=main>)</span>                       <span class=main>=</span> <span class=main>(</span><span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>f</span> <span class=bound>p</span><span class=main>.</span>          <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=main>}</span><span class=main>⟦</span><span class=bound>f</span><span class=main>⟧</span> <span class=bound>p</span><span class=main>)</span>                      <span class=main>=</span> <span class=main>(</span><span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fip</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}unicast(</span><span class=bound>fip</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>▹</span> <span class=bound>q</span><span class=main>)</span>  <span class=main>=</span> <span class=main>(</span><span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}broadcast(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span><span class=main>)</span>         <span class=main>=</span> <span class=main>(</span><span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fips</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>  <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}groupcast(</span><span class=bound>fips</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span><span class=main>)</span>   <span class=main>=</span> <span class=main>(</span><span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}send(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>               <span class=main>=</span> <span class=main>(</span><span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fdata</span> <span class=bound>p</span><span class=main>.</span>      <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}deliver(</span><span class=bound>fdata</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>           <span class=main>=</span> <span class=main>(</span><span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}receive(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>            <span class=main>=</span> <span class=main>(</span><span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Labels-in_labels_singletons><span class=command>lemma</span></span> in_labels_singletons <span class=main>[</span><span class=operator>dest</span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>f</span> <span class=bound>p</span><span class=main>.</span>          <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=main>}</span><span class=main>⟨</span><span class=bound>f</span><span class=main>⟩</span> <span class=bound>p</span><span class=main>)</span>                       <span class=main>⟹</span> <span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>f</span> <span class=bound>p</span><span class=main>.</span>          <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=main>}</span><span class=main>⟦</span><span class=bound>f</span><span class=main>⟧</span> <span class=bound>p</span><span class=main>)</span>                      <span class=main>⟹</span> <span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fip</span> <span class=bound>fmsg</span> <span class=bound>p</span> <span class=bound>q</span><span class=main>.</span> <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}unicast(</span><span class=bound>fip</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span> <span class=main>▹</span> <span class=bound>q</span><span class=main>)</span>  <span class=main>⟹</span> <span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}broadcast(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span><span class=main>)</span>         <span class=main>⟹</span> <span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fips</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>  <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}groupcast(</span><span class=bound>fips</span><span class=main>,</span> <span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=bound>p</span><span class=main>)</span>   <span class=main>⟹</span> <span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}send(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>               <span class=main>⟹</span> <span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fdata</span> <span class=bound>p</span><span class=main>.</span>      <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}deliver(</span><span class=bound>fdata</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>           <span class=main>⟹</span> <span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>l</span> <span class=bound>l'</span> <span class=bound>fmsg</span> <span class=bound>p</span><span class=main>.</span>       <span class=bound>l</span> <span class=main>∈</span> labels <span class=bound>Γ</span> <span class=main>(</span><span class=main>{</span><span class=bound>l'</span><span class=keyword1>}receive(</span><span class=bound>fmsg</span><span class=main>)</span><span class=main>.</span><span class=bound>p</span><span class=main>)</span>            <span class=main>⟹</span> <span class=bound>l</span> <span class=main>=</span> <span class=bound>l'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>simple_labels</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>simple_labels</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=bound>pn</span><span class=main>.</span> <span class=main>∀</span><span class=bound>p</span><span class=main>∈</span>subterms <span class=main>(</span><span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=bound>pn</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>∃!</span><span class=bound>l</span><span class=main>.</span> labels <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=bound>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>l</span><span class=main>}</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=AWN_Labels-simple_labelsI><span class=command>lemma</span></span> simple_labelsI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>pn</span> <span class=bound>p</span><span class=main>.</span> <span class=bound>p</span><span class=main>∈</span>subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>∃!</span><span class=bound>l</span><span class=main>.</span> labels <span class=free>Γ</span> <span class=bound>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>l</span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"simple_labels <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> simple_labels_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  The <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"simple_labels <span class=free><span class=free>Γ</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> property is necessary to transfer results shown over the
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"cterms"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> of a process specification <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>Γ</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> to the reachable actions of
  that process.

  Consider the process <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=main><span class=main>{</span></span><span class=free><span class=free>l<span class=hidden>⇩</span><sub>1</sub></span></span><span class=keyword1><span class=keyword1>}send(</span></span><span class=free><span class=free>m1</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>.</span></span> <span class=free><span class=free>p1</span></span> <span class=main><span class=main>⊕</span></span> <span class=main><span class=main>{</span></span><span class=free><span class=free>l<span class=hidden>⇩</span><sub>2</sub></span></span><span class=keyword1><span class=keyword1>}send(</span></span><span class=free><span class=free>m2</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>.</span></span> <span class=free><span class=free>p2</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>. The iteration over <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span>
  <span class=quoted><span class=quoted>"cterms <span class=free><span class=free>Γ</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> will cover the two transitions
    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=free><span class=free>l<span class=hidden>⇩</span><sub>1</sub></span></span><span class=main><span class=main>,</span></span> send <span class=free><span class=free>m1</span></span><span class=main><span class=main>,</span></span> <span class=free><span class=free>p1</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and
    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=free><span class=free>l<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main><span class=main>,</span></span> send <span class=free><span class=free>m2</span></span><span class=main><span class=main>,</span></span> <span class=free><span class=free>p2</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>,
  but reachability requires the four transitions
    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=free><span class=free>l<span class=hidden>⇩</span><sub>1</sub></span></span><span class=main><span class=main>,</span></span> send <span class=free><span class=free>m1</span></span><span class=main><span class=main>,</span></span> <span class=free><span class=free>p1</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>,
    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=free><span class=free>l<span class=hidden>⇩</span><sub>1</sub></span></span><span class=main><span class=main>,</span></span> send <span class=free><span class=free>m2</span></span><span class=main><span class=main>,</span></span> <span class=free><span class=free>p2</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>,
    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=free><span class=free>l<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main><span class=main>,</span></span> send <span class=free><span class=free>m1</span></span><span class=main><span class=main>,</span></span> <span class=free><span class=free>p1</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>, and
    <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=free><span class=free>l<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main><span class=main>,</span></span> send <span class=free><span class=free>m2</span></span><span class=main><span class=main>,</span></span> <span class=free><span class=free>p2</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.

  In a simply labelled process, the former is sufficient to show the latter, since
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>l<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=main><span class=main>=</span></span> <span class=free><span class=free>l<span class=hidden>⇩</span><sub>2</sub></span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.

  This requirement seems really only to be restrictive for processes where a <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>pn</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
  occurs as a direct subterm of a choice operator. Consider, for instance, <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=main><span class=main>{</span></span><span class=free><span class=free>l<span class=hidden>⇩</span><sub>1</sub></span></span><span class=main><span class=main>}</span></span><span class=main><span class=main>⟦</span></span><span class=free><span class=free>e</span></span><span class=main><span class=main>⟧</span></span> <span class=free><span class=free>p</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>⊕</span></span>
  <span class=keyword1><span class=keyword1>call(</span></span><span class=free><span class=free>pn</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>. Here <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>l<span class=hidden>⇩</span><sub>1</sub></span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> must equal the label of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>Γ</span></span><span class=main><span class=main>(</span></span><span class=free><span class=free>pn</span></span><span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>, which can then not be
  distinguished from any other subterm that calls <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>pn</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> in any other process.

  This limitation stems from the fact that the "call points" of a process are effectively treated as
  the root of the called process. This is by design; we try to treat call sites as "syntactic
  pastings" of process terms, giving rise, conceptually, to an infinite tree structure. But this
  prejudices the alternative view that process calls are used as "join points" of "process threads",
  in complement to the "fork points" of the <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>p1</span></span> <span class=main><span class=main>⊕</span></span> <span class=free><span class=free>p2</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> operator.
›</span></span>

<span class=keyword1 id=AWN_Labels-simple_labels_in_sterms><span class=command>lemma</span></span> simple_labels_in_sterms<span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Γ</span> <span class=free>l</span> <span class=free>p</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"simple_labels <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p</span><span class=main>∈</span>subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> labels_pinduct <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>Γ</span> <span class=skolem>p1</span> <span class=skolem>p2</span>
    <span class=keyword3><span class=command>assume</span></span> sl<span class=main>:</span> <span class=quoted><span class=quoted>"simple_labels <span class=skolem>Γ</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=skolem>Γ</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> simple_labels <span class=skolem>Γ</span><span class=main>;</span> wellformed <span class=skolem>Γ</span><span class=main>;</span>
                   <span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>;</span> <span class=free>l</span> <span class=main>∈</span> labels <span class=skolem>Γ</span> <span class=skolem>p1</span> <span class=main>⟧</span>
                 <span class=main>⟹</span> <span class=main>∀</span><span class=bound>p'</span><span class=main>∈</span>sterms <span class=skolem>Γ</span> <span class=skolem>p1</span><span class=main>.</span> <span class=free>l</span> <span class=main>∈</span> labels <span class=skolem>Γ</span> <span class=bound>p'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> simple_labels <span class=skolem>Γ</span><span class=main>;</span> wellformed <span class=skolem>Γ</span><span class=main>;</span>
                   <span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>;</span> <span class=free>l</span> <span class=main>∈</span> labels <span class=skolem>Γ</span> <span class=skolem>p2</span> <span class=main>⟧</span>
                 <span class=main>⟹</span> <span class=main>∀</span><span class=bound>p'</span><span class=main>∈</span>sterms <span class=skolem>Γ</span> <span class=skolem>p2</span><span class=main>.</span> <span class=free>l</span> <span class=main>∈</span> labels <span class=skolem>Γ</span> <span class=bound>p'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> ein<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> l12<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> labels <span class=skolem>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> sl ein l12 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"labels <span class=skolem>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> simple_labels_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> empty_iff insert_iff<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> wf <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"labels <span class=skolem>Γ</span> <span class=skolem>p1</span> <span class=main>∪</span> labels <span class=skolem>Γ</span> <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"labels <span class=skolem>Γ</span> <span class=skolem>p1</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"labels <span class=skolem>Γ</span> <span class=skolem>p2</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> wf <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> labels_not_empty<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> labels <span class=skolem>Γ</span> <span class=skolem>p1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> labels <span class=skolem>Γ</span> <span class=skolem>p2</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Un_iff empty_iff insert_iff set_eqI<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> ein <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
                       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=skolem>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>p'</span><span class=main>∈</span>sterms <span class=skolem>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>.</span> <span class=free>l</span><span class=main>∈</span>labels <span class=skolem>Γ</span> <span class=bound>p'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> wf IH1 <span class=main>[</span><span class=operator>OF</span> sl wf<span class=main>]</span> IH2 <span class=main>[</span><span class=operator>OF</span> sl wf<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Labels-labels_in_sterms><span class=command>lemma</span></span> labels_in_sterms<span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Γ</span> <span class=free>l</span> <span class=free>p</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> labels_pinduct <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> Un_iff<span class=main>)</span>

<span class=keyword1 id=AWN_Labels-labels_sterms_labels><span class=command>lemma</span></span> labels_sterms_labels<span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Γ</span> <span class=free>p</span> <span class=free>p'</span> <span class=free>l</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> labels_pinduct <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>primrec</span></span> <span class=entity>labelfrom</span> <span class=main>::</span> <span class=quoted><span class=quoted>"int <span class=main>⇒</span> int <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp <span class=main>⇒</span> int <span class=main>×</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> int<span class=main>)</span> seqp"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
   <span class=quoted><span class=quoted>"<span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=main>{</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>f</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>  <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span> <span class=main>=</span> <span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
       <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>f</span></span></span><span class=main>⟩</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
 <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=main>{</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=free><span class=bound><span class=entity>f</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span> <span class=main>=</span> <span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
       <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>n</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=free><span class=bound><span class=entity>f</span></span></span><span class=main>⟧</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
 <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span> <span class=main>=</span> <span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
       <span class=keyword1>let</span> <span class=main>(</span><span class=bound>nn''</span><span class=main>,</span> <span class=bound>q'</span><span class=main>)</span> <span class=main>=</span> <span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=bound>nn'</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=keyword1>in</span>
       <span class=main>(</span><span class=bound>nn''</span><span class=main>,</span> <span class=bound>p'</span> <span class=main>⊕</span> <span class=bound>q'</span><span class=main>)</span><span class=main>)</span>"</span></span>
 <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=main>{</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>fip</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span>  <span class=main>=</span> <span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
       <span class=keyword1>let</span> <span class=main>(</span><span class=bound>nn''</span><span class=main>,</span> <span class=bound>q'</span><span class=main>)</span> <span class=main>=</span> <span class=free>labelfrom</span> <span class=bound>nn'</span> <span class=main>(</span><span class=bound>nn'</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=keyword1>in</span>
       <span class=main>(</span><span class=bound>nn''</span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>n</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>fip</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=bound>p'</span> <span class=main>▹</span> <span class=bound>q'</span><span class=main>)</span><span class=main>)</span>"</span></span>
 <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=main>{</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=keyword1>}broadcast(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span> <span class=main>=</span> <span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
       <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>n</span></span></span><span class=keyword1>}broadcast(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
 <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=main>{</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=keyword1>}groupcast(</span><span class=free><span class=bound><span class=entity>fipset</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span> <span class=main>=</span> <span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
       <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>n</span></span></span><span class=keyword1>}groupcast(</span><span class=free><span class=bound><span class=entity>fipset</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
 <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=main>{</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=keyword1>}send(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span> <span class=main>=</span> <span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
       <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>n</span></span></span><span class=keyword1>}send(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
 <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=main>{</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=keyword1>}deliver(</span><span class=free><span class=bound><span class=entity>fdata</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span> <span class=main>=</span> <span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
       <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>n</span></span></span><span class=keyword1>}deliver(</span><span class=free><span class=bound><span class=entity>fdata</span></span></span><span class=main>)</span><span class=main>.</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
 <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=main>{</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=keyword1>}receive(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span> <span class=main>=</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span> <span class=main>=</span> <span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
       <span class=main>(</span><span class=bound>nn'</span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>n</span></span></span><span class=keyword1>}receive(</span><span class=free><span class=bound><span class=entity>fmsg</span></span></span><span class=main>)</span><span class=main>.</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
 <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>labelfrom</span> <span class=free><span class=bound><span class=entity>n</span></span></span> <span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>(</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>fargs</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>nn</span></span></span> <span class=main>-</span> <span class=main>1</span><span class=main>,</span> <span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>fargs</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>datatype</span></span> <span class=tfree>'pn</span> label <span class=main>=</span>
    LABEL <span class=tfree><span class=quoted><span class=tfree>'pn</span></span></span> <span class=quoted>int</span>  <span class=main>(</span><span class=quoted>"_<span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1><span class=keyword1>-:</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span> <span class=main>[</span>1000<span class=main>,</span> 1000<span class=main>]</span> 999<span class=main>)</span>

<span class=keyword1><span class=command>instantiation</span></span> <span class=quoted>"label"</span> <span class=main>::</span> <span class=main>(</span><span class=quoted>ord</span><span class=main>)</span> <span class=quoted>ord</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity><span class=class_parameter>less_eq_label</span></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span> label <span class=main>⇒</span> <span class=tfree>'a</span> label <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>l1</span></span></span><span class=main>-:</span><span class=free><span class=bound><span class=entity>n1</span></span></span><span class=main>)</span> <span class=main>≤</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>l2</span></span></span><span class=main>-:</span><span class=free><span class=bound><span class=entity>n2</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>l1</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>l2</span></span></span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>n1</span></span></span> <span class=main>≤</span> <span class=free><span class=bound><span class=entity>n2</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> less_label<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>l1</span></span></span><span class=main>::</span><span class=tfree>'a</span> label<span class=main>)</span> <span class=main>&lt;</span> <span class=free><span class=bound><span class=entity>l2</span></span></span> <span class=main>⟷</span> <span class=free><span class=bound><span class=entity>l1</span></span></span> <span class=main>≤</span> <span class=free><span class=bound><span class=entity>l2</span></span></span> <span class=main>∧</span> <span class=main>¬</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>l1</span></span></span> <span class=main>≤</span> <span class=free><span class=bound><span class=entity>l2</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>..</span></span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>labelled</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'p</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> seqp <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'p</span> label<span class=main>)</span> seqp"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>labelled</span> <span class=free><span class=bound><span class=entity>pn</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>≡</span> labelmap <span class=main>(</span><span class=main>λ</span><span class=bound>l</span><span class=main>.</span> LABEL <span class=free><span class=bound><span class=entity>pn</span></span></span> <span class=bound>l</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span>labelfrom <span class=main>0</span> <span class=main>1</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=Inv_Cterms><div class=head><h1>Theory Inv_Cterms</h1></div><pre class=source><span class=comment1>(*  Title:       Inv_Cterms.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"A custom tactic for showing invariants via control terms"</span></span>

<span class=keyword1><span class=command>theory</span></span> Inv_Cterms
<span class=keyword2><span class=keyword>imports</span></span> <a href=AWN_Labels.html>AWN_Labels</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  This tactic tries to solve a goal by reducing it to a problem over (local) cterms (using
  one of the cterms\_intros intro rules); expanding those to consider all process names (using
  one of the ctermsl\_cases destruction rules); simplifying each (using the
  cterms\_env simplification rules); splitting them up into separate subgoals; replacing the
  derivative term with a variable; `executing' a transition of each term; and then simplifying.

  The tactic can stop after applying introduction rule (``inv\_cterms (intro\_only)''), or after
  having generated the verification condition subgoals and before having simplified them
  (``inv\_cterms (vcs\_only)''). It takes arguments to add or remove simplification rules
  (``simp add: lemmanames''), to add forward rules on assumptions (to introduce previously
  proved invariants; ``inv add: lemmanames''), or to add elimination rules that solve any
  remaining subgoals (``solve: lemmanames'').

  To configure the tactic for a set of transition rules:
  \begin{enumerate}
  \item add elimination rules: declare seqpTEs [cterms\_seqte]
  \item add rules to replace derivative terms: declare elimders [cterms\_elimders]
  \end{enumerate}

  To configure the tactic for a process environment (<span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Γ›</span></span></span></span>):
  \begin{enumerate}
  \item add simp rules: declare <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Γ›</span></span></span></span>.simps [cterms\_env]
  \item add case rules: declare aodv\_proc\_cases [ctermsl\_cases]
  \item add invariant intros
      declare
        seq\_invariant\_ctermsI [OF aodv\_wf aodv\_control\_within aodv\_simple\_labels, cterms\_intros]
        seq\_step\_invariant\_ctermsI [OF aodv\_wf aodv\_control\_within aodv\_simple\_labels, cterms\_intros]
  \end{enumerate}

›</span></span>

<span class=keyword1 id=Inv_Cterms-has_ctermsl><span class=command>lemma</span></span> has_ctermsl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> ctermsl <span class=free>Γ</span> <span class=main>⟹</span> <span class=free>p</span> <span class=main>∈</span> ctermsl <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>.</span></span>

<span class=keyword1><span class=command>named_theorems</span></span> cterms_elimders <span class=quoted>"rules for truncating sequential process terms"</span>
<span class=keyword1><span class=command>named_theorems</span></span> cterms_seqte <span class=quoted>"elimination rules for sequential process terms"</span>
<span class=keyword1><span class=command>named_theorems</span></span> cterms_env <span class=quoted>"simplification rules for sequential process environments"</span>
<span class=keyword1><span class=command>named_theorems</span></span> ctermsl_cases <span class=quoted>"destruction rules for case splitting ctermsl"</span>
<span class=keyword1><span class=command>named_theorems</span></span> cterms_intros <span class=quoted>"introduction rules from cterms"</span>
<span class=keyword1><span class=command>named_theorems</span></span> cterms_invs <span class=quoted>"invariants to try to apply at each vc"</span>
<span class=keyword1><span class=command>named_theorems</span></span> cterms_final <span class=quoted>"elimination rules to try on each vc after simplification"</span>

<span class=keyword1><span class=command>ML</span></span> <span class=quoted>‹
<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>simp_only</span> <span class=entity>thms</span> <span class=entity>ctxt</span> <span class=main>=</span>
  <span class=entity>asm_full_simp_tac</span>
     <span class=main>(</span><span class=entity>ctxt</span> |&gt; Raw_Simplifier.clear_simpset |&gt; fold <span class=entity>Simplifier.add_simp</span> <span class=entity>thms</span><span class=main>)</span>

<span class=comment1>(* shallow_simp is useful for mopping up assumptions before really trying to simplify.
   Perhaps surprisingly, this saves minutes in some of the proofs that use a lot of
   invariants of the form (l = P-:n --&gt; P). *)</span>
<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>shallow_simp</span> <span class=entity>ctxt</span> <span class=main>=</span>
  <span class=keyword2><span class=keyword>let</span></span> <span class=keyword1><span class=keyword>val</span></span> <span class=entity>ctxt'</span> <span class=main>=</span> Config.put simp_depth_limit <span class=inner_numeral>2</span> <span class=entity>ctxt</span> <span class=keyword2><span class=keyword>in</span></span>
    TRY o <span class=entity>safe_asm_full_simp_tac</span> <span class=entity>ctxt'</span>
  <span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>create_vcs</span> <span class=entity>ctxt</span> <span class=entity>i</span> <span class=main>=</span>
  <span class=keyword2><span class=keyword>let</span></span> <span class=keyword1><span class=keyword>val</span></span> <span class=entity>main_simp_thms</span> <span class=main>=</span> rev <span class=main>(</span><span class=entity>Named_Theorems.get</span> <span class=entity>ctxt</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>named_theorems</span> cterms_env<span class=antiquote>}</span></span><span class=main>)</span>
      <span class=keyword1><span class=keyword>val</span></span> <span class=entity>ctermsl_cases</span> <span class=main>=</span> rev <span class=main>(</span><span class=entity>Named_Theorems.get</span> <span class=entity>ctxt</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>named_theorems</span> ctermsl_cases<span class=antiquote>}</span></span><span class=main>)</span>
  <span class=keyword2><span class=keyword>in</span></span>
    dresolve_tac <span class=entity>ctxt</span> <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> has_ctermsl<span class=antiquote>}</span></span></span> <span class=entity>i</span>
    THEN_ELSE <span class=main>(</span>dmatch_tac <span class=entity>ctxt</span> <span class=entity>ctermsl_cases</span> <span class=entity>i</span>
               THEN
               TRY <span class=main>(</span>REPEAT_ALL_NEW <span class=main>(</span>ematch_tac <span class=entity>ctxt</span> <span class=main>[</span><span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thm</span> disjE<span class=antiquote>}</span></span></span><span class=main>]</span><span class=main>)</span> <span class=entity>i</span><span class=main>)</span>
               THEN
               <span class=entity>PARALLEL_ALLGOALS</span>
                 <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=entity>i</span> <span class=main>=&gt;</span> <span class=entity>simp_only</span> <span class=entity>main_simp_thms</span> <span class=entity>ctxt</span> <span class=entity>i</span>
                  THEN TRY <span class=main>(</span>REPEAT_ALL_NEW <span class=main>(</span>ematch_tac <span class=entity>ctxt</span> <span class=main>[</span><span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thm</span> disjE<span class=antiquote>}</span></span></span><span class=main>]</span><span class=main>)</span> <span class=entity>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> all_tac<span class=main>)</span>
  <span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>try_invs</span> <span class=entity>ctxt</span> <span class=main>=</span>
  <span class=keyword2><span class=keyword>let</span></span> <span class=keyword1><span class=keyword>val</span></span> <span class=entity>inv_thms</span> <span class=main>=</span> rev <span class=main>(</span><span class=entity>Named_Theorems.get</span> <span class=entity>ctxt</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>named_theorems</span> cterms_invs<span class=antiquote>}</span></span><span class=main>)</span>
      <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>fapp</span> <span class=entity>thm</span> <span class=main>=</span>
        TRY o <span class=main>(</span>EVERY' <span class=main>(</span>forward_tac <span class=entity>ctxt</span> <span class=main>[</span><span class=entity>thm</span><span class=main>]</span> :: replicate <span class=main>(</span>Thm.nprems_of <span class=entity>thm</span> - <span class=inner_numeral>1</span><span class=main>)</span> <span class=main>(</span>assume_tac <span class=entity>ctxt</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>in</span></span>
    EVERY' <span class=main>(</span>map <span class=entity>fapp</span> <span class=entity>inv_thms</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>try_final</span> <span class=entity>ctxt</span> <span class=main>=</span>
  <span class=keyword2><span class=keyword>let</span></span> <span class=keyword1><span class=keyword>val</span></span> <span class=entity>final_thms</span> <span class=main>=</span> rev <span class=main>(</span><span class=entity>Named_Theorems.get</span> <span class=entity>ctxt</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>named_theorems</span> cterms_final<span class=antiquote>}</span></span><span class=main>)</span>
      <span class=keyword1><span class=keyword>fun</span></span> <span class=entity>eapp</span> <span class=entity>thm</span> <span class=main>=</span> EVERY' <span class=main>(</span>eresolve_tac <span class=entity>ctxt</span> <span class=main>[</span><span class=entity>thm</span><span class=main>]</span> :: replicate <span class=main>(</span>Thm.nprems_of <span class=entity>thm</span> - <span class=inner_numeral>1</span><span class=main>)</span> <span class=main>(</span>assume_tac <span class=entity>ctxt</span><span class=main>)</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>in</span></span>
    TRY o <span class=main>(</span>FIRST' <span class=main>(</span>map <span class=entity>eapp</span> <span class=entity>final_thms</span><span class=main>)</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>each</span> <span class=entity>ctxt</span> <span class=main>=</span>
  <span class=main>(</span>EVERY' <span class=main>(</span><span class=main>(</span>ematch_tac <span class=entity>ctxt</span> <span class=main>(</span>rev <span class=main>(</span><span class=entity>Named_Theorems.get</span> <span class=entity>ctxt</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>named_theorems</span> cterms_elimders<span class=antiquote>}</span></span><span class=main>)</span><span class=main>)</span> ::
    replicate <span class=inner_numeral>2</span> <span class=main>(</span>assume_tac <span class=entity>ctxt</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
   THEN' <span class=entity>simp_only</span> <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> labels_psimps<span class=antiquote>}</span></span></span> <span class=entity>ctxt</span>
   THEN' <span class=main>(</span>ematch_tac <span class=entity>ctxt</span> <span class=main>(</span>rev <span class=main>(</span><span class=entity>Named_Theorems.get</span> <span class=entity>ctxt</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>named_theorems</span> cterms_seqte<span class=antiquote>}</span></span><span class=main>)</span><span class=main>)</span>
     THEN_ALL_NEW
       <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=entity>j</span> <span class=main>=&gt;</span> <span class=entity>simp_only</span> <span class=main>[</span><span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thm</span> mem_Collect_eq<span class=antiquote>}</span></span></span><span class=main>]</span> <span class=entity>ctxt</span> <span class=entity>j</span>
                  THEN REPEAT <span class=main>(</span>eresolve_tac <span class=entity>ctxt</span> <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> exE<span class=antiquote>}</span></span></span> <span class=entity>j</span><span class=main>)</span>
                  THEN REPEAT <span class=main>(</span>eresolve_tac <span class=entity>ctxt</span> <span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thms</span> conjE<span class=antiquote>}</span></span></span> <span class=entity>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
  ORELSE' <span class=main>(</span>SOLVED' <span class=main>(</span><span class=entity>clarsimp_tac</span> <span class=entity>ctxt</span><span class=main>)</span><span class=main>)</span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>simp_all</span> <span class=entity>ctxt</span> <span class=main>=</span>
  <span class=keyword2><span class=keyword>let</span></span> <span class=keyword1><span class=keyword>val</span></span> <span class=entity>ctxt'</span> <span class=main>=</span>
        <span class=entity>ctxt</span> |&gt; fold <span class=entity>Splitter.add_split</span> <span class=main>[</span><span class=antiquoted><span class=entity><span class=antiquote>@{</span><span class=operator>thm</span> if_split_asm<span class=antiquote>}</span></span></span><span class=main>]</span>
  <span class=keyword2><span class=keyword>in</span></span>
    <span class=entity>PARALLEL_ALLGOALS</span> <span class=main>(</span><span class=entity>shallow_simp</span> <span class=entity>ctxt</span><span class=main>)</span>
    THEN
    TRY <span class=main>(</span>CHANGED_PROP <span class=main>(</span><span class=entity>PARALLEL_ALLGOALS</span> <span class=main>(</span><span class=entity>asm_full_simp_tac</span> <span class=entity>ctxt'</span> THEN' <span class=entity>try_final</span> <span class=entity>ctxt</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>intro_and_invs</span> <span class=entity>ctxt</span> <span class=entity>i</span> <span class=main>=</span>
  <span class=keyword2><span class=keyword>let</span></span> <span class=keyword1><span class=keyword>val</span></span> <span class=entity>cterms_intros</span> <span class=main>=</span> rev <span class=main>(</span><span class=entity>Named_Theorems.get</span> <span class=entity>ctxt</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>named_theorems</span> cterms_intros<span class=antiquote>}</span></span><span class=main>)</span> <span class=keyword2><span class=keyword>in</span></span>
    match_tac <span class=entity>ctxt</span> <span class=entity>cterms_intros</span> <span class=entity>i</span>
    THEN <span class=entity>PARALLEL_ALLGOALS</span> <span class=main>(</span><span class=entity>try_invs</span> <span class=entity>ctxt</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=keyword>fun</span></span> <span class=entity>process_vcs</span> <span class=entity>ctxt</span> <span class=main>_</span> <span class=main>=</span>
  ALLGOALS <span class=main>(</span><span class=entity>create_vcs</span> <span class=entity>ctxt</span> ORELSE' <span class=main>(</span>SOLVED' <span class=main>(</span><span class=entity>clarsimp_tac</span> <span class=entity>ctxt</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
  THEN <span class=entity>PARALLEL_ALLGOALS</span> <span class=main>(</span>TRY o <span class=entity>each</span> <span class=entity>ctxt</span><span class=main>)</span>
›</span>

<span class=keyword1><span class=command>method_setup</span></span> inv_cterms <span class=main>=</span> <span class=quoted>‹
  <span class=keyword2><span class=keyword>let</span></span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=entity>intro_onlyN</span> <span class=main>=</span> <span class=inner_quoted>"intro_only"</span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=entity>vcs_onlyN</span> <span class=main>=</span> <span class=inner_quoted>"vcs_only"</span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=entity>invN</span> <span class=main>=</span> <span class=inner_quoted>"inv"</span>
    <span class=keyword1><span class=keyword>val</span></span> <span class=entity>solveN</span> <span class=main>=</span> <span class=inner_quoted>"solve"</span>

    <span class=keyword1><span class=keyword>val</span></span> <span class=entity>inv_cterms_options</span> <span class=main>=</span>
      <span class=main>(</span>Args.parens <span class=main>(</span>Args.$$$ <span class=entity>intro_onlyN</span><span class=main>)</span> &gt;&gt;  K <span class=entity>intro_and_invs</span> ||
       Args.parens <span class=main>(</span>Args.$$$ <span class=entity>vcs_onlyN</span><span class=main>)</span> &gt;&gt;  K <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=entity>ctxt</span> <span class=main>=&gt;</span> <span class=entity>intro_and_invs</span> <span class=entity>ctxt</span>
                                                          THEN' <span class=entity>process_vcs</span> <span class=entity>ctxt</span><span class=main>)</span> ||
       Scan.succeed <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=entity>ctxt</span> <span class=main>=&gt;</span> <span class=entity>intro_and_invs</span> <span class=entity>ctxt</span>
                                THEN' <span class=entity>process_vcs</span> <span class=entity>ctxt</span>
                                THEN' K <span class=main>(</span><span class=entity>simp_all</span> <span class=entity>ctxt</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>in</span></span>
    <span class=main>(</span>Scan.lift <span class=entity>inv_cterms_options</span> --| <span class=entity>Method.sections</span>
      <span class=main>(</span><span class=main>(</span>Args.$$$ <span class=entity>invN</span> -- Args.add -- Args.colon &gt;&gt;
        K <span class=main>(</span><span class=entity>Method.modifier</span> <span class=main>(</span><span class=entity>Named_Theorems.add</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>named_theorems</span> cterms_invs<span class=antiquote>}</span></span><span class=main>)</span> <span class=antiquoted><span class=operator><span class=entity>⌂</span></span></span><span class=main>)</span><span class=main>)</span>
       :: <span class=main>(</span>Args.$$$ <span class=entity>solveN</span> -- Args.colon &gt;&gt;
        K <span class=main>(</span><span class=entity>Method.modifier</span> <span class=main>(</span><span class=entity>Named_Theorems.add</span> <span class=antiquoted><span class=antiquote>@{</span><span class=operator>named_theorems</span> cterms_final<span class=antiquote>}</span></span><span class=main>)</span> <span class=antiquoted><span class=operator><span class=entity>⌂</span></span></span><span class=main>)</span><span class=main>)</span>
       :: <span class=entity>Simplifier.simp_modifiers</span><span class=main>)</span>
      &gt;&gt; <span class=main>(</span><span class=keyword1><span class=keyword>fn</span></span> <span class=entity>tac</span> <span class=main>=&gt;</span> <span class=entity>SIMPLE_METHOD'</span> o <span class=entity>tac</span><span class=main>)</span><span class=main>)</span>
  <span class=keyword2><span class=keyword>end</span></span>
›</span> <span class=quoted>"solve invariants by considering all (interesting) control terms"</span>

<span class=keyword1><span class=command>declare</span></span>
  insert_iff <span class=main>[</span><span class=operator>cterms_env</span><span class=main>]</span>                                                
  Un_insert_right <span class=main>[</span><span class=operator>cterms_env</span><span class=main>]</span>
  sup_bot_right <span class=main>[</span><span class=operator>cterms_env</span><span class=main>]</span>
  Product_Type.prod_cases <span class=main>[</span><span class=operator>cterms_env</span><span class=main>]</span>
  ctermsl.simps <span class=main>[</span><span class=operator>cterms_env</span><span class=main>]</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=AWN_SOS_Labels><div class=head><h1>Theory AWN_SOS_Labels</h1></div><pre class=source><span class=comment1>(*  Title:       AWN_SOS_Labels.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Configure the inv-cterms tactic for sequential processes"</span></span>

<span class=keyword1><span class=command>theory</span></span> AWN_SOS_Labels
<span class=keyword2><span class=keyword>imports</span></span> <a href=AWN_SOS.html>AWN_SOS</a> <a href=Inv_Cterms.html>Inv_Cterms</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=AWN_SOS_Labels-elimder_guard><span class=command>lemma</span></span> elimder_guard<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟨</span><span class=free>fg</span><span class=main>⟩</span> <span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟨</span><span class=free>fg</span><span class=main>⟩</span> <span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_SOS_Labels-elimder_assign><span class=command>lemma</span></span> elimder_assign<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟦</span><span class=free>fa</span><span class=main>⟧</span> <span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟦</span><span class=free>fa</span><span class=main>⟧</span> <span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_SOS_Labels-elimder_ucast><span class=command>lemma</span></span> elimder_ucast<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}unicast(</span><span class=free>fip</span><span class=main>,</span> <span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>q1</span> <span class=main>▹</span> <span class=free>q2</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=free>pp'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}unicast(</span><span class=free>fip</span><span class=main>,</span> <span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>p'</span> <span class=main>▹</span> <span class=free>pp'</span>"</span></span>
                   <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>case</span> <span class=free>a</span> <span class=keyword1>of</span> unicast <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> <span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q1</span>
                                        <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> <span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>erule</span> seqpTEs<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=AWN_SOS_Labels-elimder_bcast><span class=command>lemma</span></span> elimder_bcast<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}broadcast(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}broadcast(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_SOS_Labels-elimder_gcast><span class=command>lemma</span></span> elimder_gcast<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}groupcast(</span><span class=free>fips</span><span class=main>,</span> <span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}groupcast(</span><span class=free>fips</span><span class=main>,</span> <span class=free>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_SOS_Labels-elimder_send><span class=command>lemma</span></span> elimder_send<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}send(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}send(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_SOS_Labels-elimder_deliver><span class=command>lemma</span></span> elimder_deliver<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}deliver(</span><span class=free>fdata</span><span class=main>)</span><span class=main>.</span><span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}deliver(</span><span class=free>fdata</span><span class=main>)</span><span class=main>.</span><span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_SOS_Labels-elimder_receive><span class=command>lemma</span></span> elimder_receive<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}receive(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}receive(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> elimders <span class=main>=</span> 
   elimder_guard
   elimder_assign
   elimder_ucast
   elimder_bcast
   elimder_gcast
   elimder_send
   elimder_deliver
   elimder_receive

<span class=keyword1><span class=command>declare</span></span>
  seqpTEs <span class=main>[</span><span class=operator>cterms_seqte</span><span class=main>]</span>
  elimders <span class=main>[</span><span class=operator>cterms_elimders</span><span class=main>]</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Pnet><div class=head><h1>Theory Pnet</h1></div><pre class=source><span class=comment1>(*  Title:       Pnet.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Lemmas for partial networks"</span></span>

<span class=keyword1><span class=command>theory</span></span> Pnet
<span class=keyword2><span class=keyword>imports</span></span> <a href=AWN_SOS.html>AWN_SOS</a> <a href=Invariants.html>Invariants</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  These lemmas mostly concern the preservation of node structure by <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>pnet_sos</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> transitions.
›</span></span>

<span class=keyword1 id=Pnet-pnet_maintains_dom><span class=command>lemma</span></span> pnet_maintains_dom<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s</span> <span class=main>=</span> net_ips <span class=free>s'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>s'</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>R</span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_ips <span class=skolem>s'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> node_sos.cases<span class=main>)</span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>a</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> <span class=main>⟹</span> net_ips <span class=bound>s</span> <span class=main>=</span> net_ips <span class=bound>s'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>a</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>⟹</span> net_ips <span class=bound>s</span> <span class=main>=</span> net_ips <span class=bound>s'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_ips <span class=skolem>s'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>erule</span> pnet_sos.cases<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-pnet_net_ips_net_tree_ips><span class=command>lemma</span></span> pnet_net_ips_net_tree_ips <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> <span class=free>I</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>s</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>R</span> <span class=skolem>s</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ns</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=skolem>i</span> <span class=skolem>ns</span> <span class=skolem>R</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=main>⟨</span><span class=skolem>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>s</span>
      <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> <span class=main>⟹</span> net_ips <span class=bound>s</span> <span class=main>=</span> net_tree_ips <span class=skolem>p1</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>⟹</span> net_ips <span class=bound>s</span> <span class=main>=</span> net_tree_ips <span class=skolem>p2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s1</span></span> <span class=skolem><span class=skolem>s2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>"</span></span>
                                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
                                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1-2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>p1</span>"</span></span>
                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>p2</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> IH1 IH2 <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_ips <span class=skolem>s'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_maintains_dom<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s'</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-pnet_init_net_ips_net_tree_ips><span class=command>lemma</span></span> pnet_init_net_ips_net_tree_ips<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> reachable_init <span class=main><span class=main>[</span></span><span class=operator>THEN</span> pnet_net_ips_net_tree_ips<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=Pnet-pnet_init_in_net_ips_in_net_tree_ips><span class=command>lemma</span></span> pnet_init_in_net_ips_in_net_tree_ips <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_tree_ips <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> pnet_init_net_ips_net_tree_ips<span class=main>)</span>

<span class=keyword1 id=Pnet-pnet_init_in_net_tree_ips_in_net_ips><span class=command>lemma</span></span> pnet_init_in_net_tree_ips_in_net_ips <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_tree_ips <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> pnet_init_net_ips_net_tree_ips<span class=main>)</span>

<span class=keyword1 id=Pnet-pnet_init_not_in_net_tree_ips_not_in_net_ips><span class=command>lemma</span></span> pnet_init_not_in_net_tree_ips_not_in_net_ips <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_tree_ips <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_ips <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_tree_ips <span class=free>p</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-net_node_reachable_is_node><span class=command>lemma</span></span> net_node_reachable_is_node<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>st</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=free>ii</span><span class=main>;</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=free>I</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ns</span> <span class=bound>R</span><span class=main>.</span> <span class=free>st</span> <span class=main>=</span> NodeS <span class=free>ii</span> <span class=bound>ns</span> <span class=bound>R</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=operator>induct</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=free>ii</span><span class=main>;</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ns</span> <span class=bound>R</span><span class=main>.</span> <span class=skolem>s</span> <span class=main>=</span> NodeS <span class=free>ii</span> <span class=bound>ns</span> <span class=bound>R</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_node_init'<span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=free>ii</span><span class=main>;</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ns</span> <span class=bound>R</span><span class=main>.</span> <span class=skolem>s</span> <span class=main>=</span> NodeS <span class=free>ii</span> <span class=bound>ns</span> <span class=bound>R</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=free>ii</span><span class=main>;</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ns</span> <span class=bound>R</span><span class=main>.</span> <span class=skolem>s'</span> <span class=main>=</span> NodeS <span class=free>ii</span> <span class=bound>ns</span> <span class=bound>R</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> trans_node_comp <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> node_sos_dest<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-partial_net_preserves_subnets><span class=command>lemma</span></span> partial_net_preserves_subnets<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>SubnetS <span class=free>s</span> <span class=free>t</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>st'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>s'</span> <span class=bound>t'</span><span class=main>.</span> <span class=free>st'</span> <span class=main>=</span> SubnetS <span class=bound>s'</span> <span class=bound>t'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=operator>simp_all</span>

<span class=keyword1 id=Pnet-net_par_reachable_is_subnet><span class=command>lemma</span></span> net_par_reachable_is_subnet<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>st</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span> <span class=free>I</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>s</span> <span class=bound>t</span><span class=main>.</span> <span class=free>st</span> <span class=main>=</span> SubnetS <span class=bound>s</span> <span class=bound>t</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>induct</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> partial_net_preserves_subnets<span class=main>)</span>

<span class=keyword1 id=Pnet-reachable_par_subnet_induct><span class=command>lemma</span></span> reachable_par_subnet_induct <span class=main>[</span><span class=operator>consumes</span><span class=main>,</span> <span class=operator>case_names</span> init step<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=free>s</span> <span class=free>t</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>t</span><span class=main>.</span> SubnetS <span class=bound>s</span> <span class=bound>t</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s</span> <span class=bound>t</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>t</span> <span class=bound>s'</span> <span class=bound>t'</span> <span class=bound>a</span><span class=main>.</span> <span class=main>⟦</span>
                    SubnetS <span class=bound>s</span> <span class=bound>t</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span> <span class=free>I</span><span class=main>;</span>
                    <span class=free>P</span> <span class=bound>s</span> <span class=bound>t</span><span class=main>;</span> <span class=main>(</span>SubnetS <span class=bound>s</span> <span class=bound>t</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> SubnetS <span class=bound>s'</span> <span class=bound>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>I</span> <span class=bound>a</span> <span class=main>⟧</span>
                    <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s'</span> <span class=bound>t'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>s</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=quoted>"SubnetS <span class=free>s</span> <span class=free>t</span>"</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>t</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>t</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=skolem>s</span> <span class=skolem>t</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> init <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span> <span class=skolem>t</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>st</span> <span class=skolem>a</span> <span class=skolem>s'</span> <span class=skolem>t'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>st</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>t</span><span class=main>.</span> <span class=skolem>st</span> <span class=main>=</span> SubnetS <span class=bound>s</span> <span class=bound>t</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s</span> <span class=bound>t</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>t</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>=</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span>"</span></span>
                              <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"SubnetS <span class=skolem>s</span> <span class=skolem>t</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span> <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_par_reachable_is_subnet<span class=main>)</span>
    <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> IH <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span> <span class=skolem>t</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> tr
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s'</span> <span class=skolem>t'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-subnet_reachable><span class=command>lemma</span></span> subnet_reachable<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=free>s1</span> <span class=free>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span> TT"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span> TT"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span> TT
                  <span class=main>∧</span> <span class=free>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span> TT"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> reachable_par_subnet_induct<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s1</span> <span class=skolem>s2</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span> TT
          <span class=main>∧</span> <span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> reachable_init<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>step <span class=skolem>s1</span> <span class=skolem>s2</span> <span class=skolem>s1'</span> <span class=skolem>s2'</span> <span class=skolem>a</span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> sr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span> TT"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> sr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span> TT"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>4<span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1'</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span> TT
         <span class=main>∧</span> <span class=skolem>s2'</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=main>(</span><span class=operator>insert</span> sr1 sr2<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> reachable_step<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span> TT"</span></span>
         <span class=quoted><span class=quoted>"<span class=free>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span> TT"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-delivered_to_node><span class=command>lemma</span></span> delivered_to_node <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=free>ii</span><span class=main>;</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=free>ii</span><span class=main>;</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> <span class=free>ii</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>P</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> NodeS <span class=free>ii</span> <span class=skolem>P</span> <span class=skolem>R</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_node_reachable_is_node<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> <span class=free>ii</span>"</span></span>
       <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> trans_node_comp <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> node_deliverTE'<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-delivered_to_net_ips><span class=command>lemma</span></span> delivered_to_net_ips<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>s</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>from</span></span> sr <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>P</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>P</span> <span class=skolem>R</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_node_reachable_is_node<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tr <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>P'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>P'</span> <span class=skolem>R'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> node_sos_dest<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> <span class=skolem>ii</span>"</span></span> <span class=keyword1><span class=command>using</span></span> tr <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>s</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT<span class=main>;</span>
                          <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>∈</span> net_ips <span class=bound>s</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT<span class=main>;</span>
                          <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>∈</span> net_ips <span class=bound>s</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> partial_deliverTE<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s1</span> <span class=skolem>s1'</span> <span class=skolem>s2</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> sr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> subnet_reachable<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s1</span>"</span></span> <span class=keyword1><span class=command>using</span></span> tr <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s2</span> <span class=skolem>s2'</span> <span class=skolem>s1</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2'</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> sr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> subnet_reachable<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>using</span></span> tr <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-wf_net_tree_net_ips_disjoint><span class=command>lemma</span></span> wf_net_tree_net_ips_disjoint <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span> <span class=free>S</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span> <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s1</span> <span class=main>∩</span> net_ips <span class=free>s2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=free>p1</span> <span class=main>∩</span> net_tree_ips <span class=free>p2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s1</span> <span class=main>=</span> net_tree_ips <span class=free>p1</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s2</span> <span class=main>=</span> net_tree_ips <span class=free>p2</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-init_mapstate_Some_aodv_init><span class=command>lemma</span></span> init_mapstate_Some_aodv_init <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>s</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R</span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ns</span></span> <span class=keyword2><span class=keyword>where</span></span> s<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>ns</span> <span class=skolem>R</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> ns<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ns</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>from</span></span> s <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹netmap <span class=skolem>s</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> <span class=skolem>ii</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> domI domIff<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> s ns <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹netmap <span class=skolem>s</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> <span class=main>⟹</span> netmap <span class=bound>s</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span> <span class=main>⟹</span> <span class=free>v</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>⟹</span> netmap <span class=bound>s</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span> <span class=main>⟹</span> <span class=free>v</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s1</span></span> <span class=skolem><span class=skolem>s2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
                                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>"</span></span>
                                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹netmap <span class=skolem>s</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s1</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span> <span class=main>∨</span> netmap <span class=skolem>s2</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s1</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s2</span> <span class=free>i</span> <span class=main>=</span> Some <span class=free>v</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-reachable_connect_netmap><span class=command>lemma</span></span> reachable_connect_netmap <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>s'</span> <span class=main>=</span> netmap <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>s</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>from</span></span> sr <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>p</span> <span class=skolem>R</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_node_reachable_is_node<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> tr <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s'</span> <span class=main>=</span> netmap <span class=skolem>s</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> node_sos.cases<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>s</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT<span class=main>;</span>
                          <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> netmap <span class=bound>s'</span> <span class=main>=</span> netmap <span class=bound>s</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT<span class=main>;</span>
                          <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> netmap <span class=bound>s'</span> <span class=main>=</span> netmap <span class=bound>s</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s'</span> <span class=main>=</span> netmap <span class=skolem>s</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s1</span> <span class=skolem>s1'</span> <span class=skolem>s2</span> <span class=skolem>s2'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> sr
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span> TT"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> sr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> subnet_reachable<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> sr1 tr1 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s1'</span> <span class=main>=</span> netmap <span class=skolem>s1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sr2 tr2 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s2'</span> <span class=main>=</span> netmap <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s'</span> <span class=main>=</span> netmap <span class=skolem>s</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-reachable_disconnect_netmap><span class=command>lemma</span></span> reachable_disconnect_netmap <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>s'</span> <span class=main>=</span> netmap <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>s</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>from</span></span> sr <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>p</span> <span class=skolem>R</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_node_reachable_is_node<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> tr <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s'</span> <span class=main>=</span> netmap <span class=skolem>s</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> node_sos.cases<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>s</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT<span class=main>;</span>
                          <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> netmap <span class=bound>s'</span> <span class=main>=</span> netmap <span class=bound>s</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT<span class=main>;</span>
                          <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> netmap <span class=bound>s'</span> <span class=main>=</span> netmap <span class=bound>s</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s'</span> <span class=main>=</span> netmap <span class=skolem>s</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s1</span> <span class=skolem>s1'</span> <span class=skolem>s2</span> <span class=skolem>s2'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> sr
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span> TT"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> sr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> subnet_reachable<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> sr1 tr1 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s1'</span> <span class=main>=</span> netmap <span class=skolem>s1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sr2 tr2 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s2'</span> <span class=main>=</span> netmap <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s'</span> <span class=main>=</span> netmap <span class=skolem>s</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>net_ip_action</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>ip <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton<span class=main>)</span>
                       <span class=main>⇒</span> <span class=tfree>'m</span> node_action <span class=main>⇒</span> ip <span class=main>⇒</span> net_tree <span class=main>⇒</span> <span class=tfree>'s</span> net_state <span class=main>⇒</span> <span class=tfree>'s</span> net_state <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>net_ip_action</span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>∥</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s1</span></span></span> <span class=free><span class=bound><span class=entity>s2</span></span></span><span class=main>)</span> <span class=main>(</span>SubnetS <span class=free><span class=bound><span class=entity>s1'</span></span></span> <span class=free><span class=bound><span class=entity>s2'</span></span></span><span class=main>)</span> <span class=main>=</span>
         <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>∈</span> net_ips <span class=free><span class=bound><span class=entity>s1</span></span></span> <span class=main>⟶</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>s1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s1'</span></span></span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span><span class=main>)</span>
                                <span class=main>∧</span> <span class=free><span class=bound><span class=entity>s2'</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>s2</span></span></span> <span class=main>∧</span> <span class=free>net_ip_action</span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=free><span class=bound><span class=entity>s1</span></span></span> <span class=free><span class=bound><span class=entity>s1'</span></span></span><span class=main>)</span><span class=main>)</span>
          <span class=main>∧</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>∈</span> net_ips <span class=free><span class=bound><span class=entity>s2</span></span></span> <span class=main>⟶</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>s2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s2'</span></span></span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span><span class=main>)</span>
                                   <span class=main>∧</span> <span class=free><span class=bound><span class=entity>s1'</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>s1</span></span></span> <span class=main>∧</span> <span class=free>net_ip_action</span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span> <span class=free><span class=bound><span class=entity>s2</span></span></span> <span class=free><span class=bound><span class=entity>s2'</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>net_ip_action</span> <span class=free><span class=bound><span class=entity>np</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=main>=</span> True"</span></span>

<span class=keyword1 id=Pnet-pnet_tau_single_node><span class=command>lemma</span></span> pnet_tau_single_node <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=free>s</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=bound>i</span> <span class=main>⟶</span> netmap <span class=free>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=free>s</span> <span class=bound>j</span><span class=main>)</span>
                         <span class=main>∧</span> net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=bound>i</span> <span class=free>p</span> <span class=free>s</span> <span class=free>s'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>s</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>p</span> <span class=skolem>R</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>p'</span> <span class=skolem>R'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>hide_lams<span class=main><span class=main>,</span></span> no_types<span class=main><span class=main>)</span></span> TT_True net_node_reachable_is_node
                                      reachable_step<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>ii</span><span class=main>}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>ii</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>i</span><span class=main>∈</span>dom <span class=main>(</span>netmap <span class=skolem>s</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=bound>i</span> <span class=main>⟶</span> netmap <span class=skolem>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=skolem>s</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=skolem>s</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=bound>i</span> <span class=main>⟶</span> netmap <span class=skolem>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=skolem>s</span> <span class=bound>j</span><span class=main>)</span>
                         <span class=main>∧</span> net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=bound>i</span> <span class=main>(</span><span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>s</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> wf_net_tree <span class=skolem>p1</span><span class=main>;</span>
                          <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT<span class=main>;</span>
                          <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> <span class=main>⟧</span>
                         <span class=main>⟹</span> <span class=main>∃</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=bound>s</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=bound>i</span> <span class=main>⟶</span> netmap <span class=bound>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=bound>s</span> <span class=bound>j</span><span class=main>)</span>
                                            <span class=main>∧</span> net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=bound>i</span> <span class=skolem>p1</span> <span class=bound>s</span> <span class=bound>s'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> wf_net_tree <span class=skolem>p2</span><span class=main>;</span>
                          <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT<span class=main>;</span>
                          <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>⟧</span>
                         <span class=main>⟹</span> <span class=main>∃</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=bound>s</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=bound>i</span> <span class=main>⟶</span> netmap <span class=bound>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=bound>s</span> <span class=bound>j</span><span class=main>)</span>
                                            <span class=main>∧</span> net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=bound>i</span> <span class=skolem>p2</span> <span class=bound>s</span> <span class=bound>s'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>p1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
                                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p1</span>"</span></span> 
                                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>i</span><span class=main>∈</span>net_ips <span class=skolem>s</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=bound>i</span> <span class=main>⟶</span> netmap <span class=skolem>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=skolem>s</span> <span class=bound>j</span><span class=main>)</span>
                        <span class=main>∧</span> net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=bound>i</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s1</span> <span class=skolem>s1'</span> <span class=skolem>s2</span>
      <span class=keyword3><span class=command>assume</span></span> subs<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> subs'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> sr <span class=keyword1><span class=command>have</span></span> sr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> subs<span class=main>)</span> <span class=main>(</span><span class=operator>erule</span> subnet_reachable<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>p1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom<span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span> <span class=main>∩</span> dom<span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_ips_is_dom_netmap pnet_net_ips_net_tree_ips<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>p1</span>›</span></span> sr1 tr1 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>dom<span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span>"</span></span>
                                               <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=skolem>i</span> <span class=main>⟶</span> netmap <span class=skolem>s1'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=skolem>s1</span> <span class=bound>j</span>"</span></span>
                                               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=skolem>p1</span> <span class=skolem>s1</span> <span class=skolem>s1'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> IH1<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹dom<span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span> <span class=main>∩</span> dom<span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∉</span>dom<span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> subs subs' tr1 <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=skolem>p1</span> <span class=skolem>s1</span> <span class=skolem>s1'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=skolem>i</span> <span class=main>⟶</span> <span class=main>(</span>netmap <span class=skolem>s1'</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>intro</span> allI impI<span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>≠</span> <span class=skolem>i</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s1'</span> <span class=skolem>j</span> <span class=main>=</span> netmap <span class=skolem>s1</span> <span class=skolem>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>netmap <span class=skolem>s1'</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=skolem>j</span> <span class=main>=</span> <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=skolem>j</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>hide_lams<span class=main><span class=main>,</span></span> mono_tags<span class=main><span class=main>)</span></span> map_add_dom_app_simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> map_add_dom_app_simps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>dom<span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span>›</span></span> subs subs'
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s2</span> <span class=skolem>s2'</span> <span class=skolem>s1</span>
      <span class=keyword3><span class=command>assume</span></span> subs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> subs'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2'</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> sr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> sr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> subs<span class=main>)</span> <span class=main>(</span><span class=operator>erule</span> subnet_reachable<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>p1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom<span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span> <span class=main>∩</span> dom<span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_ips_is_dom_netmap pnet_net_ips_net_tree_ips<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>p2</span>›</span></span> sr2 tr2 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>dom<span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span>"</span></span>
                                               <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=skolem>i</span> <span class=main>⟶</span> netmap <span class=skolem>s2'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=skolem>s2</span> <span class=bound>j</span>"</span></span>
                                               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=skolem>p2</span> <span class=skolem>s2</span> <span class=skolem>s2'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> IH2<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹dom<span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span> <span class=main>∩</span> dom<span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∉</span>dom<span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> subs subs' tr2 <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=skolem>p2</span> <span class=skolem>s2</span> <span class=skolem>s2'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=skolem>i</span> <span class=main>⟶</span> <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2'</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>intro</span> allI impI<span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>≠</span> <span class=skolem>i</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s2'</span> <span class=skolem>j</span> <span class=main>=</span> netmap <span class=skolem>s2</span> <span class=skolem>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2'</span><span class=main>)</span> <span class=skolem>j</span> <span class=main>=</span> <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=skolem>j</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>hide_lams<span class=main><span class=main>,</span></span> mono_tags<span class=main><span class=main>)</span></span> domD map_add_Some_iff map_add_dom_app_simps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>dom<span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span>›</span></span> subs subs'
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
           <span class=main>(</span><span class=operator>metis</span> domI dom_map_add map_add_find_right<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Pnet-pnet_deliver_single_node><span class=command>lemma</span></span> pnet_deliver_single_node <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> netmap <span class=free>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=free>s</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=free>p</span> <span class=free>s</span> <span class=free>s'</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=free>p</span> <span class=free>s</span> <span class=free>s'</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>s</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>p</span> <span class=skolem>R</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>p'</span> <span class=skolem>R'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>hide_lams<span class=main><span class=main>,</span></span> no_types<span class=main><span class=main>)</span></span> TT_True net_node_reachable_is_node
                                      reachable_step<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>ii</span><span class=main>}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s'</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>ii</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=skolem>ii</span> <span class=main>⟶</span> netmap <span class=skolem>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=skolem>s</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sr tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> <span class=skolem>ii</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> delivered_to_node<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=free>i</span> <span class=main>⟶</span> netmap <span class=skolem>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=skolem>s</span> <span class=bound>j</span><span class=main>)</span>
                     <span class=main>∧</span> net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>(</span><span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>s</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> wf_net_tree <span class=skolem>p1</span><span class=main>;</span>
                          <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT<span class=main>;</span>
                          <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> <span class=main>⟧</span>
                         <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=free>i</span> <span class=main>⟶</span> netmap <span class=bound>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=bound>s</span> <span class=bound>j</span><span class=main>)</span>
                             <span class=main>∧</span> net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=skolem>p1</span> <span class=bound>s</span> <span class=bound>s'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=main>⟦</span> wf_net_tree <span class=skolem>p2</span><span class=main>;</span>
                          <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT<span class=main>;</span>
                          <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>⟧</span>
                         <span class=main>⟹</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=free>i</span> <span class=main>⟶</span> netmap <span class=bound>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=bound>s</span> <span class=bound>j</span><span class=main>)</span>
                             <span class=main>∧</span> net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=skolem>p2</span> <span class=bound>s</span> <span class=bound>s'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>p1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
                                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p1</span>"</span></span> 
                                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=free>i</span> <span class=main>⟶</span> netmap <span class=skolem>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=skolem>s</span> <span class=bound>j</span><span class=main>)</span>
          <span class=main>∧</span> net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s1</span> <span class=skolem>s1'</span> <span class=skolem>s2</span>
      <span class=keyword3><span class=command>assume</span></span> subs<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> subs'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> sr <span class=keyword1><span class=command>have</span></span> sr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> subs<span class=main>)</span> <span class=main>(</span><span class=operator>erule</span> subnet_reachable<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>p1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom<span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span> <span class=main>∩</span> dom<span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_ips_is_dom_netmap pnet_net_ips_net_tree_ips<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sr1 tr1 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> delivered_to_net_ips<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∉</span>dom<span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>p1</span>›</span></span> sr1 tr1 <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=free>i</span> <span class=main>⟶</span> netmap <span class=skolem>s1'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=skolem>s1</span> <span class=bound>j</span>"</span></span>
                                     <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=skolem>p1</span> <span class=skolem>s1</span> <span class=skolem>s1'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> IH1<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> subs subs' tr1 this<span class=main>(</span>2<span class=main>)</span> <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∉</span>dom<span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=free>i</span> <span class=main>⟶</span> <span class=main>(</span>netmap <span class=skolem>s1'</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>intro</span> allI impI<span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>≠</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s1'</span> <span class=skolem>j</span> <span class=main>=</span> netmap <span class=skolem>s1</span> <span class=skolem>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>netmap <span class=skolem>s1'</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=skolem>j</span> <span class=main>=</span> <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=skolem>j</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>hide_lams<span class=main><span class=main>,</span></span> mono_tags<span class=main><span class=main>)</span></span> map_add_dom_app_simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> map_add_dom_app_simps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s1</span>›</span></span> subs subs' <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s2</span> <span class=skolem>s2'</span> <span class=skolem>s1</span>
      <span class=keyword3><span class=command>assume</span></span> subs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> subs'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2'</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> sr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> TT"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> sr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> subs<span class=main>)</span> <span class=main>(</span><span class=operator>erule</span> subnet_reachable<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>p1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dom<span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span> <span class=main>∩</span> dom<span class=main>(</span>netmap <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_ips_is_dom_netmap pnet_net_ips_net_tree_ips<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sr2 tr2 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> delivered_to_net_ips<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∉</span>dom<span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>p2</span>›</span></span> sr2 tr2 <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=free>i</span> <span class=main>⟶</span> netmap <span class=skolem>s2'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=skolem>s2</span> <span class=bound>j</span>"</span></span>
                                     <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=skolem>p2</span> <span class=skolem>s2</span> <span class=skolem>s2'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> IH2<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> subs subs' tr2 this<span class=main>(</span>2<span class=main>)</span> <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∉</span>dom<span class=main>(</span>netmap <span class=skolem>s1</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=free>i</span> <span class=main>⟶</span> <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2'</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>intro</span> allI impI<span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>≠</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s2'</span> <span class=skolem>j</span> <span class=main>=</span> netmap <span class=skolem>s2</span> <span class=skolem>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2'</span><span class=main>)</span> <span class=skolem>j</span> <span class=main>=</span> <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=main>++</span> netmap <span class=skolem>s2</span><span class=main>)</span> <span class=skolem>j</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>hide_lams<span class=main><span class=main>,</span></span> mono_tags<span class=main><span class=main>)</span></span> domD map_add_Some_iff map_add_dom_app_simps<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s2</span>›</span></span> subs subs' <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Closed><div class=head><h1>Theory Closed</h1></div><pre class=source><span class=comment1>(*  Title:       Closed.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Lemmas for closed networks"</span></span>

<span class=keyword1><span class=command>theory</span></span> Closed
<span class=keyword2><span class=keyword>imports</span></span> <a href=Pnet.html>Pnet</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=Closed-complete_net_preserves_subnets><span class=command>lemma</span></span> complete_net_preserves_subnets<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>SubnetS <span class=free>s</span> <span class=free>t</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>st'</span><span class=main>)</span> <span class=main>∈</span> cnet_sos <span class=main>(</span>pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>s'</span> <span class=bound>t'</span><span class=main>.</span> <span class=free>st'</span> <span class=main>=</span> SubnetS <span class=bound>s'</span> <span class=bound>t'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> partial_net_preserves_subnets<span class=main>)</span>

<span class=keyword1 id=Closed-complete_net_reachable_is_subnet><span class=command>lemma</span></span> complete_net_reachable_is_subnet<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>st</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>I</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>s</span> <span class=bound>t</span><span class=main>.</span> <span class=free>st</span> <span class=main>=</span> SubnetS <span class=bound>s</span> <span class=bound>t</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>induction</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> complete_net_preserves_subnets<span class=main>)</span>

<span class=keyword1 id=Closed-closed_reachable_par_subnet_induct><span class=command>lemma</span></span> closed_reachable_par_subnet_induct <span class=main>[</span><span class=operator>consumes</span><span class=main>,</span> <span class=operator>case_names</span> init step<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=free>s</span> <span class=free>t</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>t</span><span class=main>.</span> SubnetS <span class=bound>s</span> <span class=bound>t</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s</span> <span class=bound>t</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>t</span> <span class=bound>s'</span> <span class=bound>t'</span> <span class=bound>a</span><span class=main>.</span> <span class=main>⟦</span>
                    SubnetS <span class=bound>s</span> <span class=bound>t</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>I</span><span class=main>;</span>
                    <span class=free>P</span> <span class=bound>s</span> <span class=bound>t</span><span class=main>;</span> <span class=main>(</span>SubnetS <span class=bound>s</span> <span class=bound>t</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> SubnetS <span class=bound>s'</span> <span class=bound>t'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>I</span> <span class=bound>a</span> <span class=main>⟧</span>
                    <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s'</span> <span class=bound>t'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>s</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=quoted>"SubnetS <span class=free>s</span> <span class=free>t</span>"</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>t</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>t</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=skolem>s</span> <span class=skolem>t</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> init <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span> <span class=skolem>t</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>st</span> <span class=skolem>a</span> <span class=skolem>s'</span> <span class=skolem>t'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>st</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>t</span><span class=main>.</span> <span class=skolem>st</span> <span class=main>=</span> SubnetS <span class=bound>s</span> <span class=bound>t</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>s</span> <span class=bound>t</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>t</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>=</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span>"</span></span>
                              <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=skolem>s</span> <span class=skolem>t</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complete_net_reachable_is_subnet<span class=main>)</span>
    <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> IH <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span> <span class=skolem>t</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s'</span> <span class=skolem>t'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Closed-reachable_closed_reachable_pnet><span class=command>lemma</span></span> reachable_closed_reachable_pnet <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> reachable.induct<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>s'</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> cnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=main>(</span><span class=operator>insert</span> sr<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> reachable_step<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> reachable_init<span class=main>)</span>

<span class=keyword1 id=Closed-closed_node_net_state><span class=command>lemma</span></span> closed_node_net_state <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>st</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=free>ii</span><span class=main>;</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>ξ</span> <span class=free>p</span> <span class=free>q</span> <span class=free>R</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>st</span> <span class=main>=</span> NodeS <span class=free>ii</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span> <span class=free>R</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_node_reachable_is_node reachable_closed_reachable_pnet surj_pair<span class=main>)</span>

<span class=keyword1 id=Closed-closed_subnet_net_state><span class=command>lemma</span></span> closed_subnet_net_state <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>st</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>s</span> <span class=free>t</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>st</span> <span class=main>=</span> SubnetS <span class=free>s</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> reachable_closed_reachable_pnet net_par_reachable_is_subnet<span class=main>)</span>

<span class=keyword1 id=Closed-closed_imp_pnet_trans><span class=command>lemma</span></span> closed_imp_pnet_trans <span class=main>[</span><span class=operator>elim</span><span class=main>,</span> <span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a'</span><span class=main>.</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=bound>a'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> cnet_sos.cases<span class=main>)</span>

<span class=keyword1 id=Closed-reachable_not_in_net_tree_ips><span class=command>lemma</span></span> reachable_not_in_net_tree_ips <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∉</span>net_tree_ips <span class=free>n</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netmap <span class=free>s</span> <span class=free>i</span> <span class=main>=</span> None"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_tree_ips <span class=free>n</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s</span> <span class=free>i</span> <span class=main>=</span> None"</span></span>                                     
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>s</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R</span> <span class=skolem>s</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>≠</span> <span class=skolem>ii</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>p</span> <span class=skolem>R</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> pnet.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> pnet_node_init'<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s</span> <span class=free>i</span> <span class=main>=</span> None"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>s</span>
      <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p1</span>
                        <span class=main>⟹</span> netmap <span class=bound>s</span> <span class=free>i</span> <span class=main>=</span> None"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p2</span>
                        <span class=main>⟹</span> netmap <span class=bound>s</span> <span class=free>i</span> <span class=main>=</span> None"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_tree_ips <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s1</span></span> <span class=skolem><span class=skolem>s2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
                                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>)</span>"</span></span>
                                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=operator>metis</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span> <span class=main>∉</span> net_tree_ips <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p1</span>"</span></span>
                                                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s1</span> <span class=free>i</span> <span class=main>=</span> None"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s2</span> <span class=free>i</span> <span class=main>=</span> None"</span></span>
        <span class=keyword1><span class=command>using</span></span> IH1 IH2 <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s</span> <span class=free>i</span> <span class=main>=</span> None"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_tree_ips <span class=free>n</span> <span class=main>⟹</span> netmap <span class=skolem>s</span> <span class=free>i</span> <span class=main>=</span> None"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_tree_ips <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3-4<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∉</span>net_ips <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>with</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∉</span>net_ips <span class=skolem>s'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>erule</span> cnet_sos.cases<span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>metis</span> net_ips_is_dom_netmap pnet_maintains_dom<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s'</span> <span class=free>i</span> <span class=main>=</span> None"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Closed-closed_pnet_aodv_init><span class=command>lemma</span></span> closed_pnet_aodv_init <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=free>n</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>netmap <span class=free>s</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R</span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=free>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>p</span> <span class=skolem>R</span>"</span></span>
                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>p</span> <span class=skolem>R</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmap <span class=skolem>s</span> <span class=main>=</span> <span class=main>[</span><span class=free>i</span> <span class=main>↦</span> <span class=skolem>p</span><span class=main>]</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>netmap <span class=skolem>s</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
                      <span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p1</span> <span class=main>⟹</span> the <span class=main>(</span>netmap <span class=bound>s</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span>
                     <span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p2</span> <span class=main>⟹</span> the <span class=main>(</span>netmap <span class=bound>s</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s1</span></span> <span class=skolem><span class=skolem>s2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
                                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>)</span>"</span></span>
                                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>p1</span> <span class=main>=</span> net_ips <span class=skolem>s1</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> pnet_init_net_ips_net_tree_ips<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> net_ips <span class=skolem>s2</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> pnet_init_net_ips_net_tree_ips<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>netmap <span class=skolem>s</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p2</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p2</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>netmap <span class=skolem>s2</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p2</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> net_ips <span class=skolem>s2</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∉</span>net_tree_ips <span class=skolem>p2</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>netmap <span class=skolem>s1</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p1</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>p1</span> <span class=main>=</span> net_ips <span class=skolem>s1</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∉</span>net_tree_ips <span class=skolem>p2</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> net_ips <span class=skolem>s2</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∉</span>net_ips <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> map_add_dom_app_simps net_ips_is_dom_netmap<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=OAWN_SOS><div class=head><h1>Theory OAWN_SOS</h1></div><pre class=source><span class=comment1>(*  Title:       OAWN_SOS.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Open semantics of the Algebra of Wireless Networks"</span></span>

<span class=keyword1><span class=command>theory</span></span> OAWN_SOS
<span class=keyword2><span class=keyword>imports</span></span> <a href=TransitionSystems.html>TransitionSystems</a> <a href=AWN.html>AWN</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  These are variants of the SOS rules that work against a mixed global/local context, where
  the global context is represented by a function <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>σ</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> mapping ip addresses to states.
›</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Open structural operational semantics for sequential process expressions "</span></span>

<span class=keyword1><span class=command>inductive_set</span></span>
  <span class=entity>oseqp_sos</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>⇒</span> ip
      <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp<span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>Γ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=entity>i</span> <span class=main>::</span> <span class=quoted>ip</span>
<span class=keyword2><span class=keyword>where</span></span>
    obroadcastT<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free>i</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span> <span class=main>⟹</span>
                  <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>        broadcast <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span>              <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=main>|</span> ogroupcastT<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free>i</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span> <span class=main>⟹</span>
                  <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>  groupcast <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=main>|</span> ounicastT<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free>i</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span> <span class=main>⟹</span>
                  <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>,</span> unicast <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span>    <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=main>|</span> onotunicastT<span class=main>:</span><span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free>i</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span> <span class=main>⟹</span>
                  <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>¬unicast</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span>               <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=main>|</span> osendT<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free>i</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span> <span class=main>⟹</span>
                  <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>             send <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span>                  <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=main>|</span> odeliverT<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free>i</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span> <span class=main>⟹</span>
                  <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>         deliver <span class=main>(</span><span class=free><span class=bound><span class=entity>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span>              <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=main>|</span> oreceiveT<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free>i</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span> <span class=free><span class=bound><span class=entity>msg</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span><span class=main>)</span> <span class=main>⟹</span>
                  <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=free><span class=bound><span class=entity>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>          receive <span class=free><span class=bound><span class=entity>msg</span></span></span><span class=main>,</span>                       <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=main>|</span> oassignT<span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free>i</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>u</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span><span class=main>)</span> <span class=main>⟹</span>
                  <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=free><span class=bound><span class=entity>u</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span>                    <span class=keyword1>τ</span><span class=main>,</span>                                 <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span>

  <span class=main>|</span> ocallT<span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free>Γ</span> <span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span> <span class=main>⟹</span>
                  <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span> <span class=comment1>(* TPB: quite different to Table 1 *)</span>

  <span class=main>|</span> ochoiceT1<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span> <span class=main>⟹</span>
                  <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=main>|</span> ochoiceT2<span class=main>:</span>   <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span> <span class=main>⟹</span>
                  <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>q'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span>

  <span class=main>|</span> oguardT<span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free>i</span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>g</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>g</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oseqp_sos</span> <span class=free>Γ</span> <span class=free>i</span>"</span></span>

<span class=keyword1><span class=command>inductive_cases</span></span>
      oseq_callTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>      <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=keyword1>call(</span><span class=free>pn</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> oseq_choiceTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p1</span> <span class=main>⊕</span> <span class=free>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>

<span class=keyword1 id=OAWN_SOS-oseq_broadcastTE><span class=command>lemma</span></span> oseq_broadcastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}broadcast(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> broadcast <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}broadcast(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oseqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span> <span class=free><span class=free><span class=free>i</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_SOS-oseq_groupcastTE><span class=command>lemma</span></span> oseq_groupcastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}groupcast(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> groupcast <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}groupcast(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub><span class=hidden>⇩</span><sub>s</sub></span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oseqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span> <span class=free><span class=free><span class=free>i</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_SOS-oseq_unicastTE><span class=command>lemma</span></span> oseq_unicastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}unicast(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span> <span class=main>▹</span> <span class=free>q</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>r</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> unicast <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>;</span> <span class=free>r</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> <span class=keyword1>¬unicast</span> <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>;</span> <span class=free>r</span> <span class=main>=</span> <span class=free>q</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}unicast(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>i</sub><span class=hidden>⇩</span><sub>p</sub></span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span> <span class=main><span class=main><span class=main>▹</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>r</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oseqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span> <span class=free><span class=free><span class=free>i</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=OAWN_SOS-oseq_sendTE><span class=command>lemma</span></span> oseq_sendTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}send(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> send <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}send(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oseqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span> <span class=free><span class=free><span class=free>i</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_SOS-oseq_deliverTE><span class=command>lemma</span></span> oseq_deliverTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}deliver(</span><span class=free>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span>
    <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> deliver <span class=main>(</span><span class=free>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}deliver(</span></span></span><span class=free><span class=free><span class=free>s<span class=hidden>⇩</span><sub>d</sub><span class=hidden>⇩</span><sub>a</sub><span class=hidden>⇩</span><sub>t</sub><span class=hidden>⇩</span><sub>a</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oseqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span> <span class=free><span class=free><span class=free>i</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_SOS-oseq_receiveTE><span class=command>lemma</span></span> oseq_receiveTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}receive(</span><span class=free>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span>
    <span class=main>⋀</span><span class=bound>msg</span><span class=main>.</span> <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> receive <span class=bound>msg</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span> <span class=bound>msg</span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=keyword1><span class=keyword1><span class=keyword1>}receive(</span></span></span><span class=free><span class=free><span class=free>u<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>g</sub></span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>.</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oseqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span> <span class=free><span class=free><span class=free>i</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_SOS-oseq_assignTE><span class=command>lemma</span></span> oseq_assignTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟦</span><span class=free>u</span><span class=main>⟧</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span> <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>u</span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=main><span class=main><span class=main>}</span></span></span><span class=main><span class=main><span class=main>⟦</span></span></span><span class=free><span class=free><span class=free>u</span></span></span><span class=main><span class=main><span class=main>⟧</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oseqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span> <span class=free><span class=free><span class=free>i</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_SOS-oseq_guardTE><span class=command>lemma</span></span> oseq_guardTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟨</span><span class=free>g</span><span class=main>⟩</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span> <span class=main>⟦</span><span class=free>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>∈</span> <span class=free>g</span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>;</span> <span class=free>q</span> <span class=main>=</span> <span class=free>p</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>{</span></span></span><span class=free><span class=free><span class=free>l</span></span></span><span class=main><span class=main><span class=main>}</span></span></span><span class=main><span class=main><span class=main>⟨</span></span></span><span class=free><span class=free><span class=free>g</span></span></span><span class=main><span class=main><span class=main>⟩</span></span></span> <span class=free><span class=free><span class=free>p</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>a</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>q</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oseqp_sos <span class=free><span class=free><span class=free>Γ</span></span></span> <span class=free><span class=free><span class=free>i</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> oseqpTEs <span class=main>=</span>
  oseq_broadcastTE
  oseq_groupcastTE
  oseq_unicastTE
  oseq_sendTE
  oseq_deliverTE
  oseq_receiveTE
  oseq_assignTE
  oseq_callTE
  oseq_choiceTE
  oseq_guardTE

<span class=keyword1><span class=command>declare</span></span> oseqp_sos.intros <span class=main>[</span><span class=operator>intro</span><span class=main>]</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Open structural operational semantics for parallel process expressions "</span></span>

<span class=keyword1><span class=command>inductive_set</span></span>
  <span class=entity>oparp_sos</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ip
               <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'s1</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set
               <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s2</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set
               <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=main>(</span><span class=tfree>'s1</span> <span class=main>×</span> <span class=tfree>'s2</span><span class=main>)</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>i</span> <span class=main>::</span> <span class=quoted>ip</span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=entity>S</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'s1</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=entity>T</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s2</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    oparleft<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≠</span> receive <span class=bound>m</span> <span class=main>⟧</span> <span class=main>⟹</span>
                <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oparp_sos</span> <span class=free>i</span> <span class=free>S</span> <span class=free>T</span>"</span></span>
  <span class=main>|</span> oparright<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≠</span> send <span class=bound>m</span><span class=main>;</span> <span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free>i</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free>i</span> <span class=main>⟧</span> <span class=main>⟹</span>
                <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oparp_sos</span> <span class=free>i</span> <span class=free>S</span> <span class=free>T</span>"</span></span>
  <span class=main>|</span> oparboth<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> receive <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>,</span> send <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span> <span class=main>⟹</span>
                <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>oparp_sos</span> <span class=free>i</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

<span class=keyword1 id=OAWN_SOS-opar_broadcastTE><span class=command>lemma</span></span> opar_broadcastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> broadcast <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> broadcast <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> broadcast <span class=free>m</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> broadcast <span class=free><span class=free><span class=free>m</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oparp_sos <span class=free><span class=free><span class=free>i</span></span></span> <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=OAWN_SOS-opar_groupcastTE><span class=command>lemma</span></span> opar_groupcastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> groupcast <span class=free>ips</span> <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> groupcast <span class=free>ips</span> <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> groupcast <span class=free>ips</span> <span class=free>m</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> groupcast <span class=free><span class=free><span class=free>ips</span></span></span> <span class=free><span class=free><span class=free>m</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oparp_sos <span class=free><span class=free><span class=free>i</span></span></span> <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=OAWN_SOS-opar_unicastTE><span class=command>lemma</span></span> opar_unicastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> unicast <span class=free>i</span> <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> unicast <span class=free>i</span> <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> unicast <span class=free>i</span> <span class=free>m</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> unicast <span class=free><span class=free><span class=free>i</span></span></span> <span class=free><span class=free><span class=free>m</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oparp_sos <span class=free><span class=free><span class=free>i</span></span></span> <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=OAWN_SOS-opar_notunicastTE><span class=command>lemma</span></span> opar_notunicastTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> notunicast <span class=free>i</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> notunicast <span class=free>i</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> notunicast <span class=free>i</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> notunicast <span class=free><span class=free><span class=free>i</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oparp_sos <span class=free><span class=free><span class=free>i</span></span></span> <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=OAWN_SOS-opar_sendTE><span class=command>lemma</span></span> opar_sendTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> send <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> send <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> send <span class=free><span class=free><span class=free>m</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oparp_sos <span class=free><span class=free><span class=free>i</span></span></span> <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_SOS-opar_deliverTE><span class=command>lemma</span></span> opar_deliverTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> deliver <span class=free>d</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> deliver <span class=free>d</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> deliver <span class=free>d</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> deliver <span class=free><span class=free><span class=free>d</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oparp_sos <span class=free><span class=free><span class=free>i</span></span></span> <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=OAWN_SOS-opar_receiveTE><span class=command>lemma</span></span> opar_receiveTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> receive <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=free>S</span> <span class=free>T</span><span class=main>;</span>
    <span class=main>⟦</span><span class=main>(</span><span class=free>t</span><span class=main>,</span> receive <span class=free>m</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>ind_cases</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main>(</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> receive <span class=free><span class=free><span class=free>m</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>σ'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>s'</span></span></span><span class=main><span class=main><span class=main>,</span></span></span> <span class=free><span class=free><span class=free>t'</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main><span class=main>)</span></span></span> <span class=main><span class=main><span class=main>∈</span></span></span> oparp_sos <span class=free><span class=free><span class=free>i</span></span></span> <span class=free><span class=free><span class=free>S</span></span></span> <span class=free><span class=free><span class=free>T</span></span></span>"</span></span></span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>inductive_cases</span></span> opar_tauTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

<span class=keyword1><span class=command>lemmas</span></span> oparpTEs <span class=main>=</span>
  opar_broadcastTE
  opar_groupcastTE
  opar_unicastTE
  opar_notunicastTE
  opar_sendTE
  opar_deliverTE
  opar_receiveTE

<span class=keyword1 id=OAWN_SOS-oparp_sos_cases><span class=command>lemma</span></span> oparp_sos_cases <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=main>(</span><span class=free>s'</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=free>S</span> <span class=free>T</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free>a</span> <span class=main>≠</span> receive <span class=bound>m</span><span class=main>;</span> <span class=free>t'</span> <span class=main>=</span> <span class=free>t</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=free>t</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free>a</span> <span class=main>≠</span> send <span class=bound>m</span><span class=main>;</span> <span class=free>s'</span> <span class=main>=</span> <span class=free>s</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> receive <span class=bound>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=free>t</span><span class=main>,</span> send <span class=bound>m</span><span class=main>,</span> <span class=free>t'</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>extg</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'b</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'c</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>×</span> <span class=tfree>'b</span> <span class=main>×</span> <span class=tfree>'c</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>extg</span> <span class=main>≡</span> <span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l1</span><span class=main>)</span><span class=main>,</span> <span class=bound>l2</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main>(</span><span class=bound>l1</span><span class=main>,</span> <span class=bound>l2</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OAWN_SOS-extgsimp><span class=command>lemma</span></span> extgsimp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"extg <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l1</span><span class=main>)</span><span class=main>,</span> <span class=free>l2</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>(</span><span class=free>l1</span><span class=main>,</span> <span class=free>l2</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> extg_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_SOS-extg_range_prod><span class=command>lemma</span></span> extg_range_prod<span class=main>:</span> <span class=quoted><span class=quoted>"extg <span class=main>`</span> <span class=main>(</span><span class=free>i1</span> <span class=main>×</span> <span class=free>i2</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main>(</span><span class=bound>s1</span><span class=main>,</span> <span class=bound>s2</span><span class=main>)</span><span class=main>)</span><span class=main>|</span><span class=bound>σ</span> <span class=bound>s1</span> <span class=bound>s2</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s1</span><span class=main>)</span> <span class=main>∈</span> <span class=free>i1</span> <span class=main>∧</span> <span class=bound>s2</span> <span class=main>∈</span> <span class=free>i2</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> image_def extg_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> Collect_cong<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>opar_comp</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'s1</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton
               <span class=main>⇒</span> ip
               <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s2</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton
               <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'s1</span> <span class=main>×</span> <span class=tfree>'s2</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton"</span></span>
  <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span>_ <span class=keyword1>⟨⟨⇘</span>_<span class=keyword1>⇙</span> _<span class=keyword3>)</span>"</span> <span class=main>[</span>102<span class=main>,</span> 0<span class=main>,</span> 103<span class=main>]</span> 102<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>s</span></span></span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free><span class=bound><span class=entity>i</span></span></span></sub><span class=hidden>⇙</span> <span class=free><span class=bound><span class=entity>t</span></span></span> <span class=main>≡</span> <span class=main>⦇</span> init <span class=main>=</span> extg <span class=main>`</span> <span class=main>(</span>init <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>×</span> init <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> trans <span class=main>=</span> oparp_sos <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>(</span>trans <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span> <span class=main>(</span>trans <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span> <span class=main>⦈</span>"</span></span>

<span class=keyword1 id="OAWN_SOS-opar_comp_def'"><span class=command>lemma</span></span> opar_comp_def'<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>s</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> <span class=free>t</span> <span class=main>=</span> <span class=main>⦇</span> init <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main>(</span><span class=bound>s<span class=hidden>⇩</span><sub>l</sub></span><span class=main>,</span> <span class=bound>t<span class=hidden>⇩</span><sub>l</sub></span><span class=main>)</span><span class=main>)</span><span class=main>|</span><span class=bound>σ</span> <span class=bound>s<span class=hidden>⇩</span><sub>l</sub></span> <span class=bound>t<span class=hidden>⇩</span><sub>l</sub></span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s<span class=hidden>⇩</span><sub>l</sub></span><span class=main>)</span> <span class=main>∈</span> init <span class=free>s</span> <span class=main>∧</span> <span class=bound>t<span class=hidden>⇩</span><sub>l</sub></span> <span class=main>∈</span> init <span class=free>t</span><span class=main>}</span><span class=main>,</span>
                trans <span class=main>=</span> oparp_sos <span class=free>i</span> <span class=main>(</span>trans <span class=free>s</span><span class=main>)</span> <span class=main>(</span>trans <span class=free>t</span><span class=main>)</span> <span class=main>⦈</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> opar_comp_def extg_def image_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split<span class=main>)</span>

<span class=keyword1 id=OAWN_SOS-trans_opar_comp><span class=command>lemma</span></span> trans_opar_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"trans <span class=main>(</span><span class=free>s</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> oparp_sos <span class=free>i</span> <span class=main>(</span>trans <span class=free>s</span><span class=main>)</span> <span class=main>(</span>trans <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> opar_comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_SOS-init_opar_comp><span class=command>lemma</span></span> init_opar_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"init <span class=main>(</span><span class=free>s</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> <span class=free>t</span><span class=main>)</span> <span class=main>=</span> extg <span class=main>`</span> <span class=main>(</span>init <span class=free>s</span> <span class=main>×</span> init <span class=free>t</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> opar_comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Open structural operational semantics for node expressions "</span></span>

<span class=keyword1><span class=command>inductive_set</span></span>
  <span class=entity>onode_sos</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set
                <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>S</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    onode_bcast<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> broadcast <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_gcast<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> groupcast <span class=free><span class=bound><span class=entity>D</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>∩</span><span class=free><span class=bound><span class=entity>D</span></span></span><span class=main>)</span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_ucast<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> unicast <span class=free><span class=bound><span class=entity>d</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>∈</span><span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>}</span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

    <span class=comment1>(* Such assumptions aid later proofs, but they must be justified when transferring results
       to closed systems. *)</span>
  <span class=main>|</span> onode_notucast<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>¬unicast</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>∉</span><span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>⟶</span> <span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>j</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>j</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_deliver<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> deliver <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>⟶</span> <span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>j</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>j</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_tau<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>⟶</span> <span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>j</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>j</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span>   <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_receive<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> receive <span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>}</span><span class=main>¬</span><span class=main>{}</span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_arrive<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>{}</span><span class=main>¬</span><span class=main>{</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>}</span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span>  <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_connect1<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span>    <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>∪</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>}</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_connect2<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span><span class=main>,</span>    <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>∪</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>}</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_disconnect1<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>-</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>}</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_disconnect2<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>-</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>}</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_connect_other<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≠</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≠</span> <span class=free><span class=bound><span class=entity>i''</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i''</span></span></span><span class=main>)</span><span class=main>,</span>    <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> onode_disconnect_other<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≠</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≠</span> <span class=free><span class=bound><span class=entity>i''</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i''</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>onode_sos</span> <span class=free>S</span>"</span></span>

<span class=keyword1><span class=command>inductive_cases</span></span>
      onode_arriveTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span>   <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=free>i'</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> onode_castTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>       <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=free>RR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span>        <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=free>i'</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> onode_deliverTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=free>ii</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span>      <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=free>i'</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> onode_connectTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>ii</span><span class=main>,</span> <span class=free>ii'</span><span class=main>)</span><span class=main>,</span>   <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=free>i'</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> onode_disconnectTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>ii</span><span class=main>,</span> <span class=free>ii'</span><span class=main>)</span><span class=main>,</span><span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=free>i'</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> onode_newpktTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=free>ii</span><span class=keyword1>:newpkt(</span><span class=free>d</span><span class=main>,</span> <span class=free>di</span><span class=main>)</span><span class=main>,</span>   <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=free>i'</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> onode_tauTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>        <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span>                  <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=free>i'</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>

<span class=keyword1 id=OAWN_SOS-oarrives_or_not><span class=command>lemma</span></span> oarrives_or_not<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=free>i'</span> <span class=free>s'</span> <span class=free>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ii</span> <span class=main>=</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>∧</span> <span class=free>ni</span> <span class=main>=</span> <span class=main>{}</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=free>ii</span> <span class=main>=</span> <span class=main>{}</span> <span class=main>∧</span> <span class=free>ni</span> <span class=main>=</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>onode_comp</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ip
                 <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton
                 <span class=main>⇒</span> ip set
                 <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> automaton"</span></span>
    <span class=main>(</span><span class=quoted>"<span class=keyword3>(</span><span class=keyword1>⟨</span>_ <span class=keyword1>:</span> <span class=keyword3>(</span>_<span class=keyword3>)</span> <span class=keyword1>:</span> _<span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=keyword3>)</span>"</span> <span class=main>[</span>0<span class=main>,</span> 0<span class=main>,</span> 0<span class=main>]</span> 104<span class=main>)</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main><span class=free>⟨</span></span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main><span class=free>:</span></span> <span class=free><span class=bound><span class=entity>onp</span></span></span> <span class=main><span class=free>:</span></span> <span class=free><span class=bound><span class=entity>R<span class=hidden>⇩</span><sub>i</sub></span></span></span><span class=keyword1><span class=free>⟩<span class=hidden>⇩</span><sub>o</sub></span></span> <span class=main>≡</span> <span class=main>⦇</span> init <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=bound>s</span> <span class=free><span class=bound><span class=entity>R<span class=hidden>⇩</span><sub>i</sub></span></span></span><span class=main>)</span><span class=main>|</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=free><span class=bound><span class=entity>onp</span></span></span><span class=main>}</span><span class=main>,</span>
                      trans <span class=main>=</span> onode_sos <span class=main>(</span>trans <span class=free><span class=bound><span class=entity>onp</span></span></span><span class=main>)</span> <span class=main>⦈</span>"</span></span>

<span class=keyword1 id=OAWN_SOS-trans_onode_comp><span class=command>lemma</span></span> trans_onode_comp<span class=main>:</span>
  <span class=quoted><span class=quoted>"trans <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>S</span> <span class=main>:</span> <span class=free>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=main>=</span> onode_sos <span class=main>(</span>trans <span class=free>S</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> onode_comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_SOS-init_onode_comp><span class=command>lemma</span></span> init_onode_comp<span class=main>:</span>
  <span class=quoted><span class=quoted>"init <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>S</span> <span class=main>:</span> <span class=free>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=bound>s</span> <span class=free>R</span><span class=main>)</span><span class=main>|</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>S</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> onode_comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> onode_comps <span class=main>=</span> trans_onode_comp init_onode_comp

<span class=keyword1 id=OAWN_SOS-fst_par_onode_comp><span class=command>lemma</span></span> fst_par_onode_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"trans <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>s</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>I</span></sub><span class=hidden>⇙</span> <span class=free>t</span> <span class=main>:</span> <span class=free>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=main>=</span> onode_sos <span class=main>(</span>oparp_sos <span class=free>I</span> <span class=main>(</span>trans <span class=free>s</span><span class=main>)</span> <span class=main>(</span>trans <span class=free>t</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> onode_comp_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_SOS-init_par_onode_comp><span class=command>lemma</span></span> init_par_onode_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"init <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>s</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>I</span></sub><span class=hidden>⇙</span> <span class=free>t</span> <span class=main>:</span> <span class=free>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=main>(</span><span class=bound>s1</span><span class=main>,</span> <span class=bound>s2</span><span class=main>)</span> <span class=free>R</span><span class=main>)</span><span class=main>|</span><span class=bound>σ</span> <span class=bound>s1</span> <span class=bound>s2</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s1</span><span class=main>)</span><span class=main>,</span> <span class=bound>s2</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>s</span> <span class=main>×</span> init <span class=free>t</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> onode_comp_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> extg_range_prod<span class=main>)</span>

<span class=keyword1 id=OAWN_SOS-onode_sos_dest_is_net_state><span class=command>lemma</span></span> onode_sos_dest_is_net_state<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ'</span> <span class=bound>i'</span> <span class=bound>ζ'</span> <span class=bound>R'</span><span class=main>.</span> <span class=free>s'</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> NodeS <span class=bound>i'</span> <span class=bound>ζ'</span> <span class=bound>R'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ'</span></span> <span class=skolem><span class=skolem>i'</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=skolem>i'</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>s'</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onode_sos.cases<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="OAWN_SOS-onode_sos_dest_is_net_state'"><span class=command>lemma</span></span> onode_sos_dest_is_net_state'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>p</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ'</span> <span class=bound>ζ'</span> <span class=bound>R'</span><span class=main>.</span> <span class=free>s'</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=bound>ζ'</span> <span class=bound>R'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>p</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ'</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>s'</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onode_sos.cases<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="OAWN_SOS-onode_sos_dest_is_net_state''"><span class=command>lemma</span></span> onode_sos_dest_is_net_state''<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>p</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ'</span> <span class=bound>R'</span><span class=main>.</span> <span class=free>s'</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=bound>ζ'</span> <span class=bound>R'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>ns'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns'</span> <span class=main>=</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>p</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ''</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ''</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> onode_sos_dest_is_net_state'<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ns'_def<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_SOS-onode_sos_src_is_net_state><span class=command>lemma</span></span> onode_sos_src_is_net_state<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>i</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>.</span> <span class=free>p</span> <span class=main>=</span> NodeS <span class=bound>i</span> <span class=bound>ζ</span> <span class=bound>R</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> NodeS <span class=skolem>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>s'</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onode_sos.cases<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_SOS-onode_sos_net_states><span class=command>lemma</span></span> onode_sos_net_states<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>i</span> <span class=bound>ζ</span> <span class=bound>R</span> <span class=bound>ζ'</span> <span class=bound>R'</span><span class=main>.</span> <span class=free>s</span> <span class=main>=</span> NodeS <span class=bound>i</span> <span class=bound>ζ</span> <span class=bound>R</span> <span class=main>∧</span> <span class=free>s'</span> <span class=main>=</span> NodeS <span class=bound>i</span> <span class=bound>ζ'</span> <span class=bound>R'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> NodeS <span class=skolem>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> onode_sos_src_is_net_state<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> NodeS <span class=skolem>i</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onode_sos_dest_is_net_state'<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_SOS-node_sos_cases><span class=command>lemma</span></span> node_sos_cases <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>p</span> <span class=free>R</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>p'</span> <span class=free>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=free>S</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>m</span> <span class=main>.</span>       <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=free>R</span><span class=keyword1>:*cast(</span><span class=bound>m</span><span class=main>)</span><span class=main>;</span>          <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> broadcast <span class=bound>m</span><span class=main>,</span>   <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>m</span> <span class=bound>D</span><span class=main>.</span>      <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=main>(</span><span class=free>R</span> <span class=main>∩</span> <span class=bound>D</span><span class=main>)</span><span class=keyword1>:*cast(</span><span class=bound>m</span><span class=main>)</span><span class=main>;</span>    <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> groupcast <span class=bound>D</span> <span class=bound>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>d</span> <span class=bound>m</span><span class=main>.</span>      <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=main>{</span><span class=bound>d</span><span class=main>}</span><span class=keyword1>:*cast(</span><span class=bound>m</span><span class=main>)</span><span class=main>;</span>        <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> unicast <span class=bound>d</span> <span class=bound>m</span><span class=main>,</span>   <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=bound>d</span> <span class=main>∈</span> <span class=free>R</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>d</span><span class=main>.</span>        <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>;</span>                   <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>¬unicast</span> <span class=bound>d</span><span class=main>,</span>    <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=bound>d</span> <span class=main>∉</span> <span class=free>R</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>d</span><span class=main>.</span>        <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>;</span>        <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> deliver <span class=bound>d</span><span class=main>,</span>     <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>        <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>¬</span><span class=main>{}</span><span class=keyword1>:arrive(</span><span class=bound>m</span><span class=main>)</span><span class=main>;</span>    <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> receive <span class=bound>m</span><span class=main>,</span>     <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span>            <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>;</span>                   <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span>             <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>m</span><span class=main>.</span>        <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=main>{}</span><span class=main>¬</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=keyword1>:arrive(</span><span class=bound>m</span><span class=main>)</span><span class=main>;</span>    <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span><span class=main>;</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span><span class=main>.</span>     <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>connect(</span><span class=bound>i</span><span class=main>,</span> <span class=bound>i'</span><span class=main>)</span><span class=main>;</span>      <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span> <span class=main>∪</span> <span class=main>{</span><span class=bound>i'</span><span class=main>}</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span><span class=main>;</span> <span class=free>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span><span class=main>.</span>     <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>connect(</span><span class=bound>i'</span><span class=main>,</span> <span class=bound>i</span><span class=main>)</span><span class=main>;</span>      <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span> <span class=main>∪</span> <span class=main>{</span><span class=bound>i'</span><span class=main>}</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span><span class=main>;</span> <span class=free>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span><span class=main>.</span>     <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>disconnect(</span><span class=bound>i</span><span class=main>,</span> <span class=bound>i'</span><span class=main>)</span><span class=main>;</span>   <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span> <span class=main>-</span> <span class=main>{</span><span class=bound>i'</span><span class=main>}</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span><span class=main>;</span> <span class=free>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span><span class=main>.</span>     <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>disconnect(</span><span class=bound>i'</span><span class=main>,</span> <span class=bound>i</span><span class=main>)</span><span class=main>;</span>   <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span> <span class=main>-</span> <span class=main>{</span><span class=bound>i'</span><span class=main>}</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span><span class=main>;</span> <span class=free>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span> <span class=bound>i''</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>connect(</span><span class=bound>i'</span><span class=main>,</span> <span class=bound>i''</span><span class=main>)</span><span class=main>;</span>    <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span><span class=main>;</span> <span class=bound>i</span> <span class=main>≠</span> <span class=bound>i'</span><span class=main>;</span> <span class=bound>i</span> <span class=main>≠</span> <span class=bound>i''</span><span class=main>;</span> <span class=free>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=main>(</span><span class=main>⋀</span><span class=bound>i</span> <span class=bound>i'</span> <span class=bound>i''</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>disconnect(</span><span class=bound>i'</span><span class=main>,</span> <span class=bound>i''</span><span class=main>)</span><span class=main>;</span> <span class=free>R'</span> <span class=main>=</span> <span class=free>R</span><span class=main>;</span> <span class=free>p</span> <span class=main>=</span> <span class=free>p'</span><span class=main>;</span> <span class=bound>i</span> <span class=main>≠</span> <span class=bound>i'</span><span class=main>;</span> <span class=bound>i</span> <span class=main>≠</span> <span class=bound>i''</span><span class=main>;</span> <span class=free>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span><span class=main>)</span> <span class=main>⟹</span>
  <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>erule</span> onode_sos.cases<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=keyword3>|</span></span> <span class=operator>metis</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Open structural operational semantics for partial network expressions "</span></span>

<span class=keyword1><span class=command>inductive_set</span></span>
  <span class=entity>opnet_sos</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set
                       <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set
                       <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>S</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>and</span></span> <span class=entity>T</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    opnet_cast1<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>¬</span><span class=free><span class=bound><span class=entity>K</span></span></span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>⊆</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>K</span></span></span> <span class=main>∩</span> <span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>opnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> opnet_cast2<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>¬</span><span class=free><span class=bound><span class=entity>K</span></span></span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span><span class=main>;</span>  <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>⊆</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>K</span></span></span> <span class=main>∩</span> <span class=free><span class=bound><span class=entity>R</span></span></span> <span class=main>=</span> <span class=main>{}</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>opnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> opnet_arrive<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>¬</span><span class=free><span class=bound><span class=entity>K</span></span></span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>H'</span></span></span><span class=main>¬</span><span class=free><span class=bound><span class=entity>K'</span></span></span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span>  <span class=main>(</span><span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>∪</span> <span class=free><span class=bound><span class=entity>H'</span></span></span><span class=main>)</span><span class=main>¬</span><span class=main>(</span><span class=free><span class=bound><span class=entity>K</span></span></span> <span class=main>∪</span> <span class=free><span class=bound><span class=entity>K'</span></span></span><span class=main>)</span><span class=keyword1>:arrive(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>opnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> opnet_deliver1<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span>
      <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>opnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> opnet_deliver2<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>opnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> opnet_tau1<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>opnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> opnet_tau2<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>opnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> opnet_connect<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>opnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

  <span class=main>|</span> opnet_disconnect<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>T</span> <span class=main>⟧</span>
      <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=free><span class=bound><span class=entity>t</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> SubnetS <span class=free><span class=bound><span class=entity>s'</span></span></span> <span class=free><span class=bound><span class=entity>t'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>opnet_sos</span> <span class=free>S</span> <span class=free>T</span>"</span></span>

<span class=keyword1><span class=command>inductive_cases</span></span> opartial_castTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>       <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>R</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> opnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> opartial_arriveTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>H</span><span class=main>¬</span><span class=free>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> opnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> opartial_deliverTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> opnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> opartial_tauTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>        <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> opnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> opartial_connectTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> opnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> opartial_disconnectTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> opnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> opartial_newpktTE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>     <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:newpkt(</span><span class=free>d</span><span class=main>,</span> <span class=free>di</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> opnet_sos <span class=free>S</span> <span class=free>T</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>opnet</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>ip <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton<span class=main>)</span>
              <span class=main>⇒</span> net_tree <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> automaton"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>opnet</span> <span class=free><span class=bound><span class=entity>onp</span></span></span> <span class=main>(</span><span class=main>⟨</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>;</span> <span class=free><span class=bound><span class=entity>R<span class=hidden>⇩</span><sub>i</sub></span></span></span><span class=main>⟩</span><span class=main>)</span>  <span class=main>=</span>  <span class=main>⟨</span><span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>:</span> <span class=free><span class=bound><span class=entity>onp</span></span></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>:</span> <span class=free><span class=bound><span class=entity>R<span class=hidden>⇩</span><sub>i</sub></span></span></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>opnet</span> <span class=free><span class=bound><span class=entity>onp</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>1</sub></span></span></span> <span class=main>∥</span> <span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>⦇</span> init <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> SubnetS <span class=bound>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>|</span><span class=bound>σ</span> <span class=bound>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span>
                                        <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>opnet</span> <span class=free><span class=bound><span class=entity>onp</span></span></span> <span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>1</sub></span></span></span><span class=main>)</span>
                                      <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>opnet</span> <span class=free><span class=bound><span class=entity>onp</span></span></span> <span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span>
                                      <span class=main>∧</span> net_ips <span class=bound>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_ips <span class=bound>s<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span><span class=main>}</span><span class=main>,</span>
                             trans <span class=main>=</span> opnet_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>opnet</span> <span class=free><span class=bound><span class=entity>onp</span></span></span> <span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>1</sub></span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span><span class=free>opnet</span> <span class=free><span class=bound><span class=entity>onp</span></span></span> <span class=free><span class=bound><span class=entity>p<span class=hidden>⇩</span><sub>2</sub></span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>⦈</span>"</span></span>

<span class=keyword1 id=OAWN_SOS-opnet_node_init><span class=command>lemma</span></span> opnet_node_init <span class=main>[</span><span class=operator>elim</span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>⟨</span><span class=free>i</span><span class=main>;</span> <span class=free>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=bound>ns</span> <span class=free>R</span><span class=main>)</span> <span class=main>|</span><span class=bound>σ</span> <span class=bound>ns</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ns</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>onp</span> <span class=free>i</span><span class=main>)</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comp_def<span class=main>)</span>

<span class=keyword1 id="OAWN_SOS-opnet_node_init'"><span class=command>lemma</span></span> opnet_node_init' <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
 <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>⟨</span><span class=free>i</span><span class=main>;</span> <span class=free>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
 <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>ns</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=free>ns</span> <span class=free>R</span>"</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ns</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>onp</span> <span class=free>i</span><span class=main>)</span>"</span></span>
   <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comp_def<span class=main>)</span>

<span class=keyword1 id=OAWN_SOS-opnet_node_trans><span class=command>lemma</span></span> opnet_node_trans <span class=main>[</span><span class=operator>elim</span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>⟨</span><span class=free>i</span><span class=main>;</span> <span class=free>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> trans_onode_comp<span class=main>)</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Open structural operational semantics for complete network expressions "</span></span>

<span class=keyword1><span class=command>inductive_set</span></span>
  <span class=entity>ocnet_sos</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span><span class=main>::</span>msg node_action<span class=main>)</span> transition set
                         <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
  <span class=keyword2><span class=keyword>for</span></span> <span class=entity>S</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> transition set"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    ocnet_connect<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_ips <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>⟶</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>j</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>j</span><span class=main>)</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>ocnet_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> ocnet_disconnect<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_ips <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>⟶</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>j</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>j</span><span class=main>)</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i'</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>ocnet_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> ocnet_cast<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>R</span></span></span><span class=keyword1>:*cast(</span><span class=free><span class=bound><span class=entity>m</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_ips <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>⟶</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>j</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>j</span><span class=main>)</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>ocnet_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> ocnet_tau<span class=main>:</span>  
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_ips <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>⟶</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>j</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>j</span><span class=main>)</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>ocnet_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> ocnet_deliver<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_ips <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>⟶</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>j</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>j</span><span class=main>)</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:deliver(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>ocnet_sos</span> <span class=free>S</span>"</span></span>

  <span class=main>|</span> ocnet_newpkt<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>{</span><span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>}</span><span class=main>¬</span><span class=free><span class=bound><span class=entity>K</span></span></span><span class=keyword1>:arrive(</span>newpkt<span class=main>(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>di</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>S</span><span class=main>;</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_ips <span class=free><span class=bound><span class=entity>s</span></span></span> <span class=main>⟶</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span> <span class=bound>j</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>j</span><span class=main>)</span> <span class=main>⟧</span>
     <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s</span></span></span><span class=main>)</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=keyword1>:newpkt(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>di</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>σ'</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>s'</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=free>ocnet_sos</span> <span class=free>S</span>"</span></span>

<span class=keyword1><span class=command>inductive_cases</span></span> oconnect_completeTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> odisconnect_completeTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> otau_completeTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> odeliver_completeTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=free>S</span>"</span></span>
            <span class=keyword2><span class=keyword>and</span></span> onewpkt_completeTE<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:newpkt(</span><span class=free>d</span><span class=main>,</span> <span class=free>di</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=free>S</span>"</span></span>

<span class=keyword1><span class=command>lemmas</span></span> ocompleteTEs <span class=main>=</span> oconnect_completeTE
                      odisconnect_completeTE
                      otau_completeTE
                      odeliver_completeTE
                      onewpkt_completeTE

<span class=keyword1 id=OAWN_SOS-ocomplete_no_cast><span class=command>lemma</span></span> ocomplete_no_cast <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>R</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∉</span> ocnet_sos <span class=free>T</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>R</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=free>T</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span> <span class=main>≠</span> <span class=free>R</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span>"</span></span>
     <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ocnet_sos.cases<span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_SOS-ocomplete_no_arrive><span class=command>lemma</span></span> ocomplete_no_arrive <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∉</span> ocnet_sos <span class=free>T</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=free>T</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span> <span class=main>≠</span> <span class=free>ii</span><span class=main>¬</span><span class=free>ni</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span>"</span></span>
     <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ocnet_sos.cases<span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_SOS-ocomplete_no_change><span class=command>lemma</span></span> ocomplete_no_change <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=free>T</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>j</span> <span class=main>∉</span> net_ips <span class=free>s</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=free>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>j</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=operator>simp_all</span>

<span class=keyword1 id=OAWN_SOS-ocomplete_transE><span class=command>lemma</span></span> ocomplete_transE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>a'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>a'</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ocompleteTEs <span class=main><span class=main>[</span></span><span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1><span class=command>abbreviation</span></span>
  <span class=entity>oclosed</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=main>(</span><span class=tfree>'m</span><span class=main>::</span>msg<span class=main>)</span> node_action<span class=main>)</span> automaton
              <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span> net_state<span class=main>,</span> <span class=tfree>'m</span> node_action<span class=main>)</span> automaton"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>oclosed</span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=bound>A</span><span class=main>.</span> <span class=bound>A</span> <span class=main>⦇</span> trans <span class=main>:=</span> ocnet_sos <span class=main>(</span>trans <span class=bound>A</span><span class=main>)</span> <span class=main>⦈</span><span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=OAWN_SOS_Labels><div class=head><h1>Theory OAWN_SOS_Labels</h1></div><pre class=source><span class=comment1>(*  Title:       OAWN_SOS_Labels.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Configure the inv-cterms tactic for open sequential processes"</span></span>

<span class=keyword1><span class=command>theory</span></span> OAWN_SOS_Labels
<span class=keyword2><span class=keyword>imports</span></span> <a href=OAWN_SOS.html>OAWN_SOS</a> <a href=Inv_Cterms.html>Inv_Cterms</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=OAWN_SOS_Labels-oelimder_guard><span class=command>lemma</span></span> oelimder_guard<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟨</span><span class=free>fg</span><span class=main>⟩</span> <span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟨</span><span class=free>fg</span><span class=main>⟩</span> <span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_SOS_Labels-oelimder_assign><span class=command>lemma</span></span> oelimder_assign<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟦</span><span class=free>fa</span><span class=main>⟧</span> <span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=main>}</span><span class=main>⟦</span><span class=free>fa</span><span class=main>⟧</span> <span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_SOS_Labels-oelimder_ucast><span class=command>lemma</span></span> oelimder_ucast<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}unicast(</span><span class=free>fip</span><span class=main>,</span> <span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>q1</span> <span class=main>▹</span> <span class=free>q2</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=free>pp'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}unicast(</span><span class=free>fip</span><span class=main>,</span> <span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>p'</span> <span class=main>▹</span> <span class=free>pp'</span>"</span></span>
                   <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>case</span> <span class=free>a</span> <span class=keyword1>of</span> unicast <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> <span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q1</span>
                                        <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> <span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>erule</span> oseqpTEs<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=OAWN_SOS_Labels-oelimder_bcast><span class=command>lemma</span></span> oelimder_bcast<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}broadcast(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}broadcast(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_SOS_Labels-oelimder_gcast><span class=command>lemma</span></span> oelimder_gcast<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}groupcast(</span><span class=free>fips</span><span class=main>,</span> <span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}groupcast(</span><span class=free>fips</span><span class=main>,</span> <span class=free>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_SOS_Labels-oelimder_send><span class=command>lemma</span></span> oelimder_send<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}send(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}send(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_SOS_Labels-oelimder_deliver><span class=command>lemma</span></span> oelimder_deliver<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}deliver(</span><span class=free>fdata</span><span class=main>)</span><span class=main>.</span><span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}deliver(</span><span class=free>fdata</span><span class=main>)</span><span class=main>.</span><span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_SOS_Labels-oelimder_receive><span class=command>lemma</span></span> oelimder_receive<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}receive(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>qq</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>{</span><span class=free>l</span><span class=keyword1>}receive(</span><span class=free>fmsg</span><span class=main>)</span><span class=main>.</span><span class=free>p'</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>qq</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> oelimders <span class=main>=</span>
   oelimder_guard
   oelimder_assign
   oelimder_ucast
   oelimder_bcast
   oelimder_gcast
   oelimder_send
   oelimder_deliver
   oelimder_receive

<span class=keyword1><span class=command>declare</span></span>
  oseqpTEs <span class=main>[</span><span class=operator>cterms_seqte</span><span class=main>]</span>
  oelimders <span class=main>[</span><span class=operator>cterms_elimders</span><span class=main>]</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=OPnet><div class=head><h1>Theory OPnet</h1></div><pre class=source><span class=comment1>(*  Title:       OPnet.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Lemmas for open partial networks"</span></span>

<span class=keyword1><span class=command>theory</span></span> OPnet
<span class=keyword2><span class=keyword>imports</span></span> <a href=OAWN_SOS.html>OAWN_SOS</a> <a href=OInvariants.html>OInvariants</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  These lemmas mostly concern the preservation of node structure by <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>opnet_sos</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> transitions.
›</span></span>

<span class=keyword1 id=OPnet-opnet_maintains_dom><span class=command>lemma</span></span> opnet_maintains_dom<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ns</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ns'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>ns</span> <span class=main>=</span> net_ips <span class=free>ns'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>σ</span></span> <span class=quoted><span class=free>ns</span></span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>σ'</span></span> <span class=quoted><span class=free>ns'</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>R</span> <span class=skolem>σ</span> <span class=skolem>ns</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>ns'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ns</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ns</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>ns</span> <span class=main>=</span> net_ips <span class=skolem>ns'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
         <span class=main>(</span><span class=operator>erule</span> onode_sos.cases<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>σ</span> <span class=skolem>ns</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>ns'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ns</span> <span class=bound>a</span> <span class=bound>σ'</span> <span class=bound>ns'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ns</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ns'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> <span class=main>⟹</span> net_ips <span class=bound>ns</span> <span class=main>=</span> net_ips <span class=bound>ns'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ns</span> <span class=bound>a</span> <span class=bound>σ'</span> <span class=bound>ns'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ns</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ns'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>⟹</span> net_ips <span class=bound>ns</span> <span class=main>=</span> net_ips <span class=bound>ns'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ns</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>ns</span> <span class=main>=</span> net_ips <span class=skolem>ns'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>erule</span> opnet_sos.cases<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OPnet-opnet_net_ips_net_tree_ips><span class=command>lemma</span></span> opnet_net_ips_net_tree_ips<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ns</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>ns</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> oreachable_pair_induct<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=skolem>σ</span></span> <span class=quoted><span class=skolem>s</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span> <span class=skolem>σ</span> <span class=skolem>s</span>
      <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span> <span class=main>⟹</span> net_ips <span class=bound>s</span> <span class=main>=</span> net_tree_ips <span class=skolem>p1</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>⋀</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span> <span class=main>⟹</span> net_ips <span class=bound>s</span> <span class=main>=</span> net_tree_ips <span class=skolem>p2</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
           <span class=main>(</span><span class=operator>metis</span> Un_commute<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>σ'</span> <span class=skolem>s'</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s'</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> net_ips_is_dom_netmap<span class=main>)</span>
         <span class=main>(</span><span class=operator>metis</span> net_ips_is_dom_netmap opnet_maintains_dom<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OPnet-opnet_net_ips_net_tree_ips_init><span class=command>lemma</span></span> opnet_net_ips_net_tree_ips_init<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ns</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>ns</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_init <span class=main><span class=main>[</span></span><span class=operator>THEN</span> opnet_net_ips_net_tree_ips<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=OPnet-opartial_net_preserves_subnets><span class=command>lemma</span></span> opartial_net_preserves_subnets<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=free>s</span> <span class=free>t</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>st'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> opnet_sos <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>s'</span> <span class=bound>t'</span><span class=main>.</span> <span class=free>st'</span> <span class=main>=</span> SubnetS <span class=bound>s'</span> <span class=bound>t'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>cases</span> <span class=operator>simp_all</span>

<span class=keyword1 id=OPnet-net_par_oreachable_is_subnet><span class=command>lemma</span></span> net_par_oreachable_is_subnet<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>st</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>s</span> <span class=bound>t</span><span class=main>.</span> <span class=free>st</span> <span class=main>=</span> SubnetS <span class=bound>s</span> <span class=bound>t</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>=</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>st</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>np</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span> <span class=bound>s</span> <span class=bound>t</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> SubnetS <span class=bound>s</span> <span class=bound>t</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>induct</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> opartial_net_preserves_subnets<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> p_def <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=ONode_Lifting><div class=head><h1>Theory ONode_Lifting</h1></div><pre class=source><span class=comment1>(*  Title:       ONode_Lifting.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Lifting rules for (open) nodes"</span></span>

<span class=keyword1><span class=command>theory</span></span> ONode_Lifting
<span class=keyword2><span class=keyword>imports</span></span> <a href=AWN.html>AWN</a> <a href=OAWN_SOS.html>OAWN_SOS</a> <a href=OInvariants.html>OInvariants</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id="ONode_Lifting-node_net_state'"><span class=command>lemma</span></span> node_net_state'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>.</span> <span class=free>s</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>.</span> <span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>σ'</span>
    <span class=keyword3><span class=command>assume</span></span> rt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> ih<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>.</span> <span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=skolem>σ'</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>  <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"snd <span class=skolem>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1-2<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_other'<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹snd <span class=skolem>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>.</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> rt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> ih<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>.</span> <span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=skolem>a</span>"</span></span>
     <span class=keyword1><span class=command>from</span></span> ih <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
     <span class=keyword1><span class=command>with</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=free>T</span><span class=main>)</span>"</span></span>
       <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
     <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ'</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span>"</span></span>
       <span class=keyword1><span class=command>using</span></span> onode_sos_dest_is_net_state' <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
     <span class=keyword1><span class=command>with</span></span> tr <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>.</span> <span class=skolem>s'</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span>"</span></span>
       <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=ONode_Lifting-node_net_state><span class=command>lemma</span></span> node_net_state<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ</span> <span class=bound>R</span><span class=main>.</span> <span class=free>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=bound>ζ</span> <span class=bound>R</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Pair_inject node_net_state'<span class=main>)</span>

<span class=keyword1 id=ONode_Lifting-node_net_state_trans><span class=command>lemma</span></span> node_net_state_trans <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> sor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>ζ<span class=hidden>⇩</span><sub>i</sub></span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>ζ<span class=hidden>⇩</span><sub>i</sub></span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>ζ</span> <span class=free>R</span> <span class=free>ζ'</span> <span class=free>R'</span>
    <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=free>ζ</span> <span class=free>R</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=free>ζ'</span> <span class=free>R'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ζ</span> <span class=bound>R</span> <span class=bound>ζ'</span> <span class=bound>R'</span><span class=main>.</span> <span class=free>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=bound>ζ</span> <span class=bound>R</span> <span class=main>⟹</span> <span class=free>s'</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=bound>ζ'</span> <span class=bound>R'</span> <span class=main>⟹</span> <span class=free>thesis</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> sor <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> node_net_state<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> str <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>s'</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
         <span class=main>(</span><span class=operator>metis</span> onode_sos_dest_is_net_state''<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=free>thesis</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="ONode_Lifting-nodemap_induct'"><span class=command>lemma</span></span> nodemap_induct' <span class=main>[</span><span class=operator>consumes</span><span class=main>,</span> <span class=operator>case_names</span> init other local<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=free>ζ</span> <span class=free>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ζ</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>.</span>
                  <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                    <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span> <span class=bound>σ'</span> <span class=bound>ζ'</span> <span class=bound>R'</span> <span class=bound>a</span><span class=main>.</span>
                  <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                    <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ'</span> <span class=bound>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span><span class=main>;</span>
                    <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ'</span> <span class=bound>R'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=free>ζ</span> <span class=free>R</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_init<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> init <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>σ'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=skolem>σ'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> sr <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> node_net_state' <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>with</span></span> sr <span class=quoted><span class=quoted>‹<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=skolem>σ'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>s</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> other<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1-3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> oreachable_local<span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ'</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> node_net_state' <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>from</span></span> sr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=skolem>s</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> A1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> A4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> node_net_state' <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>with</span></span> tr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=main>(</span>fst <span class=skolem>s'</span><span class=main>)</span> <span class=skolem>a</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> A2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> A3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command>from</span></span> A1 A2 A3 A4 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> local<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>s'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=ONode_Lifting-nodemap_induct><span class=command>lemma</span></span> nodemap_induct <span class=main>[</span><span class=operator>consumes</span><span class=main>,</span> <span class=operator>case_names</span> init step<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=free>ζ</span> <span class=free>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ζ</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>ζ</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>.</span>
                  <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                    <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>;</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ'</span> <span class=bound>ζ</span> <span class=bound>R</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span> <span class=bound>σ'</span> <span class=bound>ζ'</span> <span class=bound>R'</span> <span class=bound>a</span><span class=main>.</span>
                  <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                    <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ'</span> <span class=bound>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span><span class=main>;</span>
                    <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>;</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ'</span> <span class=bound>ζ'</span> <span class=bound>R'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>σ</span> <span class=free>ζ</span> <span class=free>R</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=free>ζ</span> <span class=free>R</span><span class=main>)</span>"</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>σ</span></span> <span class=quoted><span class=free>ζ</span></span> <span class=quoted><span class=free>R</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>ζ</span> <span class=skolem>R</span>
    <span class=keyword3><span class=command>assume</span></span> a1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>R</span> <span class=main>=</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> init_onode_comp<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> a1 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> init <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>R</span> <span class=main>=</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>st</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>st</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=main>(</span>fst <span class=skolem>st</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>.</span> <span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>"</span></span>
                                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> node_net_state'<span class=main>)</span>
    <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=main>(</span>fst <span class=skolem>st</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>a</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> IH <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> local<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>st</span> <span class=skolem>σ'</span> <span class=skolem>ζ</span> <span class=skolem>R</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>st</span><span class=main>)</span> <span class=skolem>σ'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"snd <span class=skolem>st</span> <span class=main>=</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>.</span> <span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=bound>ζ</span> <span class=bound>R</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>R</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>,</span>3<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>"</span></span>
                              <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> surjective_pairing<span class=main>)</span>
    <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>st</span><span class=main>)</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> IH <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=ONode_Lifting-node_addressD><span class=command>lemma</span></span> node_addressD <span class=main>[</span><span class=operator>dest</span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>ζ</span> <span class=free>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>=</span> <span class=free>ii</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> node_net_state'<span class=main>)</span>

<span class=keyword1 id=ONode_Lifting-node_proc_reachable><span class=command>lemma</span></span> node_proc_reachable <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>ζ</span> <span class=free>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>
                                         <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sgivesu<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>ξ'</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ'</span> <span class=main>⟹</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>T</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=free>ζ</span> <span class=free>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>
                                             <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>frule</span> node_addressD<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> nodemap_induct<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>ζ</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>T</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>T</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_init<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>ζ</span> <span class=skolem>R</span> <span class=skolem>σ'</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span> <span class=skolem>a</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>T</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>T</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> oreachable_other'<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>ζ</span> <span class=skolem>R</span> <span class=skolem>σ'</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span> <span class=skolem>a</span>
      <span class=keyword3><span class=command>assume</span></span> rs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>
                                         <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ow<span class=main>:</span> <span class=quoted><span class=quoted>"otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ih<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>T</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>

      <span class=keyword1><span class=command>from</span></span> ow <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>ii</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>ii</span> <span class=main>⟹</span> other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithE<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> otherI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> sgivesu<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>ii</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=free>T</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>T</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
        <span class=keyword3><span class=command>case</span></span> onode_bcast
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> ow <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_local' otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_gcast
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> ow <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_local' otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_ucast
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> ow <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_local' otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_notucast
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> ow <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_local' otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_deliver
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> ow <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_local' otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_tau
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> ow <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_local' otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_receive
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> ow <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_local' otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>onode_arrive <span class=skolem>m</span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>ii</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>ii</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_connect1
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>ii</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>ii</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_connect2
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>ii</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>ii</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_connect_other
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>ii</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>ii</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_disconnect1
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>ii</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>ii</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_disconnect2
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>ii</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>ii</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> onode_disconnect_other
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>ii</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>ii</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> ih <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ζ'</span> <span class=main>=</span> <span class=skolem>ζ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=ONode_Lifting-node_proc_reachable_statelessassm><span class=command>lemma</span></span> node_proc_reachable_statelessassm <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=free>ζ</span> <span class=free>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>
                                         <span class=main>(</span>otherwith <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>)</span>
                                         <span class=main>(</span>other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>T</span>
                               <span class=main>(</span>otherwith <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> node_proc_reachable<span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1 id=ONode_Lifting-node_lift><span class=command>lemma</span></span> node_lift<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>T</span> <span class=main>⊨</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>→)</span> global <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>ξ'</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ'</span> <span class=main>⟹</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=main>⊨</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>→)</span> global <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> oinvariant_oreachableI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>ζ</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ζ</span> <span class=main>=</span> NodeS <span class=skolem>i</span> <span class=skolem>s</span> <span class=skolem>R</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> node_net_state<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=skolem>i</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>ii</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>
                                                   <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>T</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>ii</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span> node_proc_reachable<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"global <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> fst_conv globalsimp oinvariantD<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=ONode_Lifting-node_lift_step><span class=command>lemma</span></span> node_lift_step <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> pinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>T</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=free>Q</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span><span class=main>.</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>σ</span> <span class=bound>σ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sgivesu<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>ξ'</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ'</span> <span class=main>⟹</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                            globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=free>Q</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>)</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=var>?S</span><span class=main>,</span> <span class=var>?U</span> <span class=main>→)</span> <span class=main>_</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> rs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=var>?S</span> <span class=var>?U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> ow<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> ow <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span> <span class=main>⟹</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithE<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> otherI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> sgivesu<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> rs tr <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=var>?S</span> <span class=var>?U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> node_net_state<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> or<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>T</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=var>?U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> node_proc_reachable <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=free>T</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span> <span class=skolem>ζ'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> broadcast <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>T</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=var>?S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>(</span>broadcast <span class=skolem>m</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> or tr' <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> pinv<span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>D</span> <span class=skolem>m</span> <span class=skolem>ζ'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>R</span> <span class=main>∩</span> <span class=skolem>D</span><span class=main>)</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> groupcast <span class=skolem>D</span> <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>T</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=var>?S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>(</span>groupcast <span class=skolem>D</span> <span class=skolem>m</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> or tr' <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> pinv<span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>d</span> <span class=skolem>m</span> <span class=skolem>ζ'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>d</span><span class=main>}</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> unicast <span class=skolem>d</span> <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>T</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=var>?S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>(</span>unicast <span class=skolem>d</span> <span class=skolem>m</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> or tr' <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> pinv<span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>d</span> <span class=skolem>ζ'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>¬unicast</span> <span class=skolem>d</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>T</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=var>?S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>(</span><span class=keyword1>¬unicast</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> or tr' <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> pinv<span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>d</span> <span class=skolem>ζ'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=skolem>d</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> deliver <span class=skolem>d</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>T</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=var>?S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>(</span>deliver <span class=skolem>d</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> or tr' <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> pinv<span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ζ'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>T</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=var>?S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=keyword1>τ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> or tr' <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> pinv<span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span> <span class=skolem>ζ'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>¬</span><span class=main>{}</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> receive <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>T</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=var>?S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>(</span>receive <span class=skolem>m</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithE<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> or tr' <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> pinv<span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>{}</span><span class=main>¬</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>connect(</span><span class=skolem>i'</span><span class=main>,</span> <span class=free>i</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i'</span> <span class=skolem>i''</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>connect(</span><span class=skolem>i'</span><span class=main>,</span> <span class=skolem>i''</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>disconnect(</span><span class=skolem>i'</span><span class=main>,</span> <span class=free>i</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i'</span> <span class=skolem>i''</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>disconnect(</span><span class=skolem>i'</span><span class=main>,</span> <span class=skolem>i''</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> *<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=ONode_Lifting-node_lift_step_statelessassm><span class=command>lemma</span></span> node_lift_step_statelessassm <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>T</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                       globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=free>Q</span> <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>Q</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                            globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=free>Q</span> <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>T</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                  globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=free>Q</span> <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>,</span>
                                          other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                                         globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=free>Q</span> <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> node_lift_step<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=ONode_Lifting-node_lift_anycast><span class=command>lemma</span></span> node_lift_anycast <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> pinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>T</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                       globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> anycast <span class=main>(</span><span class=free>Q</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>ξ'</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ'</span> <span class=main>⟹</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                            globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span><span class=free>Q</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=var>?S</span><span class=main>,</span> <span class=var>?U</span> <span class=main>→)</span> <span class=main>_</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> rs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=var>?S</span> <span class=var>?U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1-2<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=var>?S</span> <span class=var>?U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> node_net_state<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>T</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=var>?U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> node_proc_reachable <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=free>T</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"castmsg <span class=main>(</span><span class=free>Q</span> <span class=skolem>σ</span> <span class=skolem>σ'</span><span class=main>)</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=var>?S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span> onode_sos.cases<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithE <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> pinv<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=ONode_Lifting-node_lift_anycast_statelessassm><span class=command>lemma</span></span> node_lift_anycast_statelessassm <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> pinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>T</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                       globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> anycast <span class=main>(</span><span class=free>Q</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                            globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span><span class=free>Q</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=var>?S</span><span class=main>,</span> <span class=main>_</span> <span class=main>→)</span> <span class=main>_</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>T</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>I</span><span class=main>)</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                  globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> anycast <span class=main>(</span><span class=free>Q</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>T</span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                            globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span><span class=free>Q</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> node_lift_anycast<span class=main>)</span> <span class=operator>simp_all</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=ONode_Lifting-node_local_deliver><span class=command>lemma</span></span> node_local_deliver<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>ζ<span class=hidden>⇩</span><sub>i</sub></span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>∀</span><span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>j</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>ζ<span class=hidden>⇩</span><sub>i</sub></span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>ζ<span class=hidden>⇩</span><sub>i</sub></span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> 1 2 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>∀</span><span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> <span class=bound>j</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>a</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=ONode_Lifting-node_tau_deliver_unchanged><span class=command>lemma</span></span> node_tau_deliver_unchanged<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>ζ<span class=hidden>⇩</span><sub>i</sub></span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span>
                                                     <span class=main>⟶</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantI<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> globalasimp snd_conv fst_conv<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>s'</span> <span class=skolem>j</span>
    <span class=keyword3><span class=command>assume</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>ζ<span class=hidden>⇩</span><sub>i</sub></span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> <span class=free>ζ<span class=hidden>⇩</span><sub>i</sub></span> <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span> <span class=main>≠</span> <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> 1 2 <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>ζ</span> <span class=skolem>R</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> NodeS <span class=free>i</span> <span class=skolem>ζ'</span> <span class=skolem>R'</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=skolem>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=skolem>j</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>a</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> step_node_tau <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=OPnet_Lifting><div class=head><h1>Theory OPnet_Lifting</h1></div><pre class=source><span class=comment1>(*  Title:       OPnet_Lifting.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Lifting rules for (open) partial networks"</span></span>

<span class=keyword1><span class=command>theory</span></span> OPnet_Lifting
<span class=keyword2><span class=keyword>imports</span></span> <a href=ONode_Lifting.html>ONode_Lifting</a> <a href=OAWN_SOS.html>OAWN_SOS</a> <a href=OPnet.html>OPnet</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=OPnet_Lifting-oreachable_par_subnet_induct><span class=command>lemma</span></span> oreachable_par_subnet_induct <span class=main>[</span><span class=operator>consumes</span><span class=main>,</span> <span class=operator>case_names</span> init other local<span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=free>s</span> <span class=free>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>s</span> <span class=bound>t</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> SubnetS <span class=bound>s</span> <span class=bound>t</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>s</span> <span class=bound>t</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>s</span> <span class=bound>t</span> <span class=bound>σ'</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> SubnetS <span class=bound>s</span> <span class=bound>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                                <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>;</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>s</span> <span class=bound>t</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ'</span> <span class=bound>s</span> <span class=bound>t</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>s</span> <span class=bound>t</span> <span class=bound>σ'</span> <span class=bound>s'</span> <span class=bound>t'</span> <span class=bound>a</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> SubnetS <span class=bound>s</span> <span class=bound>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                    <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> SubnetS <span class=bound>s</span> <span class=bound>t</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> SubnetS <span class=bound>s'</span> <span class=bound>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
                    <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>;</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>s</span> <span class=bound>t</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ'</span> <span class=bound>s'</span> <span class=bound>t'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>σ</span> <span class=free>s</span> <span class=free>t</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=free>s</span> <span class=free>t</span><span class=main>)</span>"</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>t</span></span> <span class=quoted><span class=free>σ</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>t</span> <span class=skolem>σ</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> init <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>t</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>st</span> <span class=skolem>a</span> <span class=skolem>s'</span> <span class=skolem>t'</span> <span class=skolem>σ'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>st</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=main>(</span>fst <span class=skolem>st</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>t</span> <span class=bound>σ</span><span class=main>.</span> <span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> SubnetS <span class=bound>s</span> <span class=bound>t</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>s</span> <span class=bound>t</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>t</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span>"</span></span>
                                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_par_oreachable_is_subnet prod.collapse<span class=main>)</span>
    <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=main>(</span>fst <span class=skolem>st</span><span class=main>)</span> <span class=main>(</span>fst <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>a</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> IH <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>t</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span> <span class=skolem>s'</span> <span class=skolem>t'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> local<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>st</span> <span class=skolem>σ'</span> <span class=skolem>s</span> <span class=skolem>t</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>st</span><span class=main>)</span> <span class=skolem>σ'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"snd <span class=skolem>st</span> <span class=main>=</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>t</span> <span class=bound>σ</span><span class=main>.</span> <span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> SubnetS <span class=bound>s</span> <span class=bound>t</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>s</span> <span class=bound>t</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>,</span>3<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span>"</span></span>
                              <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> prod.collapse<span class=main>)</span>
    <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>U</span> <span class=main>(</span>fst <span class=skolem>st</span><span class=main>)</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> IH <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>t</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span> <span class=skolem>s</span> <span class=skolem>t</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OPnet_Lifting-other_net_tree_ips_par_left><span class=command>lemma</span></span> other_net_tree_ips_par_left<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> ineq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>i</span>"</span></span>
                     <span class=keyword2><span class=keyword>and</span></span> outU<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>⟶</span> <span class=free>U</span> <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> otherI<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> ineq <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=skolem>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=skolem>i</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>j</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span><span class=free>σ</span> <span class=skolem>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=skolem>j</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span><span class=main>∈</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>with</span></span> ineq <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=skolem>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=skolem>j</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span><span class=free>σ</span> <span class=skolem>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=skolem>j</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule</span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>j</span><span class=main>∉</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>with</span></span> outU <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span><span class=free>σ</span> <span class=skolem>j</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span> <span class=skolem>j</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OPnet_Lifting-other_net_tree_ips_par_right><span class=command>lemma</span></span> other_net_tree_ips_par_right<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> net_tree_ips_commute<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other_net_tree_ips_par_left<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OPnet_Lifting-ostep_arrive_invariantD><span class=command>lemma</span></span> ostep_arrive_invariantD <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>p</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=free>IPS</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>)</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"oarrivemsg <span class=free>I</span> <span class=free>σ</span> <span class=free>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>p</span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span> <span class=bound>a</span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span> <span class=bound>a</span><span class=main>)</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_weakenE<span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3-4<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OPnet_Lifting-opnet_sync_action_subnet_oreachable><span class=command>lemma</span></span> opnet_sync_action_subnet_oreachable<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=free>s</span> <span class=free>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>
                                         <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>∈</span> oreachable <span class=main>_</span> <span class=main>(</span><span class=var>?S</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>)</span>

      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>

      <span class=keyword2><span class=keyword>and</span></span> act1<span class=main>:</span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>→)</span>
                   globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span><span class=free>I</span> <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span>
                                          <span class=main>∧</span> <span class=main>(</span><span class=bound>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span>
                                                 <span class=main>(</span><span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>
                                               <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

      <span class=keyword2><span class=keyword>and</span></span> act2<span class=main>:</span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>→)</span>
                   globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span><span class=free>I</span> <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span>
                                          <span class=main>∧</span> <span class=main>(</span><span class=bound>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span>
                                                 <span class=main>(</span><span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>
                                               <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span>
           <span class=main>∧</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>
           <span class=main>∧</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> oreachable_par_subnet_induct<span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>init <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> sinit<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> tinit<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>∩</span> net_ips <span class=skolem>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sinit <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> opnet_net_ips_net_tree_ips_init<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tinit <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>t</span> <span class=main>=</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> opnet_net_ips_net_tree_ips_init<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> oreachable_init<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>other <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>t</span> <span class=skolem>σ'</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> IHs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> IHt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=var>?U</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other_net_tree_ips_par_left<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> IHs <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_other'<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>

    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=var>?U</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other_net_tree_ips_par_right<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> IHt <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_other'<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>

    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>local <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>t</span> <span class=skolem>σ'</span> <span class=skolem>s'</span> <span class=skolem>t'</span> <span class=skolem>a</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> stor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"oarrivemsg <span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> tor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>∈</span> opnet_sos <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>
         <span class=main>∧</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=skolem>K</span> <span class=skolem>m</span> <span class=skolem>H'</span> <span class=skolem>K'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>H</span> <span class=main>∪</span> <span class=skolem>H'</span><span class=main>)</span><span class=main>¬</span><span class=main>(</span><span class=skolem>K</span> <span class=main>∪</span> <span class=skolem>K'</span><span class=main>)</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H'</span><span class=main>¬</span><span class=skolem>K'</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹oarrivemsg <span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

      <span class=keyword1><span class=command>with</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>›</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>R</span> <span class=skolem>m</span> <span class=skolem>H</span> <span class=skolem>K</span>
      <span class=keyword3><span class=command>assume</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>                                    
      <span class=keyword1><span class=command>from</span></span> sor str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>›</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>R</span> <span class=skolem>m</span> <span class=skolem>H</span> <span class=skolem>K</span>
      <span class=keyword3><span class=command>assume</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>                                    
      <span class=keyword1><span class=command>from</span></span> tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>›</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>i'</span>
      <span class=keyword3><span class=command>assume</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>i'</span>
      <span class=keyword3><span class=command>assume</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>d</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>=</span> <span class=skolem>t</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=skolem>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>

      <span class=keyword1><span class=command>from</span></span> sor str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sor str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> tor <span class=quoted><span class=quoted>‹<span class=skolem>t'</span> <span class=main>=</span> <span class=skolem>t</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_other'<span class=main>)</span>
                              <span class=main>(</span><span class=operator>metis</span> otherI <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> conjI <span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>d</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=skolem>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>

      <span class=keyword1><span class=command>from</span></span> tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> sor <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_other'<span class=main>)</span>
                              <span class=main>(</span><span class=operator>metis</span> otherI <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>=</span> <span class=skolem>t</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>

      <span class=keyword1><span class=command>from</span></span> sor str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sor str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> tor <span class=quoted><span class=quoted>‹<span class=skolem>t'</span> <span class=main>=</span> <span class=skolem>t</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_other'<span class=main>)</span>
                              <span class=main>(</span><span class=operator>metis</span> otherI <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> conjI <span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>

      <span class=keyword1><span class=command>from</span></span> tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> sor <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_other'<span class=main>)</span>
                              <span class=main>(</span><span class=operator>metis</span> otherI <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  `Splitting' reachability is trivial when there are no assumptions on interleavings, but
  this is useless for showing non-trivial properties, since the interleaving steps can do
  anything at all. This lemma is too weak.
›</span></span>

<span class=keyword1 id=OPnet_Lifting-subnet_oreachable_true_true><span class=command>lemma</span></span> subnet_oreachable_true_true<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=free>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span>"</span></span>
          <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∧</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> oreachable_par_subnet_induct<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∧</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> oreachable_init<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>local <span class=skolem>σ</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub></span> <span class=skolem>σ'</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=skolem>a</span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> sr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> sr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>4<span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>)</span>
                <span class=main>∈</span> opnet_sos <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∧</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>R</span> <span class=skolem>m</span> <span class=skolem>H</span> <span class=skolem>K</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> tr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>,</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> tr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> sr1 <span class=keyword2><span class=keyword>and</span></span> tr1 <span class=keyword2><span class=keyword>and</span></span> TrueI <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_local'<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sr2 <span class=keyword2><span class=keyword>and</span></span> tr2 <span class=keyword2><span class=keyword>and</span></span> TrueI <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_local'<span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=main>=</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> tr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> sr2 <span class=keyword2><span class=keyword>and</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> TrueI<span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_other'<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sr1 <span class=keyword2><span class=keyword>and</span></span> tr1 <span class=keyword2><span class=keyword>and</span></span> TrueI <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_local'<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> sr1 sr2<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> oreachable_local'
                                                       oreachable_other'<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
         <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  It may also be tempting to try splitting from the assumption
  <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=free><span class=free>σ</span></span><span class=main><span class=main>,</span></span> SubnetS <span class=free><span class=free>s<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=free><span class=free>s<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>∈</span></span> oreachable <span class=main><span class=main>(</span></span>opnet <span class=free><span class=free>onp</span></span> <span class=main><span class=main>(</span></span><span class=free><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=main><span class=main>∥</span></span> <span class=free><span class=free>p<span class=hidden>⇩</span><sub>2</sub></span></span><span class=main><span class=main>)</span></span><span class=main><span class=main>)</span></span> <span class=main><span class=main>(</span></span><span class=main><span class=main>λ</span></span><span class=main><span class=bound><span class=main><span class=bound>_</span></span></span></span> <span class=main><span class=bound><span class=main><span class=bound>_</span></span></span></span> <span class=main><span class=bound><span class=main><span class=bound>_</span></span></span></span><span class=main><span class=main>.</span></span> True<span class=main><span class=main>)</span></span> <span class=main><span class=main>(</span></span><span class=main><span class=main>λ</span></span><span class=main><span class=bound><span class=main><span class=bound>_</span></span></span></span> <span class=main><span class=bound><span class=main><span class=bound>_</span></span></span></span><span class=main><span class=main>.</span></span> False<span class=main><span class=main>)</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>,
  where the environment step would be trivially true (since the assumption is false), but the
  lemma cannot be shown when only one side acts, since it must guarantee the assumption for
  the other side.
›</span></span>

<span class=keyword1 id=OPnet_Lifting-lift_opnet_sync_action><span class=command>lemma</span></span> lift_opnet_sync_action<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> act1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>R</span><span class=main>.</span> <span class=main>⟨</span><span class=bound>i</span> <span class=main>:</span> <span class=free>onp</span> <span class=bound>i</span> <span class=main>:</span> <span class=bound>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=bound>i</span><span class=main>}</span> <span class=main>→)</span>
                      globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span><span class=free>I</span> <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> act2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>R</span><span class=main>.</span> <span class=main>⟨</span><span class=bound>i</span> <span class=main>:</span> <span class=free>onp</span> <span class=bound>i</span> <span class=main>:</span> <span class=bound>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=bound>i</span><span class=main>}</span> <span class=main>→)</span>
                      globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>a</span> <span class=main>≠</span> <span class=keyword1>τ</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> act3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>R</span><span class=main>.</span> <span class=main>⟨</span><span class=bound>i</span> <span class=main>:</span> <span class=free>onp</span> <span class=bound>i</span> <span class=main>:</span> <span class=bound>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=bound>i</span><span class=main>}</span> <span class=main>→)</span>
                      globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=free>p</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> <span class=main>→)</span>
                       globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span><span class=free>I</span> <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span>
                                              <span class=main>∧</span> <span class=main>(</span><span class=bound>a</span> <span class=main>≠</span> <span class=keyword1>τ</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span>
                                                     <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>p</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                              <span class=main>∧</span> <span class=main>(</span><span class=bound>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span>
                                                     <span class=main>(</span><span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>p</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>
                                                   <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span><span class=main>∉</span>net_tree_ips <span class=free>p</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=free>p</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=var>?I</span><span class=main>,</span> <span class=var>?U</span> <span class=free>p</span> <span class=main>→)</span> <span class=var>?inv</span> <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>R</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=main>⟨</span><span class=skolem>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=var>?I</span><span class=main>,</span> <span class=var>?U</span> <span class=main>⟨</span><span class=skolem>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span> <span class=main>→)</span> <span class=var>?inv</span> <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> opnet.simps net_tree_ips.simps<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>s'</span>
      <span class=keyword3><span class=command>assume</span></span> sor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=main>⟨</span><span class=skolem>i</span> <span class=main>:</span> <span class=free>onp</span> <span class=skolem>i</span> <span class=main>:</span> <span class=skolem>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=skolem>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=main>⟨</span><span class=skolem>i</span> <span class=main>:</span> <span class=free>onp</span> <span class=skolem>i</span> <span class=main>:</span> <span class=skolem>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> oam<span class=main>:</span> <span class=quoted><span class=quoted>"oarrivemsg <span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>a</span>"</span></span>             
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"castmsg <span class=main>(</span><span class=free>I</span> <span class=skolem>σ</span><span class=main>)</span> <span class=skolem>a</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act1<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sor str oam <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=keyword1>τ</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act2<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>from</span></span> sor str oam <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>=</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act3<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sor str oam <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>∀</span><span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> <span class=bound>j</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> node_local_deliver<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span> <span class=operator>metis</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sor str oam <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>∀</span><span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> <span class=bound>j</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> node_local_deliver<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sor str oam <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> node_tau_deliver_unchanged<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?inv</span> <span class=main>{</span><span class=skolem>i</span><span class=main>}</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=keyword3><span class=command>assume</span></span> inv1<span class=main>:</span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=var>?I</span><span class=main>,</span> <span class=var>?U</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>→)</span> <span class=var>?inv</span> <span class=main>(</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> inv2<span class=main>:</span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=var>?I</span><span class=main>,</span> <span class=var>?U</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>→)</span> <span class=var>?inv</span> <span class=main>(</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=var>?I</span><span class=main>,</span> <span class=var>?U</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>→)</span> <span class=var>?inv</span> <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantI<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>st</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>st'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>st</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=var>?I</span> <span class=main>(</span><span class=var>?U</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>st</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>st'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"oarrivemsg <span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>t</span></span>
        <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st</span> <span class=main>=</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=var>?I</span> <span class=main>(</span><span class=var>?U</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>frule</span> net_par_oreachable_is_subnet<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span><span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> inv1 <span class=keyword2><span class=keyword>and</span></span> inv2
        <span class=keyword3><span class=command>obtain</span></span> sor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=var>?I</span> <span class=main>(</span><span class=var>?U</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> tor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=var>?I</span> <span class=main>(</span><span class=var>?U</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span> opnet_sync_action_subnet_oreachable <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> * <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>st</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>st'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>st</span> <span class=main>=</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span>›</span></span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s'</span></span> <span class=skolem><span class=skolem>t'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>st'</span> <span class=main>=</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span>"</span></span>
                       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span>
                              <span class=main>∈</span> opnet_sos <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span> <span class=main>(</span><span class=operator>frule</span> opartial_net_preserves_subnets<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span><span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span><span class=quoted><span class=quoted>"castmsg <span class=main>(</span><span class=free>I</span> <span class=skolem>σ</span><span class=main>)</span> <span class=skolem>a</span>
             <span class=main>∧</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>≠</span> <span class=keyword1>τ</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
             <span class=main>∧</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>
                                                  <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span> <span class=main>∉</span> net_tree_ips <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>R</span> <span class=skolem>m</span> <span class=skolem>H</span> <span class=skolem>K</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span>"</span></span> 
           <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> sor <span class=keyword2><span class=keyword>and</span></span> str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv1<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> tor <span class=keyword2><span class=keyword>and</span></span> ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv2<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>R</span> <span class=skolem>m</span> <span class=skolem>H</span> <span class=skolem>K</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span>"</span></span> 
           <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> tor <span class=keyword2><span class=keyword>and</span></span> ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv2<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> sor <span class=keyword2><span class=keyword>and</span></span> str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv1<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=skolem>K</span> <span class=skolem>m</span> <span class=skolem>H'</span> <span class=skolem>K'</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>H</span> <span class=main>∪</span> <span class=skolem>H'</span><span class=main>)</span><span class=main>¬</span><span class=main>(</span><span class=skolem>K</span> <span class=main>∪</span> <span class=skolem>K'</span><span class=main>)</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H'</span><span class=main>¬</span><span class=skolem>K'</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹oarrivemsg <span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>with</span></span> sor <span class=keyword2><span class=keyword>and</span></span> str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv1<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor <span class=keyword2><span class=keyword>and</span></span> ttr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv2<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>H</span> <span class=main>∪</span> <span class=skolem>H'</span><span class=main>)</span><span class=main>¬</span><span class=main>(</span><span class=skolem>K</span> <span class=main>∪</span> <span class=skolem>K'</span><span class=main>)</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>d</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=skolem>d</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=skolem>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> sor <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>
                       <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span><span class=main>∉</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv1<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=skolem>d</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>d</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=skolem>d</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=skolem>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> tor <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>
                       <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span><span class=main>∉</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv2<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=skolem>d</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> sor <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>
                       <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span><span class=main>∉</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv1<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> tor <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>
                       <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span><span class=main>∉</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv2<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>i'</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>connect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> sor <span class=keyword2><span class=keyword>and</span></span> str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv1<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor <span class=keyword2><span class=keyword>and</span></span> ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv2<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>connect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>i'</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>disconnect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> sor <span class=keyword2><span class=keyword>and</span></span> str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv1<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor <span class=keyword2><span class=keyword>and</span></span> ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv2<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>disconnect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?inv</span> <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>st</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>st'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>theorem</span></span> subnet_oreachable<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=free>s</span> <span class=free>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>
                                <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>)</span>
                                <span class=main>(</span>other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>∈</span> oreachable <span class=main>_</span> <span class=main>(</span><span class=var>?S</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>)</span>

      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>

      <span class=keyword2><span class=keyword>and</span></span> node1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>R</span><span class=main>.</span> <span class=main>⟨</span><span class=bound>i</span> <span class=main>:</span> <span class=free>onp</span> <span class=bound>i</span> <span class=main>:</span> <span class=bound>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=bound>i</span><span class=main>}</span> <span class=main>→)</span>
                      globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span><span class=free>I</span> <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> node2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>R</span><span class=main>.</span> <span class=main>⟨</span><span class=bound>i</span> <span class=main>:</span> <span class=free>onp</span> <span class=bound>i</span> <span class=main>:</span> <span class=bound>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=bound>i</span><span class=main>}</span> <span class=main>→)</span>
                      globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>a</span> <span class=main>≠</span> <span class=keyword1>τ</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> node3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>R</span><span class=main>.</span> <span class=main>⟨</span><span class=bound>i</span> <span class=main>:</span> <span class=free>onp</span> <span class=bound>i</span> <span class=main>:</span> <span class=bound>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=bound>i</span><span class=main>}</span> <span class=main>→)</span>
                      globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>
                               <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>(</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>)</span>
                               <span class=main>(</span>other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span>
           <span class=main>∧</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>
                                  <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>(</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>)</span>
                                  <span class=main>(</span>other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>
           <span class=main>∧</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> oreachable_par_subnet_induct<span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>init <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> sinit<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> tinit<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>∩</span> net_ips <span class=skolem>t</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sinit <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> opnet_net_ips_net_tree_ips_init<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tinit <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>t</span> <span class=main>=</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> opnet_net_ips_net_tree_ips_init<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> oreachable_init<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>other <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>t</span> <span class=skolem>σ'</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> IHs<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> IHt<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=var>?U</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other_net_tree_ips_par_left<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> IHs <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_other'<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>

    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=var>?U</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other_net_tree_ips_par_right<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> IHt <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_other'<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>

    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>local <span class=skolem>σ</span> <span class=skolem>s</span> <span class=skolem>t</span> <span class=skolem>σ'</span> <span class=skolem>s'</span> <span class=skolem>t'</span> <span class=skolem>a</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> stor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> tor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword1><span class=command>have</span></span> act<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span><span class=main>.</span> opnet <span class=free>onp</span> <span class=bound>p</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=bound>p</span><span class=main>)</span> <span class=main>→)</span>
                 globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span><span class=free>I</span> <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span>
                                        <span class=main>∧</span> <span class=main>(</span><span class=bound>a</span> <span class=main>≠</span> <span class=keyword1>τ</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span>
                                               <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=bound>p</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                        <span class=main>∧</span> <span class=main>(</span><span class=bound>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>i</span> <span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span>
                                               <span class=main>(</span><span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=bound>p</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span>
                                             <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=bound>i</span><span class=main>∉</span>net_tree_ips <span class=bound>p</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> lift_opnet_sync_action <span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>3-6<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=var>?S</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
                                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"oarrivemsg <span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithE<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=skolem>s'</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>∈</span> opnet_sos <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>
         <span class=main>∧</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=skolem>K</span> <span class=skolem>m</span> <span class=skolem>H'</span> <span class=skolem>K'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>H</span> <span class=main>∪</span> <span class=skolem>H'</span><span class=main>)</span><span class=main>¬</span><span class=main>(</span><span class=skolem>K</span> <span class=main>∪</span> <span class=skolem>K'</span><span class=main>)</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H'</span><span class=main>¬</span><span class=skolem>K'</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=var>?S</span> <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>with</span></span> sor str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>›</span></span> tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>›</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>›</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>R</span> <span class=skolem>m</span> <span class=skolem>H</span> <span class=skolem>K</span>
      <span class=keyword3><span class=command>assume</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>                                    
      <span class=keyword1><span class=command>from</span></span> sor str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> sor str tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>›</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>›</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>R</span> <span class=skolem>m</span> <span class=skolem>H</span> <span class=skolem>K</span>
      <span class=keyword3><span class=command>assume</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>                                    
      <span class=keyword1><span class=command>from</span></span> tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> sor str tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>›</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>σ</span> <span class=skolem>m</span>›</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>i'</span>
      <span class=keyword3><span class=command>assume</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> sor tor <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>›</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>i'</span>
      <span class=keyword3><span class=command>assume</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=skolem>i</span><span class=main>,</span> <span class=skolem>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> sor tor <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=main>(</span><span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fastforce</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>i</span><span class=main>)</span>›</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>d</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>=</span> <span class=skolem>t</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=skolem>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> sor str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sor str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> tor <span class=quoted><span class=quoted>‹<span class=skolem>t'</span> <span class=main>=</span> <span class=skolem>t</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_other'<span class=main>)</span>
             <span class=main>(</span><span class=operator>metis</span> otherI <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>d</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=skolem>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> sor <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_other'<span class=main>)</span>
             <span class=main>(</span><span class=operator>metis</span> otherI <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> ttr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> tor ttr
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor ttr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> sor <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_other'<span class=main>)</span>
             <span class=main>(</span><span class=operator>metis</span> otherI <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>t'</span> <span class=main>=</span> <span class=skolem>t</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> str<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> sor str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> sor str
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>t'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?S</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> sor str <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span>net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> ostep_arrive_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> act<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> tor <span class=quoted><span class=quoted>‹<span class=skolem>t'</span> <span class=main>=</span> <span class=skolem>t</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_other'<span class=main>)</span>
             <span class=main>(</span><span class=operator>metis</span> otherI <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∩</span> net_tree_ips <span class=free>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemmas</span></span> subnet_oreachable1 <span class=main>[</span><span class=operator>dest</span><span class=main>]</span> <span class=main>=</span> subnet_oreachable <span class=main>[</span><span class=operator>THEN</span> conjunct1<span class=main>,</span> <span class=operator>rotated</span> 1<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> subnet_oreachable2 <span class=main>[</span><span class=operator>dest</span><span class=main>]</span> <span class=main>=</span> subnet_oreachable <span class=main>[</span><span class=operator>THEN</span> conjunct2<span class=main>,</span> <span class=operator>THEN</span> conjunct1<span class=main>,</span> <span class=operator>rotated</span> 1<span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> subnet_oreachable_disjoint <span class=main>[</span><span class=operator>dest</span><span class=main>]</span> <span class=main>=</span> subnet_oreachable
                                                    <span class=main>[</span><span class=operator>THEN</span> conjunct2<span class=main>,</span> <span class=operator>THEN</span> conjunct2<span class=main>,</span> <span class=operator>rotated</span> 1<span class=main>]</span>

<span class=keyword1><span class=command>corollary</span></span> pnet_lift<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ii</span> <span class=bound>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>.</span> <span class=main>⟨</span><span class=bound>ii</span> <span class=main>:</span> <span class=free>onp</span> <span class=bound>ii</span> <span class=main>:</span> <span class=bound>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span>
              <span class=main>⊨</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=bound>ii</span><span class=main>}</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=bound>ii</span><span class=main>}</span> <span class=main>→)</span> global <span class=main>(</span><span class=free>P</span> <span class=bound>ii</span><span class=main>)</span>"</span></span>

      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>

      <span class=keyword2><span class=keyword>and</span></span> node1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>R</span><span class=main>.</span> <span class=main>⟨</span><span class=bound>i</span> <span class=main>:</span> <span class=free>onp</span> <span class=bound>i</span> <span class=main>:</span> <span class=bound>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=bound>i</span><span class=main>}</span> <span class=main>→)</span>
                      globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span><span class=free>I</span> <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> node2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>R</span><span class=main>.</span> <span class=main>⟨</span><span class=bound>i</span> <span class=main>:</span> <span class=free>onp</span> <span class=bound>i</span> <span class=main>:</span> <span class=bound>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=bound>i</span><span class=main>}</span> <span class=main>→)</span>
                      globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>a</span> <span class=main>≠</span> <span class=keyword1>τ</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> node3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span> <span class=bound>R</span><span class=main>.</span> <span class=main>⟨</span><span class=bound>i</span> <span class=main>:</span> <span class=free>onp</span> <span class=bound>i</span> <span class=main>:</span> <span class=bound>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=free>I</span> <span class=bound>σ</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=bound>i</span><span class=main>}</span> <span class=main>→)</span>
                      globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> <span class=bound>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=free>p</span> <span class=main>⊨</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> <span class=main>(</span>oarrivemsg <span class=free>I</span><span class=main>)</span><span class=main>,</span>
                       other <span class=free>U</span> <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> <span class=main>→)</span> global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>p</span><span class=main>.</span> <span class=free>P</span> <span class=bound>i</span> <span class=bound>σ</span><span class=main>)</span>"</span></span>
      <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>⊨</span> <span class=main>(</span><span class=var>?owS</span> <span class=free>p</span><span class=main>,</span> <span class=var>?U</span> <span class=free>p</span> <span class=main>→)</span> <span class=main>_</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span> <span class=main>⊨</span> <span class=main>(</span><span class=var>?owS</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>,</span> <span class=var>?U</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span> <span class=main>→)</span>
                                         global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>.</span> <span class=free>P</span> <span class=bound>i</span> <span class=bound>σ</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span>
    <span class=keyword3><span class=command>assume</span></span> ih1<span class=main>:</span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>⊨</span> <span class=main>(</span><span class=var>?owS</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span> <span class=var>?U</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>→)</span> global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>P</span> <span class=bound>i</span> <span class=bound>σ</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> ih2<span class=main>:</span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>⊨</span> <span class=main>(</span><span class=var>?owS</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>,</span> <span class=var>?U</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>→)</span> global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>P</span> <span class=bound>i</span> <span class=bound>σ</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>⊨</span> <span class=main>(</span><span class=var>?owS</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>,</span> <span class=var>?U</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>→)</span>
                             global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>i</span> <span class=bound>σ</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> oinvariant_def
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pq</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>pq</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=var>?owS</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>t</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>pq</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_par_oreachable_is_subnet surjective_pairing<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>
                                               <span class=main>(</span><span class=var>?owS</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> sor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?owS</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>)</span>"</span></span>
              <span class=keyword2><span class=keyword>and</span></span> tor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>t</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?owS</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span> <span class=main>(</span><span class=var>?U</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span> subnet_oreachable <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ _ _ node1 node2 node3<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>2-3<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> sor <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span><span class=main>.</span> <span class=free>P</span> <span class=bound>i</span> <span class=skolem>σ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> oinvariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> ih1<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> tor <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=free>P</span> <span class=bound>i</span> <span class=skolem>σ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> oinvariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> ih2<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>i</span> <span class=skolem>σ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>pq</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> SubnetS <span class=skolem>s</span> <span class=skolem>t</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=main>(</span><span class=skolem>p<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>∥</span> <span class=skolem>p<span class=hidden>⇩</span><sub>2</sub></span><span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>i</span> <span class=bound>σ</span><span class=main>)</span> <span class=skolem>pq</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=OClosed_Lifting><div class=head><h1>Theory OClosed_Lifting</h1></div><pre class=source><span class=comment1>(*  Title:       OClosed_Lifting.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Lifting rules for (open) closed networks"</span></span>

<span class=keyword1><span class=command>theory</span></span> OClosed_Lifting
<span class=keyword2><span class=keyword>imports</span></span> <a href=OPnet_Lifting.html>OPnet_Lifting</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=OClosed_Lifting-trans_fst_oclosed_fst1><span class=command>lemma</span></span> trans_fst_oclosed_fst1 <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=main>(</span>trans <span class=free>p</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> prod.exhaust oconnect_completeTE<span class=main>)</span>

<span class=keyword1 id=OClosed_Lifting-trans_fst_oclosed_fst2><span class=command>lemma</span></span> trans_fst_oclosed_fst2 <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=main>(</span>trans <span class=free>p</span><span class=main>)</span> <span class=main>⟹</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> prod.exhaust odisconnect_completeTE<span class=main>)</span>

<span class=keyword1 id=OClosed_Lifting-trans_fst_oclosed_fst3><span class=command>lemma</span></span> trans_fst_oclosed_fst3 <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=main>(</span>trans <span class=free>p</span><span class=main>)</span> <span class=main>⟹</span>      <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> prod.exhaust odeliver_completeTE<span class=main>)</span>

<span class=keyword1 id=OClosed_Lifting-oclosed_oreachable_inclosed><span class=command>lemma</span></span> oclosed_oreachable_inclosed<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=free>U</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> <span class=main>(</span>otherwith <span class=main>(</span><span class=main>(=)</span><span class=main>)</span> <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> inoclosed<span class=main>)</span> <span class=free>U</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>∈</span> oreachable <span class=main>_</span> <span class=var>?owS</span> <span class=main>_</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> oreachable_pair_induct<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>ζ</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> <span class=var>?owS</span> <span class=free>U</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>ζ</span> <span class=skolem>σ'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> <span class=var>?owS</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> <span class=var>?owS</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> oreachable_other'<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>ζ</span> <span class=skolem>σ'</span> <span class=skolem>ζ'</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> zor<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> <span class=var>?owS</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> ztr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>ζ</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> opnet_net_ips_net_tree_ips<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> ztr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> ocnet_sos <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> <span class=var>?owS</span> <span class=free>U</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>K</span> <span class=skolem>d</span> <span class=skolem>di</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>i</span><span class=keyword1>:newpkt(</span><span class=skolem>d</span><span class=main>,</span> <span class=skolem>di</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=main>{</span><span class=skolem>i</span><span class=main>}</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span>msg_class.newpkt <span class=main>(</span><span class=skolem>d</span><span class=main>,</span> <span class=skolem>di</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_ips <span class=skolem>ζ</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=free>p</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>ζ</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"otherwith <span class=main>(</span><span class=main>(=)</span><span class=main>)</span> <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> inoclosed <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>(</span><span class=main>{</span><span class=skolem>i</span><span class=main>}</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span>msg_class.newpkt <span class=main>(</span><span class=skolem>d</span><span class=main>,</span> <span class=skolem>di</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> zor tr <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> oreachable_local'<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_ips <span class=skolem>ζ</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=free>p</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>ζ</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"otherwith <span class=main>(</span><span class=main>(=)</span><span class=main>)</span> <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> inoclosed <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=keyword1>τ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> zor tr <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> oreachable_local'<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>insert</span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>ζ</span> <span class=main>=</span> net_tree_ips <span class=free>p</span>›</span></span><span class=main><span class=keyword3>,</span></span>
         <span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oreachable_local' <span class=main><span class=main>[</span></span><span class=operator>OF</span> zor<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Lifting-oclosed_oreachable_oreachable><span class=command>lemma</span></span> oclosed_oreachable_oreachable <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=free>U</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=free>U</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oclosed_oreachable_inclosed <span class=main><span class=main>[</span></span><span class=operator>THEN</span> oreachable_weakenE<span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=OClosed_Lifting-inclosed_closed><span class=command>lemma</span></span> inclosed_closed <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> cinv<span class=main>:</span> <span class=quoted><span class=quoted>"opnet <span class=free>np</span> <span class=free>p</span> <span class=main>⊨</span> <span class=main>(</span>otherwith <span class=main>(</span><span class=main>(=)</span><span class=main>)</span> <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> inoclosed<span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"oclosed <span class=main>(</span>opnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span> <span class=main>⊨</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> oinvariant_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oclosed_oreachable_inclosed<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=AWN_Invariants><div class=head><h1>Theory AWN_Invariants</h1></div><pre class=source><span class=comment1>(*  Title:       AWN_Invariants.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Generic invariants on sequential AWN processes"</span></span>

<span class=keyword1><span class=command>theory</span></span> AWN_Invariants
<span class=keyword2><span class=keyword>imports</span></span> <a href=Invariants.html>Invariants</a> <a href=AWN_SOS.html>AWN_SOS</a> <a href=AWN_Labels.html>AWN_Labels</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Invariants via labelled control terms"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Used to state that the initial control-state of an automaton appears within a process
  specification <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Γ›</span></span></span></span>, meaning that its transitions, and those of its subterms, are
  subsumed by those of <span class=antiquoted><span class=raw_text><span class=antiquoted><span class=raw_text><span class=operator><span class=operator>‹</span></span>Γ›</span></span></span></span>.
›</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>control_within</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'z</span> <span class=main>×</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp<span class=main>)</span> set <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>control_within</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=main>≡</span> <span class=main>∀</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>∈</span><span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>.</span> <span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=bound>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=bound>pn</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=AWN_Invariants-control_withinI><span class=command>lemma</span></span> control_withinI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span><span class=main>.</span> <span class=bound>p</span> <span class=main>∈</span> Range <span class=free>σ</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=bound>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=free>σ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> control_within_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Invariants-control_withinD><span class=command>lemma</span></span> control_withinD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=free>σ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> <span class=free>σ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> control_within_def <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=AWN_Invariants-control_within_topI><span class=command>lemma</span></span> control_within_topI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span><span class=main>.</span> <span class=bound>p</span> <span class=main>∈</span> Range <span class=free>σ</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=bound>p</span> <span class=main>=</span> <span class=free>Γ</span> <span class=bound>pn</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=free>σ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> control_within_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span> <span class=main>(</span><span class=operator>metis</span> Range.RangeI subterms_refl<span class=main>)</span>

<span class=keyword1 id=AWN_Invariants-seqp_sos_subterms><span class=command>lemma</span></span> seqp_sos_subterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p'</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span> <span class=main>⟹</span>
                      <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span> <span class=main>⟹</span>
                      <span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p'</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span> <span class=main>⟹</span>
                      <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span> <span class=main>⟹</span>
                      <span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p'</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn</span></span>
                                            <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
                                              <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>
            <span class=main>∨</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p'</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> IH1<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> IH2<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Invariants-reachable_subterms><span class=command>lemma</span></span> reachable_subterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> reachable_pair_induct<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>ξ'</span> <span class=skolem>p'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> * <span class=keyword2><span class=keyword>and</span></span> assms<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p'</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> seqp_sos_subterms<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>onl</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env
           <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'z</span> <span class=main>×</span> <span class=tfree>'l</span> <span class=main>⇒</span> bool<span class=main>)</span>
           <span class=main>⇒</span> <span class=tfree>'z</span> <span class=main>×</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp
           <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>onl</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=bound>p</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=AWN_Invariants-onlI><span class=command>lemma</span></span> onlI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span><span class=main>.</span> <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> onl_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemmas</span></span> onlI' <span class=main>[</span><span class=operator>intro</span><span class=main>]</span> <span class=main>=</span> onlI <span class=main>[</span><span class=operator>simplified</span> atomize_ball<span class=main>]</span>

<span class=keyword1 id=AWN_Invariants-onlD><span class=command>lemma</span></span> onlD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> onl_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_Invariants-onl_invariantI><span class=command>lemma</span></span> onl_invariantI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span> <span class=bound>l</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span><span class=main>;</span> <span class=bound>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span> <span class=bound>a</span> <span class=bound>ξ'</span> <span class=bound>p'</span> <span class=bound>l'</span><span class=main>.</span>
                   <span class=main>⟦</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                     <span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                     <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                     <span class=bound>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=bound>p'</span><span class=main>;</span>
                     <span class=free>I</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> invariant_pairI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> init <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>ξ'</span> <span class=skolem>p'</span>
    <span class=keyword3><span class=command>assume</span></span> rp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> rp tr <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> step<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-onl_invariantD><span class=command>lemma</span></span> onl_invariantD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> onl_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Invariants-onl_invariant_initD><span class=command>lemma</span></span> onl_invariant_initD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> invP<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> pnl<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> init <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> invP <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> pnl <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-onl_invariant_sterms><span class=command>lemma</span></span> onl_invariant_sterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> il<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> rp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> wf <span class=quoted><span class=quoted>‹<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> labels_sterms_labels<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> il rp <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-onl_invariant_sterms_weaken><span class=command>lemma</span></span> onl_invariant_sterms_weaken<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> il<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> rp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weaken<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span><span class=main>.</span> <span class=free>I'</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>I</span> <span class=bound>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> reachable_weakenE<span class=main>)</span>
         <span class=main>(</span><span class=operator>erule</span> weaken<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1-2<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4-5<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> onl_invariant_sterms<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-onl_invariant_sterms_TT><span class=command>lemma</span></span> onl_invariant_sterms_TT<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> il<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> rp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> onl_invariant_sterms_weaken<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_Invariants-trans_from_sterms><span class=command>lemma</span></span> trans_from_sterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> sterms_pinduct <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id="AWN_Invariants-trans_from_sterms'"><span class=command>lemma</span></span> trans_from_sterms'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> sterms_pinduct <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Invariants-trans_to_dterms><span class=command>lemma</span></span> trans_to_dterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
   <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>r</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>q</span><span class=main>.</span> <span class=bound>r</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>q</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>theorem</span></span> cterms_includes_sterms_of_seq_reachable<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=main>(</span>sterms <span class=free>Γ</span> <span class=main>`</span> snd <span class=main>`</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>)</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>qs</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>qs</span> <span class=main>∈</span> <span class=main>⋃</span><span class=main>(</span>sterms <span class=free>Γ</span> <span class=main>`</span> snd <span class=main>`</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ξ</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span>  *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
                          <span class=keyword2><span class=keyword>and</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>qs</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>q</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>q</span> <span class=main>⟹</span> <span class=bound>x</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> reachable_pair_induct<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>q</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>›</span></span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>p</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subterms_sterms_in_cterms<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span> <span class=skolem>ξ</span> <span class=skolem>a</span> <span class=skolem>ξ'</span> <span class=skolem>q</span> <span class=skolem>x</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span> <span class=main>⟹</span> <span class=bound>x</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>q</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>from</span></span> this <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ps</span></span>
        <span class=keyword2><span class=keyword>where</span></span> ps<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>ps</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans_from_sterms <span class=main><span class=main>[</span></span><span class=operator>THEN</span> bexE<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> ps <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ps</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> step <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>x</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>q</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=skolem>ps</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans_to_dterms <span class=main><span class=main>[</span></span><span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ctermsDI<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>qs</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>using</span></span> ** <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> seq_reachable_in_cterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1-3<span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> cterms_includes_sterms_of_seq_reachable <span class=main><span class=main>[</span></span><span class=operator>THEN</span> subsetD<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>4-5<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span> <span class=main>∈</span> <span class=main>⋃</span><span class=main>(</span>sterms <span class=free>Γ</span> <span class=main>`</span> snd <span class=main>`</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rev_bexI<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-seq_invariant_ctermI><span class=command>lemma</span></span> seq_invariant_ctermI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> cw<span class=main>:</span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sl<span class=main>:</span> <span class=quoted><span class=quoted>"simple_labels <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span> <span class=bound>l</span><span class=main>.</span> <span class=main>⟦</span>
                   <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span><span class=main>;</span>
                   <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span>
                 <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span> <span class=bound>l</span> <span class=bound>ξ</span> <span class=bound>a</span> <span class=bound>q</span> <span class=bound>l'</span> <span class=bound>ξ'</span> <span class=bound>pp</span><span class=main>.</span> <span class=main>⟦</span>
                 <span class=bound>p</span><span class=main>∈</span>cterms <span class=free>Γ</span><span class=main>;</span>
                 <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                 <span class=free>P</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                 <span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>q</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>pp</span><span class=main>)</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                 <span class=bound>p</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=bound>pp</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                 <span class=free>I</span> <span class=bound>a</span>
               <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> init <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>ξ'</span> <span class=skolem>q</span> <span class=skolem>l'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> pl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> A6<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>q</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
     <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> tr'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
     <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>from</span></span> sr <span class=keyword2><span class=keyword>and</span></span> tr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> A7<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>from</span></span> tr' <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
                           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> trans_from_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ wf<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> wf cw sp sr this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> A1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span><span class=main>∈</span>cterms <span class=free>Γ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> seq_reachable_in_cterms<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> labels_not_empty <span class=main>[</span><span class=operator>OF</span> wf<span class=main>]</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ll</span></span> <span class=keyword2><span class=keyword>where</span></span> A2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ll</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>p</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ll</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> labels_sterms_labels <span class=main><span class=main>[</span></span><span class=operator>OF</span> wf<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> pl <span class=keyword1><span class=command>have</span></span> A3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>ll</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> sp
        <span class=keyword1><span class=command>have</span></span> A5<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> sp <span class=keyword1><span class=command>have</span></span> A4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>from</span></span> sr <span class=quoted><span class=quoted>‹<span class=skolem>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>p</span>›</span></span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pp</span></span> <span class=keyword2><span class=keyword>where</span></span> A7<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>pp</span><span class=main>)</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
                    <span class=keyword2><span class=keyword>and</span></span> A8<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>pp</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> sr tr <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> A9<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>from</span></span> A1 A2 A3 A4 A5 A6 A7 A8 A9 <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-seq_invariant_ctermsI><span class=command>lemma</span></span> seq_invariant_ctermsI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"simple_labels <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span> <span class=bound>l</span><span class=main>.</span> <span class=main>⟦</span>
                   <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span><span class=main>;</span>
                   <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span>
                 <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span> <span class=bound>l</span> <span class=bound>ξ</span> <span class=bound>a</span> <span class=bound>q</span> <span class=bound>l'</span> <span class=bound>ξ'</span> <span class=bound>pp</span> <span class=bound>pn</span><span class=main>.</span> <span class=main>⟦</span>
                 wellformed <span class=free>Γ</span><span class=main>;</span>
                 <span class=bound>p</span><span class=main>∈</span>ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>;</span>
                 not_call <span class=bound>p</span><span class=main>;</span>
                 <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                 <span class=free>P</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                 <span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>q</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>pp</span><span class=main>)</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                 <span class=bound>p</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=bound>pp</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                 <span class=free>I</span> <span class=bound>a</span>
               <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1-4<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> seq_invariant_ctermI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span> <span class=skolem>l</span> <span class=skolem>ξ</span> <span class=skolem>a</span> <span class=skolem>q</span> <span class=skolem>l'</span> <span class=skolem>ξ'</span> <span class=skolem>pp</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> otherassms<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=skolem>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>q</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>pp</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>pp</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> ctermsl<span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
                             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_call <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> cterms_def' <span class=main>[</span><span class=operator>OF</span> wf<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>with</span></span> wf <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> otherassms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Step invariants via labelled control terms"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>onll</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env
           <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'z</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition <span class=main>⇒</span> bool<span class=main>)</span>
           <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'z</span> <span class=main>×</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp<span class=main>,</span> <span class=tfree>'a</span><span class=main>)</span> transition <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>onll</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=bound>p</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l'</span><span class=main>∈</span>labels <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=bound>p'</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=AWN_Invariants-onllI><span class=command>lemma</span></span> onllI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>l</span> <span class=bound>l'</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span><span class=main>;</span> <span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"onll <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> onll_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_Invariants-onllIl><span class=command>lemma</span></span> onllIl <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"onll <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Invariants-onllD><span class=command>lemma</span></span> onllD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"onll <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> onll_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_Invariants-onl_weaken><span class=command>lemma</span></span> onl_weaken <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>P</span> <span class=bound>Q</span> <span class=bound>s</span><span class=main>.</span> <span class=main>⟦</span> onl <span class=bound>Γ</span> <span class=bound>P</span> <span class=bound>s</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>P</span> <span class=bound>s</span> <span class=main>⟹</span> <span class=bound>Q</span> <span class=bound>s</span> <span class=main>⟧</span> <span class=main>⟹</span> onl <span class=bound>Γ</span> <span class=bound>Q</span> <span class=bound>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onlD <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onlI<span class=main>)</span>

<span class=keyword1 id=AWN_Invariants-onll_weaken><span class=command>lemma</span></span> onll_weaken <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>P</span> <span class=bound>Q</span> <span class=bound>s</span><span class=main>.</span> <span class=main>⟦</span> onll <span class=bound>Γ</span> <span class=bound>P</span> <span class=bound>s</span><span class=main>;</span> <span class=main>⋀</span><span class=bound>s</span><span class=main>.</span> <span class=bound>P</span> <span class=bound>s</span> <span class=main>⟹</span> <span class=bound>Q</span> <span class=bound>s</span> <span class=main>⟧</span> <span class=main>⟹</span> onll <span class=bound>Γ</span> <span class=bound>Q</span> <span class=bound>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onllD <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onllI<span class=main>)</span>

<span class=keyword1 id="AWN_Invariants-onll_weaken'"><span class=command>lemma</span></span> onll_weaken' <span class=main>[</span><span class=operator>elim</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>Γ</span> <span class=bound>P</span> <span class=bound>Q</span> <span class=bound>s</span><span class=main>.</span> <span class=main>⟦</span> onll <span class=bound>Γ</span> <span class=bound>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
                                        <span class=main>⋀</span><span class=bound>l</span> <span class=bound>l'</span><span class=main>.</span> <span class=bound>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span> <span class=main>⟹</span> <span class=bound>Q</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span> <span class=main>⟧</span>
                                      <span class=main>⟹</span> onll <span class=bound>Γ</span> <span class=bound>Q</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onllD <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onllI<span class=main>)</span>

<span class=keyword1 id=AWN_Invariants-onll_step_invariantI><span class=command>lemma</span></span> onll_step_invariantI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span> <span class=bound>l</span> <span class=bound>a</span> <span class=bound>ξ'</span> <span class=bound>p'</span> <span class=bound>l'</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                                   <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                                   <span class=free>I</span> <span class=bound>a</span><span class=main>;</span>
                                   <span class=bound>l</span> <span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                                   <span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p'</span> <span class=main>⟧</span>
                                 <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>ξ'</span> <span class=skolem>p'</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> *<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"onll <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-onll_step_invariantE><span class=command>lemma</span></span> onll_step_invariantE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> lp<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> lp'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1-4<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"onll <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> lp lp' <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-onll_step_invariantD><span class=command>lemma</span></span> onll_step_invariantD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=free>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=AWN_Invariants-onll_step_to_invariantI><span class=command>lemma</span></span> onll_step_to_invariantI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> sinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>Q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>l</span> <span class=bound>p</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span><span class=main>;</span> <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span> <span class=bound>l</span> <span class=bound>ξ'</span> <span class=bound>l'</span> <span class=bound>a</span><span class=main>.</span>
                   <span class=main>⟦</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                     <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                     <span class=free>P</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                     <span class=free>Q</span> <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
                     <span class=free>I</span> <span class=bound>a</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>ξ'</span> <span class=skolem>p'</span> <span class=skolem>l'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> lp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> lp'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p'</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>from</span></span> lp <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>l</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> labels_not_empty <span class=main>[</span><span class=operator>OF</span> wf<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> sinv sr tr <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> this<span class=main>(</span>1<span class=main>)</span> lp' <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> sr <span class=quoted><span class=quoted>‹<span class=skolem>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-onll_step_invariant_sterms><span class=command>lemma</span></span> onll_step_invariant_sterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> si<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sos<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> wf <span class=quoted><span class=quoted>‹<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> labels_sterms_labels<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> si sr sos <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=free>a</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-seq_step_invariant_sterms><span class=command>lemma</span></span> seq_step_invariant_sterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> inv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword1><span class=command>from</span></span> tr <span class=keyword2><span class=keyword>and</span></span> sp <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> wf <span class=quoted><span class=quoted>‹<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>›</span></span> <span class=keyword1><span class=command>by</span></span>  <span class=main>(</span><span class=operator>rule</span> trans_from_sterms'<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> sp <span class=keyword1><span class=command>have</span></span> trp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>l</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> wf inv sr trp <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=free>a</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>›</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> onll_step_invariant_sterms<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-seq_step_invariant_sterms_weaken><span class=command>lemma</span></span> seq_step_invariant_sterms_weaken<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I'</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weaken<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span><span class=main>.</span> <span class=free>I'</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>I</span> <span class=bound>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>I'</span> <span class=free>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=free>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> weaken<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> Ir<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> reachable_weakenE<span class=main>)</span> <span class=main>(</span><span class=operator>erule</span> weaken<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1-4<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=free>a</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> seq_step_invariant_sterms<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-seq_step_invariant_sterms_TT><span class=command>lemma</span></span> seq_step_invariant_sterms_TT<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> seq_step_invariant_sterms_weaken<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=AWN_Invariants-onll_step_invariant_any_sterms><span class=command>lemma</span></span> onll_step_invariant_any_sterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro</span> ballI<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> onll_step_invariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=AWN_Invariants-seq_step_invariant_ctermI><span class=command>lemma</span></span> seq_step_invariant_ctermI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> cw<span class=main>:</span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sl<span class=main>:</span> <span class=quoted><span class=quoted>"simple_labels <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span> <span class=bound>pp</span> <span class=bound>l</span> <span class=bound>ξ</span> <span class=bound>a</span> <span class=bound>q</span> <span class=bound>l'</span> <span class=bound>ξ'</span><span class=main>.</span> <span class=main>⟦</span>
                 <span class=bound>p</span><span class=main>∈</span>cterms <span class=free>Γ</span><span class=main>;</span>
                 <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                 <span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>q</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>pp</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                 <span class=bound>p</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=bound>pp</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                 <span class=free>I</span> <span class=bound>a</span>
               <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>l</span> <span class=skolem>a</span> <span class=skolem>ξ'</span> <span class=skolem>q</span> <span class=skolem>l'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> pl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> A5<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>q</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> sp <span class=keyword1><span class=command>have</span></span> tr'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
                     <span class=keyword2><span class=keyword>and</span></span> A3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> trans_from_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ wf<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> wf cw sp sr this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> A1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span><span class=main>∈</span>cterms <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> seq_reachable_in_cterms<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> sp
      <span class=keyword1><span class=command>have</span></span> A4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>from</span></span> sr <span class=quoted><span class=quoted>‹<span class=skolem>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>p</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pp</span></span> <span class=keyword2><span class=keyword>where</span></span> A6<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>pp</span><span class=main>)</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
                                        <span class=keyword2><span class=keyword>and</span></span> A7<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>pp</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> sr tr <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> A8<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>∈</span>reachable <span class=free>A</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>from</span></span> wf cw sp sr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> reachable_subterms<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> sl wf <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=bound>p'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> pl <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> simple_labels_in_sterms<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> A1 <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> A3 A4 A5 A6 A7 A8 <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=AWN_Invariants-seq_step_invariant_ctermsI><span class=command>lemma</span></span> seq_step_invariant_ctermsI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> cw<span class=main>:</span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sl<span class=main>:</span> <span class=quoted><span class=quoted>"simple_labels <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span> <span class=bound>l</span> <span class=bound>ξ</span> <span class=bound>a</span> <span class=bound>q</span> <span class=bound>l'</span> <span class=bound>ξ'</span> <span class=bound>pp</span> <span class=bound>pn</span><span class=main>.</span> <span class=main>⟦</span>
                 wellformed <span class=free>Γ</span><span class=main>;</span>
                 <span class=bound>p</span><span class=main>∈</span>ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>;</span>
                 not_call <span class=bound>p</span><span class=main>;</span>
                 <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                 <span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>q</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>pp</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                 <span class=bound>p</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=bound>pp</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span><span class=main>;</span>
                 <span class=free>I</span> <span class=bound>a</span>
               <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1-4<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> seq_step_invariant_ctermI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span> <span class=skolem>pp</span> <span class=skolem>l</span> <span class=skolem>ξ</span> <span class=skolem>a</span> <span class=skolem>q</span> <span class=skolem>l'</span> <span class=skolem>ξ'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> otherassms<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=skolem>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>q</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>pp</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>pp</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> ctermsl<span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
                             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_call <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> cterms_def' <span class=main>[</span><span class=operator>OF</span> wf<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>with</span></span> wf <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> otherassms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=OAWN_Invariants><div class=head><h1>Theory OAWN_Invariants</h1></div><pre class=source><span class=comment1>(*  Title:       OAWN_Invariants.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Generic open invariants on sequential AWN processes"</span></span>

<span class=keyword1><span class=command>theory</span></span> OAWN_Invariants
<span class=keyword2><span class=keyword>imports</span></span> <a href=Invariants.html>Invariants</a> <a href=OInvariants.html>OInvariants</a>
        <a href=AWN_Cterms.html>AWN_Cterms</a> <a href=AWN_Labels.html>AWN_Labels</a> <a href=AWN_Invariants.html>AWN_Invariants</a>
        <a href=OAWN_SOS.html>OAWN_SOS</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Open invariants via labelled control terms"</span></span>

<span class=keyword1 id=OAWN_Invariants-oseqp_sos_subterms><span class=command>lemma</span></span> oseqp_sos_subterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p'</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span> <span class=main>⟹</span>
                      <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span> <span class=main>⟹</span>
                      <span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p'</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span> <span class=main>⟹</span>
                      <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span> <span class=main>⟹</span>
                      <span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p'</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn</span></span>
                                            <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
                                              <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>
            <span class=main>∨</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p'</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p1</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> IH1<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p2</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> IH2<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_Invariants-oreachable_subterms><span class=command>lemma</span></span> oreachable_subterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=free>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induct</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> oreachable_pair_induct<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>p'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> 3 <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹trans <span class=free>A</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p'</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> oseqp_sos_subterms<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-onl_oinvariantI><span class=command>lemma</span></span> onl_oinvariantI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span> <span class=bound>l</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span><span class=main>;</span> <span class=bound>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>p</span> <span class=bound>l</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                                <span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                                <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span> <span class=bound>a</span> <span class=bound>σ'</span> <span class=bound>p'</span> <span class=bound>l'</span><span class=main>.</span>
                   <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                     <span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                     <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                     <span class=bound>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=bound>p'</span><span class=main>;</span>
                     <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> init <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>p'</span>
    <span class=keyword3><span class=command>assume</span></span> rp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> rp tr <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>:</span></span> step<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"onl <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-global_oinvariantI><span class=command>lemma</span></span> global_oinvariantI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>p</span> <span class=bound>l</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span> <span class=free>P</span> <span class=bound>σ</span><span class=main>;</span> <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span> <span class=bound>a</span> <span class=bound>σ'</span> <span class=bound>p'</span><span class=main>.</span>
                   <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                     <span class=free>P</span> <span class=bound>σ</span><span class=main>;</span>
                     <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                     <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>σ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>erule</span> init<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>p'</span>
    <span class=keyword3><span class=command>assume</span></span> rp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> rp <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> tr <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>erule</span> other<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=free>P</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-onl_oinvariantD><span class=command>lemma</span></span> onl_oinvariantD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> onl_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_Invariants-onl_oinvariant_weakenD><span class=command>lemma</span></span> onl_oinvariant_weakenD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S'</span><span class=main>,</span> <span class=free>U'</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weakenS<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span><span class=main>.</span> <span class=free>S</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>S'</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weakenU<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=free>U</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=main>⟹</span> <span class=free>U'</span> <span class=bound>s</span> <span class=bound>s'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S'</span> <span class=free>U'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_weakenE<span class=main>)</span>
         <span class=main>(</span><span class=operator>erule</span> weakenS<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> weakenU<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S'</span><span class=main>,</span> <span class=free>U'</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>p</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-onl_oinvariant_initD><span class=command>lemma</span></span> onl_oinvariant_initD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> invP<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> pnl<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> init <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> invP <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> pnl <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-onl_oinvariant_sterms><span class=command>lemma</span></span> onl_oinvariant_sterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> il<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> rp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> wf <span class=quoted><span class=quoted>‹<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> labels_sterms_labels<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> il rp <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-onl_oinvariant_sterms_weaken><span class=command>lemma</span></span> onl_oinvariant_sterms_weaken<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> il<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S'</span><span class=main>,</span> <span class=free>U'</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> rp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weakenS<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>.</span> <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>S'</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weakenU<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span><span class=main>.</span> <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟹</span> <span class=free>U'</span> <span class=bound>σ</span> <span class=bound>σ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S'</span> <span class=free>U'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_weakenE<span class=main>)</span>
         <span class=main>(</span><span class=operator>erule</span> weakenS<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> weakenU<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1-2<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4-5<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> onl_oinvariant_sterms<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-otrans_from_sterms><span class=command>lemma</span></span> otrans_from_sterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> sterms_pinduct <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id="OAWN_Invariants-otrans_from_sterms'"><span class=command>lemma</span></span> otrans_from_sterms'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> sterms_pinduct <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_Invariants-otrans_to_dterms><span class=command>lemma</span></span> otrans_to_dterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
   <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>r</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>q</span><span class=main>.</span> <span class=bound>r</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>q</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>theorem</span></span> cterms_includes_sterms_of_oseq_reachable<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⋃</span><span class=main>(</span>sterms <span class=free>Γ</span> <span class=main>`</span> snd <span class=main>`</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>)</span> <span class=main>⊆</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>qs</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>qs</span> <span class=main>∈</span> <span class=main>⋃</span><span class=main>(</span>sterms <span class=free>Γ</span> <span class=main>`</span> snd <span class=main>`</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ξ</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span>  *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
                          <span class=keyword2><span class=keyword>and</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>qs</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>q</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> * <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>q</span> <span class=main>⟹</span> <span class=bound>x</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> oreachable_pair_induct<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>q</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>›</span></span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>p</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subterms_sterms_in_cterms<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span> <span class=skolem>σ</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>q</span> <span class=skolem>x</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span> <span class=main>⟹</span> <span class=bound>x</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>q</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹trans <span class=free>A</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> step<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>from</span></span> step <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ps</span></span>
        <span class=keyword2><span class=keyword>where</span></span> ps<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> step'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ps</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> otrans_from_sterms <span class=main><span class=main>[</span></span><span class=operator>THEN</span> bexE<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> ps <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ps</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> step' <span class=quoted><span class=quoted>‹wellformed <span class=free>Γ</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>x</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>q</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> dterms <span class=free>Γ</span> <span class=skolem>ps</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> otrans_to_dterms <span class=main><span class=main>[</span></span><span class=operator>rule_format</span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ctermsDI<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>qs</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span> <span class=keyword1><span class=command>using</span></span> ** <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>corollary</span></span> oseq_reachable_in_cterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1-3<span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> cterms_includes_sterms_of_oseq_reachable <span class=main><span class=main>[</span></span><span class=operator>THEN</span> subsetD<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>4-5<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span> <span class=main>∈</span> <span class=main>⋃</span><span class=main>(</span>sterms <span class=free>Γ</span> <span class=main>`</span> snd <span class=main>`</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> rev_bexI<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-oseq_invariant_ctermI><span class=command>lemma</span></span> oseq_invariant_ctermI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> cw<span class=main>:</span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sl<span class=main>:</span> <span class=quoted><span class=quoted>"simple_labels <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span> <span class=bound>l</span><span class=main>.</span> <span class=main>⟦</span>
                   <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span><span class=main>;</span>
                   <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span>
                 <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>p</span> <span class=bound>l</span><span class=main>.</span> <span class=main>⟦</span>
                   <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                   <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                   <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                   <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span> <span class=bound>l</span> <span class=bound>σ</span> <span class=bound>a</span> <span class=bound>q</span> <span class=bound>l'</span> <span class=bound>σ'</span> <span class=bound>pp</span><span class=main>.</span> <span class=main>⟦</span>
                 <span class=bound>p</span><span class=main>∈</span>cterms <span class=free>Γ</span><span class=main>;</span>
                 <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                 <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                 <span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>q</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>pp</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                 <span class=bound>p</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=bound>pp</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                 <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span>
               <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> init <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>q</span> <span class=skolem>l'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> pl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> A6<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>q</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>from</span></span> sr <span class=keyword2><span class=keyword>and</span></span> tr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> A7<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> oreachable_local'<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> tr <span class=keyword2><span class=keyword>and</span></span> sp <span class=keyword1><span class=command>have</span></span> tr'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
                       <span class=keyword2><span class=keyword>and</span></span> A4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> otrans_from_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ wf<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> wf cw sp sr this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> A1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span><span class=main>∈</span>cterms <span class=free>Γ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oseq_reachable_in_cterms<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> labels_not_empty <span class=main>[</span><span class=operator>OF</span> wf<span class=main>]</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ll</span></span> <span class=keyword2><span class=keyword>where</span></span> A2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ll</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>p</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ll</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> labels_sterms_labels <span class=main><span class=main>[</span></span><span class=operator>OF</span> wf<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> pl <span class=keyword1><span class=command>have</span></span> A3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ll</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>from</span></span> sr <span class=quoted><span class=quoted>‹<span class=skolem>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>p</span>›</span></span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pp</span></span> <span class=keyword2><span class=keyword>where</span></span> A7<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>pp</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
                    <span class=keyword2><span class=keyword>and</span></span> A8<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>pp</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> sr tr <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> A9<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> oreachable_local'<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> sp <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> A5<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>from</span></span> A1 A2 A3 A4 A5 A6 A7 A8 A9 <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> local<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>p</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>l</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> sr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-oseq_invariant_ctermsI><span class=command>lemma</span></span> oseq_invariant_ctermsI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> cw<span class=main>:</span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sl<span class=main>:</span> <span class=quoted><span class=quoted>"simple_labels <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span> <span class=bound>l</span><span class=main>.</span> <span class=main>⟦</span>
                   <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span><span class=main>;</span>
                   <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span>
                 <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>p</span> <span class=bound>l</span><span class=main>.</span> <span class=main>⟦</span>
                   wellformed <span class=free>Γ</span><span class=main>;</span>
                   <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                   <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                   <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                   <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span> <span class=bound>l</span> <span class=bound>σ</span> <span class=bound>a</span> <span class=bound>q</span> <span class=bound>l'</span> <span class=bound>σ'</span> <span class=bound>pp</span> <span class=bound>pn</span><span class=main>.</span> <span class=main>⟦</span>
                 wellformed <span class=free>Γ</span><span class=main>;</span>
                 <span class=bound>p</span><span class=main>∈</span>ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>;</span>
                 not_call <span class=bound>p</span><span class=main>;</span>
                 <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                 <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span>
                 <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                 <span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>q</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>pp</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                 <span class=bound>p</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=bound>pp</span><span class=main>;</span>
                 <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                 <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span>
               <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> oseq_invariant_ctermI <span class=main><span class=main>[</span></span><span class=operator>OF</span> wf cw sl sp<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>p</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> wf <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span> <span class=skolem>l</span> <span class=skolem>σ</span> <span class=skolem>a</span> <span class=skolem>q</span> <span class=skolem>l'</span> <span class=skolem>σ'</span> <span class=skolem>pp</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> otherassms<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=skolem>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>q</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>pp</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>pp</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> ctermsl<span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
                             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_call <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> cterms_def' <span class=main>[</span><span class=operator>OF</span> wf<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>with</span></span> wf <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> otherassms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> local<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Open step invariants via labelled control terms"</span></span>

<span class=keyword1 id=OAWN_Invariants-onll_ostep_invariantI><span class=command>lemma</span></span> onll_ostep_invariantI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span> <span class=bound>l</span> <span class=bound>a</span> <span class=bound>σ'</span> <span class=bound>p'</span> <span class=bound>l'</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                                   <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                                   <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>;</span>
                                   <span class=bound>l</span> <span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                                   <span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p'</span> <span class=main>⟧</span>
                                 <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>σ'</span> <span class=skolem>p'</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> *<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"onll <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-onll_ostep_invariantE><span class=command>lemma</span></span> onll_ostep_invariantE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> lp<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=free>l</span> <span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> lp'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1-4<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"onll <span class=free>Γ</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> lp lp' <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-onll_ostep_invariantD><span class=command>lemma</span></span> onll_ostep_invariantD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_Invariants-onll_ostep_invariant_weakenD><span class=command>lemma</span></span> onll_ostep_invariant_weakenD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S'</span><span class=main>,</span> <span class=free>U'</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S'</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weakenS<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span><span class=main>.</span> <span class=free>S</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>S'</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=bound>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weakenU<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span><span class=main>.</span> <span class=free>U</span> <span class=bound>s</span> <span class=bound>s'</span> <span class=main>⟹</span> <span class=free>U'</span> <span class=bound>s</span> <span class=bound>s'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S'</span> <span class=free>U'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_weakenE<span class=main>)</span>
         <span class=main>(</span><span class=operator>erule</span> weakenS<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> weakenU<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S'</span><span class=main>,</span> <span class=free>U'</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>S'</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-onll_ostep_to_invariantI><span class=command>lemma</span></span> onll_ostep_to_invariantI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> sinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>Q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>l</span> <span class=bound>p</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span><span class=main>;</span> <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>p</span> <span class=bound>l</span><span class=main>.</span>
                    <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                      <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                      <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                      <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span> <span class=bound>l</span> <span class=bound>σ'</span> <span class=bound>l'</span> <span class=bound>a</span><span class=main>.</span>
                    <span class=main>⟦</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                      <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                      <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>;</span>
                      <span class=free>Q</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
                      <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onl <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>p'</span> <span class=skolem>l'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> lp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> lp'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p'</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>from</span></span> lp <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>l</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> labels_not_empty <span class=main>[</span><span class=operator>OF</span> wf<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> sinv sr tr <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> this<span class=main>(</span>1<span class=main>)</span> lp' <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> sr <span class=quoted><span class=quoted>‹<span class=skolem>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> local<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>p</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>l</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=skolem>p</span>›</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>U</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-onll_ostep_invariant_sterms><span class=command>lemma</span></span> onll_ostep_invariant_sterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> si<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sos<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> wf <span class=quoted><span class=quoted>‹<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> labels_sterms_labels<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> si sr sos <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-oseq_step_invariant_sterms><span class=command>lemma</span></span> oseq_step_invariant_sterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> inv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>3<span class=main>,</span> 6<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> wf <span class=quoted><span class=quoted>‹<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>›</span></span>  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> otrans_from_sterms'<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> trp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>l</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=free>p'</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> wf inv sr trp <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>›</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>7<span class=main><span class=main>)</span></span> onll_ostep_invariant_sterms<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-oseq_step_invariant_sterms_weaken><span class=command>lemma</span></span> oseq_step_invariant_sterms_weaken<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> inv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S'</span> <span class=free>U'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S'</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weakenS<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>.</span> <span class=free>S'</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span> <span class=main>⟹</span> <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> weakenU<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span><span class=main>.</span> <span class=free>U'</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟹</span> <span class=free>U</span> <span class=bound>σ</span> <span class=bound>σ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>S'</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> weakenS<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S'</span> <span class=free>U'</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> Ir<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_weakenE<span class=main>)</span>
           <span class=main>(</span><span class=operator>erule</span> weakenS<span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> weakenU<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1-4<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> tr <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oseq_step_invariant_sterms<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-onll_ostep_invariant_any_sterms><span class=command>lemma</span></span> onll_ostep_invariant_any_sterms<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> si<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sos<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=free>σ</span> <span class=free>σ'</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=free>q</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span><span class=main>.</span> <span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p'</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro</span> ballI<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> onll_ostep_invariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=OAWN_Invariants-oseq_step_invariant_ctermI><span class=command>lemma</span></span> oseq_step_invariant_ctermI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> cw<span class=main>:</span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sl<span class=main>:</span> <span class=quoted><span class=quoted>"simple_labels <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span> <span class=bound>l</span> <span class=bound>σ</span> <span class=bound>a</span> <span class=bound>q</span> <span class=bound>l'</span> <span class=bound>σ'</span> <span class=bound>pp</span><span class=main>.</span> <span class=main>⟦</span>
                   <span class=bound>p</span><span class=main>∈</span>cterms <span class=free>Γ</span><span class=main>;</span>
                   <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                   <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span>
                   <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                   <span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>q</span><span class=main>;</span>
                   <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>pp</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                   <span class=bound>p</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=bound>pp</span><span class=main>;</span>
                   <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                   <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span>
                 <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
       <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>l</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>q</span> <span class=skolem>l'</span>
    <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> pl<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> A5<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>q</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> sp <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
                     <span class=keyword2><span class=keyword>and</span></span> A3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> otrans_from_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ wf<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> sp <span class=keyword1><span class=command>have</span></span> A4<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>from</span></span> wf cw sp sr <span class=quoted><span class=quoted>‹<span class=skolem>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>p</span>›</span></span> <span class=keyword1><span class=command>have</span></span> A1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span><span class=main>∈</span>cterms <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oseq_reachable_in_cterms<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> sr <span class=quoted><span class=quoted>‹<span class=skolem>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>p</span>›</span></span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pp</span></span> <span class=keyword2><span class=keyword>where</span></span> A6<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>pp</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> A7<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>pp</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> sr tr <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> A8<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>∈</span>oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> oreachable_local'<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> wf cw sp sr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>pn</span><span class=main>.</span> <span class=skolem>p</span> <span class=main>∈</span> subterms <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_subterms<span class=main>)</span>           
    <span class=keyword1><span class=command>with</span></span> sl wf <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>p'</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=skolem>p</span><span class=main>.</span> <span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=bound>p'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> pl <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> simple_labels_in_sterms<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p'</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> A1 <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> A3 A4 A5 A6 A7 A8 <span class=quoted><span class=quoted>‹<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> local<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-oseq_step_invariant_ctermsI><span class=command>lemma</span></span> oseq_step_invariant_ctermsI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> wf<span class=main>:</span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"control_within <span class=free>Γ</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"simple_labels <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span> <span class=bound>l</span> <span class=bound>σ</span> <span class=bound>a</span> <span class=bound>q</span> <span class=bound>l'</span> <span class=bound>σ'</span> <span class=bound>pp</span> <span class=bound>pn</span><span class=main>.</span> <span class=main>⟦</span>
                   wellformed <span class=free>Γ</span><span class=main>;</span>
                   <span class=bound>p</span><span class=main>∈</span>ctermsl <span class=main>(</span><span class=free>Γ</span> <span class=bound>pn</span><span class=main>)</span><span class=main>;</span>
                   not_call <span class=bound>p</span><span class=main>;</span>
                   <span class=bound>l</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>p</span><span class=main>;</span>
                   <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>;</span>
                   <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span><span class=main>;</span>
                   <span class=bound>l'</span><span class=main>∈</span>labels <span class=free>Γ</span> <span class=bound>q</span><span class=main>;</span>
                   <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>pp</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                   <span class=bound>p</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=bound>pp</span><span class=main>;</span>
                   <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span><span class=main>;</span>
                   <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span>
                 <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>S</span><span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> onll <span class=free>Γ</span> <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1-4<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> oseq_step_invariant_ctermI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span> <span class=skolem>l</span> <span class=skolem>σ</span> <span class=skolem>a</span> <span class=skolem>q</span> <span class=skolem>l'</span> <span class=skolem>σ'</span> <span class=skolem>pp</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> cterms <span class=free>Γ</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> otherassms<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>p</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=skolem>l'</span> <span class=main>∈</span> labels <span class=free>Γ</span> <span class=skolem>q</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>pp</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>pp</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=free>S</span> <span class=free>U</span>"</span></span>
           <span class=quoted><span class=quoted>"<span class=free>S</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>pn</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> ctermsl<span class=main>(</span><span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
                             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"not_call <span class=skolem>p</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> cterms_def' <span class=main>[</span><span class=operator>OF</span> wf<span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>with</span></span> wf <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>l</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>l'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> otherassms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> local<span class=main>)</span>
 <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Invariants-open_seqp_action><span class=command>lemma</span></span> open_seqp_action <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wellformed <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ps</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ps</span><span class=main>∈</span>sterms <span class=free>Γ</span> <span class=free>p</span>"</span></span>
                           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=skolem>ps</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span> trans_from_sterms<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=skolem>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p1</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=skolem>ps</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span> <span class=main>⟧</span>
              <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=skolem>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p2</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=skolem>ps</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span> <span class=main>⟧</span>
              <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=skolem>ps</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p1</span> <span class=main>⊕</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> oseqp_sos.ochoiceT1 oseqp_sos.ochoiceT2<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>l</span> <span class=skolem>fip</span> <span class=skolem>fmsg</span> <span class=skolem>p1</span> <span class=skolem>p2</span>
      <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=skolem>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p1</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=skolem>ps</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span> <span class=main>⟧</span>
                    <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p1</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟦</span> <span class=skolem>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=skolem>p2</span><span class=main>;</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=skolem>ps</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span> <span class=main>⟧</span>
                    <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=main>{</span><span class=skolem>l</span><span class=keyword1>}unicast(</span><span class=skolem>fip</span><span class=main>,</span> <span class=skolem>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>▹</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=skolem>ps</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3-4<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=keyword1>}unicast(</span><span class=skolem>fip</span><span class=main>,</span> <span class=skolem>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>▹</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=keyword1>}unicast(</span><span class=skolem>fip</span><span class=main>,</span> <span class=skolem>fmsg</span><span class=main>)</span><span class=main>.</span> <span class=skolem>p1</span> <span class=main>▹</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> seqp_unicastTE<span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> unicast <span class=main>(</span><span class=skolem>fip</span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>fmsg</span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span> <span class=main>=</span> <span class=skolem>p1</span>"</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=keyword1>¬unicast</span> <span class=main>(</span><span class=skolem>fip</span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>p'</span> <span class=main>=</span> <span class=skolem>p2</span>"</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>p</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=skolem>ps</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ps</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>ps</span></span><span class=main>)</span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=quoted><span class=quoted>‹<span class=skolem>ps</span> <span class=main>∈</span> sterms <span class=free>Γ</span> <span class=main>(</span><span class=keyword1>call(</span><span class=skolem>p</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>Γ</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> otrans_from_sterms'<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=keyword1>call(</span><span class=skolem>p</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=OAWN_Convert><div class=head><h1>Theory OAWN_Convert</h1></div><pre class=source><span class=comment1>(*  Title:       OAWN_Convert.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Transfer standard invariants into open invariants"</span></span>

<span class=keyword1><span class=command>theory</span></span> OAWN_Convert
<span class=keyword2><span class=keyword>imports</span></span> <a href=AWN_SOS_Labels.html>AWN_SOS_Labels</a> <a href=AWN_Invariants.html>AWN_Invariants</a>
        <a href=OAWN_SOS.html>OAWN_SOS</a> <a href=OAWN_Invariants.html>OAWN_Invariants</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>initiali</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'i</span> <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'g</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> set <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> set <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>initiali</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>OI</span></span></span> <span class=free><span class=bound><span class=entity>CI</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>{</span><span class=main>(</span><span class=bound>σ</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>|</span><span class=bound>σ</span> <span class=bound>p</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>OI</span></span></span><span class=main>}</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>CI</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OAWN_Convert-initialiI><span class=command>lemma</span></span> initialiI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> OICI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>p</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> <span class=free>OI</span> <span class=main>⟹</span> <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> <span class=free>CI</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> CIOI<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>p</span><span class=main>.</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> <span class=free>CI</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>σ</span><span class=main>.</span> <span class=bound>ξ</span> <span class=main>=</span> <span class=bound>σ</span> <span class=free>i</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span> <span class=main>∈</span> <span class=free>OI</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"initiali <span class=free>i</span> <span class=free>OI</span> <span class=free>CI</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> initiali_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro</span> set_eqI iffI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> OICI CIOI<span class=main>)</span>

<span class=keyword1 id=OAWN_Convert-open_from_initialiD><span class=command>lemma</span></span> open_from_initialiD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"initiali <span class=free>i</span> <span class=free>OI</span> <span class=free>CI</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> <span class=free>OI</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=bound>ξ</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> <span class=free>CI</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> initiali_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=OAWN_Convert-closed_from_initialiD><span class=command>lemma</span></span> closed_from_initialiD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"initiali <span class=free>i</span> <span class=free>OI</span> <span class=free>CI</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> <span class=free>CI</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ</span><span class=main>.</span> <span class=bound>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=free>ξ</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> <span class=free>OI</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> initiali_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>seql</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'i</span> <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'s</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>seql</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>(</span><span class=bound>σ</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OAWN_Convert-seqlI><span class=command>lemma</span></span> seqlI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span>fst <span class=free>s</span> <span class=free>i</span><span class=main>,</span> snd <span class=free>s</span><span class=main>)</span> <span class=main>⟹</span> seql <span class=free>i</span> <span class=free>P</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> seql_def<span class=main>)</span>

<span class=keyword1 id=OAWN_Convert-same_seql><span class=command>lemma</span></span> same_seql <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=free>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"seql <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"seql <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> seql_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main>)</span>

<span class=keyword1 id=OAWN_Convert-seqlsimp><span class=command>lemma</span></span> seqlsimp<span class=main>:</span>
  <span class=quoted><span class=quoted>"seql <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>=</span> <span class=free>P</span> <span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> seql_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_Convert-other_steps_resp_local><span class=command>lemma</span></span> other_steps_resp_local <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"other_steps <span class=main>(</span>other <span class=free>A</span> <span class=free>I</span><span class=main>)</span> <span class=free>I</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherE<span class=main>)</span>

<span class=keyword1 id=OAWN_Convert-seql_onl_swap><span class=command>lemma</span></span> seql_onl_swap<span class=main>:</span>
  <span class=quoted><span class=quoted>"seql <span class=free>i</span> <span class=main>(</span>onl <span class=free>Γ</span> <span class=free>P</span><span class=main>)</span> <span class=main>=</span> onl <span class=free>Γ</span> <span class=main>(</span>seql <span class=free>i</span> <span class=free>P</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> seql_def onl_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_Convert-oseqp_sos_resp_local_steps><span class=command>lemma</span></span> oseqp_sos_resp_local_steps <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>Γ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'p</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"local_steps <span class=main>(</span>oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>ζ</span> <span class=skolem>ζ'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=tfree>'s</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>l</span> <span class=skolem>ms</span> <span class=skolem>p</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=keyword1>}broadcast(</span><span class=skolem>ms</span><span class=main>)</span><span class=main>.</span><span class=skolem>p</span><span class=main>)</span><span class=main>,</span> broadcast <span class=main>(</span><span class=skolem>ms</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> obroadcastT singleton_iff<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span>
            <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=keyword1>}broadcast(</span><span class=skolem>ms</span><span class=main>)</span><span class=main>.</span><span class=skolem>p</span><span class=main>)</span><span class=main>,</span> broadcast <span class=main>(</span><span class=skolem>ms</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=tfree>'s</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>fmsg</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'m</span> <span class=main>⇒</span> <span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'s</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>msg</span> <span class=skolem>l</span> <span class=skolem>p</span>
      <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>fmsg</span> <span class=skolem>msg</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=main>(</span><span class=skolem>ζ</span><span class=main>(</span><span class=free>i</span> <span class=main>:=</span> <span class=skolem>fmsg</span> <span class=skolem>msg</span> <span class=main>(</span><span class=skolem>ζ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> * **
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=keyword1>}receive(</span><span class=skolem>fmsg</span><span class=main>)</span><span class=main>.</span><span class=skolem>p</span><span class=main>)</span><span class=main>,</span> receive <span class=skolem>msg</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ζ</span><span class=main>(</span><span class=free>i</span> <span class=main>:=</span> <span class=skolem>fmsg</span> <span class=skolem>msg</span> <span class=main>(</span><span class=skolem>ζ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> fun_upd_same oreceiveT<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span>
                            <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=keyword1>}receive(</span><span class=skolem>fmsg</span><span class=main>)</span><span class=main>.</span><span class=skolem>p</span><span class=main>)</span><span class=main>,</span> receive <span class=skolem>msg</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ'</span> <span class=skolem>σ</span> <span class=skolem>l</span> <span class=skolem>p</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>fas</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'s</span>"</span></span>
      <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>fas</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=main>(</span><span class=skolem>ζ</span><span class=main>(</span><span class=free>i</span> <span class=main>:=</span> <span class=skolem>fas</span> <span class=main>(</span><span class=skolem>ζ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> * ** <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=main>}</span><span class=main>⟦</span><span class=skolem>fas</span><span class=main>⟧</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ζ</span><span class=main>(</span><span class=free>i</span> <span class=main>:=</span> <span class=skolem>fas</span> <span class=main>(</span><span class=skolem>ζ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> fun_upd_same oassignT<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=main>}</span><span class=main>⟦</span><span class=skolem>fas</span><span class=main>⟧</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>g</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'s</span> set"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>l</span> <span class=skolem>p</span>
      <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>∈</span> <span class=skolem>g</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>lifting<span class=main><span class=main>,</span></span> full_types<span class=main><span class=main>)</span></span> some_eq_ex<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> * ** <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=main>}</span><span class=main>⟨</span><span class=skolem>g</span><span class=main>⟩</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> oguardT step_seq_tau<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=main>}</span><span class=main>⟨</span><span class=skolem>g</span><span class=main>⟩</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>pn</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>p'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span>"</span></span>
                       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=free>Γ</span> <span class=skolem>pn</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ζ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=keyword1>call(</span><span class=skolem>pn</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>p'</span> <span class=skolem>q</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span>"</span></span>
                       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ζ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>p</span> <span class=main>⊕</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>q</span> <span class=skolem>q'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span> <span class=main>⟹</span> <span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span>"</span></span>
                       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ζ'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=bound>ζ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>p</span> <span class=main>⊕</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ζ'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>metis</span> ogroupcastT ounicastT onotunicastT osendT odeliverT<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OAWN_Convert-oseqp_sos_subreachable><span class=command>lemma</span></span> oseqp_sos_subreachable <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"trans <span class=free>OA</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"subreachable <span class=free>OA</span> <span class=main>(</span>other <span class=free>ANY</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=OAWN_Convert-oseq_step_is_seq_step><span class=command>lemma</span></span> oseq_step_is_seq_step<span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>σ</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ip <span class=main>⇒</span> <span class=tfree>'s</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span> <span class=main>::</span> <span class=tfree>'m</span> seq_action<span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=free>ξ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ξ'</span><span class=main>.</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=bound>ξ'</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>l</span> <span class=skolem>ms</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=free>ξ</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>ξ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=keyword1>}broadcast(</span><span class=skolem>ms</span><span class=main>)</span><span class=main>.</span><span class=skolem>p</span><span class=main>)</span><span class=main>,</span> broadcast <span class=main>(</span><span class=skolem>ms</span> <span class=free>ξ</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=free>ξ</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>ξ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ξ'</span><span class=main>.</span> <span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=bound>ξ'</span>
             <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=keyword1>}broadcast(</span><span class=skolem>ms</span><span class=main>)</span><span class=main>.</span><span class=skolem>p</span><span class=main>)</span><span class=main>,</span> broadcast <span class=main>(</span><span class=skolem>ms</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
       <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>fmsg</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'m</span> <span class=main>⇒</span> <span class=tfree>'s</span> <span class=main>⇒</span> <span class=tfree>'s</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>msg</span> <span class=main>::</span> <span class=tfree><span class=quoted><span class=tfree>'m</span></span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>σ'</span> <span class=skolem>σ</span> <span class=skolem>l</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>fmsg</span> <span class=skolem>msg</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=free>ξ</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=keyword1>}receive(</span><span class=skolem>fmsg</span><span class=main>)</span><span class=main>.</span><span class=skolem>p</span><span class=main>)</span><span class=main>,</span> receive <span class=skolem>msg</span><span class=main>,</span> <span class=main>(</span><span class=skolem>fmsg</span> <span class=skolem>msg</span> <span class=free>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>fmsg</span> <span class=skolem>msg</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=free>ξ</span>›</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ξ'</span><span class=main>.</span> <span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=bound>ξ'</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=main>{</span><span class=skolem>l</span><span class=keyword1>}receive(</span><span class=skolem>fmsg</span><span class=main>)</span><span class=main>.</span><span class=skolem>p</span><span class=main>)</span><span class=main>,</span> receive <span class=skolem>msg</span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>metis</span> assignT choiceT1 choiceT2 groupcastT guardT
                        callT unicastT notunicastT sendT deliverT step_seq_tau<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>

<span class=keyword1 id=OAWN_Convert-reachable_oseq_seqp_sos><span class=command>lemma</span></span> reachable_oseq_seqp_sos<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>OA</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"initiali <span class=free>i</span> <span class=main>(</span>init <span class=free>OA</span><span class=main>)</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> spo<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>OA</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
      <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=bound>ξ</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> reachable_pair_induct<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>OA</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹initiali <span class=free>i</span> <span class=main>(</span>init <span class=free>OA</span><span class=main>)</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ξ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ</span>"</span></span>
                                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ξ</span><span class=main>.</span> <span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=bound>ξ</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>σ'</span> <span class=skolem>p'</span> <span class=skolem>a</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>OA</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ξ</span><span class=main>.</span> <span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=bound>ξ</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> otr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>OA</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> IH <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ξ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ</span>"</span></span>
                       <span class=keyword2><span class=keyword>and</span></span> cr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
    <span class=keyword1><span class=command>from</span></span> otr <span class=keyword2><span class=keyword>and</span></span> spo <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ξ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ'</span>"</span></span>
                               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oseq_step_is_seq_step<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> sp <span class=keyword1><span class=command>have</span></span> ctr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> ctr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ'</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ξ</span><span class=main>.</span> <span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=bound>ξ</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="OAWN_Convert-reachable_oseq_seqp_sos'"><span class=command>lemma</span></span> reachable_oseq_seqp_sos'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=free>OA</span> <span class=free>I</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"initiali <span class=free>i</span> <span class=main>(</span>init <span class=free>OA</span><span class=main>)</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>OA</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ξ</span><span class=main>.</span> <span class=main>(</span>fst <span class=free>s</span><span class=main>)</span> <span class=free>i</span> <span class=main>=</span> <span class=bound>ξ</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> snd <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>s</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> reachable_oseq_seqp_sos<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹
  Any invariant shown in the (simpler) closed semantics can be transferred to an invariant in
  the open semantics.
›</span></span>

<span class=keyword1><span class=command>theorem</span></span> open_seq_invariant <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"initiali <span class=free>i</span> <span class=main>(</span>init <span class=free>OA</span><span class=main>)</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> spo<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>OA</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>OA</span> <span class=main>⊨</span> <span class=main>(</span>act <span class=free>I</span><span class=main>,</span> other <span class=free>ANY</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> <span class=main>(</span>seql <span class=free>i</span> <span class=free>P</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>OA</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=main>(</span>seql <span class=free>i</span> <span class=free>P</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> invariant_arbitraryI<span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>                                      
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=free>OA</span> <span class=free>I</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹initiali <span class=free>i</span> <span class=main>(</span>init <span class=free>OA</span><span class=main>)</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ξ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ</span>"</span></span>
                                                        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> reachable_oseq_seqp_sos' <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ _ spo sp<span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>⊫</span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> snd <span class=skolem>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span>fst <span class=skolem>s</span><span class=main>)</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"seql <span class=free>i</span> <span class=free>P</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> spo <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"subreachable <span class=free>OA</span> <span class=main>(</span>other <span class=free>ANY</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> open_closed_invariant<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>s</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"seql <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"seql <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>seqll</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'i</span> <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=tfree>'s</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'a</span> <span class=main>×</span> <span class=main>(</span><span class=tfree>'s</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span><span class=main>)</span> <span class=main>⇒</span> bool<span class=main>)</span>
               <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'a</span> <span class=main>×</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'i</span> <span class=main>⇒</span> <span class=tfree>'s</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span><span class=main>)</span> <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>seqll</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> <span class=bound>p'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OAWN_Convert-same_seqll><span class=command>lemma</span></span> same_seqll <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=free>σ<span class=hidden>⇩</span><sub>1</sub>'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>j</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=free>σ<span class=hidden>⇩</span><sub>2</sub>'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ<span class=hidden>⇩</span><sub>2</sub></span> <span class=bound>j</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"seqll <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ<span class=hidden>⇩</span><sub>1</sub>'</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ<span class=hidden>⇩</span><sub>2</sub>'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"seqll <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ<span class=hidden>⇩</span><sub>1</sub></span><span class=main>,</span>  <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ<span class=hidden>⇩</span><sub>2</sub></span><span class=main>,</span>  <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> seqll_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span><span class=main>)</span>

<span class=keyword1 id=OAWN_Convert-seqllI><span class=command>lemma</span></span> seqllI <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"seqll <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> seqll_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_Convert-seqllD><span class=command>lemma</span></span> seqllD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"seqll <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> seqll_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_Convert-seqllsimp><span class=command>lemma</span></span> seqllsimp<span class=main>:</span>
  <span class=quoted><span class=quoted>"seqll <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span> <span class=free>i</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=free>p'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> seqll_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OAWN_Convert-seqll_onll_swap><span class=command>lemma</span></span> seqll_onll_swap<span class=main>:</span>
  <span class=quoted><span class=quoted>"seqll <span class=free>i</span> <span class=main>(</span>onll <span class=free>Γ</span> <span class=free>P</span><span class=main>)</span> <span class=main>=</span> onll <span class=free>Γ</span> <span class=main>(</span>seqll <span class=free>i</span> <span class=free>P</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> seqll_def onll_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>theorem</span></span> open_seq_step_invariant <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"initiali <span class=free>i</span> <span class=main>(</span>init <span class=free>OA</span><span class=main>)</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> spo<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>OA</span> <span class=main>=</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sp<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=free>A</span> <span class=main>=</span> seqp_sos <span class=free>Γ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>OA</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>act <span class=free>I</span><span class=main>,</span> other <span class=free>ANY</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> <span class=main>(</span>seqll <span class=free>i</span> <span class=free>P</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>OA</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=main>(</span>seqll <span class=free>i</span> <span class=free>P</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> step_invariant_arbitraryI<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>p'</span>
      <span class=keyword3><span class=command>assume</span></span> or<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>OA</span> <span class=free>I</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> otr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>OA</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>I</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> or <span class=quoted><span class=quoted>‹initiali <span class=free>i</span> <span class=main>(</span>init <span class=free>OA</span><span class=main>)</span> <span class=main>(</span>init <span class=free>A</span><span class=main>)</span>›</span></span> spo sp <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ξ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ</span>"</span></span>
                                                             <span class=keyword2><span class=keyword>and</span></span> cr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=free>A</span> <span class=free>I</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span><span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> reachable_oseq_seqp_sos'<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> otr <span class=keyword2><span class=keyword>and</span></span> spo <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ξ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ'</span>"</span></span>
                                 <span class=keyword2><span class=keyword>and</span></span> ctr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos <span class=free>Γ</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oseq_step_is_seq_step<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> sp <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=free>I</span> <span class=main>→)</span> <span class=free>P</span>›</span></span> cr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ξ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>I</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>ξ'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"seqll <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> spo <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"local_steps <span class=main>(</span>trans <span class=free>OA</span><span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other_steps <span class=main>(</span>other <span class=free>ANY</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> open_closed_step_invariant<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>ζ</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>ζ'</span> <span class=skolem>s</span> <span class=skolem>s'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>σ</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>ζ</span> <span class=bound>j</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>ζ'</span> <span class=bound>j</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"seqll <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"seqll <span class=free>i</span> <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>ζ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ζ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=Qmsg><div class=head><h1>Theory Qmsg</h1></div><pre class=source><span class=comment1>(*  Title:       Qmsg.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Model the standard queuing model"</span></span>

<span class=keyword1><span class=command>theory</span></span> Qmsg
<span class=keyword2><span class=keyword>imports</span></span> <a href=AWN_SOS_Labels.html>AWN_SOS_Labels</a> <a href=AWN_Invariants.html>AWN_Invariants</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Define the queue process›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'m</span> list<span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> unit<span class=main>,</span> unit label<span class=main>)</span> seqp_env"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub></span> <span class=main>()</span> <span class=main>=</span> labelled <span class=main>()</span> <span class=main>(</span><span class=keyword1>receive(</span><span class=main>λ</span><span class=bound>msg</span> <span class=bound>msgs</span><span class=main>.</span> <span class=bound>msgs</span> <span class=main>@</span> <span class=main>[</span><span class=bound>msg</span><span class=main>]</span><span class=main>)</span><span class=main>.</span> <span class=keyword1>call(</span><span class=main>()</span><span class=main>)</span>
           <span class=main>⊕</span> <span class=main>⟨</span><span class=bound><span class=bound>msgs</span></span><span class=main>.</span> <span class=bound>msgs</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>⟩</span>
               <span class=main>(</span><span class=keyword1>send(</span><span class=main>λ</span><span class=bound>msgs</span><span class=main>.</span> hd <span class=bound>msgs</span><span class=main>)</span><span class=main>.</span>
                 <span class=main>(</span><span class=main>⟦</span><span class=bound>msgs</span><span class=main>.</span> tl <span class=bound>msgs</span><span class=main>⟧</span> <span class=keyword1>call(</span><span class=main>()</span><span class=main>)</span>
                  <span class=main>⊕</span> <span class=keyword1>receive(</span><span class=main>λ</span><span class=bound>msg</span> <span class=bound>msgs</span><span class=main>.</span> tl <span class=bound>msgs</span> <span class=main>@</span> <span class=main>[</span><span class=bound>msg</span><span class=main>]</span><span class=main>)</span><span class=main>.</span> <span class=keyword1>call(</span><span class=main>()</span><span class=main>)</span><span class=main>)</span>
              <span class=main>⊕</span> <span class=keyword1>receive(</span><span class=main>λ</span><span class=bound>msg</span> <span class=bound>msgs</span><span class=main>.</span> <span class=bound>msgs</span> <span class=main>@</span> <span class=main>[</span><span class=bound>msg</span><span class=main>]</span><span class=main>)</span><span class=main>.</span> <span class=keyword1>call(</span><span class=main>()</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'m</span><span class=main>::</span>msg<span class=main>)</span> list <span class=main>×</span> <span class=main>(</span><span class=tfree>'m</span> list<span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> unit<span class=main>,</span> unit label<span class=main>)</span> seqp<span class=main>)</span> set"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub></span> <span class=main>≡</span> <span class=main>{</span><span class=main>(</span><span class=main>[]</span><span class=main>,</span> Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=main>()</span><span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>qmsg</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=tfree>'m</span><span class=main>::</span>msg<span class=main>)</span> list <span class=main>×</span> <span class=main>(</span><span class=tfree>'m</span> list<span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> unit<span class=main>,</span> unit label<span class=main>)</span> seqp<span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>qmsg</span> <span class=main>≡</span> <span class=main>⦇</span> init <span class=main>=</span> σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub><span class=main>,</span> trans <span class=main>=</span> seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=main>⦈</span>"</span></span>

<span class=keyword1><span class=command>declare</span></span> Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>.simps <span class=main>[</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main>,</span> <span class=operator>code</span> <span class=quasi_keyword>del</span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_simps <span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span> <span class=main>=</span> Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>.simps <span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1 id=Qmsg-σ><span class=command>lemma</span></span> σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_not_empty <span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Qmsg-σ><span class=command>lemma</span></span> σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_exists <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>qmsg</span> <span class=bound>q</span><span class=main>.</span> <span class=main>(</span><span class=bound>qmsg</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span> <span class=main>∈</span> σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Qmsg-qmsg_wf><span class=command>lemma</span></span> qmsg_wf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"wellformed Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> wf_no_direct_calls<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lemmas</span></span> qmsg_labels_not_empty <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> labels_not_empty <span class=main>[</span><span class=operator>OF</span> qmsg_wf<span class=main>]</span>

<span class=keyword1 id=Qmsg-qmsg_control_within><span class=command>lemma</span></span> qmsg_control_within <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"control_within Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=main>(</span>init qmsg<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> control_withinI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_simps<span class=main>)</span>

<span class=keyword1 id=Qmsg-qmsg_simple_labels><span class=command>lemma</span></span> qmsg_simple_labels <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"simple_labels Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> simple_labels_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Qmsg-qmsg_trans><span class=command>lemma</span></span> qmsg_trans<span class=main>:</span> <span class=quoted><span class=quoted>"trans qmsg <span class=main>=</span> seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Qmsg-σ><span class=command>lemma</span></span> σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_labels <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>q</span><span class=main>)</span> <span class=main>∈</span> σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=main>⟹</span>  labels Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=free>q</span> <span class=main>=</span> <span class=main>{</span><span class=main>()</span><span class=main>-:</span><span class=main>0</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Qmsg-qmsg_proc_cases><span class=command>lemma</span></span> qmsg_proc_cases <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>p</span> <span class=free>pn</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span>Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=free>pn</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span>Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=main>()</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>declare</span></span>
  Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_simps <span class=main>[</span><span class=operator>cterms_env</span><span class=main>]</span>
  qmsg_proc_cases <span class=main>[</span><span class=operator>ctermsl_cases</span><span class=main>]</span>
  seq_invariant_ctermsI <span class=main>[</span><span class=operator>OF</span> qmsg_wf qmsg_control_within qmsg_simple_labels qmsg_trans<span class=main>,</span> <span class=operator>cterms_intros</span><span class=main>]</span>
  seq_step_invariant_ctermsI <span class=main>[</span><span class=operator>OF</span> qmsg_wf qmsg_control_within qmsg_simple_labels qmsg_trans<span class=main>,</span> <span class=operator>cterms_intros</span><span class=main>]</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=Qmsg_Lifting><div class=head><h1>Theory Qmsg_Lifting</h1></div><pre class=source><span class=comment1>(*  Title:       Qmsg_Lifting.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Lifting rules for parallel compositions with QMSG"</span></span>

<span class=keyword1><span class=command>theory</span></span> Qmsg_Lifting
<span class=keyword2><span class=keyword>imports</span></span> <a href=Qmsg.html>Qmsg</a> <a href=OAWN_SOS.html>OAWN_SOS</a> <a href=Inv_Cterms.html>Inv_Cterms</a> <a href=OAWN_Invariants.html>OAWN_Invariants</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=Qmsg_Lifting-oseq_no_change_on_send><span class=command>lemma</span></span> oseq_no_change_on_send<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>σ</span> <span class=free>s</span> <span class=free>a</span> <span class=free>σ'</span> <span class=free>s'</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>case</span> <span class=free>a</span> <span class=keyword1>of</span>
           broadcast <span class=bound>m</span>     <span class=main>⇒</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>
         <span class=main>|</span> groupcast <span class=bound>ips</span> <span class=bound>m</span> <span class=main>⇒</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>
         <span class=main>|</span> unicast <span class=bound>ips</span> <span class=bound>m</span>   <span class=main>⇒</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>
         <span class=main>|</span> <span class=keyword1>¬unicast</span> <span class=bound>ips</span>    <span class=main>⇒</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>
         <span class=main>|</span> send <span class=bound>m</span>          <span class=main>⇒</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>
         <span class=main>|</span> deliver <span class=bound>m</span>       <span class=main>⇒</span> <span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>
         <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> True"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>induction</span> <span class=operator>simp_all</span>

<span class=keyword1 id=Qmsg_Lifting-qmsg_no_change_on_send_or_receive><span class=command>lemma</span></span> qmsg_no_change_on_send_or_receive<span class=main>:</span>
    <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>σ</span> <span class=free>s</span> <span class=free>a</span> <span class=free>σ'</span> <span class=free>s'</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>s</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=main>(</span>oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span>seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=keyword1>τ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=skolem><span class=skolem>q'</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>p</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>p'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=main>(</span>oseqp_sos <span class=free>Γ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span>seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>s</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>s'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oseqp_sos <span class=free>Γ</span> <span class=free>i</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free>a</span> <span class=main>≠</span> receive <span class=bound>m</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=keyword1>τ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span> oseq_no_change_on_send<span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>q</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>"</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=free>σ</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=keyword1>τ</span>"</span></span> <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=keyword1>τ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Qmsg_Lifting-qmsg_msgs_not_empty><span class=command>lemma</span></span> qmsg_msgs_not_empty<span class=main>:</span>
  <span class=quoted><span class=quoted>"qmsg <span class=main>⊫</span> onl Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>msgs</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>.</span> <span class=bound>l</span> <span class=main>=</span> <span class=main>()</span><span class=main>-:</span><span class=main>1</span> <span class=main>⟶</span> <span class=bound>msgs</span> <span class=main>≠</span> <span class=main>[]</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>inv_cterms</span>

<span class=keyword1 id=Qmsg_Lifting-qmsg_send_from_queue><span class=command>lemma</span></span> qmsg_send_from_queue<span class=main>:</span>
  <span class=quoted><span class=quoted>"qmsg <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>msgs</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> sendmsg <span class=main>(</span><span class=main>λ</span><span class=bound>m</span><span class=main>.</span> <span class=bound>m</span><span class=main>∈</span>set <span class=bound>msgs</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"qmsg <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> onll Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>msgs</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> sendmsg <span class=main>(</span><span class=main>λ</span><span class=bound>m</span><span class=main>.</span> <span class=bound>m</span><span class=main>∈</span>set <span class=bound>msgs</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>inv_cterms</span> <span class=quasi_keyword>inv</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onl_invariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> qmsg_wf qmsg_msgs_not_empty<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step_invariant_weakenE<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onllD<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Qmsg_Lifting-qmsg_queue_contents><span class=command>lemma</span></span> qmsg_queue_contents<span class=main>:</span>
  <span class=quoted><span class=quoted>"qmsg <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>msgs</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>msgs'</span><span class=main>,</span> <span class=bound>q'</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=keyword1>case</span> <span class=bound>a</span> <span class=keyword1>of</span>
                                             receive <span class=bound>m</span> <span class=main>⇒</span> set <span class=bound>msgs'</span> <span class=main>⊆</span> set <span class=main>(</span><span class=bound>msgs</span> <span class=main>@</span> <span class=main>[</span><span class=bound>m</span><span class=main>]</span><span class=main>)</span>
                                           <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> set <span class=bound>msgs'</span> <span class=main>⊆</span> set <span class=bound>msgs</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"qmsg <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> onll Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>msgs</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>msgs'</span><span class=main>,</span> <span class=bound>q'</span><span class=main>)</span><span class=main>)</span><span class=main>.</span>
                                     <span class=keyword1>case</span> <span class=bound>a</span> <span class=keyword1>of</span>
                                       receive <span class=bound>m</span> <span class=main>⇒</span> set <span class=bound>msgs'</span> <span class=main>⊆</span> set <span class=main>(</span><span class=bound>msgs</span> <span class=main>@</span> <span class=main>[</span><span class=bound>m</span><span class=main>]</span><span class=main>)</span>
                                     <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> set <span class=bound>msgs'</span> <span class=main>⊆</span> set <span class=bound>msgs</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>inv_cterms</span><span class=main>)</span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> in_set_tl<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step_invariant_weakenE<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onllD<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Qmsg_Lifting-qmsg_send_receive_or_tau><span class=command>lemma</span></span> qmsg_send_receive_or_tau<span class=main>:</span>
  <span class=quoted><span class=quoted>"qmsg <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> send <span class=bound>m</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> receive <span class=bound>m</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
   <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"qmsg <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> onll Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> <span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> send <span class=bound>m</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> receive <span class=bound>m</span> <span class=main>∨</span> <span class=bound>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>)</span>"</span></span>
     <span class=keyword1><span class=command>by</span></span> <span class=operator>inv_cterms</span>
   <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onllD<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Qmsg_Lifting-par_qmsg_oreachable><span class=command>lemma</span></span> par_qmsg_oreachable<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=free>A</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg<span class=main>)</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>R</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
           <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>∈</span> oreachable <span class=main>_</span> <span class=var>?owS</span> <span class=main>_</span>"</span></span><span class=main>)</span>
      <span class=keyword2><span class=keyword>and</span></span> pinv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>R</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                       globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> ustutter<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sgivesu<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>ξ'</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ'</span> <span class=main>⟹</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> upreservesq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>m</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>j</span><span class=main>)</span><span class=main>;</span> <span class=free>R</span> <span class=bound>σ</span> <span class=bound>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>R</span> <span class=bound>σ'</span> <span class=bound>m</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> fst <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>
         <span class=main>∧</span> snd <span class=free>ζ</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=free>σ</span><span class=main>)</span><span class=main>)</span>
         <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=main>(</span>fst <span class=main>(</span>snd <span class=free>ζ</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free>R</span> <span class=free>σ</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quasi_keyword>rule</span><span class=main><span class=main>:</span></span> oreachable_pair_induct<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>pq</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>pq</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>A</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg<span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=skolem><span class=skolem>ms</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>pq</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>p</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span>"</span></span>
                         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> init <span class=free>A</span>"</span></span>
                         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> init qmsg"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_simps<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> init qmsg›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> init qmsg›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ms</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> fst <span class=skolem>pq</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>
                     <span class=main>∧</span> snd <span class=skolem>pq</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span>
                     <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=main>(</span>fst <span class=main>(</span>snd <span class=skolem>pq</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>pq</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>p</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword1><span class=command>note</span></span> Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_simps <span class=main>[</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main>]</span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>other <span class=skolem>σ</span> <span class=skolem>pq</span> <span class=skolem>σ'</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> fst <span class=skolem>pq</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> qr<span class=main>:</span> <span class=quoted><span class=quoted>"snd <span class=skolem>pq</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=main>(</span>fst <span class=main>(</span>snd <span class=skolem>pq</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ</span> <span class=bound>m</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> ustutter <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherE<span class=main>)</span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span>
     <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> fst <span class=skolem>pq</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> fst <span class=skolem>pq</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> oreachable_other'<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=main>(</span>fst <span class=main>(</span>snd <span class=skolem>pq</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ'</span> <span class=bound>m</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>∈</span> set <span class=main>(</span>fst <span class=main>(</span>snd <span class=skolem>pq</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=main>(</span>fst <span class=main>(</span>snd <span class=skolem>pq</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ</span> <span class=bound>m</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ'</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> upreservesq<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> qr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"snd <span class=skolem>pq</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> recvmsgE <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> R<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free><span class=quoted><span class=free>R</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span> <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ'</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> upreservesq<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span> <span class=keyword1><span class=command>using</span></span> qr <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>local <span class=skolem>σ</span> <span class=skolem>pq</span> <span class=skolem>σ'</span> <span class=skolem>pq'</span> <span class=skolem>a</span><span class=main>)</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=skolem><span class=skolem>ms</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=skolem><span class=skolem>ms'</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>pq</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>p</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span>"</span></span>
                              <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>pq'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>p'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>pq</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>pq'</span></span><span class=main>)</span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>with</span></span> local.hyps local.IH
      <span class=keyword1><span class=command>have</span></span> pqtr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>p</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>p'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=main>(</span>trans <span class=free>A</span><span class=main>)</span> <span class=main>(</span>seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> por<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> qr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ</span> <span class=bound>m</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_simps<span class=main>)</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwith_syncD<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> sgivesu <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"orecvmsg <span class=free>R</span> <span class=skolem>σ</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> otherwithE<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>..</span></span>

    <span class=keyword1><span class=command>from</span></span> pqtr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>
                  <span class=main>∧</span> <span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span><span class=main>)</span>
                  <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms'</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ'</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> receive <span class=bound>m</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> ptr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> pinv por <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ostep_invariantD<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>hence</span></span> recvmsg'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span><span class=main>.</span> recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span> <span class=bound>a</span> <span class=main>⟹</span> recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span> <span class=bound>a</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> recvmsgE <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> R<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>R</span></span><span class=main><span class=main>]</span></span> upreservesq<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> por ptr <span class=quoted><span class=quoted>‹<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> oreachable_local'<span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>from</span></span> qr <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> reachable_weakenE<span class=main>)</span> <span class=main>(</span><span class=operator>erule</span> recvmsg'<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms'</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ'</span> <span class=bound>m</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span><span class=main>∈</span>set <span class=skolem>ms'</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span><span class=main>∈</span>set <span class=skolem>ms</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ</span> <span class=bound>m</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ'</span> <span class=skolem>m</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> upreservesq<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>

      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span>
        <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>
          <span class=main>∧</span> <span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span><span class=main>)</span>
          <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms'</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ'</span> <span class=bound>m</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> qtr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> send <span class=bound>m</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>=</span> <span class=skolem>p</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>

      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>4<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>hence</span></span> recvmsg'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span><span class=main>.</span> recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span> <span class=bound>a</span> <span class=main>⟹</span> recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span> <span class=bound>a</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> recvmsgE <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> R<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>R</span></span><span class=main><span class=main>]</span></span> upreservesq<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> qtr <span class=keyword1><span class=command>have</span></span> tqtr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans qmsg"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span>  <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> por <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p'</span> <span class=main>=</span> <span class=skolem>p</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> oreachable_other<span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> reachable_weakenE <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"recvmsg <span class=main><span class=main>(</span></span><span class=free><span class=free>R</span></span> <span class=skolem><span class=skolem>σ</span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>from</span></span> qr tqtr <span class=quoted><span class=quoted>‹recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span> <span class=skolem>a</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>rule</span> recvmsg'<span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms'</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ'</span> <span class=bound>m</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>∈</span> set <span class=skolem>ms'</span>"</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>case</span> <span class=skolem>a</span> <span class=keyword1>of</span> receive <span class=bound>m</span> <span class=main>⇒</span> set <span class=skolem>ms'</span> <span class=main>⊆</span> set <span class=main>(</span><span class=skolem>ms</span> <span class=main>@</span> <span class=main>[</span><span class=bound>m</span><span class=main>]</span><span class=main>)</span> <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> set <span class=skolem>ms'</span> <span class=main>⊆</span> set <span class=skolem>ms</span>"</span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
            <span class=keyword1><span class=command>from</span></span> qr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg TT"</span></span> <span class=keyword1><span class=command>..</span></span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> tqtr
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> step_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> qmsg_queue_contents<span class=main><span class=main>]</span></span><span class=main>)</span>
          <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ</span> <span class=bound>m</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹orecvmsg <span class=free>R</span> <span class=skolem>σ</span> <span class=skolem>a</span>›</span></span> 
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>a</span></span><span class=main>)</span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ'</span> <span class=skolem>m</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> upreservesq<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>

      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>
                     <span class=main>∧</span> <span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span><span class=main>)</span>
                     <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms'</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ'</span> <span class=bound>m</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> receive <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> send <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2-3<span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> ptr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> receive <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> qtr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> send <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans qmsg"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

      <span class=keyword1><span class=command>from</span></span> qr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg TT"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> qtr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>∈</span> set <span class=skolem>ms</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> step_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> qmsg_send_from_queue<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ</span> <span class=bound>m</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"orecvmsg <span class=free>R</span> <span class=skolem>σ</span> <span class=main>(</span>receive <span class=skolem>m</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=free>S</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>(</span>receive <span class=skolem>m</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwithI<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> pinv por ptr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ostep_invariantD<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> recvmsg'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span><span class=main>.</span> recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span> <span class=bound>a</span> <span class=main>⟹</span> recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span> <span class=bound>a</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> recvmsgE <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> R<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=free>R</span></span><span class=main><span class=main>]</span></span> upreservesq<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> por ptr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>(</span>receive <span class=skolem>m</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>erule</span><span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> oreachable_local<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> reachable_weakenE <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"recvmsg <span class=main><span class=main>(</span></span><span class=free><span class=free>R</span></span> <span class=skolem><span class=skolem>σ</span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span> <span class=main>(</span>send <span class=skolem>m</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>with</span></span> qr qtr <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>rule</span> recvmsg'<span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms'</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ'</span> <span class=bound>m</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span> <span class=main>∈</span> set <span class=skolem>ms'</span>"</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"set <span class=skolem>ms'</span> <span class=main>⊆</span> set <span class=skolem>ms</span>"</span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
            <span class=keyword1><span class=command>from</span></span> qr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg TT"</span></span> <span class=keyword1><span class=command>..</span></span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> qtr
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> step_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> qmsg_queue_contents<span class=main><span class=main>]</span></span><span class=main>)</span>
          <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ</span> <span class=bound>m</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ'</span> <span class=skolem>m</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> upreservesq<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>

      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>
                     <span class=main>∧</span> <span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ'</span><span class=main>)</span><span class=main>)</span>
                     <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>ms'</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ'</span> <span class=bound>m</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>pq</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>p</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>pq'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>p'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>ms'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?case</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_simps<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Qmsg_Lifting-par_qmsg_oreachable_statelessassm><span class=command>lemma</span></span> par_qmsg_oreachable_statelessassm<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=free>A</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg<span class=main>)</span>
                               <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>R</span><span class=main>)</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span>other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> ustutter<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> fst <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>R</span><span class=main>)</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span>other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>
         <span class=main>∧</span> snd <span class=free>ζ</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=free>R</span><span class=main>)</span>
         <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=main>(</span>fst <span class=main>(</span>snd <span class=free>ζ</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free>R</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=free>A</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg<span class=main>)</span>
                                <span class=main>(</span>otherwith <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>R</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                <span class=main>(</span>other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>R</span><span class=main>)</span><span class=main>)</span><span class=main>,</span>
                  other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> True<span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> fst <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span>
                           <span class=main>(</span>otherwith <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>R</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span>  *<span class=main>:</span> <span class=quoted><span class=quoted>"snd <span class=free>ζ</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=free>R</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=main>(</span>fst <span class=main>(</span>snd <span class=free>ζ</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=free>R</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> par_qmsg_oreachable<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> fst <span class=free>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>R</span><span class=main>)</span> <span class=bound>σ</span><span class=main>)</span> <span class=main>(</span>other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>using</span></span> * ** <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Qmsg_Lifting-lift_into_qmsg><span class=command>lemma</span></span> lift_into_qmsg<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>⊨</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>R</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> global <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>ξ'</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ'</span> <span class=main>⟹</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>m</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>j</span><span class=main>)</span><span class=main>;</span> <span class=free>R</span> <span class=bound>σ</span> <span class=bound>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>R</span> <span class=bound>σ'</span> <span class=bound>m</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>R</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                 globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg <span class=main>⊨</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>R</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> global <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> oinvariant_oreachableI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>ζ</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=free>A</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg<span class=main>)</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>R</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>R</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> par_qmsg_oreachable <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ assms<span class=main><span class=main><span class=main>(</span></span></span>5<span class=main><span class=main><span class=main>,</span></span></span>2-4<span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"global <span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> oinvariant_weakenD <span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main><span class=main>(</span></span></span>1<span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Qmsg_Lifting-lift_step_into_qmsg><span class=command>lemma</span></span> lift_step_into_qmsg<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> inv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>R</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> globala <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> ustutter<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span><span class=main>.</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> sgivesu<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>ξ</span> <span class=bound>ξ'</span><span class=main>.</span> <span class=free>S</span> <span class=bound>ξ</span> <span class=bound>ξ'</span> <span class=main>⟹</span> <span class=free>U</span> <span class=bound>ξ</span> <span class=bound>ξ'</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> upreservesq<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>m</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>j</span><span class=main>)</span><span class=main>;</span> <span class=free>R</span> <span class=bound>σ</span> <span class=bound>m</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>R</span> <span class=bound>σ'</span> <span class=bound>m</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> self_sync<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>R</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                            globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>

      <span class=keyword2><span class=keyword>and</span></span> recv_stutter<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>m</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=bound>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>j</span><span class=main>)</span><span class=main>;</span> <span class=bound>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=bound>σ</span> <span class=free>i</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> receive <span class=bound>m</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> receive_right<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>m</span><span class=main>.</span>  <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> receive <span class=bound>m</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=free>S</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>R</span><span class=main>)</span><span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> globala <span class=free>P</span>"</span></span>
      <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=var>?owS</span><span class=main>,</span> <span class=var>?U</span> <span class=main>→)</span> <span class=main>_</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>ζ</span> <span class=skolem>a</span> <span class=skolem>σ'</span> <span class=skolem>ζ'</span>
    <span class=keyword3><span class=command>assume</span></span> or<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span><span class=free>A</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg<span class=main>)</span> <span class=var>?owS</span> <span class=var>?U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> otr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>A</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg<span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=main>(</span>trans <span class=free>A</span><span class=main>)</span> <span class=main>(</span>seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>msgs</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=skolem><span class=skolem>s'</span></span> <span class=skolem><span class=skolem>msgs'</span></span> <span class=skolem><span class=skolem>q'</span></span>
      <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ζ</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ζ'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>s'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>s'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
               <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=main>(</span>trans <span class=free>A</span><span class=main>)</span> <span class=main>(</span>seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> prod_cases3<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1-2<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> or
      <span class=keyword3><span class=command>obtain</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=var>?U</span>"</span></span>
             <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span>"</span></span>
             <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>msgs</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ</span> <span class=bound>m</span><span class=main>)</span>"</span></span>
       <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> par_qmsg_oreachable <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ self_sync ustutter sgivesu<span class=main><span class=main>]</span></span>
                <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> upreservesq<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> otr <span class=quoted><span class=quoted>‹<span class=skolem>ζ</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ζ'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>s'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>s'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
              <span class=main>∈</span> oparp_sos <span class=free>i</span> <span class=main>(</span>trans <span class=free>A</span><span class=main>)</span> <span class=main>(</span>seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"globala <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=var>?U</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"globala <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> send <span class=bound>m</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> ustutter <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> sgivesu <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=free>U</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwith_syncD<span class=main>)</span> <span class=operator>metis</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>m</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>=</span> receive <span class=bound>m</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg TT"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans qmsg"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> send <span class=bound>m</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> step_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> qmsg_send_receive_or_tau<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"globala <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> receive_right recv_stutter step_seq_tau<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> receive <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> send <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>"</span></span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg <span class=main>(</span>recvmsg <span class=main>(</span><span class=free>R</span> <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span> <span class=main>∈</span> reachable qmsg TT"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> send <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> seqp_sos Γ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> send <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans qmsg"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>m</span><span class=main>∈</span>set <span class=skolem>msgs</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> step_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> qmsg_send_from_queue<span class=main><span class=main>]</span></span><span class=main>)</span>

      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>m</span><span class=main>∈</span>set <span class=skolem>msgs</span><span class=main>.</span> <span class=free>R</span> <span class=skolem>σ</span> <span class=bound>m</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>R</span> <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?owS</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>(</span>receive <span class=skolem>m</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwith_syncD<span class=main>)</span>

      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> receive <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>A</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"globala <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> receive <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=free>A</span> <span class=var>?owS</span> <span class=var>?U</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> ostep_invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> receive <span class=skolem>m</span><span class=main>,</span> <span class=skolem>σ'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>σ'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> receive_right<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"globala <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>s</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ζ</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ζ'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>s'</span><span class=main>,</span> <span class=main>(</span><span class=skolem>msgs'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"globala <span class=free>P</span> <span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Qmsg_Lifting-lift_step_into_qmsg_statelessassm><span class=command>lemma</span></span> lift_step_into_qmsg_statelessassm<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>R</span><span class=main>)</span> <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> globala <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>m</span><span class=main>.</span> <span class=bound>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=bound>σ</span> <span class=free>i</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> receive <span class=bound>m</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> receive <span class=bound>m</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>R</span><span class=main>)</span> <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> globala <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>R</span><span class=main>)</span><span class=main>)</span><span class=main>,</span>
                                 other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> globala <span class=free>P</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span>
              <span class=main>(</span>otherwith <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=free>R</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> globala <span class=free>P</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> lift_step_into_qmsg<span class=main>)</span>
         <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>2-3<span class=main><span class=main>)</span></span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> step_seq_tau<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=OClosed_Transfer><div class=head><h1>Theory OClosed_Transfer</h1></div><pre class=source><span class=comment1>(*  Title:       OClosed_Transfer.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Transfer open results onto closed models"</span></span>

<span class=keyword1><span class=command>theory</span></span> OClosed_Transfer
<span class=keyword2><span class=keyword>imports</span></span> <a href=Closed.html>Closed</a> <a href=OClosed_Lifting.html>OClosed_Lifting</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>locale</span></span> openproc <span class=main>=</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>np</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"ip <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=main>(</span><span class=tfree>'m</span><span class=main>::</span>msg<span class=main>)</span> seq_action<span class=main>)</span> automaton"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=free>onp</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ip <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> <span class=tfree>'g</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=free>sr</span>  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'s</span> <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'g</span> <span class=main>×</span> <span class=tfree>'l</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span>  init<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span> <span class=main>|</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>
                             <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span> <span class=main>=</span> <span class=free>sr</span> <span class=bound>s</span>
                             <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=keyword1>o</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span> <span class=main>⊆</span> init <span class=main>(</span><span class=free>onp</span> <span class=free>i</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> init_notempty<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>j</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> trans<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>a</span> <span class=bound>s'</span> <span class=bound>σ</span> <span class=bound>σ'</span><span class=main>.</span> <span class=main>⟦</span> <span class=bound>σ</span> <span class=free>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>;</span>
                                  <span class=bound>σ'</span> <span class=free>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>;</span>
                                  <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span> <span class=main>⟧</span>
                   <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=free>i</span><span class=main>)</span>"</span></span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1 id=OClosed_Transfer-init_pnet_p_NodeS><span class=command>lemma</span></span> init_pnet_p_NodeS<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"NodeS <span class=free>i</span> <span class=free>s</span> <span class=free>R</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>⟨</span><span class=free>i</span><span class=main>;</span> <span class=free>R</span><span class=main>⟩</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comps<span class=main>)</span>

<span class=keyword1 id=OClosed_Transfer-init_pnet_p_SubnetS><span class=command>lemma</span></span> init_pnet_p_SubnetS<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=free>s1</span> <span class=free>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>p1</span> <span class=free>p2</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>=</span> <span class=main>(</span><span class=free>p1</span> <span class=main>∥</span> <span class=free>p2</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p1</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comps<span class=main>)</span>

<span class=keyword1 id=OClosed_Transfer-init_pnet_fst_sr_netgmap><span class=command>lemma</span></span> init_pnet_fst_sr_netgmap<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>p</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>s</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=main>(</span>NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p</span>"</span></span>
    <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>=</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init_pnet_p_NodeS<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> node_comps<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span> <span class=main>∈</span> net_ips <span class=main>(</span>NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span>›</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>)</span><span class=main>)</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s1</span> <span class=skolem>s2</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span><span class=main>.</span> <span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=bound>p</span><span class=main>)</span>
                  <span class=main>⟹</span> <span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s1</span>
                  <span class=main>⟹</span> wf_net_tree <span class=bound>p</span>
                  <span class=main>⟹</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>p</span><span class=main>.</span> <span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=bound>p</span><span class=main>)</span>
                  <span class=main>⟹</span> <span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s2</span>
                  <span class=main>⟹</span> wf_net_tree <span class=bound>p</span>
                  <span class=main>⟹</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p1</span></span> <span class=skolem><span class=skolem>p2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
                                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>"</span></span>
                                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init_pnet_p_SubnetS<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>p</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p1</span>"</span></span>
                                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p2</span>"</span></span>
                                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>p1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span> <span class=main>∈</span> net_ips <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s1</span> <span class=main>∨</span> <span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s2</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s1</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_ips <span class=skolem>s2</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s1</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p1</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>p1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∉</span>net_tree_ips <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>›</span></span>  <span class=quoted><span class=quoted>‹<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s1</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>p1</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s2</span>"</span></span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span> <span class=free>i</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>p2</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>s2</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-init_lifted><span class=command>lemma</span></span> init_lifted<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>p</span>"</span></span>                                                          
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>
                               <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>p</span> <span class=keyword1>then</span> <span class=bound>σ</span> <span class=bound>i</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span>
                                      <span class=keyword1>else</span> <span class=bound>σ</span> <span class=bound>i</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=keyword1>o</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span> <span class=main>⊆</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>p</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>R</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>⟨</span><span class=skolem>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span><span class=main>)</span>
            <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>j</span> <span class=main>∈</span> net_tree_ips <span class=main>⟨</span><span class=skolem>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span> <span class=keyword1>then</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span> <span class=bound>j</span><span class=main>)</span>
                   <span class=keyword1>else</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span><span class=main>}</span> <span class=main>⊆</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>⟨</span><span class=skolem>i</span><span class=main>;</span> <span class=skolem>R</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comps onode_comps<span class=main>)</span>
         <span class=main>(</span><span class=operator>rule</span> subsetD <span class=main><span class=main>[</span></span><span class=operator>OF</span> init<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p1</span> <span class=skolem>p2</span>
    <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p1</span>
                <span class=main>⟹</span> <span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>
                      <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>i</span> <span class=main>∈</span> net_tree_ips <span class=skolem>p1</span> <span class=keyword1>then</span> <span class=bound>σ</span> <span class=bound>i</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span>
                             <span class=keyword1>else</span> <span class=bound>σ</span> <span class=bound>i</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>}</span> <span class=main>⊆</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p1</span><span class=main>)</span>"</span></span>
                <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>⟹</span> <span class=var>?S1</span> <span class=main>⊆</span> <span class=main>_</span>"</span></span><span class=main>)</span>
       <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p2</span>
                 <span class=main>⟹</span> <span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>
                       <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>i</span> <span class=main>∈</span> net_tree_ips <span class=skolem>p2</span> <span class=keyword1>then</span> <span class=bound>σ</span> <span class=bound>i</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span>
                              <span class=keyword1>else</span> <span class=bound>σ</span> <span class=bound>i</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>}</span> <span class=main>⊆</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
                <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>⟹</span> <span class=var>?S2</span> <span class=main>⊆</span> <span class=main>_</span>"</span></span><span class=main>)</span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p1</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>p2</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>p1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>
            <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>i</span> <span class=main>∈</span> net_tree_ips <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span> <span class=keyword1>then</span> <span class=bound>σ</span> <span class=bound>i</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span>
                   <span class=keyword1>else</span> <span class=bound>σ</span> <span class=bound>i</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>}</span> <span class=main>⊆</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> split_paired_all pnet.simps automaton.simps<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>s1</span> <span class=skolem>s2</span>
      <span class=keyword3><span class=command>assume</span></span> σ_desc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>i</span> <span class=main>∈</span> net_tree_ips <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span>
                          <span class=keyword1>then</span> <span class=skolem>σ</span> <span class=bound>i</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span>
                          <span class=keyword1>else</span> <span class=skolem>σ</span> <span class=bound>i</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>i</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2-3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>p1</span>"</span></span>
                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?S1</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>{</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=skolem>p1</span>"</span></span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>p1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_ips <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span> <span class=main>++</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>{</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p1</span>"</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=skolem>i</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=skolem>p2</span>"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p2</span>"</span></span>
            <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p1</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> σ_desc <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> spec <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=skolem>i</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=skolem>p2</span>"</span></span>
            <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_ips <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
            <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>p2</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init_pnet_fst_sr_netgmap<span class=main>)</span>
            <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p2</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=skolem>s2</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>using</span></span> σ_desc <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> σ_desc <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p1</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subsetD <span class=main><span class=main>[</span></span><span class=operator>OF</span> IH1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>p1</span>›</span></span><span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?S2</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>{</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=skolem>p2</span>"</span></span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_ips <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span><span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span> <span class=main>++</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>{</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p2</span>"</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=skolem>i</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=skolem>p1</span>"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p1</span>"</span></span>
            <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p2</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> σ_desc <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> spec <span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=skolem>i</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=skolem>p1</span>"</span></span>
            <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_ips <span class=skolem>s1</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
            <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p1</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>p1</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init_pnet_fst_sr_netgmap<span class=main>)</span>
            <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=skolem>p2</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∉</span>net_ips <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
            <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=skolem>p1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=skolem>s1</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∉</span>net_tree_ips <span class=skolem>p2</span>›</span></span> σ_desc <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>}</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>p2</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> σ_desc <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p2</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subsetD <span class=main><span class=main>[</span></span><span class=operator>OF</span> IH2 <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>p2</span>›</span></span><span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>

      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>p1</span><span class=main>)</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>p1</span> <span class=main>∥</span> <span class=skolem>p2</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>p1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>p2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
              <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>p1</span>›</span></span>
              <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>p2</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-init_pnet_opnet><span class=command>lemma</span></span> init_pnet_opnet <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>∈</span> netmask <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=free>p</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span> <span class=main>|</span><span class=bound>σ</span> <span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>
                              <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>p</span> <span class=keyword1>then</span> <span class=bound>σ</span> <span class=bound>i</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span>
                                     <span class=keyword1>else</span> <span class=bound>σ</span> <span class=bound>i</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=keyword1>o</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span> <span class=main>⊆</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p</span><span class=main>)</span>"</span></span>
        <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=main>⊆</span> <span class=main>_</span>"</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init_lifted<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"netmask <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> <span class=main>`</span> <span class=var>?S</span> <span class=main>⊆</span> netmask <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>p</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> image_mono<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>∈</span> netmask <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> <span class=main>`</span> <span class=var>?S</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>{</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
        <span class=keyword1><span class=command>from</span></span> init_notempty <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>}</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> init_notempty
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>if</span> <span class=bound>i</span> <span class=main>∈</span> net_tree_ips <span class=free>p</span>
                   <span class=keyword1>then</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=bound>i</span><span class=main>)</span>
                   <span class=keyword1>else</span> <span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>i</span><span class=main>)</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?S</span>"</span></span>
          <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?s</span> <span class=main>∈</span> <span class=var>?S</span>"</span></span><span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> <span class=var>?s</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>intro</span> prod_eqI ext<span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span>netmask <span class=main>(</span>net_tree_ips <span class=free>p</span><span class=main>)</span> <span class=var>?s</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>p</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>p</span>"</span></span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>s</span><span class=main>∈</span>init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=free>s</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Some <span class=main>(</span>the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> some_the_fst_netgmap<span class=main>)</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=free>p</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=free>p</span>"</span></span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> <span class=quoted><span class=quoted>‹<span class=free>s</span><span class=main>∈</span>init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∉</span>net_ips <span class=free>s</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> rev_image_eqI<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> rev_subsetD <span class=main><span class=main>[</span></span><span class=operator>rotated</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-transfer_connect><span class=command>lemma</span></span> transfer_connect<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>σ'</span> <span class=free>ζ'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=free>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>atomize_elim</span>
    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                     <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span> <span class=quoted><span class=free>ζ</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>ns</span> <span class=skolem>ns'</span> <span class=skolem>ζ</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comps<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ni</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>s'</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ni</span> <span class=skolem>s</span> <span class=skolem>R</span>"</span></span>
                                            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ni</span> <span class=skolem>s'</span> <span class=skolem>R'</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=skolem>ni</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> NodeS <span class=skolem>ni</span> <span class=skolem>s'</span> <span class=skolem>R'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ni</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ni</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R'</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> node_connectTE'<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onode_sos.intros <span class=main><span class=main>[</span></span><span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span> <span class=main>=</span> NodeS <span class=skolem>ni</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ni</span> <span class=skolem>s'</span> <span class=skolem>R'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>›</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>›</span></span>
          <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>
                <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=skolem>ns'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n1</span> <span class=skolem>n2</span> <span class=skolem>s</span> <span class=skolem>s'</span> <span class=skolem>ζ</span>
        <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>
                      <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT
                      <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                      <span class=main>⟹</span> wf_net_tree <span class=skolem>n1</span>
                      <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>
                          <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>
                      <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT
                      <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                      <span class=main>⟹</span> wf_net_tree <span class=skolem>n2</span>
                      <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>
                          <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> nm<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span>
                                                               <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s1</span></span> <span class=skolem><span class=skolem>s1'</span></span> <span class=skolem><span class=skolem>s2</span></span> <span class=skolem><span class=skolem>s2'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> partial_connectTE<span class=main>)</span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> nm <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n2</span>"</span></span>
                                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

        <span class=keyword1><span class=command>from</span></span> sr <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> subnet_reachable<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> sr <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> subnet_reachable<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> nm <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split1<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>›</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT›</span></span>
         <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n1</span>›</span></span> <span class=keyword1><span class=command>unfolding</span></span> atomize_conj <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split2<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT›</span></span>
         <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n2</span>›</span></span> <span class=keyword1><span class=command>unfolding</span></span> atomize_conj <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>

        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                         <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
          <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>›</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span>
                   <span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                           <span class=main>∈</span> opnet_sos <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> opnet_connect<span class=main>)</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>qed</span></span>

        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>›</span></span>
                      <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>›</span></span>
                      <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>

        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                                                <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>
                         <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>" <span class=main>∃</span><span class=bound>σ'</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>connect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                              <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span><span class=main>)</span>
                              <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-transfer_disconnect><span class=command>lemma</span></span> transfer_disconnect<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>σ'</span> <span class=free>ζ'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=free>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>atomize_elim</span>
    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                     <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span> <span class=quoted><span class=free>ζ</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>ns</span> <span class=skolem>ns'</span> <span class=skolem>ζ</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comps<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ni</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>s'</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ni</span> <span class=skolem>s</span> <span class=skolem>R</span>"</span></span>
                                            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ni</span> <span class=skolem>s'</span> <span class=skolem>R'</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=skolem>ni</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> NodeS <span class=skolem>ni</span> <span class=skolem>s'</span> <span class=skolem>R'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ni</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ni</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R'</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> node_disconnectTE'<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onode_sos.intros <span class=main><span class=main>[</span></span><span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span> <span class=main>=</span> NodeS <span class=skolem>ni</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ni</span> <span class=skolem>s'</span> <span class=skolem>R'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>›</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>›</span></span>
          <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>
                <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=skolem>ns'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n1</span> <span class=skolem>n2</span> <span class=skolem>s</span> <span class=skolem>s'</span> <span class=skolem>ζ</span>
        <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>
                      <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT
                      <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                      <span class=main>⟹</span> wf_net_tree <span class=skolem>n1</span>
                      <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>
                          <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>
                      <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT
                      <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                      <span class=main>⟹</span> wf_net_tree <span class=skolem>n2</span>
                      <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>
                          <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> nm<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span>
                                                               <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s1</span></span> <span class=skolem><span class=skolem>s1'</span></span> <span class=skolem><span class=skolem>s2</span></span> <span class=skolem><span class=skolem>s2'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> partial_disconnectTE<span class=main>)</span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> nm <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n2</span>"</span></span>
                                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

        <span class=keyword1><span class=command>from</span></span> sr <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> subnet_reachable<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> sr <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> subnet_reachable<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> nm <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
                <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split1<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>›</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT›</span></span>
         <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n1</span>›</span></span> <span class=keyword1><span class=command>unfolding</span></span> atomize_conj <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split2<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT›</span></span>
         <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>"</span></span>
           <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n2</span>›</span></span> <span class=keyword1><span class=command>unfolding</span></span> atomize_conj <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>

        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                         <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
          <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>›</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span>
                   <span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                           <span class=main>∈</span> opnet_sos <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> opnet_disconnect<span class=main>)</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>qed</span></span>

        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>›</span></span>
                      <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>›</span></span>
                      <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>

        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                                                <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>
                         <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ'</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>disconnect(</span><span class=free>i</span><span class=main>,</span> <span class=free>i'</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                              <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span><span class=main>)</span>
                              <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-transfer_tau><span class=command>lemma</span></span> transfer_tau<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>σ'</span> <span class=free>ζ'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=free>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>atomize_elim</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>4<span class=main>,</span>2<span class=main>,</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>i</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=free>s</span>"</span></span>
                                 <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> netmap <span class=free>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=free>s</span> <span class=bound>j</span>"</span></span>
                                 <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=free>n</span> <span class=free>s</span> <span class=free>s'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_tau_single_node<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> netmap_is_fst_netgmap'<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s'</span> <span class=main>=</span> net_ips <span class=free>s</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_maintains_dom <span class=main><span class=main>[</span></span><span class=operator>THEN</span> sym<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>σ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=skolem>j</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=skolem>j</span> <span class=main>=</span> <span class=skolem>i</span> <span class=keyword1>then</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>σ</span> <span class=skolem>j</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>j</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=bound>j</span>›</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> σ'_def <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>

    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=bound>j</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>›</span></span>
         <span class=quoted><span class=quoted>‹net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>›</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=free>s'</span> <span class=main>=</span> net_ips <span class=free>s</span>›</span></span>
         <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> σ'_def <span class=main>[</span><span class=operator>abs_def</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>

    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> prod_eqI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>,</span> 3<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span>4<span class=main>)</span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=free>s</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=free>n</span> <span class=free>s</span> <span class=free>s'</span>›</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span> <span class=quoted><span class=free>ζ</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>ns</span> <span class=skolem>ns'</span> <span class=skolem>ζ</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> nsr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ns</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> TT"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>ns'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=skolem>ns</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comps<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> nsr <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>s'</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>"</span></span>
                                           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R'</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_node_reachable_is_node node_tauTE'<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span> <span class=main>∈</span> net_ips <span class=skolem>ns</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ii</span> <span class=main>=</span> <span class=skolem>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> ntr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=skolem>i</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> NodeS <span class=skolem>i</span> <span class=skolem>s'</span> <span class=skolem>R'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>R'</span> <span class=main>=</span> <span class=skolem>R</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_state.inject<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> node_tauTE'<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> ntr <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
                          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>¬unicast</span> <span class=bound>d</span> <span class=main>∧</span> <span class=bound>d</span><span class=main>∉</span><span class=skolem>R</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> node_tauTE'<span class=main>)</span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ii</span> <span class=main>=</span> <span class=skolem>i</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>σ</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> map_upd_Some_unfold<span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span>›</span></span>
                    <span class=quoted><span class=quoted>‹<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ii</span> <span class=main>=</span> <span class=skolem>i</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> σ'_def <span class=main>[</span><span class=operator>abs_def</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span> <span class=main>(</span><span class=operator>hypsubst_thin</span><span class=main><span class=keyword3>,</span></span>
                                        <span class=operator>metis</span> <span class=main><span class=main>(</span></span>full_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> fun_upd_same option.sel<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>∃</span><span class=bound>d</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>¬unicast</span> <span class=bound>d</span> <span class=main>∧</span> <span class=bound>d</span><span class=main>∉</span><span class=skolem>R</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>R'</span><span class=main>=</span><span class=skolem>R</span>›</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>i</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=skolem>i</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> onode_sos.onode_notucast onode_sos.onode_tau<span class=main>)</span>

      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ii</span> <span class=main>=</span> <span class=skolem>i</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n1</span> <span class=skolem>n2</span> <span class=skolem>s</span> <span class=skolem>s'</span> <span class=skolem>ζ</span>
      <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>
                    <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                    <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT
                    <span class=main>⟹</span> wf_net_tree <span class=skolem>n1</span>
                    <span class=main>⟹</span> <span class=skolem>i</span><span class=main>∈</span>net_ips <span class=bound>s</span>
                    <span class=main>⟹</span> net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=skolem>n1</span> <span class=bound>s</span> <span class=bound>s'</span>
                    <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>
                    <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                    <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT
                    <span class=main>⟹</span> wf_net_tree <span class=skolem>n2</span>
                    <span class=main>⟹</span> <span class=skolem>i</span><span class=main>∈</span>net_ips <span class=bound>s</span>
                    <span class=main>⟹</span> net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=skolem>n2</span> <span class=bound>s</span> <span class=bound>s'</span>
                    <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> nm<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> nm'<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=skolem>s</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s1</span></span> <span class=skolem><span class=skolem>s1'</span></span> <span class=skolem><span class=skolem>s2</span></span> <span class=skolem><span class=skolem>s2'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
                                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> partial_tauTE<span class=main>)</span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> nm <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> nm'
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n1</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n2</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>from</span></span> sr <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subnet_reachable<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> sr <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subnet_reachable<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> nm <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span>
           <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split1<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> nm <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split2<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=skolem>s</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=skolem>s1</span> <span class=main>∨</span> <span class=skolem>i</span><span class=main>∈</span>net_ips <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=skolem>s1</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=skolem>n1</span> <span class=skolem>s1</span> <span class=skolem>s1'</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2'</span> <span class=main>=</span> <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_maintains_dom<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> nm' <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2'</span> <span class=main>=</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span>
                        <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
                        <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
                        <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split1<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT›</span></span>
             <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n1</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=skolem>s1</span>›</span></span>
             <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=skolem>n1</span> <span class=skolem>s1</span> <span class=skolem>s1'</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
             <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>

        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2'</span> <span class=main>=</span> <span class=skolem>s2</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> step_node_tau<span class=main>)</span> <span class=main>(</span><span class=operator>erule</span> opnet_tau1<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=skolem>s2</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=skolem>n2</span> <span class=skolem>s2</span> <span class=skolem>s2'</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1'</span> <span class=main>=</span> <span class=skolem>s1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_maintains_dom<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> nm' <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1'</span> <span class=main>=</span> <span class=skolem>s1</span>›</span></span><span class=main>]</span>
                        <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
                        <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split2<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT›</span></span>
             <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n2</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=skolem>s2</span>›</span></span>
             <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=keyword1>τ</span> <span class=skolem>i</span> <span class=skolem>n2</span> <span class=skolem>s2</span> <span class=skolem>s2'</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
             <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>

        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1'</span> <span class=main>=</span> <span class=skolem>s1</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> step_node_tau<span class=main>)</span> <span class=main>(</span><span class=operator>erule</span> opnet_tau2<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_ips_netgmap<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                     <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span><span class=main>)</span>
                     <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ'</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=keyword1>τ</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                  <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span><span class=main>)</span>
                  <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-transfer_deliver><span class=command>lemma</span></span> transfer_deliver<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>σ'</span> <span class=free>ζ'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=free>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>atomize_elim</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>4<span class=main>,</span>2<span class=main>,</span>1<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_ips <span class=free>s</span>"</span></span>
                         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> netmap <span class=free>s'</span> <span class=bound>j</span> <span class=main>=</span> netmap <span class=free>s</span> <span class=bound>j</span>"</span></span>
                         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=free>n</span> <span class=free>s</span> <span class=free>s'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> delivered_to_net_ips pnet_deliver_single_node<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=bound>j</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> netmap_is_fst_netgmap'<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s'</span> <span class=main>=</span> net_ips <span class=free>s</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_maintains_dom <span class=main><span class=main>[</span></span><span class=operator>THEN</span> sym<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>σ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=skolem>j</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=skolem>j</span> <span class=main>=</span> <span class=free>i</span> <span class=keyword1>then</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=free>i</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>σ</span> <span class=skolem>j</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>j</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=bound>j</span>›</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> σ'_def <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>

    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=bound>j</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=bound>j</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>›</span></span>
         <span class=quoted><span class=quoted>‹net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>›</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=free>s'</span> <span class=main>=</span> net_ips <span class=free>s</span>›</span></span>
         <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> σ'_def <span class=main>[</span><span class=operator>abs_def</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>

    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> prod_eqI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>,</span> 3<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span>4<span class=main>)</span> <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∈</span>net_ips <span class=free>s</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=free>n</span> <span class=free>s</span> <span class=free>s'</span>›</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span> <span class=quoted><span class=free>ζ</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>ns</span> <span class=skolem>ns'</span> <span class=skolem>ζ</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> nsr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ns</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> TT"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>ns'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>ns</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comps<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> nsr <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>s'</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=skolem><span class=skolem>R'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>"</span></span>
                                           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R'</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_node_reachable_is_node node_sos_dest<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span> <span class=main>∈</span> net_ips <span class=skolem>ns</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ii</span> <span class=main>=</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> ntr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=free>i</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=skolem>s'</span> <span class=skolem>R'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>R'</span> <span class=main>=</span> <span class=skolem>R</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_state.inject<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> node_deliverTE'<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> ntr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> deliver <span class=free>d</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> node_deliverTE'<span class=main>)</span> <span class=operator>simp</span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ii</span> <span class=main>=</span> <span class=free>i</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>σ</span> <span class=free>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> map_upd_Some_unfold<span class=main>)</span>

      <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span>›</span></span>
                    <span class=quoted><span class=quoted>‹<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ii</span> <span class=main>=</span> <span class=free>i</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> σ'_def <span class=main>[</span><span class=operator>abs_def</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span> <span class=main>(</span><span class=operator>hypsubst_thin</span><span class=main><span class=keyword3>,</span></span>
                                        <span class=operator>metis</span> <span class=main><span class=main>(</span></span>lifting<span class=main><span class=main>,</span></span> full_types<span class=main><span class=main>)</span></span> fun_upd_same option.sel<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> deliver <span class=free>d</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=free>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> deliver <span class=free>d</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=free>i</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>

      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>R'</span><span class=main>=</span><span class=skolem>R</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=free>i</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R'</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> onode_sos.onode_deliver<span class=main>)</span>

      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ii</span> <span class=main>=</span> <span class=free>i</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n1</span> <span class=skolem>n2</span> <span class=skolem>s</span> <span class=skolem>s'</span> <span class=skolem>ζ</span>
      <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>
                    <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                    <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT
                    <span class=main>⟹</span> wf_net_tree <span class=skolem>n1</span>
                    <span class=main>⟹</span> <span class=free>i</span><span class=main>∈</span>net_ips <span class=bound>s</span>
                    <span class=main>⟹</span> net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=skolem>n1</span> <span class=bound>s</span> <span class=bound>s'</span>
                    <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>
                    <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                    <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT
                    <span class=main>⟹</span> wf_net_tree <span class=skolem>n2</span>
                    <span class=main>⟹</span> <span class=free>i</span><span class=main>∈</span>net_ips <span class=bound>s</span>
                    <span class=main>⟹</span> net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=skolem>n2</span> <span class=bound>s</span> <span class=bound>s'</span>
                    <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> tr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> nm<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> nm'<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> tr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s1</span></span> <span class=skolem><span class=skolem>s1'</span></span> <span class=skolem><span class=skolem>s2</span></span> <span class=skolem><span class=skolem>s2'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
                                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> partial_deliverTE<span class=main>)</span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> nm <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> nm'
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=main>(</span>SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n1</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n2</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>from</span></span> sr <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subnet_reachable<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> sr <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subnet_reachable<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> nm <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span>
           <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split1<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> nm <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split2<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s1</span> <span class=main>∨</span> <span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s1</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=skolem>n1</span> <span class=skolem>s1</span> <span class=skolem>s1'</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2'</span> <span class=main>=</span> <span class=skolem>s2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_maintains_dom<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> nm' <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2'</span> <span class=main>=</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span>
                        <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
                        <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
                        <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split1<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT›</span></span>
             <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n1</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s1</span>›</span></span>
             <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=skolem>n1</span> <span class=skolem>s1</span> <span class=skolem>s1'</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
             <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>

        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s2'</span> <span class=main>=</span> <span class=skolem>s2</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>erule</span> opnet_deliver1<span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s2</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=skolem>n2</span> <span class=skolem>s2</span> <span class=skolem>s2'</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1'</span> <span class=main>=</span> <span class=skolem>s1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_maintains_dom<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> nm' <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1'</span> <span class=main>=</span> <span class=skolem>s1</span>›</span></span><span class=main>]</span>
                        <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
                        <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split2<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT›</span></span>
             <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n2</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=free>i</span><span class=main>∈</span>net_ips <span class=skolem>s2</span>›</span></span>
             <span class=quoted><span class=quoted>‹net_ip_action <span class=free>np</span> <span class=main>(</span><span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=skolem>n2</span> <span class=skolem>s2</span> <span class=skolem>s2'</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
             <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>

        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s1'</span> <span class=main>=</span> <span class=skolem>s1</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>erule</span> opnet_deliver2<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_ips_netgmap<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                     <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span><span class=main>)</span>
                     <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ'</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>i</span><span class=keyword1>:deliver(</span><span class=free>d</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                  <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span><span class=main>)</span>
                  <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="OClosed_Transfer-transfer_arrive'"><span class=command>lemma</span></span> transfer_arrive'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>H</span><span class=main>¬</span><span class=free>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span>  <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>H</span><span class=main>¬</span><span class=free>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>

    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s'</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_maintains_dom<span class=main>)</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ζ'</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1-3<span class=main>)</span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>›</span></span> assms<span class=main>(</span>5<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>H</span><span class=main>¬</span><span class=free>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span> <span class=quoted><span class=free>ζ</span></span> <span class=quoted><span class=free>H</span></span> <span class=quoted><span class=free>K</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>ns</span> <span class=skolem>ns'</span> <span class=skolem>ζ</span> <span class=skolem>H</span> <span class=skolem>K</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> nsr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ns</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> TT"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>ns'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comps<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> nsr <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>s'</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>"</span></span>
                                          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_node_reachable_is_node node_arriveTE'<span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> node_arriveTE<span class=main>)</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> receive <span class=free>m</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span>"</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>ii</span><span class=main>}</span>"</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>K</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
          <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>σ</span> <span class=skolem>ii</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> map_upd_Some_unfold<span class=main>)</span>
          <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span>›</span></span>
                        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R</span>›</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=skolem>ii</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> map_upd_Some_unfold<span class=main>)</span>
          <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> receive <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> receive <span class=free>m</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=main>{</span><span class=skolem>ii</span><span class=main>}</span><span class=main>¬</span><span class=main>{}</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> onode_receive<span class=main>)</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>H</span><span class=main>=</span><span class=main>{</span><span class=skolem>ii</span><span class=main>}</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>K</span><span class=main>=</span><span class=main>{}</span>›</span></span>
            <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>"</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>K</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>ii</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>›</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span>›</span></span>
                        <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>›</span></span>
                        <span class=quoted><span class=quoted>‹<span class=skolem>ns</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R</span>›</span></span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>σ'</span> <span class=skolem>ii</span> <span class=main>=</span> <span class=free>σ</span> <span class=skolem>ii</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> option.sel<span class=main>)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=main>{}</span><span class=main>¬</span><span class=main>{</span><span class=skolem>ii</span><span class=main>}</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> onode_arrive<span class=main>)</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>H</span><span class=main>=</span><span class=main>{}</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>K</span><span class=main>=</span><span class=main>{</span><span class=skolem>ii</span><span class=main>}</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> <span class=skolem>s</span>›</span></span>
          <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                     <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                                             <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n1</span> <span class=skolem>n2</span> <span class=skolem>s</span> <span class=skolem>s'</span> <span class=skolem>ζ</span> <span class=skolem>H</span> <span class=skolem>K</span>
      <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span> <span class=bound>H</span> <span class=bound>K</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>H</span><span class=main>¬</span><span class=bound>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>
                         <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT
                         <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                         <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                         <span class=main>⟹</span> wf_net_tree <span class=skolem>n1</span>
                         <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=bound>H</span><span class=main>¬</span><span class=bound>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                                                                        <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span> <span class=bound>H</span> <span class=bound>K</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>H</span><span class=main>¬</span><span class=bound>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>
                         <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT
                         <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                         <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                         <span class=main>⟹</span> wf_net_tree <span class=skolem>n2</span>
                         <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=bound>H</span><span class=main>¬</span><span class=bound>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                                                                        <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> nm<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> nm'<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span>
                                                              <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                                                   <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> partial_arriveTE<span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s1</span> <span class=skolem>s1'</span> <span class=skolem>s2</span> <span class=skolem>s2'</span> <span class=skolem>H1</span> <span class=skolem>H2</span> <span class=skolem>K1</span> <span class=skolem>K2</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> tr1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=skolem>H1</span><span class=main>¬</span><span class=skolem>K1</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> tr2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=skolem>H2</span><span class=main>¬</span><span class=skolem>K2</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=skolem>H1</span> <span class=main>∪</span> <span class=skolem>H2</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>K</span> <span class=main>=</span> <span class=skolem>K1</span> <span class=main>∪</span> <span class=skolem>K2</span>"</span></span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n1</span>"</span></span>
                                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n2</span>"</span></span>
                                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

        <span class=keyword1><span class=command>from</span></span> sr <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subnet_reachable<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> tr1 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_maintains_dom<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> sr <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subnet_reachable<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> tr2 <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_maintains_dom<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=skolem>H1</span><span class=main>¬</span><span class=skolem>K1</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H1</span><span class=main>¬</span><span class=skolem>K1</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                                                            <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> IH1 <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ _ _ _ <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n1</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
            <span class=keyword1><span class=command>from</span></span> nm <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span>
                 <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
                 <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
                 <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
              <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split1<span class=main>)</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword1><span class=command>from</span></span> nm' <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span><span class=main>]</span>
                 <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
                 <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
                 <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
              <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split1<span class=main>)</span>
          <span class=keyword1><span class=command>qed</span></span>

        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=skolem>H2</span><span class=main>¬</span><span class=skolem>K2</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span>
                      <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H2</span><span class=main>¬</span><span class=skolem>K2</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                                                            <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> IH2 <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ _ _ _ <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n2</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
            <span class=keyword1><span class=command>from</span></span> nm <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span>
                 <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
                 <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
              <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split2<span class=main>)</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword1><span class=command>from</span></span> nm' <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span><span class=main>]</span>
                 <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
                 <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
              <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>"</span></span>
                <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split2<span class=main>)</span>
          <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                                                     <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>H</span> <span class=main>=</span> <span class=skolem>H1</span> <span class=main>∪</span> <span class=skolem>H2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>K</span> <span class=main>=</span> <span class=skolem>K1</span> <span class=main>∪</span> <span class=skolem>K2</span>›</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule</span> opnet_sos.opnet_arrive<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=free>ζ'</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span>›</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>H</span><span class=main>¬</span><span class=free>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-transfer_arrive><span class=command>lemma</span></span> transfer_arrive<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>H</span><span class=main>¬</span><span class=free>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span>  <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>σ'</span> <span class=free>ζ'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>H</span><span class=main>¬</span><span class=free>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=free>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>atomize_elim</span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>σ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=skolem>i</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=free>n</span> <span class=keyword1>then</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>σ</span> <span class=skolem>i</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>i</span>

    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s'</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_maintains_dom<span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> prod_eqI<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=free>s'</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> σ'_def <span class=main>[</span><span class=operator>abs_def</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> assms<span class=main>(</span>1-3<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>H</span><span class=main>¬</span><span class=free>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=free>n</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> transfer_arrive'<span class=main>)</span>

    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>n</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>unfolding</span></span> σ'_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>3<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>)</span></span> net_ips_netgmap snd_conv<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>

    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ'</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>H</span><span class=main>¬</span><span class=free>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                          <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span><span class=main>)</span>
                          <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-transfer_cast><span class=command>lemma</span></span> transfer_cast<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>σ'</span> <span class=free>ζ'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=free>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>atomize_elim</span>
    <span class=keyword3><span class=command>define</span></span> <span class=skolem><span class=skolem>σ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=skolem>i</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=free>n</span> <span class=keyword1>then</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span> <span class=keyword1>else</span> <span class=free>σ</span> <span class=skolem>i</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>i</span>

    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s'</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_maintains_dom<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> prod_eqI<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=free>s'</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> σ'_def <span class=main>[</span><span class=operator>abs_def</span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> some_the_fst_netgmap<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=free>s'</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>›</span></span> 
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> σ'_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1-3<span class=main>)</span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>›</span></span> assms<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=free>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>induction</span> <span class=quoted><span class=free>n</span></span> <span class=quasi_keyword>arbitrary</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s'</span></span> <span class=quoted><span class=free>ζ</span></span> <span class=quoted><span class=free>mR</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ii</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span> <span class=skolem>ns</span> <span class=skolem>ns'</span> <span class=skolem>ζ</span> <span class=skolem>mR</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> nsr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>ns</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> TT"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>ns'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ns</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>ns'</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> node_comps<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> nsr <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s</span></span> <span class=skolem><span class=skolem>s'</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>"</span></span>
                                          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> net_node_reachable_is_node node_castTE'<span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span>  <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>σ</span> <span class=skolem>ii</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> map_upd_Some_unfold<span class=main>)</span>
        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>ns'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=skolem>ii</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> map_upd_Some_unfold<span class=main>)</span>

        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span>NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R</span><span class=main>)</span> <span class=main>∈</span> node_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> node_castTE<span class=main>)</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> broadcast <span class=free>m</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span>"</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>mR</span> <span class=main>=</span> <span class=skolem>R</span>"</span></span>
          <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>σ</span> <span class=skolem>ii</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=skolem>ii</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> this<span class=main>(</span>1<span class=main>)</span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> broadcast <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> onode_bcast<span class=main>)</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>mR</span> <span class=main>=</span> <span class=skolem>R</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>D</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> groupcast <span class=skolem>D</span> <span class=free>m</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span>"</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>mR</span> <span class=main>=</span> <span class=skolem>R</span> <span class=main>∩</span> <span class=skolem>D</span>"</span></span>
          <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>σ</span> <span class=skolem>ii</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=skolem>ii</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> this<span class=main>(</span>1<span class=main>)</span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> groupcast <span class=skolem>D</span> <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>R</span> <span class=main>∩</span> <span class=skolem>D</span><span class=main>)</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> onode_gcast<span class=main>)</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>mR</span> <span class=main>=</span> <span class=skolem>R</span> <span class=main>∩</span> <span class=skolem>D</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>d</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> unicast <span class=skolem>d</span> <span class=free>m</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=skolem>ii</span><span class=main>)</span>"</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>d</span> <span class=main>∈</span> <span class=skolem>R</span>"</span></span>
             <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>mR</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>d</span><span class=main>}</span>"</span></span>
          <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>σ</span> <span class=skolem>ii</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=skolem>ii</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> this<span class=main>(</span>1<span class=main>)</span>
            <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> unicast <span class=skolem>d</span> <span class=free>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span>"</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=main>{</span><span class=skolem>d</span><span class=main>}</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>d</span><span class=main>∈</span><span class=skolem>R</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> onode_ucast<span class=main>)</span>
          <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>mR</span><span class=main>=</span><span class=main>{</span><span class=skolem>d</span><span class=main>}</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> NodeS <span class=skolem>ii</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>R</span><span class=main>)</span><span class=main>)</span>
                                                                      <span class=main>∈</span> onode_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>ii</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s</span> <span class=skolem>R</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>ns'</span> <span class=main>=</span> NodeS <span class=skolem>ii</span> <span class=skolem>s'</span> <span class=skolem>R</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>ns'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                                             <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>⟨</span><span class=skolem>ii</span><span class=main>;</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onode_comps<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>n1</span> <span class=skolem>n2</span> <span class=skolem>s</span> <span class=skolem>s'</span> <span class=skolem>ζ</span> <span class=skolem>mR</span>
      <span class=keyword3><span class=command>assume</span></span> IH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span> <span class=bound>mR</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>
                         <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT
                         <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                         <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                         <span class=main>⟹</span> wf_net_tree <span class=skolem>n1</span>
                         <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=bound>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                                                                        <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> IH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>s</span> <span class=bound>s'</span> <span class=bound>ζ</span> <span class=bound>mR</span><span class=main>.</span> <span class=main>(</span><span class=bound>s</span><span class=main>,</span> <span class=bound>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=bound>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>
                         <span class=main>⟹</span> <span class=bound>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT
                         <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span>
                         <span class=main>⟹</span> netgmap <span class=free>sr</span> <span class=bound>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                         <span class=main>⟹</span> wf_net_tree <span class=skolem>n2</span>
                         <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=bound>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s'</span><span class=main>)</span><span class=main>)</span>
                                                                        <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> nm<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> nm'<span class=main>:</span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> pnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>s1</span></span> <span class=skolem><span class=skolem>s1'</span></span> <span class=skolem><span class=skolem>s2</span></span> <span class=skolem><span class=skolem>s2'</span></span> <span class=skolem><span class=skolem>H</span></span> <span class=skolem><span class=skolem>K</span></span>
        <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span>  <span class=main>=</span> SubnetS <span class=skolem>s1</span>  <span class=skolem>s2</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>⊆</span> <span class=skolem>mR</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>K</span> <span class=main>∩</span> <span class=skolem>mR</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> trtr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>
                                  <span class=main>∧</span> <span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>∨</span> <span class=main>(</span><span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>
                                  <span class=main>∧</span> <span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> partial_castTE<span class=main>)</span> <span class=operator>metis</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n1</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=skolem>n2</span>"</span></span>
                                    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>from</span></span> sr <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subnet_reachable<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> trtr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s1'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_maintains_dom<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> sr <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> subnet_reachable<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> trtr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s2'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_maintains_dom<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> nm <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span>
           <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split1<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> nm' <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span><span class=main>]</span>
           <span class=quoted><span class=quoted>‹net_tree_ips <span class=skolem>n1</span> <span class=main>∩</span> net_tree_ips <span class=skolem>n2</span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split1<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> nm <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span><span class=main>]</span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split2<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> nm' <span class=main>[</span><span class=operator>simplified</span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span><span class=main>]</span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s1'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n1</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s2'</span> <span class=main>=</span> net_tree_ips <span class=skolem>n2</span>›</span></span> 
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netgmap_subnet_split2<span class=main>)</span>

      <span class=keyword1><span class=command>from</span></span> trtr <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                                              <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=main>(</span><span class=skolem>n1</span> <span class=main>∥</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>elim</span> disjE conjE<span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n1</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH1<span class=main>)</span>

        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n2</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> transfer_arrive'<span class=main>)</span>

        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span>
                          <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                             <span class=main>∈</span> opnet_sos <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>H</span> <span class=main>⊆</span> <span class=skolem>mR</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>K</span> <span class=main>∩</span> <span class=skolem>mR</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> opnet_sos.intros<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s1</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s1'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=skolem>s1</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n1</span><span class=main>)</span> TT›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s1</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s1'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n1</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n1</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>H</span><span class=main>¬</span><span class=skolem>K</span><span class=keyword1>:arrive(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> transfer_arrive'<span class=main>)</span>

        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s2</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=skolem>s2'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹<span class=skolem>s2</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=skolem>n2</span><span class=main>)</span> TT›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s2</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s2'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=skolem>n2</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span>›</span></span>
             <span class=quoted><span class=quoted>‹wf_net_tree <span class=skolem>n2</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> IH2<span class=main>)</span>

        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> SubnetS <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span>
                          <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> SubnetS <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s1'</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s2'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                             <span class=main>∈</span> opnet_sos <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=skolem>n2</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>H</span> <span class=main>⊆</span> <span class=skolem>mR</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>K</span> <span class=main>∩</span> <span class=skolem>mR</span> <span class=main>=</span> <span class=main>{}</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> opnet_sos.intros<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> SubnetS <span class=skolem>s1</span> <span class=skolem>s2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> SubnetS <span class=skolem>s1'</span> <span class=skolem>s2'</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=main>(</span>snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>ζ</span> <span class=main>=</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>note</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s'</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ'</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>mR</span><span class=keyword1>:*cast(</span><span class=free>m</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                           <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span><span class=main>)</span>
                           <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-transfer_pnet_action><span class=command>lemma</span></span> transfer_pnet_action<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>σ'</span> <span class=free>ζ'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=free>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>atomize_elim</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ'</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                  <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=free>ζ</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=free>σ</span> <span class=bound>j</span><span class=main>)</span>
                  <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> node_cast
      <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>4<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> transfer_cast <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ assms<span class=main><span class=main><span class=main>(</span></span></span>1-3<span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> node_deliver
      <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>4<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> transfer_deliver <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ assms<span class=main><span class=main><span class=main>(</span></span></span>1-3<span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> node_arrive
      <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>4<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> transfer_arrive <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ assms<span class=main><span class=main><span class=main>(</span></span></span>1-3<span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> node_connect
      <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>4<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> transfer_connect <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ assms<span class=main><span class=main><span class=main>(</span></span></span>1-3<span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> node_disconnect
      <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>4<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> transfer_disconnect <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ assms<span class=main><span class=main><span class=main>(</span></span></span>1-3<span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> node_newpkt
      <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>4<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted>False</span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> pnet_never_newpkt<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> node_tau
      <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>4<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> transfer_tau <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ assms<span class=main><span class=main><span class=main>(</span></span></span>1-3<span class=main><span class=main><span class=main>)</span></span></span><span class=main><span class=main>,</span></span> <span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-transfer_action_pnet_closed><span class=command>lemma</span></span> transfer_action_pnet_closed<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>a'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span>
               <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>σ'</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=main>⟦</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>a'</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>;</span>
                                  <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_ips <span class=bound>ζ</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>⟧</span>
                            <span class=main>⟹</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>atomize_elim</span><span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> cnet_sos <span class=main>(</span>trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a'</span><span class=main>.</span> <span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=bound>a'</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>
                <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>σ'</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span><span class=main>,</span> <span class=bound>a'</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>
                               <span class=main>⟶</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_ips <span class=bound>ζ</span> <span class=main>⟶</span> <span class=bound>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=bound>σ</span> <span class=bound>j</span><span class=main>)</span>
                               <span class=main>⟶</span> <span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
      <span class=keyword3><span class=command>case</span></span> <span class=main>(</span>cnet_cast <span class=skolem>R</span> <span class=skolem>m</span><span class=main>)</span> <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> exI <span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> x<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted>"<span class=skolem>R</span><span class=keyword1>:*cast(</span><span class=skolem>m</span><span class=main>)</span>"</span></span><span class=main><span class=main>]</span></span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ocnet_cast<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ocnet_sos.intros <span class=main><span class=main>[</span></span><span class=operator>simplified</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-transfer_action><span class=command>lemma</span></span> transfer_action<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>s</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=free>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>obtains</span></span> <span class=free>σ'</span> <span class=free>ζ'</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
                  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=free>σ'</span><span class=main>,</span> <span class=free>ζ'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>atomize_elim</span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>4<span class=main>)</span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>σ'</span> <span class=bound>ζ'</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span><span class=main>,</span> <span class=free>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>
                    <span class=main>∧</span> netgmap <span class=free>sr</span> <span class=free>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=bound>ζ'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span>
           <span class=main>(</span><span class=main>(</span><span class=operator>elim</span> transfer_action_pnet_closed
                  transfer_pnet_action <span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT›</span></span> assms<span class=main><span class=main>(</span></span>2-3<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>?</span></span><span class=main><span class=keyword3>,</span></span>
            <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> exI<span class=main>)</span><span class=main><span class=keyword3>[</span></span>1<span class=main><span class=keyword3>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="OClosed_Transfer-pnet_reachable_transfer'"><span class=command>lemma</span></span> pnet_reachable_transfer'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>∈</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>`</span> oreachable <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=free>U</span>"</span></span>
          <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>" <span class=main>_</span> <span class=main>∈</span> <span class=var>?f</span> <span class=main>`</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=free>n</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>∈</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> init_pnet_opnet<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>∈</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>
                                        <span class=main>⊆</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>`</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>intro</span> image_mono subsetI<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> oreachable_init<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>∈</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>`</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> rev_subsetD<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>∈</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>`</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
                              <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>clarsimp</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT›</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=free>n</span>›</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>›</span></span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ'</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
                     <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> transfer_action<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_local<span class=main>)</span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span>›</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>∈</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>`</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> image_eqI<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>someinit</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> <span class=tfree>'g</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>someinit</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≡</span> <span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=keyword1>o</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>initmissing</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>nat <span class=main>⇒</span> <span class=tfree>'g</span> option<span class=main>)</span> <span class=main>×</span> <span class=tfree>'a</span><span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span>nat <span class=main>⇒</span> <span class=tfree>'g</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'a</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>initmissing</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>case</span> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>)</span> <span class=bound>i</span> <span class=keyword1>of</span> None <span class=main>⇒</span> someinit <span class=bound>i</span> <span class=main>|</span> Some <span class=bound>s</span> <span class=main>⇒</span> <span class=bound>s</span><span class=main>,</span> snd <span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id="OClosed_Transfer-initmissing_def'"><span class=command>lemma</span></span> initmissing_def'<span class=main>:</span>
  <span class=quoted><span class=quoted>"initmissing <span class=main>=</span> apfst <span class=main>(</span>default someinit<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> initmissing_def default_def<span class=main>)</span>

<span class=keyword1 id=OClosed_Transfer-netmask_initmissing_netgmap><span class=command>lemma</span></span> netmask_initmissing_netgmap<span class=main>:</span>
  <span class=quoted><span class=quoted>"netmask <span class=main>(</span>net_ips <span class=free>s</span><span class=main>)</span> <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> netgmap <span class=free>sr</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>intro</span> prod_eqI ext<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netmask <span class=main>(</span>net_ips <span class=free>s</span><span class=main>)</span> <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> initmissing_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.split<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> initmissing_def<span class=main>)</span>

<span class=keyword1 id=OClosed_Transfer-snd_initmissing><span class=command>lemma</span></span> snd_initmissing <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"snd <span class=main>(</span>initmissing <span class=free>x</span><span class=main>)</span><span class=main>=</span> snd <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> initmissing_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OClosed_Transfer-initmnissing_snd_netgmap><span class=command>lemma</span></span> initmnissing_snd_netgmap <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>ζ</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=main>=</span> <span class=free>ζ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> initmissing_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1 id=OClosed_Transfer-in_net_ips_fst_init_missing><span class=command>lemma</span></span> in_net_ips_fst_init_missing <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∈</span> net_ips <span class=free>s</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> initmissing_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.split<span class=main>)</span>

<span class=keyword1 id=OClosed_Transfer-not_in_net_ips_fst_init_missing><span class=command>lemma</span></span> not_in_net_ips_fst_init_missing <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_ips <span class=free>s</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>=</span> someinit <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> initmissing_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.split<span class=main>)</span>

<span class=keyword1 id=OClosed_Transfer-initmissing_oreachable_netmask><span class=command>lemma</span></span> initmissing_oreachable_netmask <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=free>U</span>"</span></span>
          <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span><span class=main>)</span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"net_ips <span class=free>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>∈</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>`</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> surj_pair<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_ips <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>intro</span> prod_eqI ext<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span>netmask <span class=main>(</span>net_ips <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=free>s</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=free>s</span>"</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> in_net_ips_fst_init_missing<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∈</span>net_ips <span class=free>s</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Some <span class=main>(</span>the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> some_the_fst_netgmap<span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=main>=</span> snd <span class=main>(</span>netmask <span class=main>(</span>net_ips <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=free>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netmask <span class=main>(</span>net_ips <span class=free>s</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> netmask <span class=main>(</span>net_ips <span class=free>s</span><span class=main>)</span> <span class=main>`</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> imageI<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-pnet_reachable_transfer><span class=command>lemma</span></span> pnet_reachable_transfer<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=free>U</span>"</span></span>
          <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>" <span class=main>_</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=operator>induction</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=free>n</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> init_lifted <span class=main><span class=main>[</span></span><span class=operator>THEN</span> subsetD<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>intro</span> CollectI exI conjI allI<span class=main>)</span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> snd <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> snd_initmissing surjective_pairing<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>if</span> <span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>n</span>
            <span class=keyword1>then</span> <span class=main>(</span>fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span>
            <span class=keyword1>else</span> <span class=main>(</span>fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>n</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> if_True if_False<span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_tree_ips <span class=free>n</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∈</span> net_ips <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> the <span class=main>(</span>fst <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span> <span class=skolem>i</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_tree_ips <span class=free>n</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span> <span class=main>∉</span> net_ips <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> someinit <span class=skolem>i</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"someinit <span class=skolem>i</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> someinit_def <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> someI_ex<span class=main>)</span>
          <span class=keyword1><span class=command>from</span></span> init_notempty <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=keyword1>o</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> TT"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_net_ips_net_tree_ips<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>∈</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>`</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> initmissing_oreachable_netmask<span class=main>)</span>

    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>ζ</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>=</span> initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> surj_pair<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>=</span> initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>›</span></span> <span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> netmask_initmissing_netgmap<span class=main>)</span>

    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT›</span></span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ'</span></span> <span class=skolem><span class=skolem>ζ'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>"</span></span>
                     <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=free>n</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> transfer_action<span class=main>)</span>

    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>ζ</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> opnet_net_ips_net_tree_ips <span class=main><span class=main>[</span></span><span class=operator>OF</span> oclosed_oreachable_oreachable<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>n</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> ocomplete_no_change<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>intro</span> prod_eqI ext<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span>›</span></span>
           <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>∉</span>net_tree_ips <span class=free>n</span> <span class=main>⟶</span> <span class=skolem>σ'</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>j</span>›</span></span>
           <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>=</span> initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span>›</span></span>
           <span class=quoted><span class=quoted>‹net_ips <span class=skolem>s</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>›</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> initmissing_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹netgmap <span class=free>sr</span> <span class=skolem>s'</span> <span class=main>=</span> netmask <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"snd <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> snd <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>ζ</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>ζ'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oreachable_local<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> TrueI<span class=main>)</span>

    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> <span class=var>?oreachable</span> <span class=free>n</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>netglobal</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>nat <span class=main>⇒</span> <span class=tfree>'g</span><span class=main>)</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'s</span> net_state <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>netglobal</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=bound>s</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>(</span>fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=OClosed_Transfer-netglobalsimp><span class=command>lemma</span></span> netglobalsimp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"netglobal <span class=free>P</span> <span class=free>s</span> <span class=main>=</span> <span class=free>P</span> <span class=main>(</span>fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> netglobal_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OClosed_Transfer-netglobalE><span class=command>lemma</span></span> netglobalE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"netglobal <span class=free>P</span> <span class=free>s</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>P</span> <span class=bound>σ</span><span class=main>;</span> fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=bound>σ</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>σ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"netglobal <span class=free>Q</span> <span class=free>s</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=OClosed_Transfer-netglobal_weakenE><span class=command>lemma</span></span> netglobal_weakenE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>⊫</span> netglobal <span class=free>P</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span><span class=main>.</span> <span class=free>P</span> <span class=bound>σ</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>σ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>⊫</span> netglobal <span class=free>Q</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> invariant_weakenE<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"netglobal <span class=free>P</span> <span class=skolem>s</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"netglobal <span class=free>Q</span> <span class=skolem>s</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> netglobalE<span class=main>)</span> <span class=main>(</span><span class=operator>erule</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=OClosed_Transfer-close_opnet><span class=command>lemma</span></span> close_opnet<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span> <span class=main>⊨</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>,</span> <span class=free>U</span> <span class=main>→)</span> global <span class=free>P</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span> <span class=main>⊫</span> netglobal <span class=free>P</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> invariant_def <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=free>np</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>oclosed <span class=main>(</span>opnet <span class=free>onp</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=free>U</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_reachable_transfer<span class=main>)</span>
    <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"global <span class=free>P</span> <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"netglobal <span class=free>P</span> <span class=skolem>s</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>locale</span></span> openproc_parq <span class=main>=</span>
  op<span class=main>?</span><span class=main>:</span> openproc <span class=quoted><span class=free>np</span></span> <span class=quoted><span class=free>onp</span></span> <span class=quoted><span class=free>sr</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=free>np</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ip <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=main>(</span><span class=tfree>'m</span><span class=main>::</span>msg<span class=main>)</span> seq_action<span class=main>)</span> automaton"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=free>onp</span> <span class=free>sr</span>
  <span class=main>+</span> <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>qp</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'t</span><span class=main>,</span> <span class=tfree>'m</span> seq_action<span class=main>)</span> automaton"</span></span>
    <span class=keyword2><span class=keyword>assumes</span></span> init_qp_notempty<span class=main>:</span> <span class=quoted><span class=quoted>"init <span class=free>qp</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>

<span class=keyword1><span class=command>sublocale</span></span> openproc_parq <span class=main>⊆</span> openproc <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=free>np</span> <span class=bound>i</span> <span class=main>⟨⟨</span> <span class=free>qp</span>"</span></span>
                                   <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=free>onp</span> <span class=bound>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=bound>i</span></sub><span class=hidden>⇙</span> <span class=free>qp</span>"</span></span>
                                   <span class=quoted><span class=quoted>"<span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>unfold_locales</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span> <span class=main>|</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span> <span class=main>⟨⟨</span> <span class=free>qp</span><span class=main>)</span>
                         <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span> <span class=skolem>i</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>s</span><span class=main>)</span>
                         <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=keyword1>o</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                                  <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>j</span> <span class=main>⟨⟨</span> <span class=free>qp</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span> <span class=main>⊆</span> init <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> <span class=free>qp</span><span class=main>)</span>"</span></span>
       <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?S</span> <span class=main>⊆</span> <span class=main>_</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> <span class=var>?S</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>σ</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=skolem><span class=skolem>lq</span></span>
        <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>lq</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>lq</span> <span class=main>∈</span> init <span class=free>qp</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
          <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=skolem>i</span> <span class=main>⟶</span> <span class=skolem>σ</span> <span class=bound>j</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                                                                        <span class=main>`</span> <span class=main>(</span>init <span class=main>(</span><span class=free>np</span> <span class=bound>j</span><span class=main>)</span> <span class=main>×</span> init <span class=free>qp</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>5<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=skolem>i</span> <span class=main>⟶</span> <span class=skolem>σ</span> <span class=bound>j</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=main>∘</span> <span class=free>sr</span><span class=main>)</span> <span class=main>`</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>p</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> init <span class=main><span class=main>[</span></span><span class=operator>THEN</span> subsetD<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>lq</span><span class=main>∈</span> init <span class=free>qp</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>lq</span><span class=main>)</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>×</span> init <span class=free>qp</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>lq</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> extg <span class=main>`</span> <span class=main>(</span>init <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>×</span> init <span class=free>qp</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> rev_image_eqI<span class=main>)</span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>lq</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>∈</span> init <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> <span class=free>qp</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>s</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>s'</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span> <span class=main>⟨⟨</span> <span class=free>qp</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>p</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=skolem><span class=skolem>p'</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span>  <span class=main>=</span> <span class=main>(</span><span class=skolem>p</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span>"</span></span>
                            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>p'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span>"</span></span>
                            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=skolem>i</span>  <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span>"</span></span>
                            <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>p'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> prod.split_asm<span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1-2<span class=main>)</span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span> <span class=main>⟨⟨</span> <span class=free>qp</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>p</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>p'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> parp_sos <span class=main>(</span>trans <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>trans <span class=free>qp</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> <span class=free>qp</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>cases</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>q'</span> <span class=main>=</span> <span class=skolem>q</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>p</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> receive <span class=bound>m</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>p'</span><span class=main>)</span>›</span></span> this<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>q'</span> <span class=main>=</span> <span class=skolem>q</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> receive <span class=bound>m</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> <span class=free>qp</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oparleft<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p'</span> <span class=main>=</span> <span class=skolem>p</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>q</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>qp</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>≠</span> send <span class=bound>m</span>"</span></span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>p'</span><span class=main>)</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> <span class=free>qp</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oparright<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>p</span><span class=main>,</span> receive <span class=skolem>m</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>np</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>q</span><span class=main>,</span> send <span class=skolem>m</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>qp</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span><span class=free>sr</span> <span class=skolem>p'</span><span class=main>)</span>›</span></span> this<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> receive <span class=skolem>m</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> trans<span class=main>)</span>
      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>q</span><span class=main>,</span> send <span class=skolem>m</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=free>qp</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=keyword1>τ</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p</span><span class=main>)</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=skolem>p'</span><span class=main>)</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> <span class=free>qp</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> step_seq_tau<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> oparboth<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>p</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>p'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span>›</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span>
                 <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span><span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span>snd <span class=main>(</span><span class=free>sr</span> <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span><span class=free>onp</span> <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> <span class=free>qp</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> init <span class=main>(</span><span class=free>np</span> <span class=bound>j</span> <span class=main>⟨⟨</span> <span class=free>qp</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> init_notempty init_qp_notempty<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=AWN_Main><div class=head><h1>Theory AWN_Main</h1></div><pre class=source><span class=comment1>(*  Title:       AWN_Main.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Import all AWN-related theories"</span></span>

<span class=keyword1><span class=command>theory</span></span> AWN_Main
<span class=keyword2><span class=keyword>imports</span></span> <a href=AWN_SOS.html>AWN_SOS</a> <a href=AWN_SOS_Labels.html>AWN_SOS_Labels</a> <a href=OAWN_SOS_Labels.html>OAWN_SOS_Labels</a> <a href=AWN_Invariants.html>AWN_Invariants</a>
        <a href=OAWN_Convert.html>OAWN_Convert</a> <a href=OClosed_Transfer.html>OClosed_Transfer</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword2><span class=keyword>end</span></span>

</pre></div><div id=Toy><div class=head><h1>Theory Toy</h1></div><pre class=source><span class=comment1>(*  Title:       Toy.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
    Author:      Peter Höfner
*)</span>

<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>"Simple toy example"</span></span>

<span class=keyword1><span class=command>theory</span></span> Toy
<span class=keyword2><span class=keyword>imports</span></span> <a href=../../HOL/HOL/Main.html>Main</a> <a href=AWN_Main.html>AWN_Main</a> <a href=Qmsg_Lifting.html>Qmsg_Lifting</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Messages used in the protocol"</span></span>

<span class=keyword1><span class=command>datatype</span></span> msg <span class=main>=</span>
    Pkt <span class=quoted>data</span> <span class=quoted>ip</span>
  <span class=main>|</span> Newpkt <span class=quoted>data</span> <span class=quoted>ip</span>

<span class=keyword1><span class=command>instantiation</span></span> msg <span class=main>::</span> <span class=quoted>msg</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>definition</span></span> newpkt_def <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"newpkt <span class=main>≡</span> <span class=main>λ</span><span class=main>(</span><span class=bound>d</span><span class=main>,</span><span class=bound>did</span><span class=main>)</span><span class=main>.</span> Newpkt <span class=bound>d</span> <span class=bound>did</span>"</span></span>
<span class=keyword1><span class=command>definition</span></span> eq_newpkt_def<span class=main>:</span> <span class=quoted><span class=quoted>"eq_newpkt <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=keyword1>of</span> Newpkt <span class=bound>d</span> <span class=bound>did</span>  <span class=main>⇒</span> True <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> False"</span></span> 

<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>intro_classes</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> eq_newpkt_def<span class=main>)</span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>pkt</span> <span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>×</span> nat <span class=main>⇒</span> msg"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>pkt</span> <span class=main>≡</span> <span class=main>λ</span><span class=main>(</span><span class=bound>no</span><span class=main>,</span> <span class=bound>sid</span><span class=main>)</span><span class=main>.</span> Pkt <span class=bound>no</span> <span class=bound>sid</span>"</span></span>

<span class=keyword1 id=Toy-pkt_simp><span class=command>lemma</span></span> pkt_simp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"pkt<span class=main>(</span><span class=free>no</span><span class=main>,</span> <span class=free>sid</span><span class=main>)</span> <span class=main>=</span> Pkt <span class=free>no</span> <span class=free>sid</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> pkt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Toy-not_eq_newpkt_pkt><span class=command>lemma</span></span> not_eq_newpkt_pkt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span>eq_newpkt <span class=main>(</span>Pkt <span class=free>no</span> <span class=free>sid</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> eq_newpkt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Protocol model"</span></span>

<span class=keyword1><span class=command>record</span></span> state <span class=main>=</span>
  id    <span class=main>::</span> <span class=quoted><span class=quoted>"nat"</span></span>
  no    <span class=main>::</span> <span class=quoted><span class=quoted>"nat"</span></span>
  nhid  <span class=main>::</span> <span class=quoted><span class=quoted>"nat"</span></span>
  <span class=comment1>(* all locals *)</span>
  msg    <span class=main>::</span> <span class=quoted><span class=quoted>"msg"</span></span>
  num    <span class=main>::</span> <span class=quoted><span class=quoted>"nat"</span></span>
  sid    <span class=main>::</span> <span class=quoted><span class=quoted>"nat"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>toy_init</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ip <span class=main>⇒</span> state"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>toy_init</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≡</span> <span class=main>⦇</span>
         id <span class=main>=</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span>
         no <span class=main>=</span> <span class=main>0</span><span class=main>,</span>
         nhid <span class=main>=</span> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span>

         msg    <span class=main>=</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> True<span class=main>)</span><span class=main>,</span>
         num    <span class=main>=</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> True<span class=main>)</span><span class=main>,</span>
         sid    <span class=main>=</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> True<span class=main>)</span>
       <span class=main>⦈</span>"</span></span>

<span class=keyword1 id=Toy-some_neq_not_eq><span class=command>lemma</span></span> some_neq_not_eq <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span> <span class=main>::</span> nat<span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> some_eq_ex<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> zero_neq_numeral<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>clear_locals</span> <span class=main>::</span> <span class=quoted><span class=quoted>"state <span class=main>⇒</span> state"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>clear_locals</span> <span class=free><span class=bound><span class=entity>ξ</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>ξ</span></span></span> <span class=main>⦇</span>
    msg    <span class=main>:=</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> True<span class=main>)</span><span class=main>,</span>
    num    <span class=main>:=</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> True<span class=main>)</span><span class=main>,</span>
    sid    <span class=main>:=</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> True<span class=main>)</span>
  <span class=main>⦈</span>"</span></span>

<span class=keyword1 id=Toy-clear_locals_but_not_globals><span class=command>lemma</span></span> clear_locals_but_not_globals <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"id <span class=main>(</span>clear_locals <span class=free>ξ</span><span class=main>)</span> <span class=main>=</span> id <span class=free>ξ</span>"</span></span>
  <span class=quoted><span class=quoted>"no <span class=main>(</span>clear_locals <span class=free>ξ</span><span class=main>)</span> <span class=main>=</span> no <span class=free>ξ</span>"</span></span>
  <span class=quoted><span class=quoted>"nhid <span class=main>(</span>clear_locals <span class=free>ξ</span><span class=main>)</span> <span class=main>=</span> nhid <span class=free>ξ</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> clear_locals_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_newpkt</span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_newpkt</span> <span class=free><span class=bound><span class=entity>ξ</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> msg <span class=free><span class=bound><span class=entity>ξ</span></span></span> <span class=keyword1>of</span>
                       Newpkt <span class=bound>data</span> <span class=bound>did</span> <span class=main>⇒</span> <span class=main>{</span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>⦇</span>num <span class=main>:=</span> <span class=bound>data</span><span class=main>⦈</span> <span class=main>}</span>
                     <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> <span class=main>{}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_pkt</span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_pkt</span> <span class=free><span class=bound><span class=entity>ξ</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> msg <span class=free><span class=bound><span class=entity>ξ</span></span></span> <span class=keyword1>of</span>
                    Pkt <span class=bound>num'</span> <span class=bound>sid'</span> <span class=main>⇒</span> <span class=main>{</span> <span class=free><span class=bound><span class=entity>ξ</span></span></span><span class=main>⦇</span> num <span class=main>:=</span> <span class=bound>num'</span><span class=main>,</span> sid <span class=main>:=</span> <span class=bound>sid'</span> <span class=main>⦈</span> <span class=main>}</span>
                  <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> <span class=main>{}</span>"</span></span>

<span class=keyword1><span class=command>lemmas</span></span> is_msg_defs <span class=main>=</span>
  is_pkt_def is_newpkt_def

<span class=keyword1 id=Toy-is_msg_inv_id><span class=command>lemma</span></span> is_msg_inv_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>ξ'</span> <span class=main>∈</span> is_pkt <span class=free>ξ</span>    <span class=main>⟹</span> id <span class=free>ξ'</span> <span class=main>=</span> id <span class=free>ξ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ξ'</span> <span class=main>∈</span> is_newpkt <span class=free>ξ</span> <span class=main>⟹</span> id <span class=free>ξ'</span> <span class=main>=</span> id <span class=free>ξ</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> is_msg_defs
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"msg <span class=free>ξ</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Toy-is_msg_inv_sid><span class=command>lemma</span></span> is_msg_inv_sid <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>ξ'</span> <span class=main>∈</span> is_newpkt <span class=free>ξ</span> <span class=main>⟹</span> sid <span class=free>ξ'</span> <span class=main>=</span> sid <span class=free>ξ</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> is_msg_defs
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"msg <span class=free>ξ</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Toy-is_msg_inv_no><span class=command>lemma</span></span> is_msg_inv_no <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>ξ'</span> <span class=main>∈</span> is_pkt <span class=free>ξ</span>    <span class=main>⟹</span> no <span class=free>ξ'</span> <span class=main>=</span> no <span class=free>ξ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ξ'</span> <span class=main>∈</span> is_newpkt <span class=free>ξ</span> <span class=main>⟹</span> no <span class=free>ξ'</span> <span class=main>=</span> no <span class=free>ξ</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> is_msg_defs
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"msg <span class=free>ξ</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Toy-is_msg_inv_nhid><span class=command>lemma</span></span> is_msg_inv_nhid <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>ξ'</span> <span class=main>∈</span> is_pkt <span class=free>ξ</span>    <span class=main>⟹</span> nhid <span class=free>ξ'</span> <span class=main>=</span> nhid <span class=free>ξ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ξ'</span> <span class=main>∈</span> is_newpkt <span class=free>ξ</span> <span class=main>⟹</span> nhid <span class=free>ξ'</span> <span class=main>=</span> nhid <span class=free>ξ</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> is_msg_defs
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"msg <span class=free>ξ</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Toy-is_msg_inv_msg><span class=command>lemma</span></span> is_msg_inv_msg <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>ξ'</span> <span class=main>∈</span> is_pkt <span class=free>ξ</span>    <span class=main>⟹</span> msg <span class=free>ξ'</span> <span class=main>=</span> msg <span class=free>ξ</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ξ'</span> <span class=main>∈</span> is_newpkt <span class=free>ξ</span> <span class=main>⟹</span> msg <span class=free>ξ'</span> <span class=main>=</span> msg <span class=free>ξ</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> is_msg_defs
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"msg <span class=free>ξ</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>clarsimp</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>datatype</span></span> pseqp <span class=main>=</span>
    PToy

<span class=keyword1><span class=command>fun</span></span> <span class=entity>nat_of_seqp</span> <span class=main>::</span> <span class=quoted><span class=quoted>"pseqp <span class=main>⇒</span> nat"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>nat_of_seqp</span> PToy <span class=main>=</span> <span class=main>1</span>"</span></span>

<span class=keyword1><span class=command>instantiation</span></span> <span class=quoted>"pseqp"</span> <span class=main>::</span> <span class=quoted>ord</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>definition</span></span> less_eq_seqp <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>l1</span></span></span> <span class=main>≤</span> <span class=free><span class=bound><span class=entity>l2</span></span></span> <span class=main>=</span> <span class=main>(</span>nat_of_seqp <span class=free><span class=bound><span class=entity>l1</span></span></span> <span class=main>≤</span> nat_of_seqp <span class=free><span class=bound><span class=entity>l2</span></span></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>definition</span></span> less_seqp <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span>    <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>l1</span></span></span> <span class=main>&lt;</span> <span class=free><span class=bound><span class=entity>l2</span></span></span> <span class=main>=</span> <span class=main>(</span>nat_of_seqp <span class=free><span class=bound><span class=entity>l1</span></span></span> <span class=main>&lt;</span> nat_of_seqp <span class=free><span class=bound><span class=entity>l2</span></span></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>..</span></span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>Toy</span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Toy</span> <span class=main>≡</span> <span class=main>λ</span><span class=main><span class=bound>_</span></span><span class=main>.</span> <span class=main>⟦</span>clear_locals<span class=main>⟧</span> <span class=keyword1>call(</span>PToy<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>state<span class=main>,</span> msg<span class=main>,</span> pseqp<span class=main>,</span> pseqp label<span class=main>)</span> seqp_env"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub></span> PToy <span class=main>=</span> labelled PToy <span class=main>(</span>
     <span class=keyword1>receive(</span><span class=main>λ</span><span class=bound>msg'</span> <span class=bound>ξ</span><span class=main>.</span> <span class=bound>ξ</span> <span class=main>⦇</span> msg <span class=main>:=</span> <span class=bound>msg'</span> <span class=main>⦈</span><span class=main>)</span><span class=main>.</span>
     <span class=main>⟦</span><span class=bound>ξ</span><span class=main>.</span> <span class=bound>ξ</span> <span class=main>⦇</span>nhid <span class=main>:=</span> id <span class=bound>ξ</span><span class=main>⦈</span><span class=main>⟧</span>
     <span class=main>(</span>   <span class=main>⟨</span>is_newpkt<span class=main>⟩</span> 
         <span class=main>(</span>
             <span class=main>⟦</span><span class=bound>ξ</span><span class=main>.</span> <span class=bound>ξ</span> <span class=main>⦇</span>no <span class=main>:=</span> max <span class=main>(</span>no <span class=bound>ξ</span><span class=main>)</span> <span class=main>(</span>num <span class=bound>ξ</span><span class=main>)</span><span class=main>⦈</span><span class=main>⟧</span>
             <span class=keyword1>broadcast(</span><span class=main>λ</span><span class=bound>ξ</span><span class=main>.</span> pkt<span class=main>(</span>no <span class=bound>ξ</span><span class=main>,</span> id <span class=bound>ξ</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> Toy<span class=main>()</span>
         <span class=main>)</span>
       <span class=main>⊕</span> <span class=main>⟨</span>is_pkt<span class=main>⟩</span>
       <span class=main>(</span>
            <span class=main>⟨</span><span class=bound><span class=bound>ξ</span></span><span class=main>.</span> num <span class=bound>ξ</span> <span class=main>&gt;</span> no <span class=bound>ξ</span><span class=main>⟩</span>
               <span class=main>⟦</span><span class=bound>ξ</span><span class=main>.</span> <span class=bound>ξ</span> <span class=main>⦇</span>no <span class=main>:=</span> num <span class=bound>ξ</span><span class=main>⦈</span><span class=main>⟧</span>
               <span class=main>⟦</span><span class=bound>ξ</span><span class=main>.</span> <span class=bound>ξ</span> <span class=main>⦇</span>nhid <span class=main>:=</span> sid <span class=bound>ξ</span><span class=main>⦈</span><span class=main>⟧</span>
               <span class=keyword1>broadcast(</span><span class=main>λ</span><span class=bound>ξ</span><span class=main>.</span> pkt<span class=main>(</span>no <span class=bound>ξ</span><span class=main>,</span> id <span class=bound>ξ</span><span class=main>)</span><span class=main>)</span><span class=main>.</span> Toy<span class=main>()</span>
         <span class=main>⊕</span> <span class=main>⟨</span><span class=bound><span class=bound>ξ</span></span><span class=main>.</span> num <span class=bound>ξ</span> <span class=main>≤</span> no <span class=bound>ξ</span><span class=main>⟩</span>
               Toy<span class=main>()</span>
       <span class=main>)</span>
     <span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>declare</span></span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>.simps <span class=main>[</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main>,</span> <span class=operator>code</span> <span class=quasi_keyword>del</span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_simps <span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span> <span class=main>=</span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>.simps <span class=main>[</span><span class=operator>simplified</span><span class=main>]</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_skeleton</span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_skeleton</span> PToy <span class=main>=</span> seqp_skeleton <span class=main>(</span>Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> PToy<span class=main>)</span>"</span></span>

<span class=keyword1 id=Toy-Γ><span class=command>lemma</span></span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_skeleton_wf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"wellformed Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_skeleton"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>intro</span> allI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pn</span> <span class=skolem>pn'</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>call(</span><span class=skolem>pn'</span><span class=main>)</span> <span class=main>∉</span> stermsl <span class=main>(</span>Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_skeleton <span class=skolem>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>pn</span></span><span class=main>)</span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>declare</span></span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_skeleton.simps <span class=main>[</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main>,</span> <span class=operator>code</span> <span class=quasi_keyword>del</span><span class=main>]</span>
<span class=keyword1><span class=command>lemmas</span></span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_skeleton_simps <span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>code</span><span class=main>]</span> <span class=main>=</span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_skeleton.simps <span class=main>[</span><span class=operator>simplified</span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_simps seqp_skeleton.simps<span class=main>]</span>

<span class=keyword1 id=Toy-toy_proc_cases><span class=command>lemma</span></span> toy_proc_cases <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>p</span> <span class=free>pn</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span>Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=free>pn</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>p</span> <span class=main>∈</span> ctermsl <span class=main>(</span>Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> PToy<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>pn</span></span><span class=main>)</span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"ip <span class=main>⇒</span> <span class=main>(</span>state <span class=main>×</span> <span class=main>(</span>state<span class=main>,</span> msg<span class=main>,</span> pseqp<span class=main>,</span> pseqp label<span class=main>)</span> seqp<span class=main>)</span> set"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub></span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≡</span> <span class=main>{</span><span class=main>(</span>toy_init <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> PToy<span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>ptoy</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"ip <span class=main>⇒</span> <span class=main>(</span>state <span class=main>×</span> <span class=main>(</span>state<span class=main>,</span> msg<span class=main>,</span> pseqp<span class=main>,</span> pseqp label<span class=main>)</span> seqp<span class=main>,</span> msg seq_action<span class=main>)</span> automaton"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ptoy</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≡</span> <span class=main>⦇</span> init <span class=main>=</span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=free><span class=bound><span class=entity>i</span></span></span><span class=main>,</span> trans <span class=main>=</span> seqp_sos Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>⦈</span>"</span></span>

<span class=keyword1 id=Toy-toy_trans><span class=command>lemma</span></span> toy_trans<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=main>(</span>ptoy <span class=free>i</span><span class=main>)</span> <span class=main>=</span> seqp_sos Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Toy-toy_control_within><span class=command>lemma</span></span> toy_control_within <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"control_within Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span>init <span class=main>(</span>ptoy <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> control_withinI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_simps<span class=main>)</span>

<span class=keyword1 id=Toy-toy_wf><span class=command>lemma</span></span> toy_wf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"wellformed Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>intro</span> allI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pn</span> <span class=skolem>pn'</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>call(</span><span class=skolem>pn'</span><span class=main>)</span> <span class=main>∉</span> stermsl <span class=main>(</span>Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>pn</span></span><span class=main>)</span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemmas</span></span> toy_labels_not_empty <span class=main>[</span><span class=operator>simp</span><span class=main>]</span> <span class=main>=</span> labels_not_empty <span class=main>[</span><span class=operator>OF</span> toy_wf<span class=main>]</span>

<span class=keyword1 id=Toy-toy_ex_label><span class=command>lemma</span></span> toy_ex_label <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>l</span><span class=main>.</span> <span class=bound>l</span><span class=main>∈</span>labels Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=free>p</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> toy_labels_not_empty all_not_in_conv<span class=main>)</span>

<span class=keyword1 id=Toy-toy_ex_labelE><span class=command>lemma</span></span> toy_ex_labelE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>l</span><span class=main>∈</span>labels Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=free>p</span><span class=main>.</span> <span class=free>P</span> <span class=bound>l</span> <span class=free>p</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>p</span> <span class=bound>l</span><span class=main>.</span> <span class=free>P</span> <span class=bound>l</span> <span class=bound>p</span> <span class=main>⟹</span> <span class=free>Q</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>Q</span>"</span></span>
 <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> toy_ex_label<span class=main>)</span> 

<span class=keyword1 id=Toy-toy_simple_labels><span class=command>lemma</span></span> toy_simple_labels <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"simple_labels Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pn</span> <span class=skolem>p</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>p</span><span class=main>∈</span>subterms<span class=main>(</span>Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=skolem>pn</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span><span class=bound>l</span><span class=main>.</span> labels Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=skolem>p</span> <span class=main>=</span> <span class=main>{</span><span class=bound>l</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>pn</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>cong</span><span class=main><span class=main>:</span></span> seqp_congs <span class=main><span class=keyword3>|</span></span> <span class=operator>elim</span> disjE<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Toy-σ><span class=command>lemma</span></span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_labels <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>ξ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=free>i</span> <span class=main>⟹</span>  labels Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=free>p</span> <span class=main>=</span> <span class=main>{</span>PToy<span class=main>-:</span><span class=main>0</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹By default, we no longer let the simplifier descend into process terms.›</span></span>

<span class=keyword1><span class=command>declare</span></span> seqp_congs <span class=main>[</span><span class=operator>cong</span><span class=main>]</span>

<span class=comment1>(* configure the inv_cterms tactic *)</span>
<span class=keyword1><span class=command>declare</span></span>
  Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_simps <span class=main>[</span><span class=operator>cterms_env</span><span class=main>]</span>
  toy_proc_cases <span class=main>[</span><span class=operator>ctermsl_cases</span><span class=main>]</span>
  seq_invariant_ctermsI <span class=main>[</span><span class=operator>OF</span> toy_wf toy_control_within toy_simple_labels toy_trans<span class=main>,</span> <span class=operator>cterms_intros</span><span class=main>]</span>
  seq_step_invariant_ctermsI <span class=main>[</span><span class=operator>OF</span> toy_wf toy_control_within toy_simple_labels toy_trans<span class=main>,</span> <span class=operator>cterms_intros</span><span class=main>]</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Define an open version of the protocol"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub></span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> state<span class=main>)</span> <span class=main>×</span> <span class=main>(</span><span class=main>(</span>state<span class=main>,</span> msg<span class=main>,</span> pseqp<span class=main>,</span> pseqp label<span class=main>)</span> seqp<span class=main>)</span><span class=main>)</span> set"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub></span> <span class=main>≡</span> <span class=main>{</span><span class=main>(</span>toy_init<span class=main>,</span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> PToy<span class=main>)</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>optoy</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"ip <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>ip <span class=main>⇒</span> state<span class=main>)</span> <span class=main>×</span> <span class=main>(</span>state<span class=main>,</span> msg<span class=main>,</span> pseqp<span class=main>,</span> pseqp label<span class=main>)</span> seqp<span class=main>,</span> msg seq_action<span class=main>)</span> automaton"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>optoy</span> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>≡</span> <span class=main>⦇</span> init <span class=main>=</span> σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub><span class=main>,</span> trans <span class=main>=</span> oseqp_sos Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=free><span class=bound><span class=entity>i</span></span></span> <span class=main>⦈</span>"</span></span>

<span class=keyword1 id=Toy-initiali_toy><span class=command>lemma</span></span> initiali_toy <span class=main>[</span><span class=operator>intro</span><span class=main><span class=main><span class=main><span class=main>!</span></span></span></span><span class=main>,</span> <span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"initiali <span class=free>i</span> <span class=main>(</span>init <span class=main>(</span>optoy <span class=free>i</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>init <span class=main>(</span>ptoy <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>rule</span> <span class=operator>simp_all</span>

<span class=keyword1 id=Toy-oaodv_control_within><span class=command>lemma</span></span> oaodv_control_within <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"control_within Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span>init <span class=main>(</span>optoy <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> control_withinI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_simps<span class=main>)</span>

<span class=keyword1 id=Toy-σ><span class=command>lemma</span></span> σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_labels <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>σ</span><span class=main>,</span> <span class=free>p</span><span class=main>)</span> <span class=main>∈</span> σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>⟹</span>  labels Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=free>p</span> <span class=main>=</span> <span class=main>{</span>PToy<span class=main>-:</span><span class=main>0</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Toy-otoy_trans><span class=command>lemma</span></span> otoy_trans<span class=main>:</span> <span class=quoted><span class=quoted>"trans <span class=main>(</span>optoy <span class=free>i</span><span class=main>)</span> <span class=main>=</span> oseqp_sos Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* configure the inv_cterms tactic *)</span>
<span class=keyword1><span class=command>declare</span></span>
  oseq_invariant_ctermsI <span class=main>[</span><span class=operator>OF</span> toy_wf oaodv_control_within toy_simple_labels otoy_trans<span class=main>,</span> <span class=operator>cterms_intros</span><span class=main>]</span>
  oseq_step_invariant_ctermsI <span class=main>[</span><span class=operator>OF</span> toy_wf oaodv_control_within toy_simple_labels otoy_trans<span class=main>,</span> <span class=operator>cterms_intros</span><span class=main>]</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Predicates"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>msg_sender</span> <span class=main>::</span> <span class=quoted><span class=quoted>"msg <span class=main>⇒</span> ip"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>msg_sender</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=keyword1>of</span> Pkt <span class=main><span class=bound>_</span></span> <span class=bound>ipc</span> <span class=main>⇒</span> <span class=bound>ipc</span>"</span></span>

<span class=keyword1 id=Toy-msg_sender_simps><span class=command>lemma</span></span> msg_sender_simps <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>d</span> <span class=bound>did</span> <span class=bound>sid</span><span class=main>.</span> msg_sender <span class=main>(</span>Pkt <span class=bound>d</span> <span class=bound>sid</span><span class=main>)</span> <span class=main>=</span> <span class=bound>sid</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> msg_sender_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>not_Pkt</span> <span class=main>::</span> <span class=quoted><span class=quoted>"msg <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>not_Pkt</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=keyword1>of</span> Pkt <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> False <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> True"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>nos_inc</span> <span class=main>::</span> <span class=quoted><span class=quoted>"state <span class=main>⇒</span> state <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>nos_inc</span> <span class=free><span class=bound><span class=entity>ξ</span></span></span> <span class=free><span class=bound><span class=entity>ξ'</span></span></span> <span class=main>≡</span> <span class=main>(</span>no <span class=free><span class=bound><span class=entity>ξ</span></span></span> <span class=main>≤</span> no <span class=free><span class=bound><span class=entity>ξ'</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>msg_ok</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>ip <span class=main>⇒</span> state<span class=main>)</span> <span class=main>⇒</span> msg <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>msg_ok</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=main>≡</span> <span class=keyword1>case</span> <span class=free><span class=bound><span class=entity>m</span></span></span> <span class=keyword1>of</span> Pkt <span class=bound>num'</span> <span class=bound>sid'</span> <span class=main>⇒</span> <span class=bound>num'</span> <span class=main>≤</span> no <span class=main>(</span><span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=bound>sid'</span><span class=main>)</span> <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> True"</span></span>

<span class=keyword1 id=Toy-msg_okI><span class=command>lemma</span></span> msg_okI <span class=main>[</span><span class=operator>intro</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>num'</span> <span class=bound>sid'</span><span class=main>.</span> <span class=free>m</span> <span class=main>=</span> Pkt <span class=bound>num'</span> <span class=bound>sid'</span> <span class=main>⟹</span> <span class=bound>num'</span> <span class=main>≤</span> no <span class=main>(</span><span class=free>σ</span> <span class=bound>sid'</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=free>σ</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> msg_ok_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> msg.split<span class=main>)</span>

<span class=keyword1 id=Toy-msg_ok_Pkt><span class=command>lemma</span></span> msg_ok_Pkt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"msg_ok <span class=free>σ</span> <span class=main>(</span>Pkt <span class=free>data</span> <span class=free>src</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>data</span> <span class=main>≤</span> no <span class=main>(</span><span class=free>σ</span> <span class=free>src</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> msg_ok_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Toy-msg_ok_pkt><span class=command>lemma</span></span> msg_ok_pkt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"msg_ok <span class=free>σ</span> <span class=main>(</span>pkt<span class=main>(</span><span class=free>data</span><span class=main>,</span> <span class=free>src</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>data</span> <span class=main>≤</span> no <span class=main>(</span><span class=free>σ</span> <span class=free>src</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> msg_ok_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Toy-msg_ok_Newpkt><span class=command>lemma</span></span> msg_ok_Newpkt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"msg_ok <span class=free>σ</span> <span class=main>(</span>Newpkt <span class=free>data</span> <span class=free>dst</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> msg_ok_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Toy-msg_ok_newpkt><span class=command>lemma</span></span> msg_ok_newpkt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"msg_ok <span class=free>σ</span> <span class=main>(</span>newpkt<span class=main>(</span><span class=free>data</span><span class=main>,</span> <span class=free>dst</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> msg_ok_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Sequential Invariants"</span></span>

<span class=keyword1 id=Toy-seq_no_leq_num><span class=command>lemma</span></span> seq_no_leq_num<span class=main>:</span>
  <span class=quoted><span class=quoted>"ptoy <span class=free>i</span> <span class=main>⊫</span> onl Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>.</span> <span class=bound>l</span><span class=main>∈</span><span class=main>{</span>PToy<span class=main>-:</span><span class=numeral>7</span><span class=main>..</span>PToy<span class=main>-:</span><span class=numeral>8</span><span class=main>}</span> <span class=main>⟶</span> no <span class=bound>ξ</span> <span class=main>≤</span> num <span class=bound>ξ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>inv_cterms</span>

<span class=keyword1 id=Toy-seq_nos_incs><span class=command>lemma</span></span> seq_nos_incs<span class=main>:</span>
  <span class=quoted><span class=quoted>"ptoy <span class=free>i</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> onll Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>)</span><span class=main>.</span> nos_inc <span class=bound>ξ</span> <span class=bound>ξ'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> nos_inc_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>inv_cterms</span> <span class=quasi_keyword>inv</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onl_invariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> toy_wf seq_no_leq_num<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id="Toy-seq_nos_incs'"><span class=command>lemma</span></span> seq_nos_incs'<span class=main>:</span>
  <span class=quoted><span class=quoted>"ptoy <span class=free>i</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=main>(</span><span class=bound>ξ'</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>)</span><span class=main>.</span> nos_inc <span class=bound>ξ</span> <span class=bound>ξ'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> step_invariant_weakenE <span class=main><span class=main>[</span></span><span class=operator>OF</span> seq_nos_incs<span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onllD<span class=main>)</span>

<span class=keyword1 id=Toy-sender_ip_valid><span class=command>lemma</span></span> sender_ip_valid<span class=main>:</span>
  <span class=quoted><span class=quoted>"ptoy <span class=free>i</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> onll Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> anycast <span class=main>(</span><span class=main>λ</span><span class=bound>m</span><span class=main>.</span> msg_sender <span class=bound>m</span> <span class=main>=</span> id <span class=bound>ξ</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>inv_cterms</span>

<span class=keyword1 id=Toy-id_constant><span class=command>lemma</span></span> id_constant<span class=main>:</span>
  <span class=quoted><span class=quoted>"ptoy <span class=free>i</span> <span class=main>⊫</span> onl Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> id <span class=bound>ξ</span> <span class=main>=</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>inv_cterms</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def<span class=main>)</span>

<span class=keyword1 id=Toy-nhid_eq_id><span class=command>lemma</span></span> nhid_eq_id<span class=main>:</span>
  <span class=quoted><span class=quoted>"ptoy <span class=free>i</span> <span class=main>⊫</span> onl Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>.</span> <span class=bound>l</span><span class=main>∈</span><span class=main>{</span>PToy<span class=main>-:</span><span class=numeral>2</span><span class=main>..</span>PToy<span class=main>-:</span><span class=numeral>8</span><span class=main>}</span> <span class=main>⟶</span> nhid <span class=bound>ξ</span> <span class=main>=</span> id <span class=bound>ξ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>inv_cterms</span>

<span class=keyword1 id=Toy-seq_msg_ok><span class=command>lemma</span></span> seq_msg_ok<span class=main>:</span>
  <span class=quoted><span class=quoted>"ptoy <span class=free>i</span> <span class=keyword1>⊫<span class=hidden>⇩</span><sub>A</sub></span> onll Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span>
                anycast <span class=main>(</span><span class=main>λ</span><span class=bound>m</span><span class=main>.</span> <span class=keyword1>case</span> <span class=bound>m</span> <span class=keyword1>of</span> Pkt <span class=bound>num'</span> <span class=bound>sid'</span> <span class=main>⇒</span> <span class=bound>num'</span> <span class=main>=</span> no <span class=bound>ξ</span> <span class=main>∧</span> <span class=bound>sid'</span> <span class=main>=</span> <span class=free>i</span> <span class=main>|</span> <span class=main><span class=bound>_</span></span> <span class=main>⇒</span> True<span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>inv_cterms</span> <span class=quasi_keyword>inv</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onl_invariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> toy_wf id_constant<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=Toy-nhid_eq_i><span class=command>lemma</span></span> nhid_eq_i<span class=main>:</span>
  <span class=quoted><span class=quoted>"ptoy <span class=free>i</span> <span class=main>⊫</span> onl Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>ξ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>.</span> <span class=bound>l</span><span class=main>∈</span><span class=main>{</span>PToy<span class=main>-:</span><span class=numeral>2</span><span class=main>..</span>PToy<span class=main>-:</span><span class=numeral>8</span><span class=main>}</span> <span class=main>⟶</span> nhid <span class=bound>ξ</span> <span class=main>=</span> <span class=free>i</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> invariant_arbitraryI<span class=main><span class=keyword3>,</span></span> <span class=operator>clarify</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onlI impI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>ξ</span> <span class=skolem>p</span> <span class=skolem>l</span> <span class=skolem>n</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=main>(</span>ptoy <span class=free>i</span><span class=main>)</span> TT"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=skolem>p</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> <span class=main>{</span>PToy<span class=main>-:</span><span class=numeral>2</span><span class=main>..</span>PToy<span class=main>-:</span><span class=numeral>8</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1-3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"nhid <span class=skolem>ξ</span> <span class=main>=</span> id <span class=skolem>ξ</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span> invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> nhid_eq_id<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command><span class=improper>with</span></span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>ξ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> reachable <span class=main>(</span>ptoy <span class=free>i</span><span class=main>)</span> TT›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>l</span> <span class=main>∈</span> labels Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=skolem>p</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"id <span class=skolem>ξ</span> <span class=main>=</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>:</span></span> invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> id_constant<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"nhid <span class=skolem>ξ</span> <span class=main>=</span> <span class=free>i</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Global Invariants"</span></span>

<span class=keyword1 id=Toy-nos_incD><span class=command>lemma</span></span> nos_incD <span class=main>[</span><span class=operator>dest</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"nos_inc <span class=free>ξ</span> <span class=free>ξ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"no <span class=free>ξ</span> <span class=main>≤</span> no <span class=free>ξ'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> nos_inc_def <span class=keyword1><span class=command>.</span></span>

<span class=keyword1 id=Toy-nos_inc_simp><span class=command>lemma</span></span> nos_inc_simp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"nos_inc <span class=free>ξ</span> <span class=free>ξ'</span> <span class=main>=</span> <span class=main>(</span>no <span class=free>ξ</span> <span class=main>≤</span> no <span class=free>ξ'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> nos_inc_def <span class=keyword1><span class=command>..</span></span>

<span class=keyword1><span class=command>lemmas</span></span> oseq_nos_incs <span class=main>=</span>
  open_seq_step_invariant <span class=main>[</span><span class=operator>OF</span> seq_nos_incs initiali_toy otoy_trans toy_trans<span class=main>,</span>
                           <span class=operator>simplified</span> seqll_onll_swap<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> oseq_no_leq_num <span class=main>=</span>
  open_seq_invariant <span class=main>[</span><span class=operator>OF</span> seq_no_leq_num initiali_toy otoy_trans toy_trans<span class=main>,</span>
                      <span class=operator>simplified</span> seql_onl_swap<span class=main>]</span>

<span class=keyword1 id=Toy-all_nos_inc><span class=command>lemma</span></span> all_nos_inc<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=free>S</span><span class=main>,</span>
                      other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                       onll Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main>(</span><span class=bound>σ'</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> nos_inc <span class=main>(</span><span class=bound>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=bound>j</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>.</span> <span class=main>⟦</span> otherwith nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=free>S</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>a</span><span class=main>;</span> no <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=main>⟧</span>
                       <span class=main>⟹</span> <span class=main>∀</span><span class=bound>j</span><span class=main>.</span> no <span class=main>(</span><span class=bound>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherwith_syncD<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>inv_cterms</span>
            <span class=quasi_keyword>inv</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> oseq_step_invariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> oseq_nos_incs <span class=main><span class=main><span class=main>[</span></span></span><span class=operator>THEN</span> oinvariant_step_anyact<span class=main><span class=main><span class=main>]</span></span></span>
                                                                                   toy_wf otoy_trans<span class=main><span class=main>]</span></span>
            <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> seqllsimp<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> *<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Toy-oreceived_msg_inv><span class=command>lemma</span></span> oreceived_msg_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>σ'</span> <span class=bound>m</span><span class=main>.</span> <span class=main>⟦</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>m</span><span class=main>;</span> other <span class=free>Q</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=bound>σ</span> <span class=bound>σ'</span> <span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>σ'</span> <span class=bound>m</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> local<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span> <span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>σ</span> <span class=bound>m</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>σ</span><span class=main>(</span><span class=free>i</span> <span class=main>:=</span> <span class=bound>σ</span> <span class=free>i</span><span class=main>⦇</span>msg <span class=main>:=</span> <span class=bound>m</span><span class=main>⦈</span><span class=main>)</span><span class=main>)</span> <span class=bound>m</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=main>⊨</span> <span class=main>(</span>otherwith <span class=free>Q</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>P</span><span class=main>)</span><span class=main>,</span> other <span class=free>Q</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                       onl Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>.</span> <span class=bound>l</span> <span class=main>∈</span> <span class=main>{</span>PToy<span class=main>-:</span><span class=main>1</span><span class=main>}</span> <span class=main>⟶</span> <span class=free>P</span> <span class=bound>σ</span> <span class=main>(</span>msg <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>inv_cterms</span><span class=main><span class=keyword3>,</span></span> <span class=operator>intro</span> impI<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>l</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>=</span> PToy<span class=main>-:</span><span class=main>1</span> <span class=main>⟶</span> <span class=free>P</span> <span class=skolem>σ</span> <span class=main>(</span>msg <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>=</span> PToy<span class=main>-:</span><span class=main>1</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"other <span class=free>Q</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1-2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span> <span class=main>(</span>msg <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span> <span class=main>(</span>msg <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹other <span class=free>Q</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹other <span class=free>Q</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span> <span class=main>(</span>msg <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>msg</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"otherwith <span class=free>Q</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg <span class=free>P</span><span class=main>)</span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=main>(</span>receive <span class=skolem>msg</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span><span class=main>⦇</span>msg <span class=main>:=</span> <span class=skolem>msg</span><span class=main>⦈</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ</span> <span class=skolem>msg</span>"</span></span>
                 <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=free>Q</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>(</span><span class=free>i</span> <span class=main>:=</span> <span class=skolem>σ</span> <span class=free>i</span><span class=main>⦇</span>msg <span class=main>:=</span> <span class=skolem>msg</span><span class=main>⦈</span><span class=main>)</span><span class=main>)</span> <span class=skolem>msg</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> local<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=skolem>σ'</span> <span class=skolem>msg</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> other<span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span><span class=main>⦇</span>msg <span class=main>:=</span> <span class=skolem>msg</span><span class=main>⦈</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=free>i</span> <span class=main>⟶</span> <span class=free>Q</span> <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"other <span class=free>Q</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span><span class=skolem>σ</span><span class=main>(</span><span class=free>i</span> <span class=main>:=</span> <span class=skolem>σ</span> <span class=free>i</span><span class=main>⦇</span>msg <span class=main>:=</span> <span class=skolem>msg</span><span class=main>⦈</span><span class=main>)</span><span class=main>)</span> <span class=skolem>σ'</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span> otherI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Toy-msg_ok_other_nos_inc><span class=command>lemma</span></span> msg_ok_other_nos_inc <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=free>σ</span> <span class=free>m</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=free>σ</span> <span class=free>σ'</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=free>σ'</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>m</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>num</span> <span class=skolem>sid</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> Pkt <span class=skolem>num</span> <span class=skolem>sid</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹msg_ok <span class=free>σ</span> <span class=free>m</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>num</span> <span class=main>≤</span> no <span class=main>(</span><span class=free>σ</span> <span class=skolem>sid</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=free>σ</span> <span class=free>σ'</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=free>σ</span> <span class=skolem>sid</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=free>σ'</span> <span class=skolem>sid</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> otherE<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> eq_iff nos_incD<span class=main>)</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>num</span> <span class=main>≤</span> no <span class=main>(</span><span class=free>σ'</span> <span class=skolem>sid</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>=</span> Pkt <span class=skolem>num</span> <span class=skolem>sid</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Toy-msg_ok_no_leq_no><span class=command>lemma</span></span> msg_ok_no_leq_no <span class=main>[</span><span class=operator>simp</span><span class=main>,</span> <span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=free>σ</span> <span class=free>m</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> no <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=free>σ'</span> <span class=free>m</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>m</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>num</span> <span class=skolem>sid</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>m</span> <span class=main>=</span> Pkt <span class=skolem>num</span> <span class=skolem>sid</span>"</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹msg_ok <span class=free>σ</span> <span class=free>m</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>num</span> <span class=main>≤</span> no <span class=main>(</span><span class=free>σ</span> <span class=skolem>sid</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> no <span class=main>(</span><span class=free>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=free>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=free>σ</span> <span class=skolem>sid</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=free>σ'</span> <span class=skolem>sid</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>num</span> <span class=main>≤</span> no <span class=main>(</span><span class=free>σ'</span> <span class=skolem>sid</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>m</span> <span class=main>=</span> Pkt <span class=skolem>num</span> <span class=skolem>sid</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id=Toy-oreceived_msg_ok><span class=command>lemma</span></span> oreceived_msg_ok<span class=main>:</span>
  <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=main>⊨</span> <span class=main>(</span>otherwith nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg msg_ok<span class=main>)</span><span class=main>,</span>
               other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
              onl Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>.</span> <span class=bound>l</span><span class=main>∈</span><span class=main>{</span>PToy<span class=main>-:</span><span class=main>1</span><span class=main>..}</span> <span class=main>⟶</span> msg_ok <span class=bound>σ</span> <span class=main>(</span>msg <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>⊨</span> <span class=main>(</span><span class=var>?S</span><span class=main>,</span> <span class=var>?U</span> <span class=main>→)</span> <span class=main>_</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>inv_cterms</span> <span class=quasi_keyword>inv</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> oseq_step_invariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> all_nos_inc toy_wf otoy_trans<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span>
         <span class=operator>intro</span> impI<span class=main><span class=keyword3>,</span></span> <span class=operator>elim</span> impE<span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=skolem>σ</span> <span class=main>(</span>msg <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> other<span class=main>:</span> <span class=quoted><span class=quoted>"other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> other <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"msg <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> msg <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> otherE<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=skolem>σ'</span> <span class=main>(</span>msg <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span> <span class=skolem>l</span> <span class=skolem>σ</span> <span class=skolem>a</span> <span class=skolem>q</span> <span class=skolem>l'</span> <span class=skolem>σ'</span> <span class=skolem>pp</span> <span class=skolem>p'</span> <span class=skolem>m</span>
    <span class=keyword3><span class=command>assume</span></span> a1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>p'</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>optoy <span class=free>i</span><span class=main>)</span> <span class=var>?S</span> <span class=var>?U</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> a2<span class=main>:</span> <span class=quoted><span class=quoted>"PToy<span class=main>-:</span><span class=main>1</span> <span class=main>∈</span> labels Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=skolem>p'</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> a3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span><span class=main>⦇</span>msg <span class=main>:=</span> <span class=skolem>m</span><span class=main>⦈</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> inv<span class=main>:</span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=main>⊨</span> <span class=main>(</span><span class=var>?S</span><span class=main>,</span> <span class=var>?U</span> <span class=main>→)</span> onl Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>.</span> <span class=bound>l</span> <span class=main>∈</span> <span class=main>{</span>PToy<span class=main>-:</span><span class=main>1</span><span class=main>}</span> <span class=main>⟶</span> msg_ok <span class=bound>σ</span> <span class=main>(</span>msg <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> oreceived_msg_inv<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>m</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=skolem>σ'</span> <span class=skolem>m</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>m</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=main>(</span><span class=skolem>σ</span><span class=main>(</span><span class=free>i</span> <span class=main>:=</span> <span class=skolem>σ</span> <span class=free>i</span><span class=main>⦇</span>msg <span class=main>:=</span> <span class=skolem>m</span><span class=main>⦈</span><span class=main>)</span><span class=main>)</span> <span class=skolem>m</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>m</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>from</span></span> a1 a2 a3 <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=skolem>σ'</span> <span class=skolem>m</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> oinvariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> inv<span class=main><span class=main>]</span></span> onlD<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Toy-is_pkt_handler_num_leq_no><span class=command>lemma</span></span> is_pkt_handler_num_leq_no<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=main>⊨</span> <span class=main>(</span>otherwith nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg msg_ok<span class=main>)</span><span class=main>,</span>
                      other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                    onl Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>.</span> <span class=bound>l</span><span class=main>∈</span><span class=main>{</span>PToy<span class=main>-:</span><span class=numeral>6</span><span class=main>..</span>PToy<span class=main>-:</span><span class=numeral>10</span><span class=main>}</span> <span class=main>⟶</span> num <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ</span> <span class=main>(</span>sid <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>{</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"num <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"num <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
        <span class=keyword1><span class=command>note</span></span> <span class=quoted><span class=quoted>‹num <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> solve_step <span class=main>=</span> this
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>inv_cterms</span> <span class=quasi_keyword>inv</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> oseq_step_invariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> all_nos_inc toy_wf otoy_trans<span class=main><span class=main>]</span></span>
                               onl_oinvariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> toy_wf oreceived_msg_ok<span class=main><span class=main>]</span></span>
                        <span class=quasi_keyword>solve</span><span class=main><span class=main>:</span></span> solve_step<span class=main><span class=keyword3>,</span></span> <span class=operator>intro</span> impI<span class=main><span class=keyword3>,</span></span> <span class=operator>elim</span> impE<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span>
      <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"num <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>i</span>"</span></span>
                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>⟶</span> nos_inc <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"num <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>      
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>i</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> * <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>i</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≠</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>⟶</span> nos_inc <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>with</span></span> * <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span><span class=main>{</span><span class=free>i</span><span class=main>}</span><span class=main>.</span> <span class=skolem>σ'</span> <span class=bound>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=bound>i</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span> <span class=skolem>l</span> <span class=skolem>σ</span> <span class=skolem>a</span> <span class=skolem>q</span> <span class=skolem>l'</span> <span class=skolem>σ'</span> <span class=skolem>pp</span> <span class=skolem>p'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=skolem>σ</span> <span class=main>(</span>msg <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>∈</span> is_pkt <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"num <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"msg <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>num'</span> <span class=skolem>sid'</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"msg <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> Pkt <span class=skolem>num'</span> <span class=skolem>sid'</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>∈</span> is_pkt <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=quoted><span class=quoted>"num <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>num'</span>"</span></span>
                                      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sid <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>sid'</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> is_pkt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹msg <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> Pkt <span class=skolem>num'</span> <span class=skolem>sid'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹msg_ok <span class=skolem>σ</span> <span class=main>(</span>msg <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"num <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>.</span></span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>num'</span> <span class=skolem>sid'</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"msg <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> Newpkt <span class=skolem>num'</span> <span class=skolem>sid'</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>∈</span> is_pkt <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted>False</span>
          <span class=keyword1><span class=command>unfolding</span></span> is_pkt_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>..</span></span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemmas</span></span> oseq_id_constant <span class=main>=</span>
  open_seq_invariant <span class=main>[</span><span class=operator>OF</span> id_constant initiali_toy otoy_trans toy_trans<span class=main>,</span>
                      <span class=operator>simplified</span> seql_onl_swap<span class=main>]</span>

<span class=keyword1><span class=command>lemmas</span></span> oseq_nhid_eq_i <span class=main>=</span>
  open_seq_invariant <span class=main>[</span><span class=operator>OF</span> nhid_eq_i initiali_toy otoy_trans toy_trans<span class=main>,</span>
                      <span class=operator>simplified</span> seql_onl_swap<span class=main>]</span>
  
<span class=keyword1><span class=command>lemmas</span></span> oseq_nhid_eq_id <span class=main>=</span>
  open_seq_invariant <span class=main>[</span><span class=operator>OF</span> nhid_eq_id initiali_toy otoy_trans toy_trans<span class=main>,</span>
                      <span class=operator>simplified</span> seql_onl_swap<span class=main>]</span>

<span class=keyword1 id=Toy-oseq_bigger_than_next><span class=command>lemma</span></span> oseq_bigger_than_next<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=main>⊨</span> <span class=main>(</span>otherwith nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg msg_ok<span class=main>)</span><span class=main>,</span>
                      other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> no <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>⊨</span> <span class=main>(</span><span class=var>?S</span><span class=main>,</span> <span class=var>?U</span> <span class=main>→)</span> <span class=var>?P</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> nhidinv<span class=main>:</span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=main>⊨</span> <span class=main>(</span><span class=var>?S</span><span class=main>,</span> <span class=var>?U</span> <span class=main>→)</span>
                              onl Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>.</span> <span class=bound>l</span><span class=main>∈</span><span class=main>{</span>PToy<span class=main>-:</span><span class=numeral>2</span><span class=main>..</span>PToy<span class=main>-:</span><span class=numeral>8</span><span class=main>}</span>
                                                    <span class=main>⟶</span> nhid <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> id <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oinvariant_weakenE <span class=main><span class=main>[</span></span><span class=operator>OF</span> oseq_nhid_eq_id<span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> seqlsimp<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> idinv<span class=main>:</span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=main>⊨</span> <span class=main>(</span><span class=var>?S</span><span class=main>,</span> <span class=var>?U</span> <span class=main>→)</span> onl Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>.</span> id <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oinvariant_weakenE <span class=main><span class=main>[</span></span><span class=operator>OF</span> oseq_id_constant<span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> seqlsimp<span class=main>)</span>
    <span class=keyword1><span class=command>{</span></span> <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>a</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> nos_inc <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>note</span></span> this<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> nos_inc <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>nhid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>nhid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> * <span class=main>=</span> this
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=main>⊨</span> <span class=main>(</span>otherwith nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg msg_ok<span class=main>)</span><span class=main>,</span>
                      other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                     onl Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>l</span><span class=main>)</span><span class=main>.</span> no <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>inv_cterms</span>
             <span class=quasi_keyword>inv</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> onl_oinvariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> toy_wf oseq_no_leq_num <span class=main><span class=main><span class=main>[</span></span></span><span class=operator>THEN</span> oinvariant_anyact<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span>
                      oseq_step_invariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> all_nos_inc toy_wf otoy_trans<span class=main><span class=main>]</span></span>
                      onl_oinvariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> toy_wf is_pkt_handler_num_leq_no<span class=main><span class=main>]</span></span>
                      onl_oinvariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> toy_wf nhidinv<span class=main><span class=main>]</span></span>
                      onl_oinvariant_sterms <span class=main><span class=main>[</span></span><span class=operator>OF</span> toy_wf idinv<span class=main><span class=main>]</span></span>
             <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> seqlsimp seqllsimp
             <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> nos_inc_simp
                <span class=quasi_keyword>solve</span><span class=main><span class=main>:</span></span> *<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>p</span> <span class=skolem>l</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>p</span> <span class=skolem>l</span>
      <span class=keyword3><span class=command>assume</span></span> or<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>p</span><span class=main>)</span> <span class=main>∈</span> oreachable <span class=main>(</span>optoy <span class=free>i</span><span class=main>)</span> <span class=var>?S</span> <span class=var>?U</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>l</span> <span class=main>∈</span> labels Γ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=skolem>p</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>nhid <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"nhid <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>i</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"nhid <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=main>=</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹no <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"nhid <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span> <span class=main>≠</span> <span class=free>i</span>"</span></span>
        <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=main>[</span><span class=operator>THEN</span> other_localD<span class=main>]</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>nhid <span class=main>(</span><span class=skolem>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span><span class=main>)</span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹no <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>σ'</span> <span class=free>i</span> <span class=main>=</span> <span class=skolem>σ</span> <span class=free>i</span>›</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>p</span> <span class=skolem>l</span> <span class=skolem>σ</span> <span class=skolem>a</span> <span class=skolem>q</span> <span class=skolem>l'</span> <span class=skolem>σ'</span> <span class=skolem>pp</span> <span class=skolem>p'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> num <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"num <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> nos_inc <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>1-2<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> le_trans<span class=main>)</span>
      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> nos_inc <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=main>(</span>sid <span class=main>(</span><span class=skolem>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> oinvariant_weakenE<span class=main>)</span>
         <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> onl_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Toy-anycast_weakenE><span class=command>lemma</span></span> anycast_weakenE <span class=main>[</span><span class=operator>elim</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"anycast <span class=free>P</span> <span class=free>a</span>"</span></span>
      <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>m</span><span class=main>.</span> <span class=free>P</span> <span class=bound>m</span> <span class=main>⟹</span> <span class=free>Q</span> <span class=bound>m</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"anycast <span class=free>Q</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> anycast_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> seq_action.split<span class=main>)</span>

<span class=keyword1 id=Toy-oseq_msg_ok><span class=command>lemma</span></span> oseq_msg_ok<span class=main>:</span>
  <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>act TT<span class=main>,</span> other <span class=free>U</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> anycast <span class=main>(</span>msg_ok <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariant_weakenE <span class=main><span class=main>[</span></span><span class=operator>OF</span> open_seq_step_invariant
            <span class=main><span class=main><span class=main>[</span></span></span><span class=operator>OF</span> seq_msg_ok initiali_toy otoy_trans toy_trans<span class=main><span class=main><span class=main>,</span></span></span> <span class=operator>simplified</span> seql_onl_swap<span class=main><span class=main><span class=main>]</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> seqllsimp <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onllD <span class=quasi_keyword>elim</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> anycast_weakenE <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> msg_okI<span class=main>)</span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Lifting"</span></span>

<span class=keyword1 id=Toy-opar_bigger_than_next><span class=command>lemma</span></span> opar_bigger_than_next<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg <span class=main>⊨</span> <span class=main>(</span>otherwith nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg msg_ok<span class=main>)</span><span class=main>,</span>
                      other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span> global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> no <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> lift_into_qmsg <span class=main><span class=main>[</span></span><span class=operator>OF</span> oseq_bigger_than_next<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>σ'</span> <span class=skolem>m</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> nos_inc <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>"</span></span>
       <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=skolem>σ</span> <span class=skolem>m</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>2<span class=main>)</span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"msg_ok <span class=skolem>σ'</span> <span class=skolem>m</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>m</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> msg_ok_Pkt<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>num'</span> <span class=skolem>sid'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>num'</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ</span> <span class=skolem>sid'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> nos_inc <span class=main>(</span><span class=skolem>σ</span> <span class=bound>j</span><span class=main>)</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=bound>j</span><span class=main>)</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"no <span class=main>(</span><span class=skolem>σ</span> <span class=skolem>sid'</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=skolem>sid'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>num'</span> <span class=main>≤</span> no <span class=main>(</span><span class=skolem>σ'</span> <span class=skolem>sid'</span><span class=main>)</span>"</span></span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span>otherwith nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>orecvmsg msg_ok<span class=main>)</span><span class=main>,</span> other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                      globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> nos_inc <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariant_weakenE <span class=main><span class=main>[</span></span><span class=operator>OF</span> open_seq_step_invariant
                                         <span class=main><span class=main>[</span></span><span class=operator>OF</span> seq_nos_incs initiali_toy otoy_trans toy_trans<span class=main><span class=main>]</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
         <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> seqllsimp <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onllD<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Toy-onode_bigger_than_next><span class=command>lemma</span></span> onode_bigger_than_next<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> optoy <span class=free>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span>
     <span class=main>⊨</span> <span class=main>(</span>otherwith nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>(</span>oarrivemsg msg_ok<span class=main>)</span><span class=main>,</span> other nos_inc <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
        global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> no <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> node_lift <span class=main><span class=main>[</span></span><span class=operator>OF</span> opar_bigger_than_next<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=Toy-node_local_nos_inc><span class=command>lemma</span></span> node_local_nos_inc<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>i</span> <span class=main>:</span> optoy <span class=free>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg <span class=main>:</span> <span class=free>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                                     globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> nos_inc <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> node_lift_step_statelessassm<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                      globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> nos_inc <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariant_weakenE <span class=main><span class=main>[</span></span><span class=operator>OF</span> oseq_nos_incs<span class=main><span class=main>]</span></span><span class=main>)</span>
         <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> seqllsimp <span class=quasi_keyword>dest</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> onllD<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"optoy <span class=free>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=free>i</span></sub><span class=hidden>⇙</span> qmsg <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=free>i</span><span class=main>}</span> <span class=main>→)</span>
                                globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> nos_inc <span class=main>(</span><span class=bound>σ</span> <span class=free>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=free>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> lift_step_into_qmsg_statelessassm<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Toy-opnet_bigger_than_next><span class=command>lemma</span></span> opnet_bigger_than_next<span class=main>:</span>
  <span class=quoted><span class=quoted>"opnet <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> optoy <span class=bound>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=bound>i</span></sub><span class=hidden>⇙</span> qmsg<span class=main>)</span> <span class=free>n</span>
     <span class=main>⊨</span> <span class=main>(</span>otherwith nos_inc <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span>oarrivemsg msg_ok<span class=main>)</span><span class=main>,</span>
         other nos_inc <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>→)</span>
        global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>n</span><span class=main>.</span> no <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> pnet_lift <span class=main><span class=main>[</span></span><span class=operator>OF</span> onode_bigger_than_next<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=skolem>i</span> <span class=main>:</span> optoy <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> qmsg <span class=main>:</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg msg_ok <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=skolem>i</span><span class=main>}</span> <span class=main>→)</span>
                                            globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span>msg_ok <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> node_lift_anycast_statelessassm<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"optoy <span class=skolem>i</span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=skolem>i</span><span class=main>}</span> <span class=main>→)</span>
                        globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> anycast <span class=main>(</span>msg_ok <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariant_weakenE <span class=main><span class=main>[</span></span><span class=operator>OF</span> oseq_msg_ok<span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"optoy <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> qmsg <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=skolem>i</span><span class=main>}</span> <span class=main>→)</span>
                                   globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> anycast <span class=main>(</span>msg_ok <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> lift_step_into_qmsg_statelessassm<span class=main>)</span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"optoy <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> qmsg <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> orecvmsg msg_ok <span class=bound>σ</span><span class=main>,</span> other <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>)</span> <span class=main>{</span><span class=skolem>i</span><span class=main>}</span> <span class=main>→)</span>
                                  globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> anycast <span class=main>(</span>msg_ok <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariant_weakenE<span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=skolem>i</span> <span class=main>:</span> optoy <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> qmsg <span class=main>:</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg msg_ok <span class=bound>σ</span><span class=main>,</span> other nos_inc <span class=main>{</span><span class=skolem>i</span><span class=main>}</span> <span class=main>→)</span>
                                            globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=main><span class=bound>_</span></span><span class=main>)</span><span class=main>.</span> castmsg <span class=main>(</span>msg_ok <span class=bound>σ</span><span class=main>)</span> <span class=bound>a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariant_weakenE<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=skolem>i</span> <span class=main>:</span> optoy <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> qmsg <span class=main>:</span> <span class=skolem>R<span class=hidden>⇩</span><sub>i</sub></span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg msg_ok <span class=bound>σ</span><span class=main>,</span>
                                            other nos_inc <span class=main>{</span><span class=skolem>i</span><span class=main>}</span> <span class=main>→)</span>
             globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=keyword1>τ</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> nos_inc <span class=main>(</span><span class=bound>σ</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=skolem>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariant_weakenE <span class=main><span class=main>[</span></span><span class=operator>OF</span> node_local_nos_inc<span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>R</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=skolem>i</span> <span class=main>:</span> optoy <span class=skolem>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=skolem>i</span></sub><span class=hidden>⇙</span> qmsg <span class=main>:</span> <span class=skolem>R</span><span class=keyword1>⟩<span class=hidden>⇩</span><sub>o</sub></span> <span class=keyword1>⊨<span class=hidden>⇩</span><sub>A</sub></span> <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span> <span class=main><span class=bound>_</span></span><span class=main>.</span> oarrivemsg msg_ok <span class=bound>σ</span><span class=main>,</span>
                                           other nos_inc <span class=main>{</span><span class=skolem>i</span><span class=main>}</span> <span class=main>→)</span>
             globala <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>a</span><span class=main>,</span> <span class=bound>σ'</span><span class=main>)</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> <span class=keyword1>τ</span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>d</span><span class=main>.</span> <span class=bound>a</span> <span class=main>=</span> <span class=skolem>i</span><span class=keyword1>:deliver(</span><span class=bound>d</span><span class=main>)</span><span class=main>)</span> <span class=main>⟶</span> nos_inc <span class=main>(</span><span class=bound>σ</span> <span class=skolem>i</span><span class=main>)</span> <span class=main>(</span><span class=bound>σ'</span> <span class=skolem>i</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ostep_invariant_weakenE <span class=main><span class=main>[</span></span><span class=operator>OF</span> node_local_nos_inc<span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>

<span class=keyword1 id=Toy-ocnet_bigger_than_next><span class=command>lemma</span></span> ocnet_bigger_than_next<span class=main>:</span>
  <span class=quoted><span class=quoted>"oclosed <span class=main>(</span>opnet <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> optoy <span class=bound>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=bound>i</span></sub><span class=hidden>⇙</span> qmsg<span class=main>)</span> <span class=free>n</span><span class=main>)</span>
     <span class=main>⊨</span> <span class=main>(</span><span class=main>λ</span><span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span> <span class=main><span class=bound>_</span></span><span class=main>.</span> True<span class=main>,</span> other nos_inc <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>→)</span>
        global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>n</span><span class=main>.</span> no <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> inclosed_closed<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"opnet <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> optoy <span class=bound>i</span> ⟨⟨<span class=hidden>⇘</span><sub><span class=bound>i</span></sub><span class=hidden>⇙</span> qmsg<span class=main>)</span> <span class=free>n</span>
            <span class=main>⊨</span> <span class=main>(</span>otherwith <span class=main>(=)</span> <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> inoclosed<span class=main>,</span> other nos_inc <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>→)</span>
               global <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>n</span><span class=main>.</span> no <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> oinvariant_weakenE <span class=main><span class=main>[</span></span><span class=operator>OF</span> opnet_bigger_than_next<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>s</span> <span class=skolem>s'</span><span class=main>::</span> <span class=quoted><span class=quoted>"nat <span class=main>⇒</span> state"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>a</span> <span class=main>::</span> <span class=quoted><span class=quoted>"msg node_action"</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"otherwith <span class=main>(=)</span> <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> inoclosed <span class=skolem>s</span> <span class=skolem>s'</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"otherwith nos_inc <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> <span class=main>(</span>oarrivemsg msg_ok<span class=main>)</span> <span class=skolem>s</span> <span class=skolem>s'</span> <span class=skolem>a</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> otherwithE<span class=main><span class=keyword3>,</span></span> <span class=operator>intro</span> otherwithI<span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"inoclosed <span class=skolem>s</span> <span class=skolem>a</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>∉</span> net_tree_ips <span class=free>n</span> <span class=main>⟶</span> <span class=skolem>s</span> <span class=bound>j</span> <span class=main>=</span> <span class=skolem>s'</span> <span class=bound>j</span>"</span></span>
           <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"otherwith <span class=main>(</span><span class=main>(=)</span><span class=main>)</span> <span class=main>(</span>net_tree_ips <span class=free>n</span><span class=main>)</span> inoclosed <span class=skolem>s</span> <span class=skolem>s'</span> <span class=skolem>a</span>"</span></span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"oarrivemsg msg_ok <span class=skolem>s</span> <span class=skolem>a</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>a</span></span><span class=main>)</span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Transfer"</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>initmissing</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>nat <span class=main>⇒</span> state option<span class=main>)</span> <span class=main>×</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=main>(</span>nat <span class=main>⇒</span> state<span class=main>)</span> <span class=main>×</span> <span class=tfree>'a</span>"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>initmissing</span> <span class=free><span class=bound><span class=entity>σ</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> <span class=keyword1>case</span> <span class=main>(</span>fst <span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>)</span> <span class=bound>i</span> <span class=keyword1>of</span> None <span class=main>⇒</span> toy_init <span class=bound>i</span> <span class=main>|</span> Some <span class=bound>s</span> <span class=main>⇒</span> <span class=bound>s</span><span class=main>,</span> snd <span class=free><span class=bound><span class=entity>σ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Toy-not_in_net_ips_fst_init_missing><span class=command>lemma</span></span> not_in_net_ips_fst_init_missing <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>i</span> <span class=main>∉</span> net_ips <span class=free>σ</span>"</span></span>
    <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap fst <span class=free>σ</span><span class=main>)</span><span class=main>)</span> <span class=free>i</span> <span class=main>=</span> toy_init <span class=free>i</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>unfolding</span></span> initmissing_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Toy-fst_initmissing_netgmap_pair_fst><span class=command>lemma</span></span> fst_initmissing_netgmap_pair_fst <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span>Fun.id <span class=bound>p</span><span class=main>)</span><span class=main>,</span> snd <span class=main>(</span>Fun.id <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span>
                                               <span class=main>=</span> fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap fst <span class=free>s</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> initmissing_def <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>interpretation</span></span> toy_openproc<span class=main>:</span> openproc <span class=quoted>ptoy</span> <span class=quoted>optoy</span> <span class=quoted>Fun.id</span>
  <span class=keyword2><span class=keyword>rewrites</span></span> <span class=quoted><span class=quoted>"toy_openproc.initmissing <span class=main>=</span> initmissing"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"openproc ptoy optoy Fun.id"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>unfold_locales</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=main>::</span> <span class=quoted>ip</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span> <span class=skolem>i</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span> <span class=main>∈</span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=skolem>i</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=skolem>i</span> <span class=main>⟶</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>∈</span> fst <span class=main>`</span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub> <span class=bound>j</span><span class=main>)</span><span class=main>}</span> <span class=main>⊆</span> σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def σ<span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> equalityD1<span class=main>)</span>
          <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>f</span> <span class=bound>p</span><span class=main>.</span> <span class=main>{</span><span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span><span class=bound>σ</span> <span class=skolem>i</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=main>(</span><span class=bound>f</span> <span class=skolem>i</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>}</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span> <span class=main>≠</span> <span class=skolem>i</span>
                      <span class=main>⟶</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>∈</span> fst <span class=main>`</span> <span class=main>{</span><span class=main>(</span><span class=bound>f</span> <span class=bound>j</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>}</span><span class=main>)</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=main>(</span><span class=bound>f</span><span class=main>,</span> <span class=bound>p</span><span class=main>)</span><span class=main>}</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> set_eqI<span class=main>)</span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span> <span class=main>(</span><span class=bound>σ</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span> <span class=main>|</span><span class=bound>σ</span> <span class=bound>ζ</span> <span class=bound>s</span><span class=main>.</span> <span class=bound>s</span> <span class=main>∈</span> init <span class=main>(</span>ptoy <span class=skolem>i</span><span class=main>)</span>
                             <span class=main>∧</span> <span class=main>(</span><span class=bound>σ</span> <span class=skolem>i</span><span class=main>,</span> <span class=bound>ζ</span><span class=main>)</span> <span class=main>=</span> Fun.id <span class=bound>s</span>
                             <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span><span class=bound>j</span><span class=main>.</span> <span class=bound>j</span><span class=main>≠</span><span class=skolem>i</span> <span class=main>⟶</span> <span class=bound>σ</span> <span class=bound>j</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=keyword1>o</span> Fun.id<span class=main>)</span> <span class=main>`</span> init <span class=main>(</span>ptoy <span class=bound>j</span><span class=main>)</span><span class=main>)</span> <span class=main>}</span> <span class=main>⊆</span> init <span class=main>(</span>optoy <span class=skolem>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>j</span><span class=main>.</span> init <span class=main>(</span>ptoy <span class=bound>j</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>i</span> <span class=skolem>s</span> <span class=skolem>a</span> <span class=skolem>s'</span> <span class=skolem>σ</span> <span class=skolem>σ'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span>Fun.id <span class=skolem>s</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ'</span> <span class=skolem>i</span> <span class=main>=</span> fst <span class=main>(</span>Fun.id <span class=skolem>s'</span><span class=main>)</span>"</span></span>
         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>s</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>s'</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>ptoy <span class=skolem>i</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>q</span></span> <span class=skolem><span class=skolem>q'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span> <span class=skolem>i</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span>"</span></span>
                         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>s'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=skolem>i</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span>"</span></span>
                         <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span> <span class=skolem>i</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=skolem>i</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>ptoy <span class=skolem>i</span><span class=main>)</span>"</span></span> 
         <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>s</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>s'</span></span><span class=main>)</span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>from</span></span> this<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>optoy <span class=skolem>i</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule</span> open_seqp_action <span class=main><span class=main>[</span></span><span class=operator>OF</span> toy_wf<span class=main><span class=main>]</span></span><span class=main>)</span>

      <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ</span> <span class=skolem>i</span><span class=main>,</span> <span class=skolem>q</span><span class=main>)</span>›</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>s'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>σ'</span> <span class=skolem>i</span><span class=main>,</span> <span class=skolem>q'</span><span class=main>)</span>›</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>σ</span><span class=main>,</span> snd <span class=main>(</span>Fun.id <span class=skolem>s</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=main>(</span><span class=skolem>σ'</span><span class=main>,</span> snd <span class=main>(</span>Fun.id <span class=skolem>s'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∈</span> trans <span class=main>(</span>optoy <span class=skolem>i</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>interpret</span></span> op0<span class=main>:</span> openproc <span class=quoted>ptoy</span> <span class=quoted>optoy</span> <span class=quoted>Fun.id</span> <span class=keyword1><span class=command>.</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span><span class=main>.</span> <span class=main>(</span><span class=keyword1>SOME</span> <span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> <span class=main>(</span>fst <span class=keyword1>o</span> Fun.id<span class=main>)</span> <span class=main>`</span> init <span class=main>(</span>ptoy <span class=bound>i</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> toy_init <span class=bound>i</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>i</span><span class=main>.</span> openproc.initmissing ptoy Fun.id <span class=bound>i</span> <span class=main>=</span> initmissing <span class=bound>i</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> op0.initmissing_def op0.someinit_def initmissing_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> option.split<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"openproc.initmissing ptoy Fun.id <span class=main>=</span> initmissing"</span></span> <span class=keyword1><span class=command>..</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Toy-fst_initmissing_netgmap_default_toy_init_netlift><span class=command>lemma</span></span> fst_initmissing_netgmap_default_toy_init_netlift<span class=main>:</span>
  <span class=quoted><span class=quoted>"fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap <span class=free>sr</span> <span class=free>s</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> default toy_init <span class=main>(</span>netlift <span class=free>sr</span> <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> initmissing_def default_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fst_netgmap_netlift <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> One_nat_def<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=entity>netglobal</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>nat <span class=main>⇒</span> state<span class=main>)</span> <span class=main>⇒</span> bool<span class=main>)</span> <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span>state <span class=main>×</span> <span class=tfree>'b</span><span class=main>)</span> <span class=main>×</span> <span class=tfree>'c</span><span class=main>)</span> net_state <span class=main>⇒</span> bool"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>netglobal</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>λ</span><span class=bound>s</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>P</span></span></span> <span class=main>(</span>default toy_init <span class=main>(</span>netlift fst <span class=bound>s</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>interpretation</span></span> toy_openproc_par_qmsg<span class=main>:</span> openproc_parq <span class=quoted>ptoy</span> <span class=quoted>optoy</span> <span class=quoted>Fun.id</span> <span class=quoted>qmsg</span>
  <span class=keyword2><span class=keyword>rewrites</span></span> <span class=quoted><span class=quoted>"toy_openproc_par_qmsg.netglobal <span class=main>=</span> netglobal"</span></span>
    <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"toy_openproc_par_qmsg.initmissing <span class=main>=</span> initmissing"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"openproc_parq ptoy optoy Fun.id qmsg"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>unfold_locales</span><span class=main>)</span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword1><span class=command>interpret</span></span> opq<span class=main>:</span> openproc_parq <span class=quoted>ptoy</span> <span class=quoted>optoy</span> <span class=quoted>Fun.id</span> <span class=quoted>qmsg</span> <span class=keyword1><span class=command>.</span></span>

    <span class=keyword1><span class=command>have</span></span> im<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>σ</span><span class=main>.</span> openproc.initmissing <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> ptoy <span class=bound>i</span> <span class=main>⟨⟨</span> qmsg<span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span>Fun.id <span class=bound>p</span><span class=main>)</span><span class=main>,</span> snd <span class=main>(</span>Fun.id <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=bound>σ</span>
                                                                                    <span class=main>=</span> initmissing <span class=bound>σ</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> opq.initmissing_def opq.someinit_def initmissing_def
      <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_def <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>cong</span><span class=main><span class=main>:</span></span> option.case_cong<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"openproc.initmissing <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> ptoy <span class=bound>i</span> <span class=main>⟨⟨</span> qmsg<span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span>Fun.id <span class=bound>p</span><span class=main>)</span><span class=main>,</span> snd <span class=main>(</span>Fun.id <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> initmissing"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>P</span> <span class=bound>σ</span><span class=main>.</span> openproc.netglobal <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> ptoy <span class=bound>i</span> <span class=main>⟨⟨</span> qmsg<span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span>Fun.id <span class=bound>p</span><span class=main>)</span><span class=main>,</span> snd <span class=main>(</span>Fun.id <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=bound>P</span> <span class=bound>σ</span>
                                                                                <span class=main>=</span> netglobal <span class=bound>P</span> <span class=bound>σ</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> opq.netglobal_def netglobal_def opq.initmissing_def initmissing_def opq.someinit_def
      <span class=keyword1><span class=command>unfolding</span></span> σ<span class=hidden>⇩</span><sub>T</sub><span class=hidden>⇩</span><sub>O</sub><span class=hidden>⇩</span><sub>Y</sub>_def σ<span class=hidden>⇩</span><sub>Q</sub><span class=hidden>⇩</span><sub>M</sub><span class=hidden>⇩</span><sub>S</sub><span class=hidden>⇩</span><sub>G</sub>_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>clarsimp</span> <span class=quasi_keyword>cong</span><span class=main><span class=main>:</span></span> option.case_cong
                   <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> One_nat_def
                   <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> fst_initmissing_netgmap_default_toy_init_netlift
                                                  <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>,</span></span> <span class=operator>unfolded</span> initmissing_def<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"openproc.netglobal <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> ptoy <span class=bound>i</span> <span class=main>⟨⟨</span> qmsg<span class=main>)</span> <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>p</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>.</span> <span class=main>(</span>fst <span class=main>(</span>Fun.id <span class=bound>p</span><span class=main>)</span><span class=main>,</span> snd <span class=main>(</span>Fun.id <span class=bound>p</span><span class=main>)</span><span class=main>,</span> <span class=bound>q</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> netglobal"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>"Final result"</span></span>

<span class=keyword1 id=Toy-bigger_than_next><span class=command>lemma</span></span> bigger_than_next<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"wf_net_tree <span class=free>n</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"closed <span class=main>(</span>pnet <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> ptoy <span class=bound>i</span> <span class=main>⟨⟨</span> qmsg<span class=main>)</span> <span class=free>n</span><span class=main>)</span> <span class=main>⊫</span> netglobal <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>.</span> no <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>_</span> <span class=main>⊫</span> netglobal <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>.</span> <span class=var>?inv</span> <span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹wf_net_tree <span class=free>n</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> proto<span class=main>:</span> <span class=quoted><span class=quoted>"closed <span class=main>(</span>pnet <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> ptoy <span class=bound>i</span> <span class=main>⟨⟨</span> qmsg<span class=main>)</span> <span class=free>n</span><span class=main>)</span>
                      <span class=main>⊫</span> netglobal <span class=main>(</span><span class=main>λ</span><span class=bound>σ</span><span class=main>.</span> <span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>n</span><span class=main>.</span> no <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span> <span class=main>≤</span> no <span class=main>(</span><span class=bound>σ</span> <span class=main>(</span>nhid <span class=main>(</span><span class=bound>σ</span> <span class=bound>i</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> toy_openproc_par_qmsg.close_opnet <span class=main><span class=main>[</span></span><span class=operator>OF</span> _ ocnet_bigger_than_next<span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> invariant_def opnet_sos.opnet_tau1
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> toy_openproc_par_qmsg.netglobalsimp
                            fst_initmissing_netgmap_pair_fst<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> allI<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>σ</span> <span class=skolem>i</span>
      <span class=keyword3><span class=command>assume</span></span> sr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=main>∈</span> reachable <span class=main>(</span>closed <span class=main>(</span>pnet <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> ptoy <span class=bound>i</span> <span class=main>⟨⟨</span> qmsg<span class=main>)</span> <span class=free>n</span><span class=main>)</span><span class=main>)</span> TT"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>i</span><span class=main>∈</span>net_tree_ips <span class=free>n</span><span class=main>.</span> <span class=var>?inv</span> <span class=main>(</span>fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap fst <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>i</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>drule</span> invariantD <span class=main><span class=main>[</span></span><span class=operator>OF</span> proto<span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span>
              <span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> toy_openproc_par_qmsg.netglobalsimp
                         fst_initmissing_netgmap_pair_fst<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?inv</span> <span class=main>(</span>fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap fst <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∈</span>net_tree_ips <span class=free>n</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∉</span>net_tree_ips <span class=free>n</span>"</span></span>
        <span class=keyword1><span class=command>from</span></span> sr <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>σ</span> <span class=main>∈</span> reachable <span class=main>(</span>pnet <span class=main>(</span><span class=main>λ</span><span class=bound>i</span><span class=main>.</span> ptoy <span class=bound>i</span> <span class=main>⟨⟨</span> qmsg<span class=main>)</span> <span class=free>n</span><span class=main>)</span> TT"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"net_ips <span class=skolem>σ</span> <span class=main>=</span> net_tree_ips <span class=free>n</span>"</span></span> <span class=keyword1><span class=command>..</span></span>
        <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>i</span><span class=main>∉</span>net_tree_ips <span class=free>n</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>i</span><span class=main>∉</span>net_ips <span class=skolem>σ</span>"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>fst <span class=main>(</span>initmissing <span class=main>(</span>netgmap fst <span class=skolem>σ</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=skolem>i</span> <span class=main>=</span> toy_init <span class=skolem>i</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span> <span class=operator>metis</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div><div id=AWN_Term_Graph><div class=head><h1>Theory AWN_Term_Graph</h1></div><pre class=source><span class=comment1>(*  Title:       AWN_Term_Graph.thy
    License:     BSD 2-Clause. See LICENSE.
    Author:      Timothy Bourke
*)</span>
<span class=keyword1><span class=command>theory</span></span> AWN_Term_Graph
<span class=keyword2><span class=keyword>imports</span></span> <a href=AWN_Cterms.html>AWN_Cterms</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>datatype</span></span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node <span class=main>=</span>
    RootNode <span class=tfree><span class=quoted><span class=tfree>'p</span></span></span>
  <span class=main>|</span> InternalNode <span class=tfree><span class=quoted><span class=tfree>'l</span></span></span>

<span class=keyword1><span class=command>datatype</span></span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> link <span class=main>=</span>
    ILink <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node"</span></span>
  <span class=main>|</span> ELink <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>gseqp'_fails</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>gseqp'_fails</span> <span class=main>=</span> <span class=main>[]</span>"</span></span>
<span class=keyword1><span class=command>declare</span></span> <span class=main>[</span><span class=main>[</span><span class=operator>code</span> <span class=quasi_keyword>abort</span><span class=main><span class=main>:</span></span> <span class=quoted>gseqp'_fails</span><span class=main>]</span><span class=main>]</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>gseqp'</span>
  <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>⟩</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span>                <span class=main>=</span> <span class=main>[</span>InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>⟧</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span>                <span class=main>=</span> <span class=main>[</span>InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span><span class=main><span class=bound><span class=entity>_</span></span></span> <span class=main>▹</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>[</span>InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span>     <span class=main>=</span> <span class=main>[</span>InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span>  <span class=main>=</span> <span class=main>[</span>InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span>           <span class=main>=</span> <span class=main>[</span>InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span>        <span class=main>=</span> <span class=main>[</span>InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span>        <span class=main>=</span> <span class=main>[</span>InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>]</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span>                <span class=main>=</span> <span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>@</span> <span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp'</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span>               <span class=main>=</span> gseqp'_fails"</span></span>
<span class=comment1>(*
(* It would be better to define this function for all wellformed Γ, as shown
   below, but I can't get the code generator to work smoothly with the
   conditional simp rules. *)

  | "gseqp' Γ (call(pn))               = gseqp' Γ (Γ pn)"
  by pat_completeness auto

lemma gseqp'_termination:
  assumes "wellformed Γ"
    shows "gseqp'_dom (Γ, p)"
  proof -
    have gseqp'_rel':
      "gseqp'_rel = (λgq gp. (gq, gp) ∈ {((Γ, q), (Γ', p)). Γ = Γ' ∧ p ↝<span class=hidden>⇘</span><sub>Γ</sub><span class=hidden>⇙</span> q})"
      by (rule ext)+ (auto simp: gseqp'_rel.simps elim: microstep.cases)

    from assms have "∀x. x ∈ acc {(q, p). p ↝<span class=hidden>⇘</span><sub>Γ</sub><span class=hidden>⇙</span> q}"
      unfolding wellformed_def by (simp add: wf_acc_iff)
    hence "p ∈ acc {(q, p). p ↝<span class=hidden>⇘</span><sub>Γ</sub><span class=hidden>⇙</span> q}" ..

    hence "(Γ, p) ∈ acc {((Γ, q), (Γ', p)). Γ = Γ' ∧ p ↝<span class=hidden>⇘</span><sub>Γ</sub><span class=hidden>⇙</span> q}"
      by (rule acc_induct) (auto intro: accI)

    thus "gseqp'_dom (Γ, p)" unfolding gseqp'_rel' accp_acc_eq .
  qed

declare gseqp'.psimps [simp, code del]
lemmas gseqp'_psimps[simp] = gseqp'.psimps [OF gseqp'_termination]
   and gseqp'_pinduct = gseqp'.pinduct [OF gseqp'_termination]
*)</span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>gseqp</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp
              <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node list <span class=main>*</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node list <span class=main>*</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> link list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟨</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>⟩</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>me</span> <span class=main>=</span> InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=keyword1>in</span>
                                          <span class=keyword1>let</span> <span class=main>(</span><span class=bound>next</span><span class=main>,</span> <span class=bound>acc</span><span class=main>,</span> <span class=bound>links</span><span class=main>)</span> <span class=main>=</span> <span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
                                          <span class=main>(</span><span class=main>[</span><span class=bound>me</span><span class=main>]</span><span class=main>,</span> <span class=bound>me</span> <span class=main>#</span> <span class=bound>acc</span><span class=main>,</span> map <span class=main>(</span>ILink <span class=bound>me</span><span class=main>)</span> <span class=bound>next</span> <span class=main>@</span> <span class=bound>links</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=main>}</span><span class=main>⟦</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>⟧</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>                <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>me</span> <span class=main>=</span> InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=keyword1>in</span>
                                          <span class=keyword1>let</span> <span class=main>(</span><span class=bound>next</span><span class=main>,</span> <span class=bound>acc</span><span class=main>,</span> <span class=bound>links</span><span class=main>)</span> <span class=main>=</span> <span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
                                          <span class=main>(</span><span class=main>[</span><span class=bound>me</span><span class=main>]</span><span class=main>,</span> <span class=bound>me</span> <span class=main>#</span> <span class=bound>acc</span><span class=main>,</span> map <span class=main>(</span>ILink <span class=bound>me</span><span class=main>)</span> <span class=bound>next</span> <span class=main>@</span> <span class=bound>links</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=main>⊕</span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span>                <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>next1</span><span class=main>,</span> <span class=bound>acc1</span><span class=main>,</span> <span class=bound>links1</span><span class=main>)</span> <span class=main>=</span> <span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=keyword1>in</span>
                                          <span class=keyword1>let</span> <span class=main>(</span><span class=bound>next2</span><span class=main>,</span> <span class=bound>acc2</span><span class=main>,</span> <span class=bound>links2</span><span class=main>)</span> <span class=main>=</span> <span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span> <span class=keyword1>in</span>
                                          <span class=main>(</span><span class=bound>next1</span> <span class=main>@</span> <span class=bound>next2</span><span class=main>,</span> <span class=bound>acc1</span> <span class=main>@</span> <span class=bound>acc2</span><span class=main>,</span> <span class=bound>links1</span> <span class=main>@</span> <span class=bound>links2</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}unicast(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>▹</span> <span class=free><span class=bound><span class=entity>q</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>me</span> <span class=main>=</span> InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=keyword1>in</span>
                                          <span class=keyword1>let</span> <span class=main>(</span><span class=bound>next1</span><span class=main>,</span> <span class=bound>acc1</span><span class=main>,</span> <span class=bound>links1</span><span class=main>)</span> <span class=main>=</span> <span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
                                          <span class=keyword1>let</span> <span class=main>(</span><span class=bound>next2</span><span class=main>,</span> <span class=bound>acc2</span><span class=main>,</span> <span class=bound>links2</span><span class=main>)</span> <span class=main>=</span> <span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>q</span></span></span> <span class=keyword1>in</span>
                                          <span class=main>(</span><span class=main>[</span><span class=bound>me</span><span class=main>]</span><span class=main>,</span> <span class=bound>me</span> <span class=main>#</span> <span class=bound>acc1</span> <span class=main>@</span> <span class=bound>acc2</span><span class=main>,</span>
                                        map <span class=main>(</span>ELink <span class=bound>me</span><span class=main>)</span> <span class=main>(</span><span class=bound>next1</span> <span class=main>@</span> <span class=bound>next2</span><span class=main>)</span> <span class=main>@</span> <span class=bound>links1</span> <span class=main>@</span> <span class=bound>links2</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}broadcast(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>     <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>me</span> <span class=main>=</span> InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=keyword1>in</span>
                                          <span class=keyword1>let</span> <span class=main>(</span><span class=bound>next</span><span class=main>,</span> <span class=bound>acc</span><span class=main>,</span> <span class=bound>links</span><span class=main>)</span> <span class=main>=</span> <span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
                                         <span class=main>(</span><span class=main>[</span><span class=bound>me</span><span class=main>]</span><span class=main>,</span> <span class=bound>me</span> <span class=main>#</span> <span class=bound>acc</span><span class=main>,</span> map <span class=main>(</span>ELink <span class=bound>me</span><span class=main>)</span> <span class=bound>next</span> <span class=main>@</span> <span class=bound>links</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}groupcast(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>,</span> <span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>  <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>me</span> <span class=main>=</span> InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=keyword1>in</span>
                                          <span class=keyword1>let</span> <span class=main>(</span><span class=bound>next</span><span class=main>,</span> <span class=bound>acc</span><span class=main>,</span> <span class=bound>links</span><span class=main>)</span> <span class=main>=</span> <span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
                                          <span class=main>(</span><span class=main>[</span><span class=bound>me</span><span class=main>]</span><span class=main>,</span> <span class=bound>me</span> <span class=main>#</span> <span class=bound>acc</span><span class=main>,</span> map <span class=main>(</span>ELink <span class=bound>me</span><span class=main>)</span> <span class=bound>next</span> <span class=main>@</span> <span class=bound>links</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}send(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>           <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>me</span> <span class=main>=</span> InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=keyword1>in</span>
                                          <span class=keyword1>let</span> <span class=main>(</span><span class=bound>next</span><span class=main>,</span> <span class=bound>acc</span><span class=main>,</span> <span class=bound>links</span><span class=main>)</span> <span class=main>=</span> <span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
                                          <span class=main>(</span><span class=main>[</span><span class=bound>me</span><span class=main>]</span><span class=main>,</span> <span class=bound>me</span> <span class=main>#</span> <span class=bound>acc</span><span class=main>,</span> map <span class=main>(</span>ELink <span class=bound>me</span><span class=main>)</span> <span class=bound>next</span> <span class=main>@</span> <span class=bound>links</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}deliver(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>        <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>me</span> <span class=main>=</span> InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=keyword1>in</span>
                                          <span class=keyword1>let</span> <span class=main>(</span><span class=bound>next</span><span class=main>,</span> <span class=bound>acc</span><span class=main>,</span> <span class=bound>links</span><span class=main>)</span> <span class=main>=</span> <span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
                                          <span class=main>(</span><span class=main>[</span><span class=bound>me</span><span class=main>]</span><span class=main>,</span> <span class=bound>me</span> <span class=main>#</span> <span class=bound>acc</span><span class=main>,</span> map <span class=main>(</span>ELink <span class=bound>me</span><span class=main>)</span> <span class=bound>next</span> <span class=main>@</span> <span class=bound>links</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>{</span><span class=free><span class=bound><span class=entity>l</span></span></span><span class=keyword1>}receive(</span><span class=main><span class=bound><span class=entity>_</span></span></span><span class=main>)</span><span class=main>.</span><span class=free><span class=bound><span class=entity>p</span></span></span><span class=main>)</span>        <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>me</span> <span class=main>=</span> InternalNode <span class=free><span class=bound><span class=entity>l</span></span></span> <span class=keyword1>in</span>
                                          <span class=keyword1>let</span> <span class=main>(</span><span class=bound>next</span><span class=main>,</span> <span class=bound>acc</span><span class=main>,</span> <span class=bound>links</span><span class=main>)</span> <span class=main>=</span> <span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>in</span>
                                          <span class=main>(</span><span class=main>[</span><span class=bound>me</span><span class=main>]</span><span class=main>,</span> <span class=bound>me</span> <span class=main>#</span> <span class=bound>acc</span><span class=main>,</span> map <span class=main>(</span>ELink <span class=bound>me</span><span class=main>)</span> <span class=bound>next</span> <span class=main>@</span> <span class=bound>links</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=main>|</span> <span class=quoted><span class=quoted>"<span class=free>gseqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=keyword1>call(</span><span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>)</span>               <span class=main>=</span> <span class=main>(</span>gseqp' <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span><span class=main>,</span> <span class=main>[]</span><span class=main>,</span> <span class=main>[]</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>graph_of_other</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env
                              <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node list <span class=main>*</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> link list<span class=main>)</span>
                              <span class=main>⇒</span> <span class=tfree>'p</span>
                              <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node list <span class=main>*</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> link list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>graph_of_other</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=free><span class=bound><span class=entity>pn</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>next</span><span class=main>,</span> <span class=bound>acc</span><span class=main>,</span> <span class=bound>links</span><span class=main>)</span> <span class=main>=</span> gseqp <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span> <span class=keyword1>in</span>
                            <span class=main>(</span><span class=bound>acc</span> <span class=main>@</span> fst <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>,</span> <span class=bound>links</span> <span class=main>@</span> snd <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>graph_of_root</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env
                             <span class=main>⇒</span> <span class=main>(</span><span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node list <span class=main>*</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> link list<span class=main>)</span>
                             <span class=main>⇒</span> <span class=tfree>'p</span>
                             <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node list <span class=main>*</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> link list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>graph_of_root</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=free><span class=bound><span class=entity>pn</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=bound>me</span> <span class=main>=</span> RootNode <span class=free><span class=bound><span class=entity>pn</span></span></span> <span class=keyword1>in</span>
                           <span class=keyword1>let</span> <span class=main>(</span><span class=bound>next</span><span class=main>,</span> <span class=bound>acc</span><span class=main>,</span> <span class=bound>links</span><span class=main>)</span> <span class=main>=</span> gseqp <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>pn</span></span></span><span class=main>)</span> <span class=keyword1>in</span>
                           <span class=main>(</span><span class=bound>acc</span> <span class=main>@</span> fst <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>@</span> <span class=main>[</span><span class=bound>me</span><span class=main>]</span><span class=main>,</span> map <span class=main>(</span>ILink <span class=bound>me</span><span class=main>)</span> <span class=bound>next</span> <span class=main>@</span> <span class=bound>links</span> <span class=main>@</span> snd <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>graph_of_seqp</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env
                             <span class=main>⇒</span> <span class=tfree>'p</span> list
                             <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node list <span class=main>*</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> link list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>graph_of_seqp</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>pns</span></span></span> <span class=main>=</span> map_prod <span class=main>(</span>rev <span class=main>∘</span> remdups<span class=main>)</span> remdups
                           <span class=main>(</span>foldl <span class=main>(</span>graph_of_other <span class=free><span class=bound><span class=entity>Γ</span></span></span><span class=main>)</span> <span class=main>(</span>graph_of_root <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=main>(</span><span class=main>[]</span><span class=main>,</span> <span class=main>[]</span><span class=main>)</span> <span class=main>(</span>hd <span class=free><span class=bound><span class=entity>pns</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>tl <span class=free><span class=bound><span class=entity>pns</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>graph_of_seqps</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'s</span><span class=main>,</span> <span class=tfree>'m</span><span class=main>,</span> <span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> seqp_env
                              <span class=main>⇒</span> <span class=tfree>'p</span> list
                              <span class=main>⇒</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> node list <span class=main>*</span> <span class=main>(</span><span class=tfree>'p</span><span class=main>,</span> <span class=tfree>'l</span><span class=main>)</span> link list"</span></span>
<span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>graph_of_seqps</span> <span class=free><span class=bound><span class=entity>Γ</span></span></span> <span class=free><span class=bound><span class=entity>pns</span></span></span> <span class=main>=</span> map_prod <span class=main>(</span>rev <span class=main>∘</span> remdups<span class=main>)</span> remdups <span class=main>(</span>foldl <span class=main>(</span>graph_of_root <span class=free><span class=bound><span class=entity>Γ</span></span></span><span class=main>)</span> <span class=main>(</span><span class=main>[]</span><span class=main>,</span> <span class=main>[]</span><span class=main>)</span>
                                   <span class=main>(</span>List.rev <span class=free><span class=bound><span class=entity>pns</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre></div></main></div></div></body></html>