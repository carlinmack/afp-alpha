<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1"><title>Session Complex_Geometry - Archive of Formal Proofs</title><meta name=description content="A collection of proof libraries, examples, and larger scientific developments, mechanically checked in the theorem prover Isabelle."><meta property="og:title" content="Session Complex_Geometry">
<meta property="og:description" content>
<meta property="og:type" content="article">
<meta property="og:url" content="/entries/complex_geometry/theories/"><meta property="og:image" content="/images/afp.png"><meta property="article:section" content="theories">
<meta property="og:site_name" content="Archive of Formal Proofs">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/images/afp.png">
<meta name=twitter:title content="Session Complex_Geometry">
<meta name=twitter:description content>
<link rel=stylesheet type=text/css href=/css/front.min.css><link rel=stylesheet type=text/css href=/css/isabelle.css>
<link rel=icon href=/images/favicon.ico type=image/icon><script src=/js/flexsearch.min.js></script>
<script src=/js/banner.js></script><script src=/js/header-search.js></script></head>
<body class=mathjax_ignore>
<aside>
<div>
<div>
<a href=/>
<img src=/images/afp.png alt="Logo of the Archive of Formal Proofs" class=logo>
</a>
<ul>
<li><a href=/entries/complex_geometry>Return to entry</a></li>
</ul>
<hr>
<ul><li><a href=#More_Transcendental>More_Transcendental</a>
<ul>
<li><a href=#More_Transcendental-cos_lt_zero_on_pi2_pi>cos_lt_zero_on_pi2_pi</a></li>
<li><a href=#More_Transcendental-sin_kpi>sin_kpi</a></li>
<li><a href=#More_Transcendental-cos_odd_kpi>cos_odd_kpi</a></li>
<li><a href=#More_Transcendental-cos_even_kpi>cos_even_kpi</a></li>
<li><a href=#More_Transcendental-sin_pi2_plus_odd_kpi>sin_pi2_plus_odd_kpi</a></li>
<li><a href=#More_Transcendental-sin_pi2_plus_even_kpi>sin_pi2_plus_even_kpi</a></li>
<li><a href=#More_Transcendental-cos_0_iff_canon>cos_0_iff_canon</a></li>
<li><a href=#More_Transcendental-sin_0_iff_canon>sin_0_iff_canon</a></li>
<li><a href=#More_Transcendental-cos0_sin1>cos0_sin1</a></li>
<li><a href=#More_Transcendental-sin_inj>sin_inj</a></li>
<li><a href=#More_Transcendental-sin_periodic_nat>sin_periodic_nat</a></li>
<li><a href=#More_Transcendental-sin_periodic_int>sin_periodic_int</a></li>
<li><a href=#More_Transcendental-cos_periodic_nat>cos_periodic_nat</a></li>
<li><a href=#More_Transcendental-cos_periodic_int>cos_periodic_int</a></li>
<li><a href=#More_Transcendental-sin_cos_eq>sin_cos_eq</a></li>
<li><a href=#More_Transcendental-ex_cos_eq>ex_cos_eq</a></li>
<li><a href=#More_Transcendental-ex_cos_gt>ex_cos_gt</a></li>
<li><a href=#More_Transcendental-atan2_bounded>atan2_bounded</a></li>
</ul>
</li><li><a href=#Canonical_Angle>Canonical_Angle</a>
<ul>
<li><a href=#Canonical_Angle-canon_ang_ex>canon_ang_ex</a></li>
<li><a href=#Canonical_Angle-canon_ang_unique>canon_ang_unique</a></li>
<li><a href=#Canonical_Angle-canon_ang>canon_ang</a></li>
<li><a href=#Canonical_Angle-canon_ang_id>canon_ang_id</a></li>
<li><a href=#Canonical_Angle-canon_ang_eq>canon_ang_eq</a></li>
<li><a href=#Canonical_Angle-canon_ang_eqI>canon_ang_eqI</a></li>
<li><a href=#Canonical_Angle-canon_ang_eqE>canon_ang_eqE</a></li>
<li><a href=#Canonical_Angle-canon_ang_uminus>canon_ang_uminus</a></li>
<li><a href=#Canonical_Angle-canon_ang_uminus_pi>canon_ang_uminus_pi</a></li>
<li><a href=#Canonical_Angle-canon_ang_diff>canon_ang_diff</a></li>
<li><a href=#Canonical_Angle-canon_ang_sum>canon_ang_sum</a></li>
<li><a href=#Canonical_Angle-canon_ang_plus_pi1>canon_ang_plus_pi1</a></li>
<li><a href=#Canonical_Angle-canon_ang_minus_pi1>canon_ang_minus_pi1</a></li>
<li><a href=#Canonical_Angle-canon_ang_plus_pi2>canon_ang_plus_pi2</a></li>
<li><a href=#Canonical_Angle-canon_ang_minus_pi2>canon_ang_minus_pi2</a></li>
<li><a href=#Canonical_Angle-canon_ang_pi_3pi>canon_ang_pi_3pi</a></li>
<li><a href=#Canonical_Angle-canon_ang_minus_3pi_minus_pi>canon_ang_minus_3pi_minus_pi</a></li>
<li><a href=#Canonical_Angle-zero_canonical>zero_canonical</a></li>
<li><a href=#Canonical_Angle-pi_canonical>pi_canonical</a></li>
<li><a href=#Canonical_Angle-two_pi_canonical>two_pi_canonical</a></li>
<li><a href=#Canonical_Angle-canon_ang_sin>canon_ang_sin</a></li>
<li><a href=#Canonical_Angle-canon_ang_cos>canon_ang_cos</a></li>
</ul>
</li><li><a href=#More_Complex>More_Complex</a>
<ul>
<li><a href=#More_Complex-rcis_cnj>rcis_cnj</a></li>
<li><a href=#More_Complex-cmod_cis>cmod_cis</a></li>
<li><a href=#More_Complex-cis_cmod>cis_cmod</a></li>
<li><a href=#More_Complex-cor_squared>cor_squared</a></li>
<li><a href=#More_Complex-cor_sqrt_mult_cor_sqrt>cor_sqrt_mult_cor_sqrt</a></li>
<li><a href=#More_Complex-cor_eq_0>cor_eq_0</a></li>
<li><a href=#More_Complex-one_plus_square_neq_zero>one_plus_square_neq_zero</a></li>
<li><a href=#More_Complex-complex_real_two>complex_real_two</a></li>
<li><a href=#More_Complex-complex_double>complex_double</a></li>
<li><a href=#More_Complex-complex_half>complex_half</a></li>
<li><a href=#More_Complex-Complex_scale1>Complex_scale1</a></li>
<li><a href=#More_Complex-Complex_scale2>Complex_scale2</a></li>
<li><a href=#More_Complex-Complex_scale3>Complex_scale3</a></li>
<li><a href=#More_Complex-Complex_scale4>Complex_scale4</a></li>
<li><a href=#More_Complex-Complex_Re_express_cnj>Complex_Re_express_cnj</a></li>
<li><a href=#More_Complex-Complex_Im_express_cnj>Complex_Im_express_cnj</a></li>
<li><a href=#More_Complex-complex_mult_cnj_cmod>complex_mult_cnj_cmod</a></li>
<li><a href=#More_Complex-cmod_square>cmod_square</a></li>
<li><a href=#More_Complex-cor_cmod_power_4>cor_cmod_power_4</a></li>
<li><a href=#More_Complex-cnjE>cnjE</a></li>
<li><a href=#More_Complex-cmod_cor_divide>cmod_cor_divide</a></li>
<li><a href=#More_Complex-cmod_mult_minus_left_distrib>cmod_mult_minus_left_distrib</a></li>
<li><a href=#More_Complex-cmod_eqI>cmod_eqI</a></li>
<li><a href=#More_Complex-cmod_eqE>cmod_eqE</a></li>
<li><a href=#More_Complex-cmod_eq_one>cmod_eq_one</a></li>
<li><a href=#More_Complex-real_imag_0>real_imag_0</a></li>
<li><a href=#More_Complex-complex_eq_if_Re_eq>complex_eq_if_Re_eq</a></li>
<li><a href=#More_Complex-mult_reals>mult_reals</a></li>
<li><a href=#More_Complex-div_reals>div_reals</a></li>
<li><a href=#More_Complex-complex_of_real_Re>complex_of_real_Re</a></li>
<li><a href=#More_Complex-cor_cmod_real>cor_cmod_real</a></li>
<li><a href=#More_Complex-eq_cnj_iff_real>eq_cnj_iff_real</a></li>
<li><a href=#More_Complex-eq_minus_cnj_iff_imag>eq_minus_cnj_iff_imag</a></li>
<li><a href=#More_Complex-Re_divide_real>Re_divide_real</a></li>
<li><a href=#More_Complex-Re_mult_real>Re_mult_real</a></li>
<li><a href=#More_Complex-Im_mult_real>Im_mult_real</a></li>
<li><a href=#More_Complex-Im_divide_real>Im_divide_real</a></li>
<li><a href=#More_Complex-Re_sgn>Re_sgn</a></li>
<li><a href=#More_Complex-is_real_div>is_real_div</a></li>
<li><a href=#More_Complex-is_real_mult_real>is_real_mult_real</a></li>
<li><a href=#More_Complex-Im_express_cnj>Im_express_cnj</a></li>
<li><a href=#More_Complex-Re_express_cnj>Re_express_cnj</a></li>
<li><a href=#More_Complex-rot90_ii>rot90_ii</a></li>
<li><a href=#More_Complex-cnj_mix_minus>cnj_mix_minus</a></li>
<li><a href=#More_Complex-cnj_mix_minus%27>cnj_mix_minus'</a></li>
<li><a href=#More_Complex-cnj_mix_real>cnj_mix_real</a></li>
<li><a href=#More_Complex-scalprod_real>scalprod_real</a></li>
<li><a href=#More_Complex-cis_minus_pi2>cis_minus_pi2</a></li>
<li><a href=#More_Complex-cis_pi2_minus_x>cis_pi2_minus_x</a></li>
<li><a href=#More_Complex-cis_pm_pi>cis_pm_pi</a></li>
<li><a href=#More_Complex-cis_times_cis_opposite>cis_times_cis_opposite</a></li>
<li><a href=#More_Complex-cis_eq>cis_eq</a></li>
<li><a href=#More_Complex-cis_inj>cis_inj</a></li>
<li><a href=#More_Complex-cis_diff_cis_opposite>cis_diff_cis_opposite</a></li>
<li><a href=#More_Complex-cis_opposite_diff_cis>cis_opposite_diff_cis</a></li>
<li><a href=#More_Complex-cis_add_cis_opposite>cis_add_cis_opposite</a></li>
<li><a href=#More_Complex-cis_one>cis_one</a></li>
<li><a href=#More_Complex-cis_minus_one>cis_minus_one</a></li>
<li><a href=#More_Complex-is_real_arg1>is_real_arg1</a></li>
<li><a href=#More_Complex-is_real_arg2>is_real_arg2</a></li>
<li><a href=#More_Complex-arg_complex_of_real_positive>arg_complex_of_real_positive</a></li>
<li><a href=#More_Complex-arg_complex_of_real_negative>arg_complex_of_real_negative</a></li>
<li><a href=#More_Complex-arg_0_iff>arg_0_iff</a></li>
<li><a href=#More_Complex-arg_pi_iff>arg_pi_iff</a></li>
<li><a href=#More_Complex-is_imag_arg1>is_imag_arg1</a></li>
<li><a href=#More_Complex-is_imag_arg2>is_imag_arg2</a></li>
<li><a href=#More_Complex-arg_complex_of_real_times_i_positive>arg_complex_of_real_times_i_positive</a></li>
<li><a href=#More_Complex-arg_complex_of_real_times_i_negative>arg_complex_of_real_times_i_negative</a></li>
<li><a href=#More_Complex-arg_pi2_iff>arg_pi2_iff</a></li>
<li><a href=#More_Complex-arg_minus_pi2_iff>arg_minus_pi2_iff</a></li>
<li><a href=#More_Complex-arg_ii>arg_ii</a></li>
<li><a href=#More_Complex-arg_minus_ii>arg_minus_ii</a></li>
<li><a href=#More_Complex-canon_ang_arg>canon_ang_arg</a></li>
<li><a href=#More_Complex-arg_cis>arg_cis</a></li>
<li><a href=#More_Complex-cos_arg>cos_arg</a></li>
<li><a href=#More_Complex-sin_arg>sin_arg</a></li>
<li><a href=#More_Complex-cis_arg_mult>cis_arg_mult</a></li>
<li><a href=#More_Complex-arg_mult_2kpi>arg_mult_2kpi</a></li>
<li><a href=#More_Complex-arg_mult>arg_mult</a></li>
<li><a href=#More_Complex-arg_mult_real_positive>arg_mult_real_positive</a></li>
<li><a href=#More_Complex-arg_mult_real_negative>arg_mult_real_negative</a></li>
<li><a href=#More_Complex-arg_div_real_positive>arg_div_real_positive</a></li>
<li><a href=#More_Complex-arg_div_real_negative>arg_div_real_negative</a></li>
<li><a href=#More_Complex-arg_mult_eq>arg_mult_eq</a></li>
<li><a href=#More_Complex-arg_cnj_pi>arg_cnj_pi</a></li>
<li><a href=#More_Complex-arg_cnj_not_pi>arg_cnj_not_pi</a></li>
<li><a href=#More_Complex-arg_inv_not_pi>arg_inv_not_pi</a></li>
<li><a href=#More_Complex-arg_inv_pi>arg_inv_pi</a></li>
<li><a href=#More_Complex-arg_inv_2kpi>arg_inv_2kpi</a></li>
<li><a href=#More_Complex-arg_inv>arg_inv</a></li>
<li><a href=#More_Complex-arg_div_2kpi>arg_div_2kpi</a></li>
<li><a href=#More_Complex-arg_div>arg_div</a></li>
<li><a href=#More_Complex-arg_uminus>arg_uminus</a></li>
<li><a href=#More_Complex-arg_uminus_opposite_sign>arg_uminus_opposite_sign</a></li>
<li><a href=#More_Complex-arg_Im_sgn>arg_Im_sgn</a></li>
<li><a href=#More_Complex-square_ccsqrt>square_ccsqrt</a></li>
<li><a href=#More_Complex-ex_complex_sqrt>ex_complex_sqrt</a></li>
<li><a href=#More_Complex-ccsqrt>ccsqrt</a></li>
<li><a href=#More_Complex-null_ccsqrt>null_ccsqrt</a></li>
<li><a href=#More_Complex-ccsqrt_mult>ccsqrt_mult</a></li>
<li><a href=#More_Complex-csqrt_real>csqrt_real</a></li>
<li><a href=#More_Complex-is_real_rot_to_x_axis>is_real_rot_to_x_axis</a></li>
<li><a href=#More_Complex-positive_rot_to_x_axis>positive_rot_to_x_axis</a></li>
<li><a href=#More_Complex-cmod_1_plus_mult_le>cmod_1_plus_mult_le</a></li>
<li><a href=#More_Complex-cmod_diff_ge>cmod_diff_ge</a></li>
<li><a href=#More_Complex-cmod_diff_le>cmod_diff_le</a></li>
<li><a href=#More_Complex-ex_complex_to_complex>ex_complex_to_complex</a></li>
<li><a href=#More_Complex-ex_complex_to_one>ex_complex_to_one</a></li>
<li><a href=#More_Complex-ex_complex_to_complex2>ex_complex_to_complex2</a></li>
<li><a href=#More_Complex-complex_sqrt_1>complex_sqrt_1</a></li>
</ul>
</li><li><a href=#Angles>Angles</a>
<ul>
<li><a href=#Angles-ang_vec_bounded>ang_vec_bounded</a></li>
<li><a href=#Angles-ang_vec_sym>ang_vec_sym</a></li>
<li><a href=#Angles-ang_vec_sym_pi>ang_vec_sym_pi</a></li>
<li><a href=#Angles-ang_vec_plus_pi1>ang_vec_plus_pi1</a></li>
<li><a href=#Angles-ang_vec_plus_pi2>ang_vec_plus_pi2</a></li>
<li><a href=#Angles-ang_vec_opposite1>ang_vec_opposite1</a></li>
<li><a href=#Angles-ang_vec_opposite2>ang_vec_opposite2</a></li>
<li><a href=#Angles-ang_vec_opposite_opposite>ang_vec_opposite_opposite</a></li>
<li><a href=#Angles-ang_vec_opposite_opposite%27>ang_vec_opposite_opposite'</a></li>
<li><a href=#Angles-cos_cmod_scalprod>cos_cmod_scalprod</a></li>
<li><a href=#Angles-cos0_scalprod0>cos0_scalprod0</a></li>
<li><a href=#Angles-ortho_scalprod0>ortho_scalprod0</a></li>
<li><a href=#Angles-law_of_cosines>law_of_cosines</a></li>
<li><a href=#Angles-ang_vec_c_sym>ang_vec_c_sym</a></li>
<li><a href=#Angles-ang_vec_c_bounded>ang_vec_c_bounded</a></li>
<li><a href=#Angles-cos_c_>cos_c_</a></li>
<li><a href=#Angles-ortho_c_scalprod0>ortho_c_scalprod0</a></li>
<li><a href=#Angles-ang_vec_a_sym>ang_vec_a_sym</a></li>
<li><a href=#Angles-ang_vec_a_opposite2>ang_vec_a_opposite2</a></li>
<li><a href=#Angles-ang_vec_a_opposite1>ang_vec_a_opposite1</a></li>
<li><a href=#Angles-ang_vec_a_scale1>ang_vec_a_scale1</a></li>
<li><a href=#Angles-ang_vec_a_scale2>ang_vec_a_scale2</a></li>
<li><a href=#Angles-ang_vec_a_scale>ang_vec_a_scale</a></li>
<li><a href=#Angles-ang_a_cnj_cnj>ang_a_cnj_cnj</a></li>
<li><a href=#Angles-ortho_a_scalprod0>ortho_a_scalprod0</a></li>
<li><a href=#Angles-cos_a_c>cos_a_c</a></li>
</ul>
</li><li><a href=#More_Set>More_Set</a>
<ul>
<li><a href=#More_Set-infinite_contains_2_elems>infinite_contains_2_elems</a></li>
<li><a href=#More_Set-infinite_contains_3_elems>infinite_contains_3_elems</a></li>
<li><a href=#More_Set-card_geq_2_iff_contains_2_elems>card_geq_2_iff_contains_2_elems</a></li>
<li><a href=#More_Set-card_geq_3_iff_contains_3_elems>card_geq_3_iff_contains_3_elems</a></li>
<li><a href=#More_Set-card_eq_2_iff_doubleton>card_eq_2_iff_doubleton</a></li>
<li><a href=#More_Set-card_eq_2_doubleton>card_eq_2_doubleton</a></li>
<li><a href=#More_Set-bij_image_singleton>bij_image_singleton</a></li>
</ul>
</li><li><a href=#Linear_Systems>Linear_Systems</a>
<ul>
<li><a href=#Linear_Systems-regular_homogenous_system>regular_homogenous_system</a></li>
<li><a href=#Linear_Systems-regular_system>regular_system</a></li>
<li><a href=#Linear_Systems-singular_system>singular_system</a></li>
<li><a href=#Linear_Systems-linear_system_homogenous_3_2>linear_system_homogenous_3_2</a></li>
</ul>
</li><li><a href=#Quadratic>Quadratic</a>
<ul>
<li><a href=#Quadratic-viette2_monic>viette2_monic</a></li>
<li><a href=#Quadratic-viette2>viette2</a></li>
<li><a href=#Quadratic-viette2%27_monic>viette2'_monic</a></li>
<li><a href=#Quadratic-viette2%27>viette2'</a></li>
<li><a href=#Quadratic-complex_quadratic_equation_monic_only_two_roots>complex_quadratic_equation_monic_only_two_roots</a></li>
<li><a href=#Quadratic-complex_quadratic_equation_monic_roots>complex_quadratic_equation_monic_roots</a></li>
<li><a href=#Quadratic-complex_quadratic_equation_monic_distinct_roots>complex_quadratic_equation_monic_distinct_roots</a></li>
<li><a href=#Quadratic-complex_quadratic_equation_two_roots>complex_quadratic_equation_two_roots</a></li>
<li><a href=#Quadratic-complex_quadratic_equation_only_two_roots>complex_quadratic_equation_only_two_roots</a></li>
<li><a href=#Quadratic-quadratic_linear_at_most_2_intersections_help>quadratic_linear_at_most_2_intersections_help</a></li>
<li><a href=#Quadratic-quadratic_linear_at_most_2_intersections_help%27>quadratic_linear_at_most_2_intersections_help'</a></li>
<li><a href=#Quadratic-quadratic_linear_at_most_2_intersections>quadratic_linear_at_most_2_intersections</a></li>
<li><a href=#Quadratic-quadratic_quadratic_at_most_2_intersections%27>quadratic_quadratic_at_most_2_intersections'</a></li>
<li><a href=#Quadratic-quadratic_change_coefficients>quadratic_change_coefficients</a></li>
<li><a href=#Quadratic-quadratic_quadratic_at_most_2_intersections>quadratic_quadratic_at_most_2_intersections</a></li>
</ul>
</li><li><a href=#Matrices>Matrices</a>
<ul>
<li><a href=#Matrices-fst_mult_sv>fst_mult_sv</a></li>
<li><a href=#Matrices-snd_mult_sv>snd_mult_sv</a></li>
<li><a href=#Matrices-mult_sv_mult_sv>mult_sv_mult_sv</a></li>
<li><a href=#Matrices-one_mult_sv>one_mult_sv</a></li>
<li><a href=#Matrices-mult_sv_ex_id1>mult_sv_ex_id1</a></li>
<li><a href=#Matrices-mult_sv_ex_id2>mult_sv_ex_id2</a></li>
<li><a href=#Matrices-mult_vv_commute>mult_vv_commute</a></li>
<li><a href=#Matrices-mult_vv_scale_sv1>mult_vv_scale_sv1</a></li>
<li><a href=#Matrices-mult_vv_scale_sv2>mult_vv_scale_sv2</a></li>
<li><a href=#Matrices-vec_cnj_vec_cnj>vec_cnj_vec_cnj</a></li>
<li><a href=#Matrices-cnj_mult_vv>cnj_mult_vv</a></li>
<li><a href=#Matrices-vec_cnj_sv>vec_cnj_sv</a></li>
<li><a href=#Matrices-scalsquare_vv_zero>scalsquare_vv_zero</a></li>
<li><a href=#Matrices-mult_sm_distribution>mult_sm_distribution</a></li>
<li><a href=#Matrices-mult_sm_neutral>mult_sm_neutral</a></li>
<li><a href=#Matrices-mult_sm_inv_l>mult_sm_inv_l</a></li>
<li><a href=#Matrices-mult_sm_ex_id1>mult_sm_ex_id1</a></li>
<li><a href=#Matrices-mult_sm_ex_id2>mult_sm_ex_id2</a></li>
<li><a href=#Matrices-nonzero_mult_real>nonzero_mult_real</a></li>
<li><a href=#Matrices-mult_mm_assoc>mult_mm_assoc</a></li>
<li><a href=#Matrices-mult_assoc_5>mult_assoc_5</a></li>
<li><a href=#Matrices-mat_zero_r>mat_zero_r</a></li>
<li><a href=#Matrices-mat_zero_l>mat_zero_l</a></li>
<li><a href=#Matrices-mat_eye_l>mat_eye_l</a></li>
<li><a href=#Matrices-mat_eye_r>mat_eye_r</a></li>
<li><a href=#Matrices-mult_mm_sm>mult_mm_sm</a></li>
<li><a href=#Matrices-mult_sm_mm>mult_sm_mm</a></li>
<li><a href=#Matrices-mult_sm_eye_mm>mult_sm_eye_mm</a></li>
<li><a href=#Matrices-mat_det_mult>mat_det_mult</a></li>
<li><a href=#Matrices-mat_det_mult_sm>mat_det_mult_sm</a></li>
<li><a href=#Matrices-mat_inv_r>mat_inv_r</a></li>
<li><a href=#Matrices-mat_inv_l>mat_inv_l</a></li>
<li><a href=#Matrices-mat_det_inv>mat_det_inv</a></li>
<li><a href=#Matrices-mult_mm_inv_l>mult_mm_inv_l</a></li>
<li><a href=#Matrices-mult_mm_inv_r>mult_mm_inv_r</a></li>
<li><a href=#Matrices-mult_mm_non_zero_l>mult_mm_non_zero_l</a></li>
<li><a href=#Matrices-mat_inv_mult_mm>mat_inv_mult_mm</a></li>
<li><a href=#Matrices-mult_mm_cancel_l>mult_mm_cancel_l</a></li>
<li><a href=#Matrices-mult_mm_cancel_r>mult_mm_cancel_r</a></li>
<li><a href=#Matrices-mult_mm_non_zero_r>mult_mm_non_zero_r</a></li>
<li><a href=#Matrices-mat_inv_mult_sm>mat_inv_mult_sm</a></li>
<li><a href=#Matrices-mat_inv_inv>mat_inv_inv</a></li>
<li><a href=#Matrices-mat_t_mat_t>mat_t_mat_t</a></li>
<li><a href=#Matrices-mat_t_mult_sm>mat_t_mult_sm</a></li>
<li><a href=#Matrices-mat_t_mult_mm>mat_t_mult_mm</a></li>
<li><a href=#Matrices-mat_inv_transpose>mat_inv_transpose</a></li>
<li><a href=#Matrices-mat_det_transpose>mat_det_transpose</a></li>
<li><a href=#Matrices-mat_cnj_cnj>mat_cnj_cnj</a></li>
<li><a href=#Matrices-mat_cnj_sm>mat_cnj_sm</a></li>
<li><a href=#Matrices-mat_det_cnj>mat_det_cnj</a></li>
<li><a href=#Matrices-nonzero_mat_cnj>nonzero_mat_cnj</a></li>
<li><a href=#Matrices-mat_inv_cnj>mat_inv_cnj</a></li>
<li><a href=#Matrices-mat_adj_mult_mm>mat_adj_mult_mm</a></li>
<li><a href=#Matrices-mat_adj_mult_sm>mat_adj_mult_sm</a></li>
<li><a href=#Matrices-mat_det_adj>mat_det_adj</a></li>
<li><a href=#Matrices-mat_adj_inv>mat_adj_inv</a></li>
<li><a href=#Matrices-mat_transpose_mat_cnj>mat_transpose_mat_cnj</a></li>
<li><a href=#Matrices-mat_adj_adj>mat_adj_adj</a></li>
<li><a href=#Matrices-mat_adj_eye>mat_adj_eye</a></li>
<li><a href=#Matrices-eye_mv_l>eye_mv_l</a></li>
<li><a href=#Matrices-mult_mv_mv>mult_mv_mv</a></li>
<li><a href=#Matrices-mult_vm_vm>mult_vm_vm</a></li>
<li><a href=#Matrices-mult_mv_inv>mult_mv_inv</a></li>
<li><a href=#Matrices-mult_vm_inv>mult_vm_inv</a></li>
<li><a href=#Matrices-mult_mv_cancel_l>mult_mv_cancel_l</a></li>
<li><a href=#Matrices-mult_vm_cancel_r>mult_vm_cancel_r</a></li>
<li><a href=#Matrices-vec_zero_l>vec_zero_l</a></li>
<li><a href=#Matrices-vec_zero_r>vec_zero_r</a></li>
<li><a href=#Matrices-mult_mv_nonzero>mult_mv_nonzero</a></li>
<li><a href=#Matrices-mult_vm_nonzero>mult_vm_nonzero</a></li>
<li><a href=#Matrices-mult_sv_mv>mult_sv_mv</a></li>
<li><a href=#Matrices-mult_mv_mult_vm>mult_mv_mult_vm</a></li>
<li><a href=#Matrices-mult_mv_vv>mult_mv_vv</a></li>
<li><a href=#Matrices-mult_vv_mv>mult_vv_mv</a></li>
<li><a href=#Matrices-vec_cnj_mult_mv>vec_cnj_mult_mv</a></li>
<li><a href=#Matrices-vec_cnj_mult_vm>vec_cnj_mult_vm</a></li>
<li><a href=#Matrices-eigen_equation>eigen_equation</a></li>
<li><a href=#Matrices-bilinear_form_scale_m>bilinear_form_scale_m</a></li>
<li><a href=#Matrices-bilinear_form_scale_v1>bilinear_form_scale_v1</a></li>
<li><a href=#Matrices-bilinear_form_scale_v2>bilinear_form_scale_v2</a></li>
<li><a href=#Matrices-quad_form_bilinear_form>quad_form_bilinear_form</a></li>
<li><a href=#Matrices-quad_form_scale_v>quad_form_scale_v</a></li>
<li><a href=#Matrices-quad_form_scale_m>quad_form_scale_m</a></li>
<li><a href=#Matrices-cnj_quad_form>cnj_quad_form</a></li>
<li><a href=#Matrices-congruence_nonzero>congruence_nonzero</a></li>
<li><a href=#Matrices-congruence_congruence>congruence_congruence</a></li>
<li><a href=#Matrices-congruence_eye>congruence_eye</a></li>
<li><a href=#Matrices-congruence_congruence_inv>congruence_congruence_inv</a></li>
<li><a href=#Matrices-congruence_inv>congruence_inv</a></li>
<li><a href=#Matrices-congruence_scale_m>congruence_scale_m</a></li>
<li><a href=#Matrices-inj_congruence>inj_congruence</a></li>
<li><a href=#Matrices-mat_det_congruence>mat_det_congruence</a></li>
<li><a href=#Matrices-det_sgn_congruence>det_sgn_congruence</a></li>
<li><a href=#Matrices-Re_det_sgn_congruence>Re_det_sgn_congruence</a></li>
<li><a href=#Matrices-bilinear_form_congruence>bilinear_form_congruence</a></li>
<li><a href=#Matrices-quad_form_congruence>quad_form_congruence</a></li>
<li><a href=#Matrices-mat_det_similarity>mat_det_similarity</a></li>
<li><a href=#Matrices-mat_trace_similarity>mat_trace_similarity</a></li>
<li><a href=#Matrices-similarity_eye>similarity_eye</a></li>
<li><a href=#Matrices-similarity_eye%27>similarity_eye'</a></li>
<li><a href=#Matrices-similarity_comp>similarity_comp</a></li>
<li><a href=#Matrices-similarity_inv>similarity_inv</a></li>
</ul>
</li><li><a href=#Unitary_Matrices>Unitary_Matrices</a>
<ul>
<li><a href=#Unitary_Matrices-unitary_gen_real>unitary_gen_real</a></li>
<li><a href=#Unitary_Matrices-unitary_gen_unitary>unitary_gen_unitary</a></li>
<li><a href=#Unitary_Matrices-unitary_gen_iff%27>unitary_gen_iff'</a></li>
<li><a href=#Unitary_Matrices-unitary_unitary_gen>unitary_unitary_gen</a></li>
<li><a href=#Unitary_Matrices-unitary_gen_regular>unitary_gen_regular</a></li>
<li><a href=#Unitary_Matrices-unitary_gen_scale>unitary_gen_scale</a></li>
<li><a href=#Unitary_Matrices-unitary_comp>unitary_comp</a></li>
<li><a href=#Unitary_Matrices-unitary_gen_comp>unitary_gen_comp</a></li>
<li><a href=#Unitary_Matrices-unitary_adj_eq_inv>unitary_adj_eq_inv</a></li>
<li><a href=#Unitary_Matrices-unitary_inv>unitary_inv</a></li>
<li><a href=#Unitary_Matrices-unitary_gen_inv>unitary_gen_inv</a></li>
<li><a href=#Unitary_Matrices-unitary_special>unitary_special</a></li>
<li><a href=#Unitary_Matrices-unitary_gen_special>unitary_gen_special</a></li>
<li><a href=#Unitary_Matrices-unitary_gen_iff>unitary_gen_iff</a></li>
<li><a href=#Unitary_Matrices-unitary_iff>unitary_iff</a></li>
</ul>
</li><li><a href=#Unitary11_Matrices>Unitary11_Matrices</a>
<ul>
<li><a href=#Unitary11_Matrices-unitary11_gen_real>unitary11_gen_real</a></li>
<li><a href=#Unitary11_Matrices-unitary11_unitary11_gen>unitary11_unitary11_gen</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_regular>unitary11_gen_regular</a></li>
<li><a href=#Unitary11_Matrices-unitary11_special>unitary11_special</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_special>unitary11_gen_special</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_iff%27>unitary11_gen_iff'</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_cis_blaschke>unitary11_gen_cis_blaschke</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_cis_blaschke%27>unitary11_gen_cis_blaschke'</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_cis_blaschke_rev>unitary11_gen_cis_blaschke_rev</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_cis_inversion>unitary11_gen_cis_inversion</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_cis_inversion%27>unitary11_gen_cis_inversion'</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_cis_inversion_rev>unitary11_gen_cis_inversion_rev</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_iff>unitary11_gen_iff</a></li>
<li><a href=#Unitary11_Matrices-unitary11_iff>unitary11_iff</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_mult_sm>unitary11_gen_mult_sm</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_div_sm>unitary11_gen_div_sm</a></li>
<li><a href=#Unitary11_Matrices-unitary11_inv>unitary11_inv</a></li>
<li><a href=#Unitary11_Matrices-unitary11_comp>unitary11_comp</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_mat_inv>unitary11_gen_mat_inv</a></li>
<li><a href=#Unitary11_Matrices-unitary11_gen_comp>unitary11_gen_comp</a></li>
<li><a href=#Unitary11_Matrices-unitary11_sgn_det_orientation>unitary11_sgn_det_orientation</a></li>
<li><a href=#Unitary11_Matrices-unitary11_sgn_det>unitary11_sgn_det</a></li>
<li><a href=#Unitary11_Matrices-unitary11_orientation>unitary11_orientation</a></li>
<li><a href=#Unitary11_Matrices-unitary11_sgn_det_orientation%27>unitary11_sgn_det_orientation'</a></li>
</ul>
</li><li><a href=#Hermitean_Matrices>Hermitean_Matrices</a>
<ul>
<li><a href=#Hermitean_Matrices-hermitean_transpose>hermitean_transpose</a></li>
<li><a href=#Hermitean_Matrices-hermitean_mk_circline>hermitean_mk_circline</a></li>
<li><a href=#Hermitean_Matrices-hermitean_mk_circline%27>hermitean_mk_circline'</a></li>
<li><a href=#Hermitean_Matrices-hermitean_elems>hermitean_elems</a></li>
<li><a href=#Hermitean_Matrices-hermitean_mat_cnj>hermitean_mat_cnj</a></li>
<li><a href=#Hermitean_Matrices-hermitean_mult_real>hermitean_mult_real</a></li>
<li><a href=#Hermitean_Matrices-hermitean_congruence>hermitean_congruence</a></li>
<li><a href=#Hermitean_Matrices-hermitean_eye>hermitean_eye</a></li>
<li><a href=#Hermitean_Matrices-hermitean_eye%27>hermitean_eye'</a></li>
<li><a href=#Hermitean_Matrices-hermitean_unit_circle>hermitean_unit_circle</a></li>
<li><a href=#Hermitean_Matrices-mat_det_hermitean_real>mat_det_hermitean_real</a></li>
<li><a href=#Hermitean_Matrices-hermitean_det_zero_trace_zero>hermitean_det_zero_trace_zero</a></li>
<li><a href=#Hermitean_Matrices-bilinear_form_hermitean_commute>bilinear_form_hermitean_commute</a></li>
<li><a href=#Hermitean_Matrices-quad_form_hermitean_real>quad_form_hermitean_real</a></li>
<li><a href=#Hermitean_Matrices-quad_form_vec_cnj_mat_cnj>quad_form_vec_cnj_mat_cnj</a></li>
<li><a href=#Hermitean_Matrices-hermitean_eigenval_real>hermitean_eigenval_real</a></li>
<li><a href=#Hermitean_Matrices-hermitean_distinct_eigenvals>hermitean_distinct_eigenvals</a></li>
<li><a href=#Hermitean_Matrices-hermitean_ortho_eigenvecs>hermitean_ortho_eigenvecs</a></li>
<li><a href=#Hermitean_Matrices-hermitean_diagonizable>hermitean_diagonizable</a></li>
</ul>
</li><li><a href=#Elementary_Complex_Geometry>Elementary_Complex_Geometry</a>
<ul>
<li><a href=#Elementary_Complex_Geometry-collinear_ex_real>collinear_ex_real</a></li>
<li><a href=#Elementary_Complex_Geometry-collinear_det>collinear_det</a></li>
<li><a href=#Elementary_Complex_Geometry-collinear_sym1>collinear_sym1</a></li>
<li><a href=#Elementary_Complex_Geometry-collinear_sym2%27>collinear_sym2'</a></li>
<li><a href=#Elementary_Complex_Geometry-collinear_sym2>collinear_sym2</a></li>
<li><a href=#Elementary_Complex_Geometry-collinear_trans1>collinear_trans1</a></li>
<li><a href=#Elementary_Complex_Geometry-line_points_collinear>line_points_collinear</a></li>
<li><a href=#Elementary_Complex_Geometry-line_param>line_param</a></li>
<li><a href=#Elementary_Complex_Geometry-line_equation>line_equation</a></li>
<li><a href=#Elementary_Complex_Geometry-circle_equation>circle_equation</a></li>
<li><a href=#Elementary_Complex_Geometry-circline_circle>circline_circle</a></li>
<li><a href=#Elementary_Complex_Geometry-circline_ex_circle>circline_ex_circle</a></li>
<li><a href=#Elementary_Complex_Geometry-circle_circline>circle_circline</a></li>
<li><a href=#Elementary_Complex_Geometry-circle_ex_circline>circle_ex_circline</a></li>
<li><a href=#Elementary_Complex_Geometry-circline_line>circline_line</a></li>
<li><a href=#Elementary_Complex_Geometry-circline_ex_line>circline_ex_line</a></li>
<li><a href=#Elementary_Complex_Geometry-line_ex_circline>line_ex_circline</a></li>
<li><a href=#Elementary_Complex_Geometry-circline_line%27>circline_line'</a></li>
<li><a href=#Elementary_Complex_Geometry-circ_tang_vec_ortho>circ_tang_vec_ortho</a></li>
<li><a href=#Elementary_Complex_Geometry-circ_tang_vec_opposite_orient>circ_tang_vec_opposite_orient</a></li>
<li><a href=#Elementary_Complex_Geometry-ang_circ_simp>ang_circ_simp</a></li>
<li><a href=#Elementary_Complex_Geometry-cos_ang_circ_simp>cos_ang_circ_simp</a></li>
<li><a href=#Elementary_Complex_Geometry-ang_circ_c_simp>ang_circ_c_simp</a></li>
<li><a href=#Elementary_Complex_Geometry-ang_circ_a_simp>ang_circ_a_simp</a></li>
<li><a href=#Elementary_Complex_Geometry-ang_circ_a_pTrue>ang_circ_a_pTrue</a></li>
<li><a href=#Elementary_Complex_Geometry-ang_circ_a_simp1>ang_circ_a_simp1</a></li>
<li><a href=#Elementary_Complex_Geometry-ang_circ_a%27_simp>ang_circ_a'_simp</a></li>
</ul>
</li><li><a href=#Homogeneous_Coordinates>Homogeneous_Coordinates</a>
<ul>
<li><a href=#Homogeneous_Coordinates-complex_cvec_eq_mix>complex_cvec_eq_mix</a></li>
<li><a href=#Homogeneous_Coordinates-complex_eq_cvec_reflp>complex_eq_cvec_reflp</a></li>
<li><a href=#Homogeneous_Coordinates-complex_eq_cvec_symp>complex_eq_cvec_symp</a></li>
<li><a href=#Homogeneous_Coordinates-complex_eq_cvec_transp>complex_eq_cvec_transp</a></li>
<li><a href=#Homogeneous_Coordinates-complex_eq_cvec_equivp>complex_eq_cvec_equivp</a></li>
<li><a href=#Homogeneous_Coordinates-complex_homo_coords_eq_reflp>complex_homo_coords_eq_reflp</a></li>
<li><a href=#Homogeneous_Coordinates-complex_homo_coords_eq_symp>complex_homo_coords_eq_symp</a></li>
<li><a href=#Homogeneous_Coordinates-complex_homo_coords_eq_transp>complex_homo_coords_eq_transp</a></li>
<li><a href=#Homogeneous_Coordinates-complex_homo_coords_eq_equivp>complex_homo_coords_eq_equivp</a></li>
<li><a href=#Homogeneous_Coordinates-complex_homo_coords_eq_refl>complex_homo_coords_eq_refl</a></li>
<li><a href=#Homogeneous_Coordinates-complex_homo_coords_eq_sym>complex_homo_coords_eq_sym</a></li>
<li><a href=#Homogeneous_Coordinates-complex_homo_coords_eq_trans>complex_homo_coords_eq_trans</a></li>
<li><a href=#Homogeneous_Coordinates-inf_cvec_z2_zero_iff>inf_cvec_z2_zero_iff</a></li>
<li><a href=#Homogeneous_Coordinates-zero_cvec_z1_zero_iff>zero_cvec_z1_zero_iff</a></li>
<li><a href=#Homogeneous_Coordinates-zero_one_infty_not_equal>zero_one_infty_not_equal</a></li>
<li><a href=#Homogeneous_Coordinates-ex_3_different_points>ex_3_different_points</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_inj>of_complex_inj</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_image_inj>of_complex_image_inj</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_not_inf>of_complex_not_inf</a></li>
<li><a href=#Homogeneous_Coordinates-inf_not_of_complex>inf_not_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-inf_or_of_complex>inf_or_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_zero>of_complex_zero</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_one>of_complex_one</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_ii>of_complex_ii</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_zero_iff>of_complex_zero_iff</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_one_iff>of_complex_one_iff</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_ii_iff>of_complex_ii_iff</a></li>
<li><a href=#Homogeneous_Coordinates-to_complex_of_complex>to_complex_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_to_complex>of_complex_to_complex</a></li>
<li><a href=#Homogeneous_Coordinates-to_complex_zero_zero>to_complex_zero_zero</a></li>
<li><a href=#Homogeneous_Coordinates-to_complex_one_one>to_complex_one_one</a></li>
<li><a href=#Homogeneous_Coordinates-to_complex_img_one>to_complex_img_one</a></li>
<li><a href=#Homogeneous_Coordinates-add_commute>add_commute</a></li>
<li><a href=#Homogeneous_Coordinates-add_zero_right>add_zero_right</a></li>
<li><a href=#Homogeneous_Coordinates-add_zero_left>add_zero_left</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_add_of_complex>of_complex_add_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_add_inf>of_complex_add_inf</a></li>
<li><a href=#Homogeneous_Coordinates-inf_add_of_complex>inf_add_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-inf_add_right>inf_add_right</a></li>
<li><a href=#Homogeneous_Coordinates-inf_add_left>inf_add_left</a></li>
<li><a href=#Homogeneous_Coordinates-inf_add_inf>inf_add_inf</a></li>
<li><a href=#Homogeneous_Coordinates-uminus_of_complex>uminus_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-uminus_zero>uminus_zero</a></li>
<li><a href=#Homogeneous_Coordinates-uminus_inf>uminus_inf</a></li>
<li><a href=#Homogeneous_Coordinates-uminus_inf_iff>uminus_inf_iff</a></li>
<li><a href=#Homogeneous_Coordinates-uminus_id_iff>uminus_id_iff</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_sub_of_complex>of_complex_sub_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-zero_sub_right>zero_sub_right</a></li>
<li><a href=#Homogeneous_Coordinates-zero_sub_left>zero_sub_left</a></li>
<li><a href=#Homogeneous_Coordinates-zero_sub_one>zero_sub_one</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_sub_one>of_complex_sub_one</a></li>
<li><a href=#Homogeneous_Coordinates-sub_eq_zero>sub_eq_zero</a></li>
<li><a href=#Homogeneous_Coordinates-sub_eq_zero_iff>sub_eq_zero_iff</a></li>
<li><a href=#Homogeneous_Coordinates-inf_sub_left>inf_sub_left</a></li>
<li><a href=#Homogeneous_Coordinates-inf_sub_right>inf_sub_right</a></li>
<li><a href=#Homogeneous_Coordinates-inf_sub_inf>inf_sub_inf</a></li>
<li><a href=#Homogeneous_Coordinates-sub_noteq_inf>sub_noteq_inf</a></li>
<li><a href=#Homogeneous_Coordinates-sub_eq_inf>sub_eq_inf</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_mult_of_complex>of_complex_mult_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-mult_commute>mult_commute</a></li>
<li><a href=#Homogeneous_Coordinates-mult_zero_left>mult_zero_left</a></li>
<li><a href=#Homogeneous_Coordinates-mult_zero_right>mult_zero_right</a></li>
<li><a href=#Homogeneous_Coordinates-mult_inf_right>mult_inf_right</a></li>
<li><a href=#Homogeneous_Coordinates-mult_inf_left>mult_inf_left</a></li>
<li><a href=#Homogeneous_Coordinates-mult_one_left>mult_one_left</a></li>
<li><a href=#Homogeneous_Coordinates-mult_one_right>mult_one_right</a></li>
<li><a href=#Homogeneous_Coordinates-inf_mult_zero>inf_mult_zero</a></li>
<li><a href=#Homogeneous_Coordinates-zero_mult_inf>zero_mult_inf</a></li>
<li><a href=#Homogeneous_Coordinates-mult_eq_inf>mult_eq_inf</a></li>
<li><a href=#Homogeneous_Coordinates-mult_noteq_inf>mult_noteq_inf</a></li>
<li><a href=#Homogeneous_Coordinates-reciprocal_involution>reciprocal_involution</a></li>
<li><a href=#Homogeneous_Coordinates-reciprocal_zero>reciprocal_zero</a></li>
<li><a href=#Homogeneous_Coordinates-reciprocal_inf>reciprocal_inf</a></li>
<li><a href=#Homogeneous_Coordinates-reciprocal_one>reciprocal_one</a></li>
<li><a href=#Homogeneous_Coordinates-reciprocal_inf_iff>reciprocal_inf_iff</a></li>
<li><a href=#Homogeneous_Coordinates-reciprocal_zero_iff>reciprocal_zero_iff</a></li>
<li><a href=#Homogeneous_Coordinates-reciprocal_of_complex>reciprocal_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-reciprocal_real>reciprocal_real</a></li>
<li><a href=#Homogeneous_Coordinates-reciprocal_id_iff>reciprocal_id_iff</a></li>
<li><a href=#Homogeneous_Coordinates-divide_zero_right>divide_zero_right</a></li>
<li><a href=#Homogeneous_Coordinates-divide_zero_left>divide_zero_left</a></li>
<li><a href=#Homogeneous_Coordinates-divide_inf_right>divide_inf_right</a></li>
<li><a href=#Homogeneous_Coordinates-divide_inf_left>divide_inf_left</a></li>
<li><a href=#Homogeneous_Coordinates-divide_eq_inf>divide_eq_inf</a></li>
<li><a href=#Homogeneous_Coordinates-inf_divide_zero>inf_divide_zero</a></li>
<li><a href=#Homogeneous_Coordinates-zero_divide_inf>zero_divide_inf</a></li>
<li><a href=#Homogeneous_Coordinates-divide_one_right>divide_one_right</a></li>
<li><a href=#Homogeneous_Coordinates-of_complex_divide_of_complex>of_complex_divide_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-one_div_of_complex>one_div_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-inf_divide_inf>inf_divide_inf</a></li>
<li><a href=#Homogeneous_Coordinates-zero_divide_zero>zero_divide_zero</a></li>
<li><a href=#Homogeneous_Coordinates-conjugate_involution>conjugate_involution</a></li>
<li><a href=#Homogeneous_Coordinates-conjugate_conjugate_comp>conjugate_conjugate_comp</a></li>
<li><a href=#Homogeneous_Coordinates-inv_conjugate>inv_conjugate</a></li>
<li><a href=#Homogeneous_Coordinates-conjugate_of_complex>conjugate_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-conjugate_inf>conjugate_inf</a></li>
<li><a href=#Homogeneous_Coordinates-conjugate_zero>conjugate_zero</a></li>
<li><a href=#Homogeneous_Coordinates-conjugate_one>conjugate_one</a></li>
<li><a href=#Homogeneous_Coordinates-conjugate_inj>conjugate_inj</a></li>
<li><a href=#Homogeneous_Coordinates-bij_conjugate>bij_conjugate</a></li>
<li><a href=#Homogeneous_Coordinates-conjugate_id_iff>conjugate_id_iff</a></li>
<li><a href=#Homogeneous_Coordinates-inversion_sym>inversion_sym</a></li>
<li><a href=#Homogeneous_Coordinates-inversion_involution>inversion_involution</a></li>
<li><a href=#Homogeneous_Coordinates-inversion_inversion_id>inversion_inversion_id</a></li>
<li><a href=#Homogeneous_Coordinates-inversion_zero>inversion_zero</a></li>
<li><a href=#Homogeneous_Coordinates-inversion_infty>inversion_infty</a></li>
<li><a href=#Homogeneous_Coordinates-inversion_of_complex>inversion_of_complex</a></li>
<li><a href=#Homogeneous_Coordinates-is_real_inversion>is_real_inversion</a></li>
<li><a href=#Homogeneous_Coordinates-inversion_id_iff>inversion_id_iff</a></li>
<li><a href=#Homogeneous_Coordinates-cross_ratio_01inf_id>cross_ratio_01inf_id</a></li>
<li><a href=#Homogeneous_Coordinates-cross_ratio_0>cross_ratio_0</a></li>
<li><a href=#Homogeneous_Coordinates-cross_ratio_1>cross_ratio_1</a></li>
<li><a href=#Homogeneous_Coordinates-cross_ratio_inf>cross_ratio_inf</a></li>
<li><a href=#Homogeneous_Coordinates-cross_ratio_0inf>cross_ratio_0inf</a></li>
<li><a href=#Homogeneous_Coordinates-cross_ratio_commute_13>cross_ratio_commute_13</a></li>
<li><a href=#Homogeneous_Coordinates-cross_ratio_commute_24>cross_ratio_commute_24</a></li>
<li><a href=#Homogeneous_Coordinates-cross_ratio_not_inf>cross_ratio_not_inf</a></li>
<li><a href=#Homogeneous_Coordinates-cross_ratio_not_zero>cross_ratio_not_zero</a></li>
<li><a href=#Homogeneous_Coordinates-cross_ratio_real>cross_ratio_real</a></li>
<li><a href=#Homogeneous_Coordinates-cross_ratio>cross_ratio</a></li>
</ul>
</li><li><a href=#Moebius>Moebius</a>
<ul>
<li><a href=#Moebius-moebius_mat_eq_refl>moebius_mat_eq_refl</a></li>
<li><a href=#Moebius-ex_mk_moebius>ex_mk_moebius</a></li>
<li><a href=#Moebius-bij_moebius_pt>bij_moebius_pt</a></li>
<li><a href=#Moebius-moebius_pt_eq_I>moebius_pt_eq_I</a></li>
<li><a href=#Moebius-moebius_pt_neq_I>moebius_pt_neq_I</a></li>
<li><a href=#Moebius-moebius_pt_bilinear>moebius_pt_bilinear</a></li>
<li><a href=#Moebius-moebius_pt_moebius_id>moebius_pt_moebius_id</a></li>
<li><a href=#Moebius-mk_moeibus_id>mk_moeibus_id</a></li>
<li><a href=#Moebius-moebius_inv>moebius_inv</a></li>
<li><a href=#Moebius-is_moebius_inv>is_moebius_inv</a></li>
<li><a href=#Moebius-moebius_inv_mk_moebus>moebius_inv_mk_moebus</a></li>
<li><a href=#Moebius-moebius_comp>moebius_comp</a></li>
<li><a href=#Moebius-moebius_pt_comp>moebius_pt_comp</a></li>
<li><a href=#Moebius-is_moebius_comp>is_moebius_comp</a></li>
<li><a href=#Moebius-moebius_comp_mk_moebius>moebius_comp_mk_moebius</a></li>
<li><a href=#Moebius-moebius_comp_inv_left>moebius_comp_inv_left</a></li>
<li><a href=#Moebius-moebius_comp_inv_right>moebius_comp_inv_right</a></li>
<li><a href=#Moebius-moebius_pt_comp_inv_left>moebius_pt_comp_inv_left</a></li>
<li><a href=#Moebius-moebius_pt_comp_inv_right>moebius_pt_comp_inv_right</a></li>
<li><a href=#Moebius-moebius_pt_comp_inv_image_left>moebius_pt_comp_inv_image_left</a></li>
<li><a href=#Moebius-moebius_pt_comp_inv_image_right>moebius_pt_comp_inv_image_right</a></li>
<li><a href=#Moebius-moebius_pt_invert>moebius_pt_invert</a></li>
<li><a href=#Moebius-moebius_pt_moebius_inv_in_set>moebius_pt_moebius_inv_in_set</a></li>
<li><a href=#Moebius-moebius_reciprocal>moebius_reciprocal</a></li>
<li><a href=#Moebius-moebius_reciprocal_inv>moebius_reciprocal_inv</a></li>
<li><a href=#Moebius-moebius_pt_moebius_similarity>moebius_pt_moebius_similarity</a></li>
<li><a href=#Moebius-moebius_pt_moebius_similarity%27>moebius_pt_moebius_similarity'</a></li>
<li><a href=#Moebius-is_moebius_similarity%27>is_moebius_similarity'</a></li>
<li><a href=#Moebius-is_moebius_similarity>is_moebius_similarity</a></li>
<li><a href=#Moebius-moebius_similarity_id>moebius_similarity_id</a></li>
<li><a href=#Moebius-moebius_similarity_inv>moebius_similarity_inv</a></li>
<li><a href=#Moebius-moebius_similarity_uminus>moebius_similarity_uminus</a></li>
<li><a href=#Moebius-moebius_similarity_comp>moebius_similarity_comp</a></li>
<li><a href=#Moebius-moebius_similarity_plus>moebius_similarity_plus</a></li>
<li><a href=#Moebius-moebius_similarity_inf>moebius_similarity_inf</a></li>
<li><a href=#Moebius-moebius_similarity_only_inf_to_inf>moebius_similarity_only_inf_to_inf</a></li>
<li><a href=#Moebius-moebius_similarity_inf_iff>moebius_similarity_inf_iff</a></li>
<li><a href=#Moebius-inf_fixed_only_moebius_similarity>inf_fixed_only_moebius_similarity</a></li>
<li><a href=#Moebius-moebius_translation_comp>moebius_translation_comp</a></li>
<li><a href=#Moebius-moebius_translation_plus>moebius_translation_plus</a></li>
<li><a href=#Moebius-moebius_translation_zero>moebius_translation_zero</a></li>
<li><a href=#Moebius-moebius_translation_inv>moebius_translation_inv</a></li>
<li><a href=#Moebius-moebius_translation_uminus>moebius_translation_uminus</a></li>
<li><a href=#Moebius-moebius_translation_inv_translation>moebius_translation_inv_translation</a></li>
<li><a href=#Moebius-moebius_inv_translation_translation>moebius_inv_translation_translation</a></li>
<li><a href=#Moebius-moebius_pt_moebius_translation>moebius_pt_moebius_translation</a></li>
<li><a href=#Moebius-moebius_pt_moebius_translation_inf>moebius_pt_moebius_translation_inf</a></li>
<li><a href=#Moebius-moebius_rotation_comp>moebius_rotation_comp</a></li>
<li><a href=#Moebius-moebius_rotation_plus>moebius_rotation_plus</a></li>
<li><a href=#Moebius-moebius_rotation_zero>moebius_rotation_zero</a></li>
<li><a href=#Moebius-moebius_rotation_inv>moebius_rotation_inv</a></li>
<li><a href=#Moebius-moebius_rotation_uminus>moebius_rotation_uminus</a></li>
<li><a href=#Moebius-moebius_rotation_inv_rotation>moebius_rotation_inv_rotation</a></li>
<li><a href=#Moebius-moebius_inv_rotation_rotation>moebius_inv_rotation_rotation</a></li>
<li><a href=#Moebius-moebius_pt_moebius_rotation>moebius_pt_moebius_rotation</a></li>
<li><a href=#Moebius-moebius_pt_moebius_rotation_inf>moebius_pt_moebius_rotation_inf</a></li>
<li><a href=#Moebius-moebius_pt_rotation_inf_iff>moebius_pt_rotation_inf_iff</a></li>
<li><a href=#Moebius-moebius_pt_moebius_rotation_zero>moebius_pt_moebius_rotation_zero</a></li>
<li><a href=#Moebius-moebius_pt_moebius_rotation_zero_iff>moebius_pt_moebius_rotation_zero_iff</a></li>
<li><a href=#Moebius-moebius_rotation_preserve_cmod>moebius_rotation_preserve_cmod</a></li>
<li><a href=#Moebius-moebius_dilatation_comp>moebius_dilatation_comp</a></li>
<li><a href=#Moebius-moebius_dilatation_plus>moebius_dilatation_plus</a></li>
<li><a href=#Moebius-moebius_dilatation_zero>moebius_dilatation_zero</a></li>
<li><a href=#Moebius-moebius_dilatation_inverse>moebius_dilatation_inverse</a></li>
<li><a href=#Moebius-moebius_dilatation_uminus>moebius_dilatation_uminus</a></li>
<li><a href=#Moebius-moebius_pt_dilatation>moebius_pt_dilatation</a></li>
<li><a href=#Moebius-moebius_rotation_dilatation>moebius_rotation_dilatation</a></li>
<li><a href=#Moebius-conjugate_moebius>conjugate_moebius</a></li>
<li><a href=#Moebius-similarity_decomposition>similarity_decomposition</a></li>
<li><a href=#Moebius-moebius_decomposition>moebius_decomposition</a></li>
<li><a href=#Moebius-moebius_decomposition_similarity>moebius_decomposition_similarity</a></li>
<li><a href=#Moebius-wlog_moebius_decomposition>wlog_moebius_decomposition</a></li>
<li><a href=#Moebius-is_moebius_cross_ratio>is_moebius_cross_ratio</a></li>
<li><a href=#Moebius-ex_moebius_01inf>ex_moebius_01inf</a></li>
<li><a href=#Moebius-ex_moebius>ex_moebius</a></li>
<li><a href=#Moebius-ex_moebius_1>ex_moebius_1</a></li>
<li><a href=#Moebius-wlog_moebius_01inf>wlog_moebius_01inf</a></li>
<li><a href=#Moebius-three_fixed_points_01inf>three_fixed_points_01inf</a></li>
<li><a href=#Moebius-three_fixed_points>three_fixed_points</a></li>
<li><a href=#Moebius-unique_moebius_three_points>unique_moebius_three_points</a></li>
<li><a href=#Moebius-ex_unique_moebius_three_points>ex_unique_moebius_three_points</a></li>
<li><a href=#Moebius-ex_unique_moebius_three_points_fun>ex_unique_moebius_three_points_fun</a></li>
<li><a href=#Moebius-unique_moebius_pt>unique_moebius_pt</a></li>
<li><a href=#Moebius-is_cross_ratio_01inf>is_cross_ratio_01inf</a></li>
<li><a href=#Moebius-moebius_preserve_cross_ratio>moebius_preserve_cross_ratio</a></li>
<li><a href=#Moebius-conjugate_cross_ratio>conjugate_cross_ratio</a></li>
<li><a href=#Moebius-cross_ratio_reciprocal>cross_ratio_reciprocal</a></li>
<li><a href=#Moebius-cross_ratio_inversion>cross_ratio_inversion</a></li>
<li><a href=#Moebius-fixed_points_0inf%27>fixed_points_0inf'</a></li>
<li><a href=#Moebius-fixed_points_0inf>fixed_points_0inf</a></li>
<li><a href=#Moebius-ex_cross_ratio>ex_cross_ratio</a></li>
<li><a href=#Moebius-unique_cross_ratio>unique_cross_ratio</a></li>
<li><a href=#Moebius-ex1_cross_ratio>ex1_cross_ratio</a></li>
<li><a href=#Moebius-ex1_pole>ex1_pole</a></li>
<li><a href=#Moebius-pole_mk_moebius>pole_mk_moebius</a></li>
<li><a href=#Moebius-pole_similarity>pole_similarity</a></li>
<li><a href=#Moebius-not_moebius_conjugate>not_moebius_conjugate</a></li>
<li><a href=#Moebius-conjugation_is_antihomography>conjugation_is_antihomography</a></li>
<li><a href=#Moebius-inversion_is_antihomography>inversion_is_antihomography</a></li>
<li><a href=#Moebius-homography_antihomography_exclusive>homography_antihomography_exclusive</a></li>
<li><a href=#Moebius-similarity_scale_1>similarity_scale_1</a></li>
<li><a href=#Moebius-similarity_scale_2>similarity_scale_2</a></li>
<li><a href=#Moebius-mat_trace_mult_sm>mat_trace_mult_sm</a></li>
<li><a href=#Moebius-similarity_invar_moeibus_mb>similarity_invar_moeibus_mb</a></li>
<li><a href=#Moebius-similar_refl>similar_refl</a></li>
<li><a href=#Moebius-similar_sym>similar_sym</a></li>
<li><a href=#Moebius-similar_trans>similar_trans</a></li>
</ul>
</li><li><a href=#Circlines>Circlines</a>
<ul>
<li><a href=#Circlines-symp_circline_eq_cmat>symp_circline_eq_cmat</a></li>
<li><a href=#Circlines-circline_eq_cmat_hermitean_nonzero>circline_eq_cmat_hermitean_nonzero</a></li>
<li><a href=#Circlines-circline_eq_clmat_refl>circline_eq_clmat_refl</a></li>
<li><a href=#Circlines-ex_mk_circline>ex_mk_circline</a></li>
<li><a href=#Circlines-circline_type>circline_type</a></li>
<li><a href=#Circlines-circline_type_mk_circline>circline_type_mk_circline</a></li>
<li><a href=#Circlines-circline_set_I>circline_set_I</a></li>
<li><a href=#Circlines-on_circline_cmat_cvec_circline_equation>on_circline_cmat_cvec_circline_equation</a></li>
<li><a href=#Circlines-circline_equation>circline_equation</a></li>
<li><a href=#Circlines-inf_on_circline>inf_on_circline</a></li>
<li><a href=#Circlines-inf_in_circline_set>inf_in_circline_set</a></li>
<li><a href=#Circlines-zero_on_circline>zero_on_circline</a></li>
<li><a href=#Circlines-zero_in_circline_set>zero_in_circline_set</a></li>
<li><a href=#Circlines-classic_circline>classic_circline</a></li>
<li><a href=#Circlines-is_circle_mk_circle>is_circle_mk_circle</a></li>
<li><a href=#Circlines-circline_set_mk_circle>circline_set_mk_circle</a></li>
<li><a href=#Circlines-circline_set_mk_line>circline_set_mk_line</a></li>
<li><a href=#Circlines-classic_circle>classic_circle</a></li>
<li><a href=#Circlines-classic_line>classic_line</a></li>
<li><a href=#Circlines-on_circline_cmat_cvec_unit>on_circline_cmat_cvec_unit</a></li>
<li><a href=#Circlines-one_on_unit_circle>one_on_unit_circle</a></li>
<li><a href=#Circlines-one_in_unit_circle_set>one_in_unit_circle_set</a></li>
<li><a href=#Circlines-is_circle_unit_circle>is_circle_unit_circle</a></li>
<li><a href=#Circlines-not_inf_on_unit_circle%27>not_inf_on_unit_circle'</a></li>
<li><a href=#Circlines-not_inf_on_unit_circle%27%27>not_inf_on_unit_circle''</a></li>
<li><a href=#Circlines-euclidean_circle_unit_circle>euclidean_circle_unit_circle</a></li>
<li><a href=#Circlines-circline_type_unit_circle>circline_type_unit_circle</a></li>
<li><a href=#Circlines-on_circline_unit_circle>on_circline_unit_circle</a></li>
<li><a href=#Circlines-circline_set_unit_circle>circline_set_unit_circle</a></li>
<li><a href=#Circlines-circline_set_unit_circle_I>circline_set_unit_circle_I</a></li>
<li><a href=#Circlines-inversion_unit_circle>inversion_unit_circle</a></li>
<li><a href=#Circlines-inversion_id_iff_on_unit_circle>inversion_id_iff_on_unit_circle</a></li>
<li><a href=#Circlines-on_unit_circle_conjugate>on_unit_circle_conjugate</a></li>
<li><a href=#Circlines-conjugate_unit_circle_set>conjugate_unit_circle_set</a></li>
<li><a href=#Circlines-special_points_on_x_axis%27>special_points_on_x_axis'</a></li>
<li><a href=#Circlines-special_points_on_x_axis%27%27>special_points_on_x_axis''</a></li>
<li><a href=#Circlines-is_line_x_axis>is_line_x_axis</a></li>
<li><a href=#Circlines-circline_type_x_axis>circline_type_x_axis</a></li>
<li><a href=#Circlines-on_circline_x_axis>on_circline_x_axis</a></li>
<li><a href=#Circlines-on_circline_x_axis_I>on_circline_x_axis_I</a></li>
<li><a href=#Circlines-circline_set_x_axis>circline_set_x_axis</a></li>
<li><a href=#Circlines-circline_set_x_axis_I>circline_set_x_axis_I</a></li>
<li><a href=#Circlines-circline_equation_x_axis>circline_equation_x_axis</a></li>
<li><a href=#Circlines-circline_set_positive_x_axis_I>circline_set_positive_x_axis_I</a></li>
<li><a href=#Circlines-circline_set_negative_x_axis_I>circline_set_negative_x_axis_I</a></li>
<li><a href=#Circlines-special_points_on_y_axis%27>special_points_on_y_axis'</a></li>
<li><a href=#Circlines-special_points_on_y_axis%27%27>special_points_on_y_axis''</a></li>
<li><a href=#Circlines-on_circline_y_axis>on_circline_y_axis</a></li>
<li><a href=#Circlines-on_circline_y_axis_I>on_circline_y_axis_I</a></li>
<li><a href=#Circlines-circline_set_y_axis>circline_set_y_axis</a></li>
<li><a href=#Circlines-circline_set_y_axis_I>circline_set_y_axis_I</a></li>
<li><a href=#Circlines-circline_set_positive_y_axis_I>circline_set_positive_y_axis_I</a></li>
<li><a href=#Circlines-circline_set_negative_y_axis_I>circline_set_negative_y_axis_I</a></li>
<li><a href=#Circlines-circline_type_circline_point_0>circline_type_circline_point_0</a></li>
<li><a href=#Circlines-zero_in_circline_point_0>zero_in_circline_point_0</a></li>
<li><a href=#Circlines-circline_type_imag_unit_circle>circline_type_imag_unit_circle</a></li>
<li><a href=#Circlines-circline_equation_cancel_z2>circline_equation_cancel_z2</a></li>
<li><a href=#Circlines-circline_equation_quadratic_equation>circline_equation_quadratic_equation</a></li>
<li><a href=#Circlines-circline_intersection_symetry>circline_intersection_symetry</a></li>
<li><a href=#Circlines-moebius_preserve_circline_type>moebius_preserve_circline_type</a></li>
<li><a href=#Circlines-moebius_circline>moebius_circline</a></li>
<li><a href=#Circlines-on_circline_moebius_circline_I>on_circline_moebius_circline_I</a></li>
<li><a href=#Circlines-circline_set_moebius_circline>circline_set_moebius_circline</a></li>
<li><a href=#Circlines-circline_set_moebius_circline_I>circline_set_moebius_circline_I</a></li>
<li><a href=#Circlines-circline_set_moebius_circline_E>circline_set_moebius_circline_E</a></li>
<li><a href=#Circlines-circline_set_moebius_circline_iff>circline_set_moebius_circline_iff</a></li>
<li><a href=#Circlines-inj_moebius_circline>inj_moebius_circline</a></li>
<li><a href=#Circlines-moebius_circline_eq_I>moebius_circline_eq_I</a></li>
<li><a href=#Circlines-moebius_circline_neq_I>moebius_circline_neq_I</a></li>
<li><a href=#Circlines-moebius_circline_id>moebius_circline_id</a></li>
<li><a href=#Circlines-moebius_circline_comp>moebius_circline_comp</a></li>
<li><a href=#Circlines-moebius_circline_comp_inv_left>moebius_circline_comp_inv_left</a></li>
<li><a href=#Circlines-moebius_circline_comp_inv_right>moebius_circline_comp_inv_right</a></li>
<li><a href=#Circlines-moebius_similarity_lines_to_lines>moebius_similarity_lines_to_lines</a></li>
<li><a href=#Circlines-moebius_similarity_lines_to_lines%27>moebius_similarity_lines_to_lines'</a></li>
<li><a href=#Circlines-conjugate_circline_set%27>conjugate_circline_set'</a></li>
<li><a href=#Circlines-conjugate_conjugate_circline>conjugate_conjugate_circline</a></li>
<li><a href=#Circlines-circline_set_conjugate_circline>circline_set_conjugate_circline</a></li>
<li><a href=#Circlines-on_circline_conjugate_circline>on_circline_conjugate_circline</a></li>
<li><a href=#Circlines-on_circline_circline_inversion>on_circline_circline_inversion</a></li>
<li><a href=#Circlines-circline_set_circline_inversion>circline_set_circline_inversion</a></li>
<li><a href=#Circlines-circline_set_circline_reciprocal>circline_set_circline_reciprocal</a></li>
<li><a href=#Circlines-rotation_pi_2_y_axis>rotation_pi_2_y_axis</a></li>
<li><a href=#Circlines-rotation_minus_pi_2_y_axis>rotation_minus_pi_2_y_axis</a></li>
<li><a href=#Circlines-rotation_minus_pi_2_x_axis>rotation_minus_pi_2_x_axis</a></li>
<li><a href=#Circlines-rotation_pi_2_x_axis>rotation_pi_2_x_axis</a></li>
<li><a href=#Circlines-rotation_minus_pi_2_positive_y_axis>rotation_minus_pi_2_positive_y_axis</a></li>
<li><a href=#Circlines-unique_circline_type_zero_0%27>unique_circline_type_zero_0'</a></li>
<li><a href=#Circlines-unique_circline_type_zero_0>unique_circline_type_zero_0</a></li>
<li><a href=#Circlines-unique_circline_type_zero>unique_circline_type_zero</a></li>
<li><a href=#Circlines-unique_circline_01inf%27>unique_circline_01inf'</a></li>
<li><a href=#Circlines-unique_circline_set>unique_circline_set</a></li>
<li><a href=#Circlines-zero_one_inf_x_axis>zero_one_inf_x_axis</a></li>
<li><a href=#Circlines-circline_diagonalize>circline_diagonalize</a></li>
<li><a href=#Circlines-wlog_circline_diag>wlog_circline_diag</a></li>
<li><a href=#Circlines-circline_type_zero_card_eq1_0>circline_type_zero_card_eq1_0</a></li>
<li><a href=#Circlines-circline_type_zero_card_eq1>circline_type_zero_card_eq1</a></li>
<li><a href=#Circlines-quad_form_diagonal_iff>quad_form_diagonal_iff</a></li>
<li><a href=#Circlines-circline_type_neg_card_gt3_diag>circline_type_neg_card_gt3_diag</a></li>
<li><a href=#Circlines-circline_type_neg_card_gt3>circline_type_neg_card_gt3</a></li>
<li><a href=#Circlines-circline_type_pos_card_eq0_diag>circline_type_pos_card_eq0_diag</a></li>
<li><a href=#Circlines-circline_type_pos_card_eq0>circline_type_pos_card_eq0</a></li>
<li><a href=#Circlines-card_eq1_circline_type_zero>card_eq1_circline_type_zero</a></li>
<li><a href=#Circlines-inj_circline_set>inj_circline_set</a></li>
<li><a href=#Circlines-four_points_on_circline_iff_cross_ratio_real>four_points_on_circline_iff_cross_ratio_real</a></li>
<li><a href=#Circlines-symmetry_principle>symmetry_principle</a></li>
<li><a href=#Circlines-circline_symmetric_0inf_disc>circline_symmetric_0inf_disc</a></li>
<li><a href=#Circlines-circline_symmetric_inv_homo_disc>circline_symmetric_inv_homo_disc</a></li>
<li><a href=#Circlines-circline_symmetric_inv_homo_disc%27>circline_symmetric_inv_homo_disc'</a></li>
<li><a href=#Circlines-ex_moebius_circline_x_axis>ex_moebius_circline_x_axis</a></li>
<li><a href=#Circlines-wlog_circline_x_axis>wlog_circline_x_axis</a></li>
<li><a href=#Circlines-circline_intersection_at_most_2_points>circline_intersection_at_most_2_points</a></li>
</ul>
</li><li><a href=#Oriented_Circlines>Oriented_Circlines</a>
<ul>
<li><a href=#Oriented_Circlines-ocircline_eq_cmat_id>ocircline_eq_cmat_id</a></li>
<li><a href=#Oriented_Circlines-ocircline_set_I>ocircline_set_I</a></li>
<li><a href=#Oriented_Circlines-disc_I>disc_I</a></li>
<li><a href=#Oriented_Circlines-disc_compl_I>disc_compl_I</a></li>
<li><a href=#Oriented_Circlines-in_on_out>in_on_out</a></li>
<li><a href=#Oriented_Circlines-in_on_out_univ>in_on_out_univ</a></li>
<li><a href=#Oriented_Circlines-disc_inter_disc_compl>disc_inter_disc_compl</a></li>
<li><a href=#Oriented_Circlines-disc_inter_ocircline_set>disc_inter_ocircline_set</a></li>
<li><a href=#Oriented_Circlines-disc_compl_inter_ocircline_set>disc_compl_inter_ocircline_set</a></li>
<li><a href=#Oriented_Circlines-opposite_ocircline_involution>opposite_ocircline_involution</a></li>
<li><a href=#Oriented_Circlines-on_circline_opposite_ocircline_cmat>on_circline_opposite_ocircline_cmat</a></li>
<li><a href=#Oriented_Circlines-on_circline_opposite_ocircline>on_circline_opposite_ocircline</a></li>
<li><a href=#Oriented_Circlines-ocircline_set_opposite_ocircline>ocircline_set_opposite_ocircline</a></li>
<li><a href=#Oriented_Circlines-disc_compl_opposite_ocircline>disc_compl_opposite_ocircline</a></li>
<li><a href=#Oriented_Circlines-disc_opposite_ocircline>disc_opposite_ocircline</a></li>
<li><a href=#Oriented_Circlines-of_ocircline_opposite_ocircline>of_ocircline_opposite_ocircline</a></li>
<li><a href=#Oriented_Circlines-on_ocircline_of_circline>on_ocircline_of_circline</a></li>
<li><a href=#Oriented_Circlines-circline_set_of_ocircline>circline_set_of_ocircline</a></li>
<li><a href=#Oriented_Circlines-inj_of_ocircline>inj_of_ocircline</a></li>
<li><a href=#Oriented_Circlines-inj_ocircline_set>inj_ocircline_set</a></li>
<li><a href=#Oriented_Circlines-pos_oriented>pos_oriented</a></li>
<li><a href=#Oriented_Circlines-pos_oriented_opposite_ocircline_cmat>pos_oriented_opposite_ocircline_cmat</a></li>
<li><a href=#Oriented_Circlines-pos_oriented_opposite_ocircline>pos_oriented_opposite_ocircline</a></li>
<li><a href=#Oriented_Circlines-pos_oriented_circle_inf>pos_oriented_circle_inf</a></li>
<li><a href=#Oriented_Circlines-pos_oriented_euclidean_circle>pos_oriented_euclidean_circle</a></li>
<li><a href=#Oriented_Circlines-of_circline_clmat_def%27>of_circline_clmat_def'</a></li>
<li><a href=#Oriented_Circlines-pos_oriented_cmat_mult_positive%27>pos_oriented_cmat_mult_positive'</a></li>
<li><a href=#Oriented_Circlines-pos_oriented_cmat_mult_positive>pos_oriented_cmat_mult_positive</a></li>
<li><a href=#Oriented_Circlines-pos_oriented_cmat_mult_negative>pos_oriented_cmat_mult_negative</a></li>
<li><a href=#Oriented_Circlines-pos_oriented_of_circline>pos_oriented_of_circline</a></li>
<li><a href=#Oriented_Circlines-of_ocircline_of_circline>of_ocircline_of_circline</a></li>
<li><a href=#Oriented_Circlines-of_circline_of_ocircline_pos_oriented>of_circline_of_ocircline_pos_oriented</a></li>
<li><a href=#Oriented_Circlines-inj_of_circline>inj_of_circline</a></li>
<li><a href=#Oriented_Circlines-of_circline_of_ocircline>of_circline_of_ocircline</a></li>
<li><a href=#Oriented_Circlines-ocircline_set_of_circline>ocircline_set_of_circline</a></li>
<li><a href=#Oriented_Circlines-pos_oriented_ounit_circle>pos_oriented_ounit_circle</a></li>
<li><a href=#Oriented_Circlines-of_ocircline_ounit_circle>of_ocircline_ounit_circle</a></li>
<li><a href=#Oriented_Circlines-of_circline_unit_circle>of_circline_unit_circle</a></li>
<li><a href=#Oriented_Circlines-ocircline_set_ounit_circle>ocircline_set_ounit_circle</a></li>
<li><a href=#Oriented_Circlines-zero_in_unit_disc>zero_in_unit_disc</a></li>
<li><a href=#Oriented_Circlines-one_notin_unit_dic>one_notin_unit_dic</a></li>
<li><a href=#Oriented_Circlines-inf_notin_unit_disc>inf_notin_unit_disc</a></li>
<li><a href=#Oriented_Circlines-unit_disc_iff_cmod_lt_1>unit_disc_iff_cmod_lt_1</a></li>
<li><a href=#Oriented_Circlines-unit_disc_cmod_square_lt_1>unit_disc_cmod_square_lt_1</a></li>
<li><a href=#Oriented_Circlines-unit_disc_to_complex_inj>unit_disc_to_complex_inj</a></li>
<li><a href=#Oriented_Circlines-inversion_unit_disc>inversion_unit_disc</a></li>
<li><a href=#Oriented_Circlines-inversion_unit_disc_compl>inversion_unit_disc_compl</a></li>
<li><a href=#Oriented_Circlines-inversion_noteq_unit_disc>inversion_noteq_unit_disc</a></li>
<li><a href=#Oriented_Circlines-in_ocircline_ounit_circle_conjugate>in_ocircline_ounit_circle_conjugate</a></li>
<li><a href=#Oriented_Circlines-conjugate_unit_disc>conjugate_unit_disc</a></li>
<li><a href=#Oriented_Circlines-conjugate_in_unit_disc>conjugate_in_unit_disc</a></li>
<li><a href=#Oriented_Circlines-out_ocircline_ounit_circle_conjugate>out_ocircline_ounit_circle_conjugate</a></li>
<li><a href=#Oriented_Circlines-conjugate_unit_disc_compl>conjugate_unit_disc_compl</a></li>
<li><a href=#Oriented_Circlines-conjugate_in_unit_disc_compl>conjugate_in_unit_disc_compl</a></li>
<li><a href=#Oriented_Circlines-o_x_axis_pos_oriented>o_x_axis_pos_oriented</a></li>
<li><a href=#Oriented_Circlines-of_ocircline_o_x_axis>of_ocircline_o_x_axis</a></li>
<li><a href=#Oriented_Circlines-of_circline_x_axis>of_circline_x_axis</a></li>
<li><a href=#Oriented_Circlines-ocircline_set_circline_set_x_axis>ocircline_set_circline_set_x_axis</a></li>
<li><a href=#Oriented_Circlines-ii_in_disc_o_x_axis>ii_in_disc_o_x_axis</a></li>
<li><a href=#Oriented_Circlines-ii_notin_disc_o_x_axis>ii_notin_disc_o_x_axis</a></li>
<li><a href=#Oriented_Circlines-of_complex_in_o_x_axis_disc>of_complex_in_o_x_axis_disc</a></li>
<li><a href=#Oriented_Circlines-inf_notin_disc_o_x_axis>inf_notin_disc_o_x_axis</a></li>
<li><a href=#Oriented_Circlines-disc_o_x_axis>disc_o_x_axis</a></li>
<li><a href=#Oriented_Circlines-of_ocircline_o_circline_point_0>of_ocircline_o_circline_point_0</a></li>
<li><a href=#Oriented_Circlines-moebius_circline_ocircline>moebius_circline_ocircline</a></li>
<li><a href=#Oriented_Circlines-moebius_ocircline_circline>moebius_ocircline_circline</a></li>
<li><a href=#Oriented_Circlines-inj_moebius_ocircline>inj_moebius_ocircline</a></li>
<li><a href=#Oriented_Circlines-moebius_ocircline_id_moebius>moebius_ocircline_id_moebius</a></li>
<li><a href=#Oriented_Circlines-moebius_ocircline_comp>moebius_ocircline_comp</a></li>
<li><a href=#Oriented_Circlines-moebius_ocircline_comp_inv_left>moebius_ocircline_comp_inv_left</a></li>
<li><a href=#Oriented_Circlines-moebius_ocircline_comp_inv_right>moebius_ocircline_comp_inv_right</a></li>
<li><a href=#Oriented_Circlines-moebius_ocircline_opposite_ocircline>moebius_ocircline_opposite_ocircline</a></li>
<li><a href=#Oriented_Circlines-ocircline_set_moebius_ocircline>ocircline_set_moebius_ocircline</a></li>
<li><a href=#Oriented_Circlines-ocircline_set_fix_iff_ocircline_fix>ocircline_set_fix_iff_ocircline_fix</a></li>
<li><a href=#Oriented_Circlines-disc_moebius_ocircline>disc_moebius_ocircline</a></li>
<li><a href=#Oriented_Circlines-disc_compl_moebius_ocircline>disc_compl_moebius_ocircline</a></li>
<li><a href=#Oriented_Circlines-moebius_similarity_oriented_lines_to_oriented_lines>moebius_similarity_oriented_lines_to_oriented_lines</a></li>
<li><a href=#Oriented_Circlines-moebius_similarity_preserve_orientation%27>moebius_similarity_preserve_orientation'</a></li>
<li><a href=#Oriented_Circlines-moebius_similarity_preserve_orientation>moebius_similarity_preserve_orientation</a></li>
<li><a href=#Oriented_Circlines-reciprocal_preserve_orientation>reciprocal_preserve_orientation</a></li>
<li><a href=#Oriented_Circlines-reciprocal_not_preserve_orientation>reciprocal_not_preserve_orientation</a></li>
<li><a href=#Oriented_Circlines-pole_in_disc>pole_in_disc</a></li>
<li><a href=#Oriented_Circlines-pole_in_disc_compl>pole_in_disc_compl</a></li>
<li><a href=#Oriented_Circlines-ocircline_01inf>ocircline_01inf</a></li>
<li><a href=#Oriented_Circlines-unique_ocircline_01inf>unique_ocircline_01inf</a></li>
<li><a href=#Oriented_Circlines-unique_ocircline_set>unique_ocircline_set</a></li>
<li><a href=#Oriented_Circlines-ocircline_set_0h>ocircline_set_0h</a></li>
</ul>
</li><li><a href=#Circlines_Angle>Circlines_Angle</a>
<ul>
<li><a href=#Circlines_Angle-mat_det_12_mm_l>mat_det_12_mm_l</a></li>
<li><a href=#Circlines_Angle-mat_det_12_mm_r>mat_det_12_mm_r</a></li>
<li><a href=#Circlines_Angle-mat_det_12_sm_l>mat_det_12_sm_l</a></li>
<li><a href=#Circlines_Angle-mat_det_12_sm_r>mat_det_12_sm_r</a></li>
<li><a href=#Circlines_Angle-mat_det_12_congruence>mat_det_12_congruence</a></li>
<li><a href=#Circlines_Angle-cos_angle_den_scale>cos_angle_den_scale</a></li>
<li><a href=#Circlines_Angle-cos_angle_opposite1>cos_angle_opposite1</a></li>
<li><a href=#Circlines_Angle-cos_angle_opposite2>cos_angle_opposite2</a></li>
<li><a href=#Circlines_Angle-Re_sgn>Re_sgn</a></li>
<li><a href=#Circlines_Angle-Re_mult_real3>Re_mult_real3</a></li>
<li><a href=#Circlines_Angle-sgn_sqrt>sgn_sqrt</a></li>
<li><a href=#Circlines_Angle-real_circle_sgn_r>real_circle_sgn_r</a></li>
<li><a href=#Circlines_Angle-cos_angle_eq_cos_ang_circ>cos_angle_eq_cos_ang_circ</a></li>
<li><a href=#Circlines_Angle-perpendicular_sym>perpendicular_sym</a></li>
<li><a href=#Circlines_Angle-moebius_preserve_circline_angle>moebius_preserve_circline_angle</a></li>
<li><a href=#Circlines_Angle-perpendicular_moebius>perpendicular_moebius</a></li>
</ul>
</li><li><a href=#Unit_Circle_Preserving_Moebius>Unit_Circle_Preserving_Moebius</a>
<ul>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_circle_fix_iff>unit_circle_fix_iff</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-circline_set_fix_iff_circline_fix>circline_set_fix_iff_circline_fix</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_circle_fix_iff_unit_circle_set>unit_circle_fix_iff_unit_circle_set</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_circle_fix_id_moebius>unit_circle_fix_id_moebius</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_circle_fix_moebius_add>unit_circle_fix_moebius_add</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_circle_fix_moebius_comp>unit_circle_fix_moebius_comp</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_circle_fix_moebius_uminus>unit_circle_fix_moebius_uminus</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_circle_fix_moebius_inv>unit_circle_fix_moebius_inv</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_circle_fix_moebius_pt_inversion>unit_circle_fix_moebius_pt_inversion</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-imag_unit_circle_fixed_iff_unitary_gen>imag_unit_circle_fixed_iff_unitary_gen</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_unit_circle_fix>unit_disc_fix_unit_circle_fix</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_iff_ounit_circle>unit_disc_fix_iff_ounit_circle</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_iff>unit_disc_fix_iff</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_discI>unit_disc_fix_discI</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_id_moebius>unit_disc_fix_id_moebius</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_moebius_add>unit_disc_fix_moebius_add</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_moebius_comp>unit_disc_fix_moebius_comp</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_moebius_uminus>unit_disc_fix_moebius_uminus</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_moebius_inv>unit_disc_fix_moebius_inv</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_rotation>unit_disc_fix_rotation</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-moebius_rotation_unit_circle_fix>moebius_rotation_unit_circle_fix</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-ex_rotation_mapping_u_to_positive_x_axis>ex_rotation_mapping_u_to_positive_x_axis</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-ex_rotation_mapping_u_to_positive_y_axis>ex_rotation_mapping_u_to_positive_y_axis</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-wlog_rotation_to_positive_x_axis>wlog_rotation_to_positive_x_axis</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-wlog_rotation_to_positive_x_axis%27>wlog_rotation_to_positive_x_axis'</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-wlog_rotation_to_positive_y_axis>wlog_rotation_to_positive_y_axis</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_0_id>blaschke_0_id</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_a_to_zero>blaschke_a_to_zero</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_inv_a_inf>blaschke_inv_a_inf</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_inf>blaschke_inf</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_0_minus_a>blaschke_0_minus_a</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_unit_circle_fix>blaschke_unit_circle_fix</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_unit_disc_fix>blaschke_unit_disc_fix</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_unit_circle_fix%27>blaschke_unit_circle_fix'</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_ounit_circle_fix%27>blaschke_ounit_circle_fix'</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-moebius_pt_blaschke>moebius_pt_blaschke</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_real_preserve_x_axis>blaschke_real_preserve_x_axis</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_real_preserve_sgn_Im>blaschke_real_preserve_sgn_Im</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-blaschke_real_preserve_sgn_arg>blaschke_real_preserve_sgn_arg</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-inv_blaschke_neg>inv_blaschke_neg</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-inv_blaschke>inv_blaschke</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-ex_unit_disc_fix_mapping_u_to_zero>ex_unit_disc_fix_mapping_u_to_zero</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-wlog_zero>wlog_zero</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-wlog_real_zero>wlog_real_zero</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_transitive>unit_disc_fix_transitive</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_decompose_blaschke_rotation>unit_disc_fix_decompose_blaschke_rotation</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-wlog_unit_disc_fix>wlog_unit_disc_fix</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-ex_unit_disc_fix_to_zero_positive_x_axis>ex_unit_disc_fix_to_zero_positive_x_axis</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-wlog_x_axis>wlog_x_axis</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-wlog_positive_x_axis>wlog_positive_x_axis</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_f_unit_disc>unit_disc_fix_f_unit_disc</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_f_moebius_pt>unit_disc_fix_f_moebius_pt</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_conjugate_moebius>unit_disc_fix_conjugate_moebius</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_conjugate_comp_moebius>unit_disc_fix_conjugate_comp_moebius</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_f_comp>unit_disc_fix_f_comp</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_f_inv>unit_disc_fix_f_inv</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unique_moebius_pt_conjugate>unique_moebius_pt_conjugate</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_f_circline_direct>unit_disc_fix_f_circline_direct</a></li>
<li><a href=#Unit_Circle_Preserving_Moebius-unit_disc_fix_f_circline_indirect>unit_disc_fix_f_circline_indirect</a></li>
</ul>
</li><li><a href=#Riemann_Sphere>Riemann_Sphere</a>
<ul>
<li><a href=#Riemann_Sphere-sphere_bounds%27>sphere_bounds'</a></li>
<li><a href=#Riemann_Sphere-sphere_bounds>sphere_bounds</a></li>
<li><a href=#Riemann_Sphere-sphere_params_on_sphere>sphere_params_on_sphere</a></li>
<li><a href=#Riemann_Sphere-sphere_params>sphere_params</a></li>
<li><a href=#Riemann_Sphere-ex_sphere_params>ex_sphere_params</a></li>
<li><a href=#Riemann_Sphere-Re_stereographic>Re_stereographic</a></li>
<li><a href=#Riemann_Sphere-Im_stereographic>Im_stereographic</a></li>
<li><a href=#Riemann_Sphere-inv_stereographic_on_sphere>inv_stereographic_on_sphere</a></li>
<li><a href=#Riemann_Sphere-stereographic_North>stereographic_North</a></li>
<li><a href=#Riemann_Sphere-stereographic_inv_stereographic%27>stereographic_inv_stereographic'</a></li>
<li><a href=#Riemann_Sphere-stereographic_inv_stereographic>stereographic_inv_stereographic</a></li>
<li><a href=#Riemann_Sphere-bij_stereographic>bij_stereographic</a></li>
<li><a href=#Riemann_Sphere-inv_stereographic_stereographic>inv_stereographic_stereographic</a></li>
<li><a href=#Riemann_Sphere-inv_stereographic_is_inv>inv_stereographic_is_inv</a></li>
<li><a href=#Riemann_Sphere-mult_sv_one>mult_sv_one</a></li>
<li><a href=#Riemann_Sphere-mult_sv_distb>mult_sv_distb</a></li>
<li><a href=#Riemann_Sphere-stereographic_circline_inv_stereographic_circline>stereographic_circline_inv_stereographic_circline</a></li>
<li><a href=#Riemann_Sphere-inv_stereographic_circline_stereographic_circline>inv_stereographic_circline_stereographic_circline</a></li>
<li><a href=#Riemann_Sphere-stereographic_sphere_circle_set%27%27>stereographic_sphere_circle_set''</a></li>
<li><a href=#Riemann_Sphere-stereographic_sphere_circle_set%27>stereographic_sphere_circle_set'</a></li>
<li><a href=#Riemann_Sphere-stereographic_sphere_circle_set>stereographic_sphere_circle_set</a></li>
<li><a href=#Riemann_Sphere-bij_stereographic_circline>bij_stereographic_circline</a></li>
<li><a href=#Riemann_Sphere-bij_inv_stereographic_circline>bij_inv_stereographic_circline</a></li>
</ul>
</li><li><a href=#Chordal_Metric>Chordal_Metric</a>
<ul>
<li><a href=#Chordal_Metric-real_inprod_cvec>real_inprod_cvec</a></li>
<li><a href=#Chordal_Metric-inprod_cvec_ge_zero>inprod_cvec_ge_zero</a></li>
<li><a href=#Chordal_Metric-inprod_cvec_bilinear1>inprod_cvec_bilinear1</a></li>
<li><a href=#Chordal_Metric-inprod_cvec_bilinear2>inprod_cvec_bilinear2</a></li>
<li><a href=#Chordal_Metric-inprod_cvec_g_zero>inprod_cvec_g_zero</a></li>
<li><a href=#Chordal_Metric-norm_cvec_square>norm_cvec_square</a></li>
<li><a href=#Chordal_Metric-norm_cvec_gt_0>norm_cvec_gt_0</a></li>
<li><a href=#Chordal_Metric-norm_cvec_scale>norm_cvec_scale</a></li>
<li><a href=#Chordal_Metric-dist_fs_cvec_iff>dist_fs_cvec_iff</a></li>
<li><a href=#Chordal_Metric-dist_fs_finite>dist_fs_finite</a></li>
<li><a href=#Chordal_Metric-dist_fs_infinite1>dist_fs_infinite1</a></li>
<li><a href=#Chordal_Metric-dist_fs_infinite2>dist_fs_infinite2</a></li>
<li><a href=#Chordal_Metric-dist_fs_cvec_zero>dist_fs_cvec_zero</a></li>
<li><a href=#Chordal_Metric-dist_fs_zero1>dist_fs_zero1</a></li>
<li><a href=#Chordal_Metric-dist_fs_zero2>dist_fs_zero2</a></li>
<li><a href=#Chordal_Metric-dist_fs_sym>dist_fs_sym</a></li>
<li><a href=#Chordal_Metric-dist_fs_triangle_finite>dist_fs_triangle_finite</a></li>
<li><a href=#Chordal_Metric-dist_fs_triangle_infinite1>dist_fs_triangle_infinite1</a></li>
<li><a href=#Chordal_Metric-dist_fs_triangle_infinite2>dist_fs_triangle_infinite2</a></li>
<li><a href=#Chordal_Metric-dist_fs_triangle_infinite3>dist_fs_triangle_infinite3</a></li>
<li><a href=#Chordal_Metric-dist_fs_triangle>dist_fs_triangle</a></li>
<li><a href=#Chordal_Metric-dist_riemann_sphere_r3_inner>dist_riemann_sphere_r3_inner</a></li>
<li><a href=#Chordal_Metric-dist_riemann_sphere_ge_0>dist_riemann_sphere_ge_0</a></li>
<li><a href=#Chordal_Metric-dist_stereographic_finite>dist_stereographic_finite</a></li>
<li><a href=#Chordal_Metric-dist_stereographic_infinite>dist_stereographic_infinite</a></li>
<li><a href=#Chordal_Metric-dist_rieman_sphere_zero>dist_rieman_sphere_zero</a></li>
<li><a href=#Chordal_Metric-dist_riemann_sphere_sym>dist_riemann_sphere_sym</a></li>
<li><a href=#Chordal_Metric-dist_stereographic>dist_stereographic</a></li>
<li><a href=#Chordal_Metric-dist_stereographic%27>dist_stereographic'</a></li>
<li><a href=#Chordal_Metric-Lim_within>Lim_within</a></li>
<li><a href=#Chordal_Metric-continuous_on_iff>continuous_on_iff</a></li>
<li><a href=#Chordal_Metric-chordal_circle_cmat_hermitean_nonzero>chordal_circle_cmat_hermitean_nonzero</a></li>
<li><a href=#Chordal_Metric-sqrt_1_plus_square>sqrt_1_plus_square</a></li>
<li><a href=#Chordal_Metric-chordal_circle_radius_positive>chordal_circle_radius_positive</a></li>
<li><a href=#Chordal_Metric-chordal_circle_det_positive>chordal_circle_det_positive</a></li>
<li><a href=#Chordal_Metric-cor_sqrt_squared>cor_sqrt_squared</a></li>
<li><a href=#Chordal_Metric-chordal_circle1>chordal_circle1</a></li>
<li><a href=#Chordal_Metric-chordal_circle2>chordal_circle2</a></li>
<li><a href=#Chordal_Metric-chordal_circle%27>chordal_circle'</a></li>
</ul>
</li>
</ul>
</div>
<ul>
<li><a href=https://www.isa-afp.org/browser_info/current/AFP/Complex_Geometry/outline.pdf>Proof
outline</a></li>
<li><a href=https://www.isa-afp.org/browser_info/current/AFP/Complex_Geometry/document.pdf>Proof
document</a></li>
<li><a href=https://www.isa-afp.org/browser_info/current/AFP/Complex_Geometry/session_graph.pdf>Theory dependencies</a></li>
</ul>
</div>
</aside>
<div class="content theories"><header>
<form action=/%20search>
<div class=form-container>
<input id=searchInput type=search size=31 maxlength=255 aria-label="Search the AFP" list=autocomplete><button id=searchButton type=button><img src=/images/search.svg alt=Search></button>
<datalist id=autocomplete>
</datalist>
</div>
</form>
<h1><span class=first>S</span>ession <span class=first>C</span>omplex_<span class=first>G</span>eometry</h1>
<div>
</div>
</header><div id=banner data-id=0>
<p>This is an unofficial reimagining of the <a href=https://isa-afp.org target=_blank rel="noreferrer noopener">Archive of Formal Proofs</a></p><button style=display:none id=close title=close><svg viewBox="0 0 6.718 6.718" aria-hidden="true" focusable="false"><rect transform="rotate(45)" x="4" y="-4" width="1.5" height="8"/><rect transform="rotate(45)" x=".75" y="-.75" width="8" height="1.5"/></svg></button>
</div>
<div><main>
<div id=More_Transcendental>
<div class=head>
<h1>Theory More_Transcendental</h1>
</div>
<pre class=source><span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Introduction›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The complex plane or some of its parts (e.g., the unit disc or the upper half plane) are often
taken as the domain in which models of various geometries (both Euclidean and non-Euclidean ones)
are formalized. The complex plane gives simpler and more compact formulas than the Cartesian plane.
Within complex plane is easier to describe geometric objects and perform the calculations (usually
shedding some new light on the subject). We give a formalization of the extended complex
plane (given both as a complex projective space and as the Riemann sphere), its objects (points,
circles and lines), and its transformations (Möbius transformations).›</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Related work›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span><span class=quoted><span class=plain_text>‹During the last decade, there have been many results in formalizing
geometry in proof-assistants. Parts of Hilbert’s seminal book
,,Foundations of Geometry'' \cite{hilbert} have been formalized both
in Coq and Isabelle/Isar.  Formalization of first two groups of axioms
in Coq, in an intuitionistic setting was done by Dehlinger et
al. \cite{hilbert-coq}. First formalization in Isabelle/HOL was done
by Fleuriot and Meikele \cite{hilbert-isabelle}, and some further
developments were made in master thesis of Scott \cite{hilbert-scott}.
Large fragments of Tarski's geometry \cite{tarski} have been
formalized in Coq by Narboux et al. \cite{narboux-tarski}. Within Coq,
there are also formalizations of von Plato’s constructive geometry by
Kahn \cite{vonPlato,von-plato-formalization}, French high school
geometry by Guilhot \cite{guilhot} and ruler and compass geometry by
Duprat \cite{duprat2008}, etc.

In our previous work \cite{petrovic2012formalizing}, we have already
formally investigated a Cartesian model of Euclidean geometry. 
›</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Background theories›</span></span> 
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In this section we introduce some basic mathematical notions and prove some lemmas needed in the rest of our
formalization. We describe:

    <span class=antiquoted><span class=antiquoted>▪</span></span> trigonometric functions,

    <span class=antiquoted><span class=antiquoted>▪</span></span> complex numbers, 

    <span class=antiquoted><span class=antiquoted>▪</span></span> systems of two and three linear equations with two unknowns (over arbitrary fields), 

    <span class=antiquoted><span class=antiquoted>▪</span></span> quadratic equations (over real and complex numbers), systems of quadratic and real
      equations, and systems of two quadratic equations,

    <span class=antiquoted><span class=antiquoted>▪</span></span> two-dimensional vectors and matrices over complex numbers.
›</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Library Additions for Trigonometric Functions›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>theory</span></span> More_Transcendental
  <span class=keyword2><span class=keyword>imports</span></span> <a href=https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html>Complex_Main</a> <span class=quoted>"<a href=https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Periodic_Fun.html>HOL-Library.Periodic_Fun</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Additional properties of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>sin</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>cos</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> functions that are later used in proving
conjectures for argument of complex number.›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Sign of trigonometric functions on some characteristic intervals.›</span></span>

<span class=keyword1 id=More_Transcendental-cos_lt_zero_on_pi2_pi><span class=command>lemma</span></span> cos_lt_zero_on_pi2_pi <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&gt;</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≤</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos <span class=free>x</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> cos_gt_zero_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"pi <span class=main>-</span> <span class=free>x</span>"</span></span><span class=main>]</span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Value of trigonometric functions in points $k\pi$ and $\frac{\pi}{2} + k\pi$.›</span></span>

<span class=keyword1 id=More_Transcendental-sin_kpi><span class=command>lemma</span></span> sin_kpi <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span><span class=main>::</span><span class=quoted>int</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sin <span class=main>(</span><span class=free>k</span> <span class=main>*</span> pi<span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sin_zero_iff_int2<span class=main>)</span>

<span class=keyword1 id=More_Transcendental-cos_odd_kpi><span class=command>lemma</span></span> cos_odd_kpi <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span><span class=main>::</span><span class=quoted>int</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"odd <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span><span class=free>k</span> <span class=main>*</span> pi<span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> assms mult.commute<span class=main>)</span>

<span class=keyword1 id=More_Transcendental-cos_even_kpi><span class=command>lemma</span></span> cos_even_kpi <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span><span class=main>::</span><span class=quoted>int</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"even <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span><span class=free>k</span> <span class=main>*</span> pi<span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> assms mult.commute<span class=main>)</span>

<span class=keyword1 id=More_Transcendental-sin_pi2_plus_odd_kpi><span class=command>lemma</span></span> sin_pi2_plus_odd_kpi <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span><span class=main>::</span><span class=quoted>int</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"odd <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sin <span class=main>(</span>pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>+</span> <span class=free>k</span> <span class=main>*</span> pi<span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sin_add<span class=main>)</span>

<span class=keyword1 id=More_Transcendental-sin_pi2_plus_even_kpi><span class=command>lemma</span></span> sin_pi2_plus_even_kpi <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>k</span><span class=main>::</span><span class=quoted>int</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"even <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sin <span class=main>(</span>pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>+</span> <span class=free>k</span> <span class=main>*</span> pi<span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sin_add<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Solving trigonometric equations and systems with special values (0, 1, or -1) of sine and cosine functions›</span></span>

<span class=keyword1 id=More_Transcendental-cos_0_iff_canon><span class=command>lemma</span></span> cos_0_iff_canon<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cos <span class=free>φ</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi <span class=main>&lt;</span> <span class=free>φ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>φ</span> <span class=main>≤</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>φ</span> <span class=main>=</span> pi<span class=main>/</span><span class=numeral>2</span> <span class=main>∨</span> <span class=free>φ</span> <span class=main>=</span> <span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> <span class=main><span class=main>(</span></span>verit<span class=main><span class=main>,</span></span> best<span class=main><span class=main>)</span></span> arccos_0 arccos_cos assms cos_minus divide_minus_left<span class=main>)</span>

<span class=keyword1 id=More_Transcendental-sin_0_iff_canon><span class=command>lemma</span></span> sin_0_iff_canon<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"sin <span class=free>φ</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi <span class=main>&lt;</span> <span class=free>φ</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>φ</span> <span class=main>≤</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>φ</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>φ</span> <span class=main>=</span> pi"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms sin_eq_0_pi <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=More_Transcendental-cos0_sin1><span class=command>lemma</span></span> cos0_sin1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"sin <span class=free>φ</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=free>φ</span> <span class=main>=</span> pi<span class=main>/</span><span class=numeral>2</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=bound>k</span><span class=main>*</span>pi"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> <span class=main><span class=main>(</span></span>verit<span class=main><span class=main>,</span></span> ccfv_threshold<span class=main><span class=main>)</span></span> assms cos_diff cos_one_2pi_int cos_pi_half mult_cancel_right1 sin_pi_half sin_plus_pi<span class=main>)</span>

<span class=comment1>(* TODO: add lemmas for cos = -1, sin = 0 and cos = 0, sin = -1 *)</span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Sine is injective on $[-\frac{\pi}{2}, \frac{\pi}{2}]$›</span></span>

<span class=keyword1 id=More_Transcendental-sin_inj><span class=command>lemma</span></span> sin_inj<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=main>≤</span> <span class=free>α</span> <span class=main>∧</span> <span class=free>α</span> <span class=main>≤</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=main>≤</span> <span class=free>α'</span> <span class=main>∧</span> <span class=free>α'</span> <span class=main>≤</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>≠</span> <span class=free>α'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sin <span class=free>α</span> <span class=main>≠</span> sin <span class=free>α'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms divide_minus_left sin_inj_pi<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Periodicity of trigonometric functions›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The following are available in HOL-Decision\_Procs.Approximation\_Bounds, but we want to avoid
that dependency›</span></span>

<span class=keyword1 id=More_Transcendental-sin_periodic_nat><span class=command>lemma</span></span> sin_periodic_nat <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sin <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> pi<span class=main>)</span><span class=main>)</span> <span class=main>=</span> sin <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> hide_lams<span class=main><span class=main>)</span></span> add.commute add.left_neutral cos_2npi cos_one_2pi_int mult.assoc mult.commute mult.left_neutral mult_zero_left sin_add sin_int_2pin<span class=main>)</span>

<span class=keyword1 id=More_Transcendental-sin_periodic_int><span class=command>lemma</span></span> sin_periodic_int <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sin <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>i</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> pi<span class=main>)</span><span class=main>)</span> <span class=main>=</span> sin <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.right_neutral cos_int_2pin mult.commute mult.right_neutral mult_zero_right sin_add sin_int_2pin<span class=main>)</span>

<span class=keyword1 id=More_Transcendental-cos_periodic_nat><span class=command>lemma</span></span> cos_periodic_nat <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>n</span> <span class=main>::</span> <span class=quoted>nat</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>n</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> pi<span class=main>)</span><span class=main>)</span> <span class=main>=</span> cos <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.left_neutral cos_2npi cos_add cos_periodic mult.assoc mult_2 mult_2_right of_nat_numeral sin_periodic sin_periodic_nat<span class=main>)</span>

<span class=keyword1 id=More_Transcendental-cos_periodic_int><span class=command>lemma</span></span> cos_periodic_int <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>i</span> <span class=main>::</span> <span class=quoted>int</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>i</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> pi<span class=main>)</span><span class=main>)</span> <span class=main>=</span> cos <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> cos_add cos_int_2pin diff_zero mult.commute mult.right_neutral mult_zero_right sin_int_2pin<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Values of both sine and cosine are repeated only after multiples of $2\cdot \pi$›</span></span>

<span class=keyword1 id=More_Transcendental-sin_cos_eq><span class=command>lemma</span></span> sin_cos_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=free>b</span> <span class=main>::</span> <span class=quoted>real</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cos <span class=free>a</span> <span class=main>=</span> cos <span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"sin <span class=free>a</span> <span class=main>=</span> sin <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=free>a</span> <span class=main>-</span> <span class=free>b</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=bound>k</span><span class=main>*</span>pi"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms cos_diff cos_one_2pi_int mult.commute sin_cos_squared_add3<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The following two lemmas are consequences of surjectivity of cosine for the range $[-1, 1]$.›</span></span>

<span class=keyword1 id=More_Transcendental-ex_cos_eq><span class=command>lemma</span></span> ex_cos_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=main>≤</span> <span class=free>α</span> <span class=main>∧</span> <span class=free>α</span> <span class=main>≤</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≥</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>α'</span><span class=main>.</span> <span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=main>≤</span> <span class=bound>α'</span> <span class=main>∧</span> <span class=bound>α'</span> <span class=main>≤</span> pi<span class=main>/</span><span class=numeral>2</span> <span class=main>∧</span> <span class=bound>α'</span> <span class=main>≠</span> <span class=free>α</span> <span class=main>∧</span> cos <span class=main>(</span><span class=free>α</span> <span class=main>-</span> <span class=bound>α'</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"arccos <span class=free>a</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"arccos <span class=free>a</span> <span class=main>≤</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≥</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> arccos_lt_bounded arccos_le_pi2
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>-</span> arccos <span class=free>a</span> <span class=main>≥</span> <span class=main>-</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‹arccos <span class=free>a</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹arccos <span class=free>a</span> <span class=main>≤</span> pi<span class=main>/</span><span class=numeral>2</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>-</span> arccos <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‹arccos <span class=free>a</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹arccos <span class=free>a</span> <span class=main>≤</span> pi<span class=main>/</span><span class=numeral>2</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x <span class=main><span class=main>=</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>+</span> arccos <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Transcendental-ex_cos_gt><span class=command>lemma</span></span> ex_cos_gt<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=main>≤</span> <span class=free>α</span> <span class=main>∧</span> <span class=free>α</span> <span class=main>≤</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>α'</span><span class=main>.</span> <span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=main>≤</span> <span class=bound>α'</span> <span class=main>∧</span> <span class=bound>α'</span> <span class=main>≤</span> pi<span class=main>/</span><span class=numeral>2</span> <span class=main>∧</span> <span class=bound>α'</span> <span class=main>≠</span> <span class=free>α</span> <span class=main>∧</span> cos <span class=main>(</span><span class=free>α</span> <span class=main>-</span> <span class=bound>α'</span><span class=main>)</span> <span class=main>&gt;</span> <span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>≥</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>&gt;</span> <span class=free>a</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> dense_le_bounded linear not_one_le_zero<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> ex_cos_eq<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>α</span></span> <span class=quoted><span class=skolem>a'</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The function <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>atan2</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> is a generalization of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>arctan</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> that takes a pair of coordinates
of non-zero points returns its angle in the range $[-\pi, \pi)$.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>atan2</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>atan2</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>&gt;</span> <span class=main>0</span> <span class=keyword1>then</span> arctan <span class=main>(</span><span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>/</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span>
     <span class=keyword1>else</span> <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=main>&lt;</span> <span class=main>0</span> <span class=keyword1>then</span>
          <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>&gt;</span> <span class=main>0</span> <span class=keyword1>then</span> arctan <span class=main>(</span><span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>/</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span> <span class=main>+</span> pi <span class=keyword1>else</span> arctan <span class=main>(</span><span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>/</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>)</span> <span class=main>-</span> pi
     <span class=keyword1>else</span>
          <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>&gt;</span> <span class=main>0</span> <span class=keyword1>then</span> pi<span class=main>/</span><span class=numeral>2</span> <span class=keyword1>else</span> <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>&lt;</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=keyword1>else</span> <span class=main>0</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=More_Transcendental-atan2_bounded><span class=command>lemma</span></span> atan2_bounded<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi <span class=main>≤</span> atan2 <span class=free>y</span> <span class=free>x</span> <span class=main>∧</span> atan2 <span class=free>y</span> <span class=free>x</span> <span class=main>&lt;</span> pi"</span></span>
  <span class=keyword1><span class=command>using</span></span> arctan_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>y</span><span class=main>/</span><span class=free>x</span>"</span></span><span class=main>]</span> zero_le_arctan_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>y</span><span class=main>/</span><span class=free>x</span>"</span></span><span class=main>]</span> arctan_le_zero_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>y</span><span class=main>/</span><span class=free>x</span>"</span></span><span class=main>]</span> zero_less_arctan_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>y</span><span class=main>/</span><span class=free>x</span>"</span></span><span class=main>]</span> arctan_less_zero_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>y</span><span class=main>/</span><span class=free>x</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> divide_neg_neg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> divide_neg_pos<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> divide_pos_pos<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span> <span class=quoted><span class=free>x</span></span><span class=main>]</span>  divide_pos_neg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span> <span class=quoted><span class=free>x</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> atan2_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>no_asm_simp</span><span class=main><span class=main>)</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Canonical_Angle>
<div class=head>
<h1>Theory Canonical_Angle</h1>
</div>
<pre class=source><span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Canonical angle›</span></span> 
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonize any angle to $(-\pi, \pi]$ (taking account of $2\pi$ periodicity of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>sin</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> and
<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>cos</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>). With this function, for example, multiplicative properties of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>arg</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> for complex
numbers can easily be expressed and proved.›</span></span>

<span class=keyword1><span class=command>theory</span></span> Canonical_Angle
<span class=keyword2><span class=keyword>imports</span></span> <a href=#More_Transcendental>More_Transcendental</a>
<span class=keyword2><span class=keyword>begin</span></span>


<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>canon_ang_P</span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>canon_ang_P</span> <span class=free><span class=bound><span class=entity>α</span></span></span> <span class=free><span class=bound><span class=entity>α'</span></span></span> <span class=main>≡</span> <span class=main>(</span><span class=main>-</span>pi <span class=main>&lt;</span> <span class=free><span class=bound><span class=entity>α'</span></span></span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>α'</span></span></span> <span class=main>≤</span> pi<span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=free><span class=bound><span class=entity>α</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>α'</span></span></span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=bound>k</span><span class=main>*</span>pi<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>canon_ang</span> <span class=main>::</span> <span class=quoted><span class=quoted>"real <span class=main>⇒</span> real"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>⇂</span>_<span class=keyword1>⇃</span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main><span class=free>⇂</span></span><span class=free><span class=bound><span class=entity>α</span></span></span><span class=main><span class=free>⇃</span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>α'</span><span class=main>.</span> canon_ang_P <span class=free><span class=bound><span class=entity>α</span></span></span> <span class=bound>α'</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹There is a canonical angle for every angle.›</span></span>
<span class=keyword1 id=Canonical_Angle-canon_ang_ex><span class=command>lemma</span></span> canon_ang_ex<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>α'</span><span class=main>.</span> canon_ang_P <span class=free>α</span> <span class=bound>α'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span> <span class=bound>α</span><span class=main>::</span>real<span class=main>.</span> <span class=main>∃</span> <span class=bound>α'</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>α'</span> <span class=main>∧</span> <span class=bound>α'</span> <span class=main>≤</span> <span class=main>1</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=bound>α'</span> <span class=main>=</span> <span class=bound>α</span> <span class=main>-</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>α</span><span class=main>::</span><span class=quoted>real</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound><span class=bound>α'</span></span><span class=main>&gt;</span><span class=main>0</span><span class=main>.</span> <span class=bound>α'</span> <span class=main>≤</span> <span class=main>1</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span><span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=bound>α'</span> <span class=main>=</span> <span class=skolem>α</span> <span class=main>-</span> <span class=bound>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>α</span> <span class=main>=</span> floor <span class=skolem>α</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>α</span> <span class=main>-</span> floor <span class=skolem>α</span> <span class=main>+</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"floor <span class=skolem>α</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> real_of_int_floor_ge_diff_one<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>α</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> of_int_floor_le<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>α</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>α</span> <span class=main>-</span> floor <span class=skolem>α</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>smt</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span> <span class=bound>α</span><span class=main>::</span>real<span class=main>.</span> <span class=main>∃</span> <span class=bound>α'</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=bound>α'</span> <span class=main>∧</span> <span class=bound>α'</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=bound>α</span> <span class=main>-</span> <span class=bound>α'</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=bound>k</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>α</span><span class=main>::</span><span class=quoted>real</span>
    <span class=keyword1><span class=command>from</span></span> ***<span class=main>[</span><span class=operator>rule_format</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>α</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>/</span><span class=numeral>2</span>"</span></span><span class=main>]</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>α'</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem><span class=skolem>k</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=skolem>α'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>α'</span> <span class=main>≤</span> <span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>α'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>α</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span><span class=main>/</span><span class=numeral>2</span> <span class=main>-</span> <span class=skolem>k</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=skolem>α'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>α'</span> <span class=main>≤</span> <span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>α'</span> <span class=main>=</span> <span class=skolem>α</span><span class=main>/</span><span class=numeral>2</span> <span class=main>-</span> <span class=skolem>k</span> <span class=main>+</span> <span class=main>1</span><span class=main>/</span><span class=numeral>2</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound><span class=bound>α'</span></span><span class=main>&gt;</span><span class=main>0</span><span class=main>.</span> <span class=bound>α'</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span><span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=skolem>α</span> <span class=main>-</span> <span class=bound>α'</span> <span class=main>=</span> real_of_int <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=bound>k</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span><span class=skolem>α'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span> <span class=bound>α</span><span class=main>::</span>real<span class=main>.</span> <span class=main>∃</span> <span class=bound>α'</span><span class=main>.</span> <span class=main>-</span><span class=main>1</span> <span class=main>&lt;</span> <span class=bound>α'</span> <span class=main>∧</span> <span class=bound>α'</span> <span class=main>≤</span> <span class=main>1</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=bound>α</span> <span class=main>-</span> <span class=bound>α'</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=bound>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>α</span><span class=main>::</span><span class=quoted>real</span>
    <span class=keyword1><span class=command>from</span></span> ** <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>α'</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span>
      <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=skolem>α'</span> <span class=main>∧</span> <span class=skolem>α'</span> <span class=main>≤</span> <span class=numeral>2</span> <span class=main>∧</span> <span class=skolem>α</span> <span class=main>-</span> <span class=skolem>α'</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k</span> <span class=main>-</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound><span class=bound>α'</span></span><span class=main>&gt;</span><span class=main>-</span><span class=main>1</span><span class=main>.</span> <span class=bound>α'</span> <span class=main>≤</span> <span class=main>1</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span><span class=bound>k</span><span class=main>.</span> <span class=skolem>α</span> <span class=main>-</span> <span class=bound>α'</span> <span class=main>=</span> real_of_int <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=bound>k</span><span class=main>::</span>int<span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>α'</span> <span class=main>-</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>α'</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>α'</span> <span class=main>&gt;</span><span class=main>-</span> <span class=main>1</span> <span class=main>∧</span> <span class=skolem>α'</span> <span class=main>≤</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>/</span> pi <span class=main>-</span> <span class=skolem>α'</span> <span class=main>=</span> real_of_int <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *<span class=main>[</span><span class=operator>rule_format</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>/</span> pi"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>α'</span><span class=main>*</span>pi <span class=main>&gt;</span> <span class=main>-</span>pi <span class=main>∧</span> <span class=skolem>α'</span><span class=main>*</span>pi <span class=main>≤</span> pi"</span></span> 
    <span class=keyword1><span class=command>using</span></span> 1
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> mult.commute mult_le_cancel_left1 mult_minus_right pi_gt_zero<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>-</span> <span class=skolem>α'</span><span class=main>*</span>pi <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> real_of_int <span class=skolem>k</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> 2
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonical angle of any angle is unique.›</span></span>
<span class=keyword1 id=Canonical_Angle-canon_ang_unique><span class=command>lemma</span></span> canon_ang_unique<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"canon_ang_P <span class=free>α</span> <span class=free>α<span class=hidden>⇩</span><sub>1</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"canon_ang_P <span class=free>α</span> <span class=free>α<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=free>α<span class=hidden>⇩</span><sub>2</sub></span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k1</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>-</span> <span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k1</span><span class=main>*</span>pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k2</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>-</span> <span class=free>α<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k2</span><span class=main>*</span>pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>+</span> <span class=free>α<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=main>(</span><span class=skolem>k1</span> <span class=main>-</span> <span class=skolem>k2</span><span class=main>)</span><span class=main>*</span>pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>α</span> <span class=main>-</span> <span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k1</span><span class=main>*</span>pi›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>+</span> <span class=free>α<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>&lt;</span> <span class=numeral>2</span> <span class=main>*</span> pi"</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>+</span> <span class=free>α<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>&gt;</span> <span class=main>-</span><span class=numeral>2</span><span class=main>*</span>pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>+</span> <span class=free>α<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> mult_less_cancel_right<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>2</span>"</span></span> <span class=quoted>pi</span> <span class=quoted><span class=quoted>"real_of_int<span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>k1</span> <span class=main>-</span> <span class=skolem>k2</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonical angle is always in $(-\pi, \pi]$ and differs from the starting angle by $2k\pi$.›</span></span>
<span class=keyword1 id=Canonical_Angle-canon_ang><span class=command>lemma</span></span> canon_ang<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi <span class=main>&lt;</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>≤</span> pi"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=free>α</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=bound>k</span><span class=main>*</span>pi"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>α'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"canon_ang_P <span class=free>α</span> <span class=skolem>α'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_ex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>α</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"canon_ang_P <span class=free>α</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> canon_ang_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> theI<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> a<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=skolem><span class=skolem>α'</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"canon_ang_P <span class=free>α</span> <span class=skolem>α'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fact</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>α''</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"canon_ang_P <span class=free>α</span> <span class=skolem>α''</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>α''</span> <span class=main>=</span> <span class=skolem>α'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹canon_ang_P <span class=free>α</span> <span class=skolem>α'</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> canon_ang_unique<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>α'</span></span> <span class=quoted><span class=free>α</span></span> <span class=quoted><span class=skolem>α''</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi <span class=main>&lt;</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>≤</span> pi"</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=free>α</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=bound>k</span><span class=main>*</span>pi"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Angles in $(-\pi, \pi]$ are already canonical.›</span></span>
<span class=keyword1 id=Canonical_Angle-canon_ang_id><span class=command>lemma</span></span> canon_ang_id<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span>  <span class=quoted><span class=quoted>"<span class=main>-</span>pi <span class=main>&lt;</span> <span class=free>α</span> <span class=main>∧</span> <span class=free>α</span> <span class=main>≤</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> <span class=free>α</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> canon_ang_unique<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"canon_ang <span class=free>α</span>"</span></span> <span class=quoted><span class=free>α</span></span> <span class=quoted><span class=free>α</span></span><span class=main>]</span> canon_ang<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>α</span></span></span></span></span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Angles that differ by $2k\pi$ have equal canonical angles.›</span></span>
<span class=keyword1 id=Canonical_Angle-canon_ang_eq><span class=command>lemma</span></span> canon_ang_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>-</span> <span class=free>α<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=bound>k</span><span class=main>*</span>pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span><span class=main>⇃</span> <span class=main>=</span> <span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>2</sub></span><span class=main>⇃</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span> pi <span class=main>&lt;</span> <span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span><span class=main>⇃</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span><span class=main>⇃</span> <span class=main>≤</span> pi"</span></span> <span class=quoted><span class=quoted>"<span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=skolem>k'</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span></span></span></span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k''</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span> pi <span class=main>&lt;</span> <span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>2</sub></span><span class=main>⇃</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>2</sub></span><span class=main>⇃</span> <span class=main>≤</span> pi"</span></span> <span class=quoted><span class=quoted>"<span class=free>α<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>2</sub></span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=skolem>k''</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>α<span class=hidden>⇩</span><sub>2</sub></span></span></span></span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>-</span> <span class=free>α<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k</span><span class=main>*</span>pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>m</span><span class=main>::</span>int<span class=main>.</span> <span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>2</sub></span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>m</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> **<span class=main>(</span>3<span class=main>)</span> ***
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k</span><span class=main>+</span><span class=skolem>k''</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_unique<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span><span class=main>⇃</span>"</span></span> <span class=quoted><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>2</sub></span><span class=main>⇃</span>"</span></span><span class=main>]</span> * **
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Introduction and elimination rules›</span></span>
<span class=keyword1 id=Canonical_Angle-canon_ang_eqI><span class=command>lemma</span></span> canon_ang_eqI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=free>α'</span> <span class=main>-</span> <span class=free>α</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>k</span> <span class=main>*</span> pi"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> pi <span class=main>&lt;</span> <span class=free>α'</span> <span class=main>∧</span> <span class=free>α'</span> <span class=main>≤</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> <span class=free>α'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> canon_ang_eq<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>α'</span></span> <span class=quoted><span class=free>α</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> canon_ang_id<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>α'</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Canonical_Angle-canon_ang_eqE><span class=command>lemma</span></span> canon_ang_eqE<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span><span class=main>⇃</span> <span class=main>=</span> <span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>2</sub></span><span class=main>⇃</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=main>(</span><span class=bound>k</span><span class=main>::</span>int<span class=main>)</span><span class=main>.</span> <span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>-</span> <span class=free>α<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span><span class=bound>k</span> <span class=main>*</span> pi"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k1</span></span> <span class=skolem><span class=skolem>k2</span></span> <span class=main>::</span> <span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=free>α<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=skolem>k1</span> <span class=main>*</span> pi"</span></span>
    <span class=quoted><span class=quoted>"<span class=free>α<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α<span class=hidden>⇩</span><sub>2</sub></span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=skolem>k2</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>α<span class=hidden>⇩</span><sub>1</sub></span></span></span></span></span></span><span class=main>]</span> canon_ang<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>α<span class=hidden>⇩</span><sub>2</sub></span></span></span></span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k1</span> <span class=main>-</span> <span class=skolem>k2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonical angle of opposite angle›</span></span>

<span class=keyword1 id=Canonical_Angle-canon_ang_uminus><span class=command>lemma</span></span> canon_ang_uminus<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>≠</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=main>-</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> <span class=main>-</span><span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> canon_ang_eqI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>::</span>int<span class=main>.</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>-</span> <span class=main>-</span> <span class=free>α</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>x</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>α</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> minus_diff_eq minus_diff_minus<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> pi <span class=main>&lt;</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>∧</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>≤</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>α</span></span><span class=main>]</span> canon_ang<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>α</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Canonical_Angle-canon_ang_uminus_pi><span class=command>lemma</span></span> canon_ang_uminus_pi<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=main>-</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> canon_ang_eqI<span class=main>)</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=skolem>k</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>α</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>::</span>int<span class=main>.</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>-</span> <span class=main>-</span> <span class=free>α</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>x</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k</span><span class=main>+</span><span class=main>(</span><span class=main>1</span><span class=main>::</span>int<span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> pi <span class=main>&lt;</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>∧</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>≤</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonical angle of difference of two angles›</span></span>
<span class=keyword1 id=Canonical_Angle-canon_ang_diff><span class=command>lemma</span></span> canon_ang_diff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span> <span class=main>-</span> <span class=free>β</span><span class=main>⇃</span> <span class=main>=</span> <span class=main>⇂</span><span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>β</span><span class=main>⇃</span><span class=main>⇃</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> canon_ang_eq<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>::</span>int<span class=main>.</span> <span class=free>α</span> <span class=main>-</span> <span class=free>β</span> <span class=main>-</span> <span class=main>(</span><span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>β</span><span class=main>⇃</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>x</span> <span class=main>*</span> pi"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k1</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k1</span><span class=main>*</span>pi"</span></span>
      <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k2</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>β</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>β</span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k2</span><span class=main>*</span>pi"</span></span>
      <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k1</span> <span class=main>-</span> <span class=skolem>k2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonical angle of sum of two angles›</span></span>
<span class=keyword1 id=Canonical_Angle-canon_ang_sum><span class=command>lemma</span></span> canon_ang_sum<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span> <span class=main>+</span> <span class=free>β</span><span class=main>⇃</span> <span class=main>=</span> <span class=main>⇂</span><span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>+</span> <span class=main>⇂</span><span class=free>β</span><span class=main>⇃</span><span class=main>⇃</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> canon_ang_eq<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>::</span>int<span class=main>.</span> <span class=free>α</span> <span class=main>+</span> <span class=free>β</span> <span class=main>-</span> <span class=main>(</span><span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>+</span> <span class=main>⇂</span><span class=free>β</span><span class=main>⇃</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>x</span> <span class=main>*</span> pi"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k1</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k1</span><span class=main>*</span>pi"</span></span>
      <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k2</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>β</span> <span class=main>-</span> <span class=main>⇂</span><span class=free>β</span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k2</span><span class=main>*</span>pi"</span></span>
      <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>3<span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k1</span> <span class=main>+</span> <span class=skolem>k2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonical angle of angle from $(0, 2\pi]$ shifted by $\pi$›</span></span>

<span class=keyword1 id=Canonical_Angle-canon_ang_plus_pi1><span class=command>lemma</span></span> canon_ang_plus_pi1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>α</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>≤</span> <span class=numeral>2</span><span class=main>*</span>pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span> <span class=main>+</span> pi<span class=main>⇃</span> <span class=main>=</span> <span class=free>α</span> <span class=main>-</span> pi"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> canon_ang_eqI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>x</span><span class=main>::</span>int<span class=main>.</span> <span class=free>α</span> <span class=main>-</span> pi <span class=main>-</span> <span class=main>(</span><span class=free>α</span> <span class=main>+</span> pi<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>x</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> pi <span class=main>&lt;</span> <span class=free>α</span> <span class=main>-</span> pi <span class=main>∧</span> <span class=free>α</span> <span class=main>-</span> pi <span class=main>≤</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Canonical_Angle-canon_ang_minus_pi1><span class=command>lemma</span></span> canon_ang_minus_pi1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=free>α</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>≤</span> <span class=numeral>2</span><span class=main>*</span>pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span> <span class=main>-</span> pi<span class=main>⇃</span> <span class=main>=</span> <span class=free>α</span> <span class=main>-</span> pi"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> canon_ang_id<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> pi <span class=main>&lt;</span> <span class=free>α</span> <span class=main>-</span> pi <span class=main>∧</span> <span class=free>α</span> <span class=main>-</span> pi <span class=main>≤</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonical angle of angles from $(-2\pi, 0]$ shifted by $\pi$›</span></span>

<span class=keyword1 id=Canonical_Angle-canon_ang_plus_pi2><span class=command>lemma</span></span> canon_ang_plus_pi2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>2</span><span class=main>*</span>pi <span class=main>&lt;</span> <span class=free>α</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>≤</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span> <span class=main>+</span> pi<span class=main>⇃</span> <span class=main>=</span> <span class=free>α</span> <span class=main>+</span> pi"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> canon_ang_id<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> pi <span class=main>&lt;</span> <span class=free>α</span> <span class=main>+</span> pi <span class=main>∧</span> <span class=free>α</span> <span class=main>+</span> pi <span class=main>≤</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Canonical_Angle-canon_ang_minus_pi2><span class=command>lemma</span></span> canon_ang_minus_pi2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>2</span><span class=main>*</span>pi <span class=main>&lt;</span> <span class=free>α</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>≤</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span> <span class=main>-</span> pi<span class=main>⇃</span> <span class=main>=</span> <span class=free>α</span> <span class=main>+</span> pi"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> canon_ang_eqI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>x</span><span class=main>::</span>int<span class=main>.</span> <span class=free>α</span> <span class=main>+</span> pi <span class=main>-</span> <span class=main>(</span><span class=free>α</span> <span class=main>-</span> pi<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>x</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> pi <span class=main>&lt;</span> <span class=free>α</span> <span class=main>+</span> pi <span class=main>∧</span> <span class=free>α</span> <span class=main>+</span> pi <span class=main>≤</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonical angle of angle in $(\pi, 3\pi]$.›</span></span>
<span class=keyword1 id=Canonical_Angle-canon_ang_pi_3pi><span class=command>lemma</span></span> canon_ang_pi_3pi<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"pi <span class=main>&lt;</span> <span class=free>α</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>≤</span> <span class=numeral>3</span> <span class=main>*</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> <span class=free>α</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span>pi"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=main>-</span> pi <span class=main>=</span> pi <span class=main>*</span> real_of_int <span class=bound>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms canon_ang_eqI<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span>pi"</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonical angle of angle in $(-3\pi, -\pi]$.›</span></span>
<span class=keyword1 id=Canonical_Angle-canon_ang_minus_3pi_minus_pi><span class=command>lemma</span></span> canon_ang_minus_3pi_minus_pi<span class=main>:</span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>3</span><span class=main>*</span>pi <span class=main>&lt;</span> <span class=free>α</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>≤</span> <span class=main>-</span>pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> <span class=free>α</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>pi"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> pi <span class=main>=</span> pi <span class=main>*</span> real_of_int <span class=bound>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms canon_ang_eqI<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>pi"</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonical angles for some special angles›</span></span>

<span class=keyword1 id=Canonical_Angle-zero_canonical><span class=command>lemma</span></span> zero_canonical <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=main>0</span><span class=main>⇃</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> canon_ang_eqI<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=main>0</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Canonical_Angle-pi_canonical><span class=command>lemma</span></span> pi_canonical <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span>pi<span class=main>⇃</span> <span class=main>=</span> pi"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> canon_ang_id<span class=main>)</span>

<span class=keyword1 id=Canonical_Angle-two_pi_canonical><span class=command>lemma</span></span> two_pi_canonical <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=numeral>2</span> <span class=main>*</span> pi<span class=main>⇃</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> canon_ang_plus_pi1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"pi"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Canonization preserves sine and cosine›</span></span>
<span class=keyword1 id=Canonical_Angle-canon_ang_sin><span class=command>lemma</span></span> canon_ang_sin <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sin <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> sin <span class=free>α</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>=</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>+</span> pi <span class=main>*</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>α</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> sin_periodic_int<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span>"</span></span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Canonical_Angle-canon_ang_cos><span class=command>lemma</span></span> canon_ang_cos <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>=</span> cos <span class=free>α</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>=</span> <span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span> <span class=main>+</span> pi <span class=main>*</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>α</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cos_periodic_int<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=free>α</span><span class=main>⇃</span>"</span></span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=More_Complex>
<div class=head>
<h1>Theory More_Complex</h1>
</div>
<pre class=source><span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Library Additions for Complex Numbers›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Some additional lemmas about complex numbers.›</span></span>

<span class=keyword1><span class=command>theory</span></span> More_Complex
  <span class=keyword2><span class=keyword>imports</span></span> <a href=https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Complex_Main.html>Complex_Main</a> <a href=#More_Transcendental>More_Transcendental</a> <a href=#Canonical_Angle>Canonical_Angle</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Conjugation and <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>cis</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>›</span></span>
          
<span class=keyword1><span class=command>declare</span></span> cis_cnj<span class=main>[</span><span class=operator>simp</span><span class=main>]</span> 

<span class=keyword1 id=More_Complex-rcis_cnj><span class=command>lemma</span></span> rcis_cnj<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnj <span class=free>a</span> <span class=main>=</span> rcis <span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span> arg <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> rcis_cmod_arg<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rcis_def<span class=main>)</span>

<span class=keyword1><span class=command>lemmas</span></span> complex_cnj <span class=main>=</span> complex_cnj_diff complex_cnj_mult complex_cnj_add complex_cnj_divide complex_cnj_minus

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Some properties for <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>complex_of_real</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>. Also, since it is often used in our
formalization we abbreviate it to <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>cor</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>cor</span> <span class=main>::</span> <span class=quoted><span class=quoted>"real <span class=main>⇒</span> complex"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>cor</span> <span class=main>≡</span> complex_of_real"</span></span>

<span class=keyword1 id=More_Complex-cmod_cis><span class=command>lemma</span></span> cmod_cis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span> <span class=main>*</span> cis <span class=main>(</span>arg <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> rcis_cmod_arg rcis_def<span class=main>)</span>

<span class=keyword1 id=More_Complex-cis_cmod><span class=command>lemma</span></span> cis_cmod <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cis <span class=main>(</span>arg <span class=free>a</span><span class=main>)</span> <span class=main>*</span> cor <span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms cmod_cis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=More_Complex-cor_squared><span class=command>lemma</span></span> cor_squared<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cor <span class=free>x</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> cor <span class=main>(</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>

<span class=keyword1 id=More_Complex-cor_sqrt_mult_cor_sqrt><span class=command>lemma</span></span> cor_sqrt_mult_cor_sqrt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>sqrt <span class=free>A</span><span class=main>)</span> <span class=main>*</span> cor <span class=main>(</span>sqrt <span class=free>A</span><span class=main>)</span> <span class=main>=</span> cor <span class=main>¦</span><span class=free>A</span><span class=main>¦</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> of_real_mult real_sqrt_mult_self<span class=main>)</span>

<span class=keyword1 id=More_Complex-cor_eq_0><span class=command>lemma</span></span> cor_eq_0<span class=main>:</span> <span class=quoted><span class=quoted>"cor <span class=free>x</span> <span class=main>+</span> <span class=keyword1>𝗂</span> <span class=main>*</span> cor <span class=free>y</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
 <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Complex_eq Im_complex_of_real Im_i_times Re_complex_of_real add_cancel_left_left of_real_eq_0_iff plus_complex.sel<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> zero_complex.code<span class=main>)</span>

<span class=keyword1 id=More_Complex-one_plus_square_neq_zero><span class=command>lemma</span></span> one_plus_square_neq_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cor <span class=free>x</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>hide_lams<span class=main><span class=main>,</span></span> no_types<span class=main><span class=main>)</span></span> of_real_1 of_real_add of_real_eq_0_iff of_real_power power_one sum_power2_eq_zero_iff zero_neq_one<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Additional lemmas about <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>Complex</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> constructor. Following newer versions of Isabelle,
these should be deprecated.›</span></span>

<span class=keyword1 id=More_Complex-complex_real_two><span class=command>lemma</span></span> complex_real_two <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Complex <span class=numeral>2</span> <span class=main>0</span> <span class=main>=</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>

<span class=keyword1 id=More_Complex-complex_double><span class=command>lemma</span></span> complex_double <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Complex <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>=</span> Complex <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=free>a</span><span class=main>)</span> <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>

<span class=keyword1 id=More_Complex-complex_half><span class=command>lemma</span></span> complex_half <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Complex <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span> <span class=main>=</span> Complex <span class=main>(</span><span class=free>a</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span> <span class=main>(</span><span class=free>b</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_eq_iff<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=More_Complex-Complex_scale1><span class=command>lemma</span></span> Complex_scale1<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Complex <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span> <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> cor <span class=free>a</span> <span class=main>*</span> Complex <span class=free>b</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> complex_of_real_def
  <span class=keyword1><span class=command>unfolding</span></span> Complex_eq
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=More_Complex-Complex_scale2><span class=command>lemma</span></span> Complex_scale2<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Complex <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>(</span><span class=free>b</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> Complex <span class=free>a</span> <span class=free>b</span> <span class=main>*</span> cor <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> complex_of_real_def
  <span class=keyword1><span class=command>unfolding</span></span> Complex_eq
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=More_Complex-Complex_scale3><span class=command>lemma</span></span> Complex_scale3<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Complex <span class=main>(</span><span class=free>a</span> <span class=main>/</span> <span class=free>b</span><span class=main>)</span> <span class=main>(</span><span class=free>a</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> cor <span class=free>a</span> <span class=main>*</span> Complex <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>b</span><span class=main>)</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> complex_of_real_def
  <span class=keyword1><span class=command>unfolding</span></span> Complex_eq
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=More_Complex-Complex_scale4><span class=command>lemma</span></span> Complex_scale4<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟹</span> Complex <span class=main>(</span><span class=free>a</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span> <span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> Complex <span class=free>a</span> <span class=free>b</span> <span class=main>/</span> cor <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> complex_of_real_def
  <span class=keyword1><span class=command>unfolding</span></span> Complex_eq
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>

<span class=keyword1 id=More_Complex-Complex_Re_express_cnj><span class=command>lemma</span></span> Complex_Re_express_cnj<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Complex <span class=main>(</span>Re <span class=free>z</span><span class=main>)</span> <span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=free>z</span> <span class=main>+</span> cnj <span class=free>z</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>

<span class=keyword1 id=More_Complex-Complex_Im_express_cnj><span class=command>lemma</span></span> Complex_Im_express_cnj<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Complex <span class=main>0</span> <span class=main>(</span>Im <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>z</span> <span class=main>-</span> cnj <span class=free>z</span><span class=main>)</span><span class=main>/</span><span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Additional properties of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>cmod</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.›</span></span>

<span class=keyword1 id=More_Complex-complex_mult_cnj_cmod><span class=command>lemma</span></span> complex_mult_cnj_cmod<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>*</span> cnj <span class=free>z</span> <span class=main>=</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> complex_norm_square
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=More_Complex-cmod_square><span class=command>lemma</span></span> cmod_square<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> Re <span class=main>(</span><span class=free>z</span> <span class=main>*</span> cnj <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>

<span class=keyword1 id=More_Complex-cor_cmod_power_4><span class=command>lemma</span></span> cor_cmod_power_4 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span> <span class=main>^</span> <span class=numeral>4</span> <span class=main>=</span> <span class=main>(</span><span class=free>z</span> <span class=main>*</span> cnj <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod<span class=main>)</span>

<span class=keyword1 id=More_Complex-cnjE><span class=command>lemma</span></span> cnjE<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnj <span class=free>x</span> <span class=main>=</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=free>x</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>/</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=More_Complex-cmod_cor_divide><span class=command>lemma</span></span> cmod_cor_divide <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>z</span> <span class=main>/</span> cor <span class=free>k</span><span class=main>)</span> <span class=main>=</span> cmod <span class=free>z</span> <span class=main>/</span> <span class=main>¦</span><span class=free>k</span><span class=main>¦</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> norm_divide<span class=main>)</span>

<span class=keyword1 id=More_Complex-cmod_mult_minus_left_distrib><span class=command>lemma</span></span> cmod_mult_minus_left_distrib <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>z</span><span class=main>*</span><span class=free>z1</span> <span class=main>-</span> <span class=free>z</span><span class=main>*</span><span class=free>z2</span><span class=main>)</span> <span class=main>=</span> cmod <span class=free>z</span> <span class=main>*</span> cmod<span class=main>(</span><span class=free>z1</span> <span class=main>-</span> <span class=free>z2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> norm_mult right_diff_distrib<span class=main>)</span>

<span class=keyword1 id=More_Complex-cmod_eqI><span class=command>lemma</span></span> cmod_eqI<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>*</span> cnj <span class=free>z1</span> <span class=main>=</span> <span class=free>z2</span> <span class=main>*</span> cnj <span class=free>z2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>z1</span> <span class=main>=</span> cmod <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_mod_sqrt_Re_mult_cnj<span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=operator>auto</span>

<span class=keyword1 id=More_Complex-cmod_eqE><span class=command>lemma</span></span> cmod_eqE<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>z1</span> <span class=main>=</span> cmod <span class=free>z2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>*</span> cnj <span class=free>z1</span> <span class=main>=</span> <span class=free>z2</span> <span class=main>*</span> cnj <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> assms complex_mult_cnj_cmod<span class=main>)</span>

<span class=keyword1 id=More_Complex-cmod_eq_one><span class=command>lemma</span></span> cmod_eq_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>=</span> <span class=main>1</span> <span class=main>⟷</span> <span class=free>a</span><span class=main>*</span>cnj <span class=free>a</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> cmod_eqE cmod_eqI complex_cnj_one monoid_mult_class.mult.left_neutral norm_one<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹We introduce <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>is_real</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> (the imaginary part of complex number is zero) and <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>is_imag</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>
(real part of complex number is zero) operators and prove some of their properties.›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>is_real</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>is_real</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>≡</span> Im <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> <span class=main>0</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>is_imag</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>is_imag</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>≡</span> Re <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> <span class=main>0</span>"</span></span>

<span class=keyword1 id=More_Complex-real_imag_0><span class=command>lemma</span></span> real_imag_0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>a</span>"</span></span> <span class=quoted><span class=quoted>"is_imag <span class=free>a</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex.expand<span class=main>)</span>

<span class=keyword1 id=More_Complex-complex_eq_if_Re_eq><span class=command>lemma</span></span> complex_eq_if_Re_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>=</span> <span class=free>z2</span> <span class=main>⟷</span> Re <span class=free>z1</span> <span class=main>=</span> Re <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>z2</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=More_Complex-mult_reals><span class=command>lemma</span></span> mult_reals <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=More_Complex-div_reals><span class=command>lemma</span></span> div_reals <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span><span class=free>a</span> <span class=main>/</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_is_Real_iff<span class=main>)</span>

<span class=keyword1 id=More_Complex-complex_of_real_Re><span class=command>lemma</span></span> complex_of_real_Re <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>k</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>Re <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>k</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_of_real_def<span class=main>)</span>

<span class=keyword1 id=More_Complex-cor_cmod_real><span class=command>lemma</span></span> cor_cmod_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=free>a</span> <span class=main>∨</span> cor <span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> cmod_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"Re <span class=free>a</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=More_Complex-eq_cnj_iff_real><span class=command>lemma</span></span> eq_cnj_iff_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnj <span class=free>z</span> <span class=main>=</span> <span class=free>z</span> <span class=main>⟷</span> is_real <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>

<span class=keyword1 id=More_Complex-eq_minus_cnj_iff_imag><span class=command>lemma</span></span> eq_minus_cnj_iff_imag<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnj <span class=free>z</span> <span class=main>=</span> <span class=main>-</span><span class=free>z</span> <span class=main>⟷</span> is_imag <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>

<span class=keyword1 id=More_Complex-Re_divide_real><span class=command>lemma</span></span> Re_divide_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>a</span> <span class=main>/</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>Re <span class=free>a</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>Re <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_is_Real_iff<span class=main>)</span>

<span class=keyword1 id=More_Complex-Re_mult_real><span class=command>lemma</span></span> Re_mult_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>Re <span class=free>a</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>Re <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=More_Complex-Im_mult_real><span class=command>lemma</span></span> Im_mult_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Im <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>Re <span class=free>a</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>Im <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=More_Complex-Im_divide_real><span class=command>lemma</span></span> Im_divide_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Im <span class=main>(</span><span class=free>a</span> <span class=main>/</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>Im <span class=free>a</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>Re <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_is_Real_iff<span class=main>)</span>

<span class=keyword1 id=More_Complex-Re_sgn><span class=command>lemma</span></span> Re_sgn<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>R</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>sgn <span class=free>R</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>Re <span class=free>R</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Re_sgn complex_of_real_Re norm_of_real real_sgn_eq<span class=main>)</span>

<span class=keyword1 id=More_Complex-is_real_div><span class=command>lemma</span></span> is_real_div<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span><span class=free>a</span> <span class=main>/</span> <span class=free>b</span><span class=main>)</span> <span class=main>⟷</span> <span class=free>a</span><span class=main>*</span>cnj <span class=free>b</span> <span class=main>=</span> <span class=free>b</span><span class=main>*</span>cnj <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex_cnj_divide complex_cnj_zero_iff eq_cnj_iff_real frac_eq_eq mult.commute<span class=main>)</span>

<span class=keyword1 id=More_Complex-is_real_mult_real><span class=command>lemma</span></span> is_real_mult_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>b</span> <span class=main>⟷</span> is_real <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>

<span class=keyword1 id=More_Complex-Im_express_cnj><span class=command>lemma</span></span> Im_express_cnj<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Im <span class=free>z</span> <span class=main>=</span> <span class=main>(</span><span class=free>z</span> <span class=main>-</span> cnj <span class=free>z</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=keyword1>𝗂</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_diff_cnj <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=More_Complex-Re_express_cnj><span class=command>lemma</span></span> Re_express_cnj<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=free>z</span> <span class=main>=</span> <span class=main>(</span><span class=free>z</span> <span class=main>+</span> cnj <span class=free>z</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_add_cnj<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Rotation of complex number for 90 degrees in the positive direction.›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>rot90</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>rot90</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>≡</span> Complex <span class=main>(</span><span class=main>-</span>Im <span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>)</span> <span class=main>(</span>Re <span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=More_Complex-rot90_ii><span class=command>lemma</span></span> rot90_ii<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"rot90 <span class=free>z</span> <span class=main>=</span> <span class=free>z</span> <span class=main>*</span> <span class=keyword1>𝗂</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Complex_mult_i complex_surj<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹With <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>cnj_mix</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> we introduce scalar product between complex vectors. This operation shows
to be useful to succinctly express some conditions.›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>cnj_mix</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>cnj_mix</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>≡</span> cnj <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=main>*</span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=main>*</span> cnj <span class=free><span class=bound><span class=entity>z2</span></span></span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>scalprod</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>scalprod</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>≡</span> cnj_mix <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>

<span class=keyword1 id=More_Complex-cnj_mix_minus><span class=command>lemma</span></span> cnj_mix_minus<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnj <span class=free>z1</span><span class=main>*</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>*</span>cnj <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>𝗂</span> <span class=main>*</span> cnj_mix <span class=main>(</span>rot90 <span class=free>z1</span><span class=main>)</span> <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>z2</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id="More_Complex-cnj_mix_minus'"><span class=command>lemma</span></span> cnj_mix_minus'<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnj <span class=free>z1</span><span class=main>*</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>*</span>cnj <span class=free>z2</span> <span class=main>=</span> rot90 <span class=main>(</span>cnj_mix <span class=main>(</span>rot90 <span class=free>z1</span><span class=main>)</span> <span class=free>z2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>z2</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=More_Complex-cnj_mix_real><span class=command>lemma</span></span> cnj_mix_real <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>cnj_mix <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>z2</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=More_Complex-scalprod_real><span class=command>lemma</span></span> scalprod_real <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>scalprod <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> cnj_mix_real
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Additional properties of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>cis</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> function.›</span></span>

<span class=keyword1 id=More_Complex-cis_minus_pi2><span class=command>lemma</span></span> cis_minus_pi2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cis <span class=main>(</span><span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=keyword1>𝗂</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_inverse<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword1 id=More_Complex-cis_pi2_minus_x><span class=command>lemma</span></span> cis_pi2_minus_x <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cis <span class=main>(</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=main>-</span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>𝗂</span> <span class=main>*</span> cis<span class=main>(</span><span class=main>-</span><span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> cis_divide<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"pi<span class=main>/</span><span class=numeral>2</span>"</span></span> <span class=quoted><span class=free>x</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> cis_divide<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=free>x</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=More_Complex-cis_pm_pi><span class=command>lemma</span></span> cis_pm_pi <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cis <span class=main>(</span><span class=free>x</span> <span class=main>-</span> pi<span class=main>)</span> <span class=main>=</span> <span class=main>-</span> cis <span class=free>x</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>  <span class=quoted><span class=quoted>"cis <span class=main>(</span><span class=free>x</span> <span class=main>+</span> pi<span class=main>)</span> <span class=main>=</span> <span class=main>-</span> cis <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis.ctr complex_minus<span class=main>)</span><span class=main><span class=keyword3>+</span></span>


<span class=keyword1 id=More_Complex-cis_times_cis_opposite><span class=command>lemma</span></span> cis_times_cis_opposite <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cis <span class=free>φ</span> <span class=main>*</span> cis <span class=main>(</span><span class=main>-</span> <span class=free>φ</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_mult<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>cis</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> repeats only after $2k\pi$›</span></span>
<span class=keyword1 id=More_Complex-cis_eq><span class=command>lemma</span></span> cis_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cis <span class=free>a</span> <span class=main>=</span> cis <span class=free>b</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> <span class=free>a</span> <span class=main>-</span> <span class=free>b</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=bound>k</span> <span class=main>*</span> pi"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms sin_cos_eq<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> cis.sel<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a</span></span></span></span><span class=main>]</span> cis.sel<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>b</span></span></span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"cis <span class=free>a</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"cis <span class=free>b</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>cis</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> is injective on $(-\pi, \pi]$.›</span></span>
<span class=keyword1 id=More_Complex-cis_inj><span class=command>lemma</span></span> cis_inj<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi <span class=main>&lt;</span> <span class=free>α</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>≤</span> pi"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi <span class=main>&lt;</span> <span class=free>α'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>α'</span> <span class=main>≤</span> pi"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cis <span class=free>α</span> <span class=main>=</span> cis <span class=free>α'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>α</span> <span class=main>=</span> <span class=free>α'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> arg_unique sgn_cis<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>cis</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> of an angle combined with <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>cis</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> of the opposite angle›</span></span>

<span class=keyword1 id=More_Complex-cis_diff_cis_opposite><span class=command>lemma</span></span> cis_diff_cis_opposite <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cis <span class=free>φ</span> <span class=main>-</span> cis <span class=main>(</span><span class=main>-</span> <span class=free>φ</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=keyword1>𝗂</span> <span class=main>*</span> sin <span class=free>φ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> Im_express_cnj<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cis <span class=free>φ</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=More_Complex-cis_opposite_diff_cis><span class=command>lemma</span></span> cis_opposite_diff_cis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cis <span class=main>(</span><span class=main>-</span><span class=free>φ</span><span class=main>)</span> <span class=main>-</span> cis <span class=main>(</span><span class=free>φ</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> <span class=keyword1>𝗂</span> <span class=main>*</span> sin <span class=free>φ</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> cis_diff_cis_opposite<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>φ</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=More_Complex-cis_add_cis_opposite><span class=command>lemma</span></span> cis_add_cis_opposite <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cis <span class=free>φ</span> <span class=main>+</span> cis <span class=main>(</span><span class=main>-</span><span class=free>φ</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> cos <span class=free>φ</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> cis.sel<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> cis_cnj complex_add_cnj<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>cis</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> equal to 1 or -1›</span></span>
<span class=keyword1 id=More_Complex-cis_one><span class=command>lemma</span></span> cis_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"sin <span class=free>φ</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cos <span class=free>φ</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cis <span class=free>φ</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis.ctr one_complex.code<span class=main>)</span>

<span class=keyword1 id=More_Complex-cis_minus_one><span class=command>lemma</span></span> cis_minus_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"sin <span class=free>φ</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cos <span class=free>φ</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cis <span class=free>φ</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis.ctr Complex_eq_neg_1<span class=main>)</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Additional properties of complex number argument›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>arg</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> of real numbers›</span></span>

<span class=keyword1 id=More_Complex-is_real_arg1><span class=command>lemma</span></span> is_real_arg1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> arg <span class=free>z</span> <span class=main>=</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> Im_rcis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=free>z</span>"</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=More_Complex-is_real_arg2><span class=command>lemma</span></span> is_real_arg2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> arg <span class=free>z</span> <span class=main>=</span> pi"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> <span class=main><span class=main>(</span></span>verit<span class=main><span class=main>,</span></span> best<span class=main><span class=main>)</span></span> Im_sgn assms cis.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> cis_arg div_0 sin_zero_pi_iff<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> arg_zero<span class=main>)</span>

<span class=keyword1 id=More_Complex-arg_complex_of_real_positive><span class=command>lemma</span></span> arg_complex_of_real_positive <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cor <span class=free>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span>arg <span class=main>(</span>Complex <span class=free>k</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Complex <span class=free>k</span> <span class=main>0</span>"</span></span><span class=main>]</span> Re_rcis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span>Complex <span class=free>k</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>Complex <span class=free>k</span> <span class=main>0</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> cmod_eq_Re <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms is_real_arg2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cor <span class=free>k</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> complex_of_real_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-arg_complex_of_real_negative><span class=command>lemma</span></span> arg_complex_of_real_negative <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cor <span class=free>k</span><span class=main>)</span> <span class=main>=</span> pi"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span>arg <span class=main>(</span>Complex <span class=free>k</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Complex <span class=free>k</span> <span class=main>0</span>"</span></span><span class=main>]</span> Re_rcis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span>Complex <span class=free>k</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>Complex <span class=free>k</span> <span class=main>0</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex.sel<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> mult_less_0_iff norm_not_less_zero<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms is_real_arg2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cor <span class=free>k</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> complex_of_real_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-arg_0_iff><span class=command>lemma</span></span> arg_0_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> arg <span class=free>z</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> is_real <span class=free>z</span> <span class=main>∧</span> Re <span class=free>z</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> arg_complex_of_real_negative arg_complex_of_real_positive arg_zero complex_of_real_Re is_real_arg1 pi_gt_zero zero_complex.simps<span class=main>)</span>

<span class=keyword1 id=More_Complex-arg_pi_iff><span class=command>lemma</span></span> arg_pi_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>=</span> pi <span class=main>⟷</span> is_real <span class=free>z</span> <span class=main>∧</span> Re <span class=free>z</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> arg_complex_of_real_negative arg_complex_of_real_positive arg_zero complex_of_real_Re is_real_arg1 pi_gt_zero zero_complex.simps<span class=main>)</span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹<span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>arg</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> of imaginary numbers›</span></span>

<span class=keyword1 id=More_Complex-is_imag_arg1><span class=command>lemma</span></span> is_imag_arg1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>=</span> pi<span class=main>/</span><span class=numeral>2</span> <span class=main>∨</span> arg <span class=free>z</span> <span class=main>=</span> <span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_imag <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> Re_rcis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=free>z</span>"</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> cos_minus cos_pi_half minus_divide_left mult_eq_0_iff<span class=main>)</span>

<span class=keyword1 id=More_Complex-is_imag_arg2><span class=command>lemma</span></span> is_imag_arg2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_imag <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>=</span> pi<span class=main>/</span><span class=numeral>2</span> <span class=main>∨</span> arg <span class=free>z</span> <span class=main>=</span> <span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> arg_bounded assms cos_0_iff_canon cos_arg_i_mult_zero <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>

<span class=keyword1 id=More_Complex-arg_complex_of_real_times_i_positive><span class=command>lemma</span></span> arg_complex_of_real_times_i_positive <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cor <span class=free>k</span> <span class=main>*</span> <span class=keyword1>𝗂</span><span class=main>)</span> <span class=main>=</span> pi <span class=main>/</span> <span class=numeral>2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sin <span class=main>(</span>arg <span class=main>(</span>Complex <span class=main>0</span> <span class=free>k</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Complex <span class=main>0</span> <span class=free>k</span>"</span></span><span class=main>]</span> Im_rcis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span>Complex <span class=main>0</span> <span class=free>k</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>Complex <span class=main>0</span> <span class=free>k</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> complex.sel<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> mult_nonneg_nonpos norm_ge_zero<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms is_imag_arg2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cor <span class=free>k</span> <span class=main>*</span> <span class=keyword1>𝗂</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> arg_zero complex_of_real_i
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-arg_complex_of_real_times_i_negative><span class=command>lemma</span></span> arg_complex_of_real_times_i_negative <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cor <span class=free>k</span> <span class=main>*</span> <span class=keyword1>𝗂</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> pi <span class=main>/</span> <span class=numeral>2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sin <span class=main>(</span>arg <span class=main>(</span>Complex <span class=main>0</span> <span class=free>k</span><span class=main>)</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Complex <span class=main>0</span> <span class=free>k</span>"</span></span><span class=main>]</span> Im_rcis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span>Complex <span class=main>0</span> <span class=free>k</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>Complex <span class=main>0</span> <span class=free>k</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex.sel<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> mult_less_0_iff norm_not_less_zero<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms is_imag_arg2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cor <span class=free>k</span> <span class=main>*</span> <span class=keyword1>𝗂</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> arg_zero complex_of_real_i<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>k</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> complex.sel<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> sin_pi_half sin_zero<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-arg_pi2_iff><span class=command>lemma</span></span> arg_pi2_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> arg <span class=free>z</span> <span class=main>=</span> pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>⟷</span> is_imag <span class=free>z</span> <span class=main>∧</span> Im <span class=free>z</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> Im_rcis Re_i_times Re_rcis arcsin_minus_1 cos_pi_half divide_minus_left mult.commute mult_cancel_right1 rcis_cmod_arg is_imag_arg2 sin_arcsin sin_pi_half zero_less_mult_pos zero_less_norm_iff<span class=main>)</span>

<span class=keyword1 id=More_Complex-arg_minus_pi2_iff><span class=command>lemma</span></span> arg_minus_pi2_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> arg <span class=free>z</span> <span class=main>=</span> <span class=main>-</span> pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>⟷</span> is_imag <span class=free>z</span> <span class=main>∧</span> Im <span class=free>z</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> arg_pi2_iff complex.expand divide_cancel_right pi_neq_zero is_imag_arg1 is_imag_arg2 zero_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> zero_complex.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id=More_Complex-arg_ii><span class=command>lemma</span></span> arg_ii <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=keyword1>𝗂</span> <span class=main>=</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> arg_pi2_iff imaginary_unit.sel zero_less_one<span class=main>)</span>

<span class=keyword1 id=More_Complex-arg_minus_ii><span class=command>lemma</span></span> arg_minus_ii <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=main>-</span><span class=keyword1>𝗂</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=keyword1>𝗂</span> <span class=main>=</span> cis <span class=main>(</span>arg <span class=main>(</span><span class=main>-</span> <span class=keyword1>𝗂</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=keyword1>𝗂</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rcis_def<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span>arg <span class=main>(</span><span class=main>-</span><span class=keyword1>𝗂</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"sin <span class=main>(</span>arg <span class=main>(</span><span class=main>-</span><span class=keyword1>𝗂</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cis.simps<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"arg <span class=main><span class=main>(</span></span><span class=main><span class=main>-</span></span><span class=keyword1><span class=keyword1>𝗂</span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cos_0_iff_canon<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=main>-</span><span class=keyword1>𝗂</span><span class=main>)</span>"</span></span><span class=main>]</span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=keyword1>𝗂</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Argument is a canonical angle›</span></span>

<span class=keyword1 id=More_Complex-canon_ang_arg><span class=command>lemma</span></span> canon_ang_arg<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span>arg <span class=free>z</span><span class=main>⇃</span> <span class=main>=</span> arg <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> canon_ang_id<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z</span>"</span></span><span class=main>]</span> arg_bounded
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=More_Complex-arg_cis><span class=command>lemma</span></span> arg_cis<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cis <span class=free>φ</span><span class=main>)</span> <span class=main>=</span> <span class=main>⇂</span><span class=free>φ</span><span class=main>⇃</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> arg_unique canon_ang canon_ang_cos canon_ang_sin cis.ctr sgn_cis <span class=keyword1><span class=command>by</span></span> <span class=operator>presburger</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Cosine and sine of <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>arg</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>›</span></span>

<span class=keyword1 id=More_Complex-cos_arg><span class=command>lemma</span></span> cos_arg<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span>arg <span class=free>z</span><span class=main>)</span> <span class=main>=</span> Re <span class=free>z</span> <span class=main>/</span> cmod <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Complex.Re_sgn cis.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> assms cis_arg<span class=main>)</span>

<span class=keyword1 id=More_Complex-sin_arg><span class=command>lemma</span></span> sin_arg<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sin <span class=main>(</span>arg <span class=free>z</span><span class=main>)</span> <span class=main>=</span> Im <span class=free>z</span> <span class=main>/</span> cmod <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Complex.Im_sgn cis.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> assms cis_arg<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Argument of product›</span></span>

<span class=keyword1 id=More_Complex-cis_arg_mult><span class=command>lemma</span></span> cis_arg_mult<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>*</span> <span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cis <span class=main>(</span>arg <span class=main>(</span><span class=free>z1</span> <span class=main>*</span> <span class=free>z2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> cis <span class=main>(</span>arg <span class=free>z1</span> <span class=main>+</span> arg <span class=free>z2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms cis_arg cis_mult mult_eq_0_iff sgn_mult<span class=main>)</span>

<span class=keyword1 id=More_Complex-arg_mult_2kpi><span class=command>lemma</span></span> arg_mult_2kpi<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>*</span> <span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> arg <span class=main>(</span><span class=free>z1</span> <span class=main>*</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> arg <span class=free>z1</span> <span class=main>+</span> arg <span class=free>z2</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=bound>k</span><span class=main>*</span>pi"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cis <span class=main>(</span>arg <span class=main>(</span><span class=free>z1</span><span class=main>*</span><span class=free>z2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> cis <span class=main>(</span>arg <span class=free>z1</span> <span class=main>+</span> arg <span class=free>z2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> cis_arg_mult<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cis_eq<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=free>z1</span><span class=main>*</span><span class=free>z2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z1</span> <span class=main>+</span> arg <span class=free>z2</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-arg_mult><span class=command>lemma</span></span> arg_mult<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>*</span> <span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg<span class=main>(</span><span class=free>z1</span> <span class=main>*</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>⇂</span>arg <span class=free>z1</span> <span class=main>+</span> arg <span class=free>z2</span><span class=main>⇃</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"arg<span class=main>(</span><span class=free>z1</span> <span class=main>*</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> arg <span class=free>z1</span> <span class=main>+</span> arg <span class=free>z2</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k</span><span class=main>*</span>pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> arg_mult_2kpi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span>arg<span class=main>(</span><span class=free>z1</span> <span class=main>*</span> <span class=free>z2</span><span class=main>)</span><span class=main>⇃</span> <span class=main>=</span> <span class=main>⇂</span>arg <span class=free>z1</span> <span class=main>+</span> arg <span class=free>z2</span><span class=main>⇃</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_eq
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>z1</span><span class=main>*</span><span class=free>z2</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-arg_mult_real_positive><span class=command>lemma</span></span> arg_mult_real_positive <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cor <span class=free>k</span> <span class=main>*</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> arg <span class=free>z</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> arg_mult assms canon_ang_arg <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> arg_zero<span class=main>)</span>

<span class=keyword1 id=More_Complex-arg_mult_real_negative><span class=command>lemma</span></span> arg_mult_real_negative <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cor <span class=free>k</span> <span class=main>*</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> arg <span class=main>(</span><span class=main>-</span><span class=free>z</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> arg_mult_real_positive minus_mult_commute neg_0_less_iff_less of_real_minus minus_minus<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> arg_zero<span class=main>)</span>

<span class=keyword1 id=More_Complex-arg_div_real_positive><span class=command>lemma</span></span> arg_div_real_positive <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=free>z</span> <span class=main>/</span> cor <span class=free>k</span><span class=main>)</span> <span class=main>=</span> arg <span class=free>z</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> arg_mult_real_positive<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=free>k</span>"</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-arg_div_real_negative><span class=command>lemma</span></span> arg_div_real_negative <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=free>z</span> <span class=main>/</span> cor <span class=free>k</span><span class=main>)</span> <span class=main>=</span> arg <span class=main>(</span><span class=main>-</span><span class=free>z</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> arg_mult_real_negative<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=free>k</span>"</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-arg_mult_eq><span class=command>lemma</span></span> arg_mult_eq<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>*</span> <span class=free>z1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>*</span> <span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=free>z</span> <span class=main>*</span> <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> arg <span class=main>(</span><span class=free>z</span> <span class=main>*</span> <span class=free>z2</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z1</span> <span class=main>=</span> arg <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> arg_cis assms canon_ang_arg cis_arg mult_eq_0_iff nonzero_mult_div_cancel_left sgn_divide<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Argument of conjugate›</span></span>

<span class=keyword1 id=More_Complex-arg_cnj_pi><span class=command>lemma</span></span> arg_cnj_pi<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>=</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cnj <span class=free>z</span><span class=main>)</span> <span class=main>=</span> pi"</span></span>
  <span class=keyword1><span class=command>using</span></span> arg_pi_iff assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=More_Complex-arg_cnj_not_pi><span class=command>lemma</span></span> arg_cnj_not_pi<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>≠</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cnj <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span>arg <span class=free>z</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> is_real_arg1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cnj <span class=free>z</span><span class=main>)</span> <span class=main>=</span> arg <span class=free>z</span> <span class=main>∨</span> arg<span class=main>(</span>cnj <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span>arg <span class=free>z</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cnj <span class=free>z</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> <span class=main><span class=main>(</span></span>verit<span class=main><span class=main>,</span></span> best<span class=main><span class=main>)</span></span> arccos_cos arccos_cos2 cnj.sel<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> complex_cnj_zero_iff complex_mod_cnj cos_arg<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cnj <span class=free>z</span><span class=main>)</span> <span class=main>≠</span> arg <span class=free>z</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> sin_0_iff_canon<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cnj <span class=free>z</span><span class=main>)</span>"</span></span><span class=main>]</span> arg_bounded False assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex_mod_cnj eq_cnj_iff_real is_real_arg2 rcis_cmod_arg<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Argument of reciprocal›</span></span>

<span class=keyword1 id=More_Complex-arg_inv_not_pi><span class=command>lemma</span></span> arg_inv_not_pi<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>≠</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> arg <span class=free>z</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=free>z</span> <span class=main>=</span> cnj <span class=free>z</span> <span class=main>/</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> arg_div_real_positive<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=quoted><span class=quoted>"cnj <span class=free>z</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> arg_cnj_not_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹arg <span class=free>z</span> <span class=main>≠</span> pi›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-arg_inv_pi><span class=command>lemma</span></span> arg_inv_pi<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>=</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> pi"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=free>z</span> <span class=main>=</span> cnj <span class=free>z</span> <span class=main>/</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> arg_div_real_positive<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=quoted><span class=quoted>"cnj <span class=free>z</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> arg_cnj_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹arg <span class=free>z</span> <span class=main>=</span> pi›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-arg_inv_2kpi><span class=command>lemma</span></span> arg_inv_2kpi<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> arg <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> arg <span class=free>z</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=bound>k</span><span class=main>*</span>pi"</span></span>
  <span class=keyword1><span class=command>using</span></span> arg_inv_pi<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> arg_inv_not_pi<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>=</span> pi"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=More_Complex-arg_inv><span class=command>lemma</span></span> arg_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>⇂</span><span class=main>-</span> arg <span class=free>z</span><span class=main>⇃</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> arg_inv_not_pi arg_inv_pi assms canon_ang_arg canon_ang_uminus_pi<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Argument of quotient›</span></span>

<span class=keyword1 id=More_Complex-arg_div_2kpi><span class=command>lemma</span></span> arg_div_2kpi<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>int<span class=main>.</span> arg <span class=main>(</span><span class=free>z1</span> <span class=main>/</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> arg <span class=free>z1</span> <span class=main>-</span> arg <span class=free>z2</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=bound>k</span><span class=main>*</span>pi"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x1</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=free>z1</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>z2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> arg <span class=free>z1</span> <span class=main>+</span> arg <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>z2</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> real_of_int <span class=skolem>x1</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms arg_mult_2kpi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=free>z2</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> arg <span class=free>z2</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> real_of_int <span class=skolem>x2</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms arg_inv_2kpi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>x1</span> <span class=main>+</span> <span class=skolem>x2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-arg_div><span class=command>lemma</span></span> arg_div<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg<span class=main>(</span><span class=free>z1</span> <span class=main>/</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>⇂</span>arg <span class=free>z1</span> <span class=main>-</span> arg <span class=free>z2</span><span class=main>⇃</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"arg<span class=main>(</span><span class=free>z1</span> <span class=main>/</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> arg <span class=free>z1</span> <span class=main>-</span> arg <span class=free>z2</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k</span><span class=main>*</span>pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> arg_div_2kpi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"canon_ang<span class=main>(</span>arg<span class=main>(</span><span class=free>z1</span> <span class=main>/</span> <span class=free>z2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> canon_ang<span class=main>(</span>arg <span class=free>z1</span> <span class=main>-</span> arg <span class=free>z2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_eq
    <span class=keyword1><span class=command>by</span></span><span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>z1</span><span class=main>/</span><span class=free>z2</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Argument of opposite›</span></span>

<span class=keyword1 id=More_Complex-arg_uminus><span class=command>lemma</span></span> arg_uminus<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=main>-</span><span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>⇂</span>arg <span class=free>z</span> <span class=main>+</span> pi<span class=main>⇃</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> arg_mult<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> arg_complex_of_real_negative<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=More_Complex-arg_uminus_opposite_sign><span class=command>lemma</span></span> arg_uminus_opposite_sign<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟷</span> <span class=main>¬</span> arg <span class=main>(</span><span class=main>-</span><span class=free>z</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> arg_uminus<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>using</span></span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> canon_ang_plus_pi1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> arg_uminus<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹arg <span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>using</span></span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> canon_ang_plus_pi2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> arg_uminus<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Sign of argument is the same as the sign of the Imaginary part›</span></span>

<span class=keyword1 id=More_Complex-arg_Im_sgn><span class=command>lemma</span></span> arg_Im_sgn<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> is_real <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>arg <span class=free>z</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>Im <span class=free>z</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>r</span></span> <span class=skolem><span class=skolem>φ</span></span> <span class=keyword2><span class=keyword>where</span></span> polar<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> cor <span class=skolem>r</span> <span class=main>*</span> cis <span class=skolem>φ</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>φ</span> <span class=main>=</span> arg <span class=free>z</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> cmod_cis mult_eq_0_iff norm_ge_zero of_real_0<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Im <span class=free>z</span> <span class=main>=</span> <span class=skolem>r</span> <span class=main>*</span> sin <span class=skolem>φ</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Im_mult_real Re_complex_of_real cis.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> Im_complex_of_real<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span>  <span class=quoted><span class=quoted>"Im <span class=free>z</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟷</span> sin <span class=skolem>φ</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"Im <span class=free>z</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> sin <span class=skolem>φ</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>r</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> mult_pos_pos mult_nonneg_nonneg zero_less_mult_pos mult_less_cancel_left
    <span class=keyword1><span class=command>by</span></span> <span class=operator>smt</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>φ</span> <span class=main>≠</span> pi"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>φ</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> is_real <span class=free>z</span>›</span></span> polar cis_pi
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sin <span class=skolem>φ</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟷</span> <span class=skolem>φ</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>φ</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> sin <span class=skolem>φ</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>φ</span> <span class=main>=</span> arg <span class=free>z</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>φ</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>φ</span> <span class=main>≠</span> pi›</span></span>
    <span class=keyword1><span class=command>using</span></span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> sin_gt_zero sin_le_zero sin_pi_minus sin_0_iff_canon sin_ge_zero<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>φ</span> <span class=main>=</span> arg <span class=free>z</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Complex square root›</span></span>

<span class=keyword1><span class=command>definition</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ccsqrt</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> rcis <span class=main>(</span>sqrt <span class=main>(</span>cmod <span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>arg <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>/</span> <span class=numeral>2</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=More_Complex-square_ccsqrt><span class=command>lemma</span></span> square_ccsqrt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>ccsqrt <span class=free>x</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ccsqrt_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> DeMoivre2<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rcis_cmod_arg<span class=main>)</span>

<span class=keyword1 id=More_Complex-ex_complex_sqrt><span class=command>lemma</span></span> ex_complex_sqrt<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>s</span><span class=main>::</span>complex<span class=main>.</span> <span class=bound>s</span><span class=main>*</span><span class=bound>s</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> power2_eq_square<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"csqrt <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=More_Complex-ccsqrt><span class=command>lemma</span></span> ccsqrt<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>*</span> <span class=free>s</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> ccsqrt <span class=free>z</span> <span class=main>∨</span> <span class=free>s</span> <span class=main>=</span> <span class=main>-</span>ccsqrt <span class=free>z</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> ccsqrt_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>s</span> <span class=main>*</span> cmod <span class=free>s</span> <span class=main>=</span> cmod <span class=free>z</span>"</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>*</span> arg <span class=free>s</span> <span class=main>-</span> arg <span class=free>z</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k</span><span class=main>*</span>pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>s</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> arg_mult<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>s</span></span> <span class=quoted><span class=free>s</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span>arg <span class=free>s</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> norm_mult arg_mult<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span> <span class=main>=</span> cmod <span class=free>s</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cmod <span class=free>s</span> <span class=main>*</span> cmod <span class=free>s</span> <span class=main>=</span> cmod <span class=free>z</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> norm_not_less_zero real_sqrt_abs2<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>/</span> <span class=numeral>2</span> <span class=main>=</span> arg <span class=free>s</span> <span class=main>-</span> <span class=skolem>k</span><span class=main>*</span>pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>*</span> arg <span class=free>s</span> <span class=main>-</span> arg <span class=free>z</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span><span class=skolem>k</span><span class=main>*</span>pi›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cis <span class=main>(</span>arg <span class=free>s</span> <span class=main>-</span> <span class=skolem>k</span><span class=main>*</span>pi<span class=main>)</span> <span class=main>=</span> cis <span class=main>(</span>arg <span class=free>s</span><span class=main>)</span> <span class=main>∨</span> cis <span class=main>(</span>arg <span class=free>s</span> <span class=main>-</span> <span class=skolem>k</span><span class=main>*</span>pi<span class=main>)</span> <span class=main>=</span> <span class=main>-</span>cis <span class=main>(</span>arg <span class=free>s</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"even <span class=skolem>k</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cis <span class=main>(</span>arg <span class=free>s</span> <span class=main>-</span> <span class=skolem>k</span><span class=main>*</span>pi<span class=main>)</span> <span class=main>=</span> cis <span class=main>(</span>arg <span class=free>s</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_def complex.corec cos_diff sin_diff<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cis <span class=main>(</span>arg <span class=free>s</span> <span class=main>-</span> <span class=skolem>k</span><span class=main>*</span>pi<span class=main>)</span> <span class=main>=</span> <span class=main>-</span>cis <span class=main>(</span>arg <span class=free>s</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_def complex.corec Complex_eq cos_diff sin_diff<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"cis <span class=main>(</span>arg <span class=free>s</span> <span class=main>-</span> <span class=skolem>k</span> <span class=main>*</span> pi<span class=main>)</span> <span class=main>=</span> cis <span class=main>(</span>arg <span class=free>s</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> ccsqrt <span class=free>z</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>s</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> ccsqrt_def rcis_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> **<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> ***<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"cis <span class=main>(</span>arg <span class=free>s</span> <span class=main>-</span> <span class=skolem>k</span> <span class=main>*</span> pi<span class=main>)</span> <span class=main>=</span> <span class=main>-</span>cis <span class=main>(</span>arg <span class=free>s</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>s</span> <span class=main>=</span> <span class=main>-</span> ccsqrt <span class=free>z</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>s</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> ccsqrt_def rcis_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> **<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> ***<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-null_ccsqrt><span class=command>lemma</span></span> null_ccsqrt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ccsqrt <span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ccsqrt_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=More_Complex-ccsqrt_mult><span class=command>lemma</span></span> ccsqrt_mult<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ccsqrt <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> ccsqrt <span class=free>a</span> <span class=main>*</span> ccsqrt <span class=free>b</span> <span class=main>∨</span>
         ccsqrt <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> ccsqrt <span class=free>a</span> <span class=main>*</span> ccsqrt <span class=free>b</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>b</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span><span class=main>::</span><span class=quoted>int</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"arg <span class=free>a</span> <span class=main>+</span> arg <span class=free>b</span> <span class=main>-</span> <span class=main>⇂</span>arg <span class=free>a</span> <span class=main>+</span> arg <span class=free>b</span><span class=main>⇃</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> real_of_int <span class=skolem>k</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>3<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>a</span> <span class=main>+</span> arg <span class=free>b</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⇂</span>arg <span class=free>a</span> <span class=main>+</span> arg <span class=free>b</span><span class=main>⇃</span> <span class=main>=</span> arg <span class=free>a</span> <span class=main>+</span> arg <span class=free>b</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span>real_of_int <span class=skolem>k</span><span class=main>)</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cis <span class=main>(</span><span class=main>⇂</span>arg <span class=free>a</span> <span class=main>+</span> arg <span class=free>b</span><span class=main>⇃</span> <span class=main>/</span> <span class=numeral>2</span><span class=main>)</span> <span class=main>=</span> cis <span class=main>(</span>arg <span class=free>a</span> <span class=main>/</span> <span class=numeral>2</span> <span class=main>+</span> arg <span class=free>b</span> <span class=main>/</span> <span class=numeral>2</span><span class=main>)</span> <span class=main>∨</span> cis <span class=main>(</span><span class=main>⇂</span>arg <span class=free>a</span> <span class=main>+</span> arg <span class=free>b</span><span class=main>⇃</span> <span class=main>/</span> <span class=numeral>2</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> cis <span class=main>(</span>arg <span class=free>a</span> <span class=main>/</span> <span class=numeral>2</span> <span class=main>+</span> arg <span class=free>b</span> <span class=main>/</span> <span class=numeral>2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cos_even_kpi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span><span class=main>]</span> cos_odd_kpi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>subst</span> diff_divide_distrib<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>subst</span> add_divide_distrib<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
       <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"even <span class=skolem>k</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_def complex.corec Complex_eq cos_diff sin_diff<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> False
    <span class=keyword1><span class=command>unfolding</span></span> ccsqrt_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> <span class=main><span class=main>(</span></span>verit<span class=main><span class=main>,</span></span> best<span class=main><span class=main>)</span></span> arg_mult mult_minus_left mult_minus_right no_zero_divisors norm_mult rcis_def rcis_mult real_sqrt_mult<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-csqrt_real><span class=command>lemma</span></span> csqrt_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Re <span class=free>x</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>∧</span> ccsqrt <span class=free>x</span> <span class=main>=</span> cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=free>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∨</span>
         <span class=main>(</span>Re <span class=free>x</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>∧</span> ccsqrt <span class=free>x</span> <span class=main>=</span> <span class=keyword1>𝗂</span> <span class=main>*</span> cor <span class=main>(</span>sqrt <span class=main>(</span><span class=main>-</span> <span class=main>(</span>Re <span class=free>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"Re <span class=free>x</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"arg <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>x</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> arg_complex_of_real_positive complex_of_real_Re<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>x</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>x</span>›</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ccsqrt_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_eq_Re<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=free>x</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>x</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> complex_eq_if_Re_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"arg <span class=free>x</span> <span class=main>=</span> pi"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>x</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> arg_complex_of_real_negative complex_of_real_Re<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>x</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>x</span>›</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ccsqrt_def rcis_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_def complex.corec Complex_eq cmod_eq_Re<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Rotation of complex vector to x-axis.›</span></span>

<span class=keyword1 id=More_Complex-is_real_rot_to_x_axis><span class=command>lemma</span></span> is_real_rot_to_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>cis <span class=main>(</span><span class=main>-</span>arg <span class=free>z</span><span class=main>)</span> <span class=main>*</span> <span class=free>z</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z</span> <span class=main>=</span> pi"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> is_real_arg1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=main>-</span> arg <span class=free>z</span><span class=main>⇃</span> <span class=main>=</span> <span class=main>-</span> arg <span class=free>z</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_eqI<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span> arg <span class=free>z</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=free>z</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"arg <span class=main>(</span>cis <span class=main>(</span><span class=main>-</span> <span class=main>(</span>arg <span class=free>z</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> arg_mult<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cis <span class=main>(</span><span class=main>-</span> <span class=main>(</span>arg <span class=free>z</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> arg_cis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span> arg <span class=free>z</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> is_real_arg1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cis <span class=main>(</span><span class=main>-</span> arg <span class=free>z</span><span class=main>)</span> <span class=main>*</span> <span class=free>z</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-positive_rot_to_x_axis><span class=command>lemma</span></span> positive_rot_to_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>cis <span class=main>(</span><span class=main>-</span>arg <span class=free>z</span><span class=main>)</span> <span class=main>*</span> <span class=free>z</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> Re_complex_of_real cis_rcis_eq mult_cancel_right1 rcis_cmod_arg rcis_mult rcis_zero_arg zero_less_norm_iff<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Inequalities involving <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>cmod</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>.›</span></span>

<span class=keyword1 id=More_Complex-cmod_1_plus_mult_le><span class=command>lemma</span></span> cmod_1_plus_mult_le<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>z</span><span class=main>*</span><span class=free>w</span><span class=main>)</span> <span class=main>≤</span> sqrt<span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>w</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=free>z</span><span class=main>*</span><span class=free>w</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span>cnj <span class=free>z</span><span class=main>*</span>cnj <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> Re <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=free>z</span><span class=main>*</span>cnj <span class=free>z</span><span class=main>)</span><span class=main>*</span> Re <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=free>w</span><span class=main>*</span>cnj <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=free>w</span> <span class=main>-</span> cnj <span class=free>z</span><span class=main>)</span><span class=main>*</span>cnj<span class=main>(</span><span class=free>w</span> <span class=main>-</span> cnj <span class=free>z</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_mult_cnj_cmod<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>z</span><span class=main>*</span><span class=free>w</span> <span class=main>+</span> cnj <span class=free>z</span> <span class=main>*</span> cnj <span class=free>w</span><span class=main>)</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>w</span><span class=main>*</span>cnj <span class=free>w</span><span class=main>)</span> <span class=main>+</span> Re<span class=main>(</span><span class=free>z</span><span class=main>*</span>cnj <span class=free>z</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>z</span> <span class=main>*</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≤</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>w</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> abs_norm_cancel real_sqrt_abs real_sqrt_le_iff<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-cmod_diff_ge><span class=command>lemma</span></span> cmod_diff_ge<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>≥</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>-</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=numeral>2</span><span class=main>*</span>Im<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>-</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≥</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=numeral>2</span><span class=main>*</span>Im<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>-</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≥</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=numeral>2</span><span class=main>*</span>Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>*</span><span class=free>c</span><span class=main>*</span>cnj <span class=free>c</span><span class=main>)</span> "</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span><span class=main>*</span><span class=main>(</span>cnj <span class=free>b</span> <span class=main>-</span> cnj <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=numeral>2</span><span class=main>*</span>Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>*</span><span class=free>c</span><span class=main>*</span>cnj <span class=free>c</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> cmod_square<span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span> <span class=main>+</span> Re<span class=main>(</span><span class=free>c</span><span class=main>*</span>cnj <span class=free>c</span><span class=main>)</span> <span class=main>+</span> Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>*</span><span class=free>c</span><span class=main>*</span>cnj <span class=free>c</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Re<span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=main>(</span>Re <span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> power2_sum<span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=numeral>2</span> <span class=main>*</span> Re <span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≥</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt<span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> one_power2 real_sqrt_sum_squares_mult_ge_zero<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt<span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> power2_le_imp_le real_sqrt_ge_0_iff real_sqrt_pow2_iff<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>cnj <span class=free>b</span> <span class=main>-</span> cnj <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=free>c</span><span class=main>*</span>cnj <span class=free>c</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span>sqrt<span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≥</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>-</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> cmod_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> power2_diff<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> real_sqrt_pow2<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> real_sqrt_pow2<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> real_sqrt_mult<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>-</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> power2_le_imp_le<span class=main>[</span><span class=operator>OF</span> *<span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≥</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>-</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> less_eq_real_def linorder_neqE_linordered_idom<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_increasing monoid_add_class.add.right_neutral<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=More_Complex-cmod_diff_le><span class=command>lemma</span></span> cmod_diff_le<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>≤</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>+</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=numeral>2</span><span class=main>*</span>Im<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>-</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≥</span> <span class=main>-</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=numeral>2</span><span class=main>*</span>Im<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>-</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≥</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=numeral>2</span><span class=main>*</span>Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>*</span><span class=free>c</span><span class=main>*</span>cnj <span class=free>c</span><span class=main>)</span> "</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span><span class=main>*</span><span class=main>(</span>cnj <span class=free>b</span> <span class=main>+</span> cnj <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=numeral>2</span><span class=main>*</span>Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>*</span><span class=free>c</span><span class=main>*</span>cnj <span class=free>c</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> cmod_square<span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span> <span class=main>+</span> Re<span class=main>(</span><span class=free>c</span><span class=main>*</span>cnj <span class=free>c</span><span class=main>)</span> <span class=main>+</span> Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>*</span><span class=free>c</span><span class=main>*</span>cnj <span class=free>c</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> ++<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span>Re<span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span> <span class=main>=</span> Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>-</span> Re <span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>1</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span>Re<span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=main>(</span>Re <span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> power2_diff<span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>-</span> Re <span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>1</span> <span class=main>-</span> Re<span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=numeral>2</span> <span class=main>*</span> Re <span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>c</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> ++<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≥</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> Re <span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt<span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> one_power2 real_sqrt_sum_squares_mult_ge_zero<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt<span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>1</span> <span class=main>-</span> Re <span class=main>(</span>scalprod <span class=free>b</span> <span class=free>c</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> power2_le_imp_le real_sqrt_ge_0_iff real_sqrt_pow2_iff<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>cnj <span class=free>b</span> <span class=main>-</span> cnj <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=free>c</span><span class=main>*</span>cnj <span class=free>c</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>sqrt<span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≤</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>+</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> cmod_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> power2_sum<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> real_sqrt_pow2<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> real_sqrt_pow2<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> real_sqrt_mult<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> power2_le_imp_le<span class=main>[</span><span class=operator>OF</span> *<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Definition of Euclidean distance between two complex numbers.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>cdist</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>cdist</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>≡</span> cmod <span class=main>(</span><span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>z1</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Misc. properties of complex numbers.›</span></span>

<span class=keyword1 id=More_Complex-ex_complex_to_complex><span class=command>lemma</span></span> ex_complex_to_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>z2</span> <span class=main>=</span> <span class=bound>k</span> <span class=main>*</span> <span class=free>z1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>z2</span><span class=main>/</span><span class=free>z1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=More_Complex-ex_complex_to_one><span class=command>lemma</span></span> ex_complex_to_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>z</span><span class=main>::</span><span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>k</span> <span class=main>*</span> <span class=free>z</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=More_Complex-ex_complex_to_complex2><span class=command>lemma</span></span> ex_complex_to_complex2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>z</span><span class=main>::</span><span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>k</span> <span class=main>*</span> <span class=free>z</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=More_Complex-complex_sqrt_1><span class=command>lemma</span></span> complex_sqrt_1<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>z</span><span class=main>::</span><span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> <span class=free>z</span> <span class=main>⟷</span> <span class=free>z</span> <span class=main>=</span> <span class=main>1</span> <span class=main>∨</span> <span class=free>z</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> nonzero_eq_divide_eq square_eq_iff
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Angles>
<div class=head>
<h1>Theory Angles</h1>
</div>
<pre class=source><span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Angle between two vectors›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In this section we introduce different measures of angle between two vectors (represented by complex numbers).›</span></span>

<span class=keyword1><span class=command>theory</span></span> Angles
<span class=keyword2><span class=keyword>imports</span></span> <a href=#More_Transcendental>More_Transcendental</a> <a href=#Canonical_Angle>Canonical_Angle</a> <a href=#More_Complex>More_Complex</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Oriented angle›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Oriented angle between two vectors (it is always in the interval $(-\pi, \pi]$).›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>ang_vec</span> <span class=main>(</span><span class=quoted>"<span class=keyword1>∠</span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main><span class=free>∠</span></span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>≡</span> <span class=main>⇂</span>arg <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>-</span> arg <span class=free><span class=bound><span class=entity>z1</span></span></span><span class=main>⇃</span>"</span></span>

<span class=keyword1 id=Angles-ang_vec_bounded><span class=command>lemma</span></span> ang_vec_bounded<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi <span class=main>&lt;</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>∧</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>≤</span> pi"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> canon_ang<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> canon_ang<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>

<span class=keyword1 id=Angles-ang_vec_sym><span class=command>lemma</span></span> ang_vec_sym<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>≠</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>-</span> <span class=main>∠</span> <span class=free>z2</span> <span class=free>z1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> ang_vec_def
  <span class=keyword1><span class=command>using</span></span> canon_ang_uminus<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Angles-ang_vec_sym_pi><span class=command>lemma</span></span> ang_vec_sym_pi<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> pi"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>∠</span> <span class=free>z2</span> <span class=free>z1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> ang_vec_def
  <span class=keyword1><span class=command>using</span></span> canon_ang_uminus_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Angles-ang_vec_plus_pi1><span class=command>lemma</span></span> ang_vec_plus_pi1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>+</span> pi<span class=main>⇃</span> <span class=main>=</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>-</span> pi"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> canon_ang_eqI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>x</span><span class=main>::</span>int<span class=main>.</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>-</span> pi <span class=main>-</span> <span class=main>(</span><span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>+</span> pi<span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> real_of_int <span class=bound>x</span> <span class=main>*</span> pi"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> pi <span class=main>&lt;</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>-</span> pi <span class=main>∧</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>-</span> pi <span class=main>≤</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> ang_vec_def
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span> canon_ang<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Angles-ang_vec_plus_pi2><span class=command>lemma</span></span> ang_vec_plus_pi2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>≤</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>+</span> pi<span class=main>⇃</span> <span class=main>=</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>+</span> pi"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> canon_ang_id<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> pi <span class=main>&lt;</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>+</span> pi <span class=main>∧</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>+</span> pi <span class=main>≤</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> ang_vec_def
    <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span> canon_ang<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Angles-ang_vec_opposite1><span class=command>lemma</span></span> ang_vec_opposite1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=main>(</span><span class=main>-</span><span class=free>z1</span><span class=main>)</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>⇂</span><span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>-</span> pi<span class=main>⇃</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=main>(</span><span class=main>-</span><span class=free>z1</span><span class=main>)</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>⇂</span>arg <span class=free>z2</span> <span class=main>-</span> <span class=main>(</span>arg <span class=free>z1</span> <span class=main>+</span> pi<span class=main>)</span><span class=main>⇃</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ang_vec_def
    <span class=keyword1><span class=command>using</span></span> arg_uminus<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> 
    <span class=keyword1><span class=command>using</span></span> canon_ang_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_diff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span>"</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z1</span> <span class=main>+</span> pi"</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⇂</span><span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>-</span> pi<span class=main>⇃</span> <span class=main>=</span> <span class=main>⇂</span>arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span> <span class=main>-</span> pi<span class=main>⇃</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_id<span class=main>[</span><span class=operator>of</span> <span class=quoted>pi</span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_diff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span> <span class=quoted><span class=quoted>"pi"</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Angles-ang_vec_opposite2><span class=command>lemma</span></span> ang_vec_opposite2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=main>(</span><span class=main>-</span><span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>⇂</span><span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>+</span> pi<span class=main>⇃</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ang_vec_def
  <span class=keyword1><span class=command>using</span></span> arg_mult<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span>"</span></span><span class=main>]</span> assms
  <span class=keyword1><span class=command>using</span></span> arg_complex_of_real_negative<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> canon_ang_diff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>+</span> arg <span class=free>z2</span>"</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z1</span>"</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> canon_ang_sum<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span> <span class=quoted><span class=quoted>"pi"</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> canon_ang_id<span class=main>[</span><span class=operator>of</span> <span class=quoted>pi</span><span class=main>]</span> canon_ang_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>algebra_simps</span></span><span class=main>)</span>
  

<span class=keyword1 id=Angles-ang_vec_opposite_opposite><span class=command>lemma</span></span> ang_vec_opposite_opposite<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=main>(</span><span class=main>-</span><span class=free>z1</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span><span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=main>(</span><span class=main>-</span><span class=free>z1</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span><span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>⇂</span><span class=main>⇂</span><span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>+</span> pi<span class=main>⇃</span> <span class=main>-</span> <span class=main>⇂</span>pi<span class=main>⇃</span><span class=main>⇃</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ang_vec_opposite1<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> ang_vec_opposite2<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_id<span class=main>[</span><span class=operator>of</span> <span class=quoted>pi</span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=main>⇂</span><span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span><span class=main>⇃</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> canon_ang_diff<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> ang_vec_def canon_ang<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> canon_ang<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> canon_ang_id<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Angles-ang_vec_opposite_opposite'"><span class=command>lemma</span></span> ang_vec_opposite_opposite'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=main>(</span><span class=free>z</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span> <span class=main>(</span><span class=free>z</span> <span class=main>-</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>∠</span> <span class=main>(</span><span class=free>z1</span> <span class=main>-</span> <span class=free>z</span><span class=main>)</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> ang_vec_opposite_opposite<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>-</span> <span class=free>z1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>-</span> <span class=free>z2</span>"</span></span><span class=main>]</span> assms
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> ang_vec_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Cosine, scalar product and the law of cosines›</span></span>

<span class=keyword1 id=Angles-cos_cmod_scalprod><span class=command>lemma</span></span> cos_cmod_scalprod<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>z1</span> <span class=main>*</span> cmod <span class=free>z2</span> <span class=main>*</span> <span class=main>(</span>cos <span class=main>(</span><span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Re <span class=main>(</span>scalprod <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cos_diff cos_arg sin_arg <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Angles-cos0_scalprod0><span class=command>lemma</span></span> cos0_scalprod0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span><span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> scalprod <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> cnj_mix_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> cos_cmod_scalprod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_eq_if_Re_eq<span class=main>)</span>

<span class=keyword1 id=Angles-ortho_scalprod0><span class=command>lemma</span></span> ortho_scalprod0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> pi<span class=main>/</span><span class=numeral>2</span> <span class=main>∨</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=main>⟷</span> scalprod <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> cos0_scalprod0<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> ang_vec_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> cos_0_iff_canon<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> cos_minus cos_pi_half divide_minus_left<span class=main>)</span>

<span class=keyword1 id=Angles-law_of_cosines><span class=command>lemma</span></span> law_of_cosines<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cdist <span class=free>B</span> <span class=free>C</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>(</span>cdist <span class=free>A</span> <span class=free>C</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span>cdist <span class=free>A</span> <span class=free>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span><span class=main>(</span>cdist <span class=free>A</span> <span class=free>C</span><span class=main>)</span><span class=main>*</span><span class=main>(</span>cdist <span class=free>A</span> <span class=free>B</span><span class=main>)</span><span class=main>*</span><span class=main>(</span>cos <span class=main>(</span><span class=main>∠</span> <span class=main>(</span><span class=free>C</span><span class=main>-</span><span class=free>A</span><span class=main>)</span> <span class=main>(</span><span class=free>B</span><span class=main>-</span><span class=free>A</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?a</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>C</span><span class=main>-</span><span class=free>B</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?b</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>C</span><span class=main>-</span><span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?c</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>B</span><span class=main>-</span><span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?a</span> <span class=main>=</span> <span class=var>?b</span> <span class=main>-</span> <span class=var>?c</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=var>?a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>(</span>cmod <span class=main>(</span><span class=var>?b</span> <span class=main>-</span> <span class=var>?c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> Re <span class=main>(</span>scalprod <span class=main>(</span><span class=var>?b</span><span class=main>-</span><span class=var>?c</span><span class=main>)</span> <span class=main>(</span><span class=var>?b</span><span class=main>-</span><span class=var>?c</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_square<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=main>(</span>cmod <span class=var>?b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span>cmod <span class=var>?c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=main>(</span>scalprod <span class=var>?b</span> <span class=var>?c</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> cos_cmod_scalprod<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?b</span></span></span> <span class=var><span class=quoted><span class=var>?c</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Unoriented angle›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Convex unoriented angle between two vectors (it is always in the interval $[0, pi]$).›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>ang_vec_c</span> <span class=main>(</span><span class=quoted>"<span class=keyword1>∠c</span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span><span class=quoted><span class=quoted>"<span class=keyword1><span class=free>∠c</span></span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>≡</span> abs <span class=main>(</span><span class=main>∠</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Angles-ang_vec_c_sym><span class=command>lemma</span></span> ang_vec_c_sym<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>∠c</span> <span class=free>z2</span> <span class=free>z1</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ang_vec_c_def
  <span class=keyword1><span class=command>using</span></span> ang_vec_sym_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span> ang_vec_sym<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> pi"</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Angles-ang_vec_c_bounded><span class=command>lemma</span></span> ang_vec_c_bounded<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>∧</span> <span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>≤</span> pi"</span></span>
  <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span> canon_ang<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Cosine and scalar product›</span></span>

<span class=keyword1 id=Angles-cos_c_><span class=command>lemma</span></span> cos_c_<span class=main>:</span> <span class=quoted><span class=quoted>"cos <span class=main>(</span><span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> cos <span class=main>(</span><span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ang_vec_c_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> cos_minus<span class=main>)</span>

<span class=keyword1 id=Angles-ortho_c_scalprod0><span class=command>lemma</span></span> ortho_c_scalprod0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> pi<span class=main>/</span><span class=numeral>2</span> <span class=main>⟷</span> scalprod <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>∨</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>-</span> pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>⟷</span> <span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ang_vec_c_def
    <span class=keyword1><span class=command>using</span></span> arctan 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> ortho_scalprod0<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Acute angle›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Acute or right angle (non-obtuse) between two vectors (it is always in the interval $[0, \frac{\pi}{2}$]).
We will use this to measure angle between two circles, since it can always be acute (or right).›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>acute_ang</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>acute_ang</span> <span class=free><span class=bound><span class=entity>α</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>α</span></span></span> <span class=main>&gt;</span> pi <span class=main>/</span> <span class=numeral>2</span> <span class=keyword1>then</span> pi <span class=main>-</span> <span class=free><span class=bound><span class=entity>α</span></span></span> <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>α</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>ang_vec_a</span> <span class=main>(</span><span class=quoted>"<span class=keyword1>∠a</span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>∠a</span></span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>≡</span> acute_ang <span class=main>(</span><span class=keyword1>∠c</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Angles-ang_vec_a_sym><span class=command>lemma</span></span> ang_vec_a_sym<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>∠a</span> <span class=free>z2</span> <span class=free>z1</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def
  <span class=keyword1><span class=command>using</span></span> ang_vec_c_sym
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Angles-ang_vec_a_opposite2><span class=command>lemma</span></span> ang_vec_a_opposite2<span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>∠a</span> <span class=free>z1</span> <span class=main>(</span><span class=main>-</span><span class=free>z2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z2</span>  <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> minus_zero<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&lt;</span> <span class=main>-</span>pi <span class=main>/</span> <span class=numeral>2</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> pi_not_less_zero
      <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> pi <span class=main>+</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> True <span class=quoted><span class=quoted>‹<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def ang_vec_a_def abs_real_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=main>(</span><span class=main>-</span><span class=free>z2</span><span class=main>)</span> <span class=main>=</span> pi <span class=main>+</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def abs_real_def
      <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span> canon_ang<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> ang_vec_plus_pi2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span> True <span class=quoted><span class=quoted>‹<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> ang_vec_opposite2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>≤</span> <span class=main>0</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>-</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&lt;</span> <span class=main>-</span> pi <span class=main>/</span> <span class=numeral>2</span>›</span></span> True
        <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def ang_vec_a_def abs_real_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=main>(</span><span class=main>-</span><span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&lt;</span> <span class=main>-</span> pi <span class=main>/</span> <span class=numeral>2</span>›</span></span> True
        <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def abs_real_def
        <span class=keyword1><span class=command>using</span></span> ang_vec_plus_pi2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span> canon_ang<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> ang_vec_opposite2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&lt;</span> pi <span class=main>/</span> <span class=numeral>2</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>≤</span> <span class=main>0</span>›</span></span> True
          <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def ang_vec_a_def abs_real_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=main>(</span><span class=main>-</span><span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>≤</span> <span class=main>0</span>›</span></span> True
          <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def abs_real_def
          <span class=keyword1><span class=command>using</span></span> ang_vec_plus_pi1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span> canon_ang<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> ang_vec_opposite2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> False
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> less_linear less_trans pi_half_gt_zero<span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> pi <span class=main>-</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> False <span class=quoted><span class=quoted>‹<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def ang_vec_a_def abs_real_def
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=main>(</span><span class=main>-</span><span class=free>z2</span><span class=main>)</span> <span class=main>=</span> pi <span class=main>-</span> <span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def abs_real_def
          <span class=keyword1><span class=command>using</span></span> False <span class=quoted><span class=quoted>‹<span class=main>∠</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>using</span></span> ang_vec_plus_pi1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>using</span></span> canon_ang<span class=main>(</span>1<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span> canon_ang<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> ang_vec_opposite2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Angles-ang_vec_a_opposite1><span class=command>lemma</span></span> ang_vec_a_opposite1<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>∠a</span> <span class=main>(</span><span class=main>-</span><span class=free>z1</span><span class=main>)</span> <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> ang_vec_a_sym<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>z1</span>"</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span> ang_vec_a_opposite2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span> ang_vec_a_sym<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Angles-ang_vec_a_scale1><span class=command>lemma</span></span> ang_vec_a_scale1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=main>(</span>cor <span class=free>k</span> <span class=main>*</span> <span class=free>z1</span><span class=main>)</span> <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def ang_vec_def
    <span class=keyword1><span class=command>using</span></span> arg_mult_real_positive<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>k</span></span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> arg_mult_real_negative<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>k</span></span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> ang_vec_a_opposite1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def ang_vec_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Angles-ang_vec_a_scale2><span class=command>lemma</span></span> ang_vec_a_scale2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=main>(</span>cor <span class=free>k</span> <span class=main>*</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> ang_vec_a_sym<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=quoted>"complex_of_real <span class=free>k</span> <span class=main>*</span> <span class=free>z2</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> ang_vec_a_scale1<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> ang_vec_a_sym<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Angles-ang_vec_a_scale><span class=command>lemma</span></span> ang_vec_a_scale<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=main>(</span>cor <span class=free>k1</span> <span class=main>*</span> <span class=free>z1</span><span class=main>)</span> <span class=main>(</span>cor <span class=free>k2</span> <span class=main>*</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> ang_vec_a_scale1<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span> ang_vec_a_scale2<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Angles-ang_a_cnj_cnj><span class=command>lemma</span></span> ang_a_cnj_cnj<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>∠a</span> <span class=main>(</span>cnj <span class=free>z1</span><span class=main>)</span> <span class=main>(</span>cnj <span class=free>z2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def ang_vec_def
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z1</span> <span class=main>≠</span> pi <span class=main>∧</span> arg <span class=free>z2</span> <span class=main>≠</span> pi"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span><span class=main>⇃</span><span class=main>¦</span> <span class=main>=</span> acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=main>(</span>cnj <span class=free>z2</span><span class=main>)</span> <span class=main>-</span> arg <span class=main>(</span>cnj <span class=free>z1</span><span class=main>)</span><span class=main>⇃</span><span class=main>¦</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> arg_cnj_not_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span> arg_cnj_not_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span>acute_ang_def<span class=main>)</span>
    <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>⇂</span>arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span><span class=main>⇃</span> <span class=main>=</span> pi"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span><span class=main>⇃</span><span class=main>¦</span> <span class=main>=</span> acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=free>z1</span> <span class=main>-</span> arg <span class=free>z2</span><span class=main>⇃</span><span class=main>¦</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span>  canon_ang_uminus_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span><span class=main>⇃</span><span class=main>¦</span> <span class=main>=</span> acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=free>z1</span> <span class=main>-</span> arg <span class=free>z2</span><span class=main>⇃</span><span class=main>¦</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span>  canon_ang_uminus<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=free>z2</span> <span class=main>-</span> arg <span class=free>z1</span><span class=main>⇃</span><span class=main>¦</span> <span class=main>=</span> acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=main>(</span>cnj <span class=free>z2</span><span class=main>)</span> <span class=main>-</span> arg <span class=main>(</span>cnj <span class=free>z1</span><span class=main>)</span><span class=main>⇃</span><span class=main>¦</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z1</span> <span class=main>=</span> pi"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>=</span> pi"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹ <span class=main>¬</span> <span class=main>(</span>arg <span class=free>z1</span> <span class=main>≠</span> pi <span class=main>∧</span> arg <span class=free>z2</span> <span class=main>≠</span> pi<span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> False
        <span class=keyword1><span class=command>using</span></span> arg_cnj_not_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span> arg_cnj_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span>acute_ang_def<span class=main>)</span>
      <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z1</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=free>z1</span> <span class=main>≤</span> <span class=main>0</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"acute_ang <span class=main>¦</span><span class=main>⇂</span>pi <span class=main>-</span> arg <span class=free>z1</span><span class=main>⇃</span><span class=main>¦</span> <span class=main>=</span> acute_ang <span class=main>¦</span><span class=main>⇂</span>pi <span class=main>+</span> arg <span class=free>z1</span><span class=main>⇃</span><span class=main>¦</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> True canon_ang_plus_pi1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z1</span>"</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>using</span></span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span> canon_ang_plus_pi2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=free>z1</span>"</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=free>z1</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
             <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"acute_ang <span class=main>¦</span><span class=main>⇂</span>pi <span class=main>-</span> arg <span class=free>z1</span><span class=main>⇃</span><span class=main>¦</span> <span class=main>=</span> acute_ang <span class=main>¦</span><span class=main>⇂</span>pi <span class=main>+</span> arg <span class=free>z1</span><span class=main>⇃</span><span class=main>¦</span>"</span></span>
          <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z1</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> True
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span>acute_ang_def<span class=main>)</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=free>z1</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>-</span>arg <span class=free>z1</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> False canon_ang_plus_pi1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=free>z1</span>"</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>using</span></span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span> canon_ang_plus_pi2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z1</span>"</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> arg_cnj_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span>acute_ang_def<span class=main>)</span>
      <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>=</span> pi"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=free>z2</span> <span class=main>-</span> pi<span class=main>⇃</span><span class=main>¦</span> <span class=main>=</span> acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=main>(</span>cnj <span class=free>z2</span><span class=main>)</span> <span class=main>-</span> pi<span class=main>⇃</span><span class=main>¦</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> arg_cnj_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=free>z2</span> <span class=main>-</span> pi<span class=main>⇃</span><span class=main>¦</span> <span class=main>=</span> acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=main>(</span>cnj <span class=free>z2</span><span class=main>)</span> <span class=main>-</span> pi<span class=main>⇃</span><span class=main>¦</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> arg_cnj_not_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span>acute_ang_def<span class=main>)</span>
        <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>case</span></span> True
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=free>z2</span> <span class=main>≤</span> <span class=main>0</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=free>z2</span> <span class=main>-</span> pi<span class=main>⇃</span><span class=main>¦</span> <span class=main>=</span> acute_ang <span class=main>¦</span><span class=main>⇂</span><span class=main>-</span> arg <span class=free>z2</span> <span class=main>-</span> pi<span class=main>⇃</span><span class=main>¦</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> True canon_ang_minus_pi1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span>"</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>using</span></span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span> canon_ang_minus_pi2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=free>z2</span>"</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>next</span></span>
          <span class=keyword3><span class=command>case</span></span> False
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=free>z2</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
             <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"acute_ang <span class=main>¦</span><span class=main>⇂</span>arg <span class=free>z2</span> <span class=main>-</span> pi<span class=main>⇃</span><span class=main>¦</span> <span class=main>=</span> acute_ang <span class=main>¦</span><span class=main>⇂</span><span class=main>-</span> arg <span class=free>z2</span> <span class=main>-</span> pi<span class=main>⇃</span><span class=main>¦</span>"</span></span>
          <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
            <span class=keyword3><span class=command>case</span></span> True
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span>acute_ang_def<span class=main>)</span>
          <span class=keyword1><span class=command>next</span></span>
            <span class=keyword3><span class=command>case</span></span> False
            <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=free>z2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
              <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>-</span>arg <span class=free>z2</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
              <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
            <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> False canon_ang_minus_pi1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=free>z2</span>"</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>using</span></span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span> canon_ang_minus_pi2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=free>z2</span>"</span></span><span class=main>]</span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Cosine and scalar product›</span></span>

<span class=keyword1 id=Angles-ortho_a_scalprod0><span class=command>lemma</span></span> ortho_a_scalprod0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> pi<span class=main>/</span><span class=numeral>2</span> <span class=main>⟷</span> scalprod <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def
  <span class=keyword1><span class=command>using</span></span> assms ortho_c_scalprod0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>declare</span></span> ang_vec_c_def<span class=main>[</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main>]</span>

<span class=keyword1 id=Angles-cos_a_c><span class=command>lemma</span></span> cos_a_c<span class=main>:</span> <span class=quoted><span class=quoted>"cos <span class=main>(</span><span class=keyword1>∠a</span> <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> abs <span class=main>(</span>cos <span class=main>(</span><span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>≤</span> pi"</span></span>
    <span class=keyword1><span class=command>using</span></span> ang_vec_c_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def acute_ang_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> cos_pi_half pi_def pi_half<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&lt;</span> pi <span class=main>/</span> <span class=numeral>2</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>≤</span> <span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> cos_gt_zero_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&gt;</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>≠</span> pi<span class=main>/</span><span class=numeral>2</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span><span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>≤</span> pi›</span></span>
        <span class=keyword1><span class=command>using</span></span> cos_lt_zero_on_pi2_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span><span class=main>]</span> 
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>∠c</span> <span class=free>z1</span> <span class=free>z2</span> <span class=main>&gt;</span> pi<span class=main>/</span><span class=numeral>2</span>›</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=More_Set>
<div class=head>
<h1>Theory More_Set</h1>
</div>
<pre class=source><span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Library Aditions for Set Cardinality›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In this section some additional simple lemmas about set cardinality are proved.›</span></span>

<span class=keyword1><span class=command>theory</span></span> More_Set
<span class=keyword2><span class=keyword>imports</span></span> <a href=https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Every infinite set has at least two different elements›</span></span>
<span class=keyword1 id=More_Set-infinite_contains_2_elems><span class=command>lemma</span></span> infinite_contains_2_elems<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"infinite <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> assms finite.simps is_singletonI' is_singleton_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Every infinite set has at least three different elements›</span></span>
<span class=keyword1 id=More_Set-infinite_contains_3_elems><span class=command>lemma</span></span> infinite_contains_3_elems<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"infinite <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>x</span> <span class=bound>y</span> <span class=bound>z</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>z</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>≠</span> <span class=bound>z</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>z</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Diff_iff assms infinite_contains_2_elems infinite_remove insertI1<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Every set with cardinality greater than 1 has at least two different elements›</span></span>
<span class=keyword1 id=More_Set-card_geq_2_iff_contains_2_elems><span class=command>lemma</span></span> card_geq_2_iff_contains_2_elems<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"card <span class=free>A</span> <span class=main>≥</span> <span class=numeral>2</span> <span class=main>⟷</span> finite <span class=free>A</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>intro</span> iffI conjI<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"card <span class=free>A</span> <span class=main>≥</span> <span class=numeral>2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> card_0_eq card_Suc_eq empty_iff leI less_2_cases singletonD<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>≤</span> card <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> card.infinite <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>meson</span> <span class=quoted>"*"</span> card_2_iff' in_mono obtain_subset_with_card_n<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Set cardinality is at least 3 if and only if it contains three different elements›</span></span>
<span class=keyword1 id=More_Set-card_geq_3_iff_contains_3_elems><span class=command>lemma</span></span> card_geq_3_iff_contains_3_elems<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"card <span class=free>A</span> <span class=main>≥</span> <span class=numeral>3</span> <span class=main>⟷</span> finite <span class=free>A</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>x</span> <span class=bound>y</span> <span class=bound>z</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>z</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>≠</span> <span class=bound>z</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>z</span> <span class=main>∈</span> <span class=free>A</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>intro</span> iffI conjI<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=free>A</span> <span class=main>≥</span> <span class=numeral>3</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"finite <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> card.infinite <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>x</span> <span class=bound>y</span> <span class=bound>z</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>z</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>≠</span> <span class=bound>z</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>z</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> <span class=main><span class=main>(</span></span>verit<span class=main><span class=main>,</span></span> best<span class=main><span class=main>)</span></span> <span class=quoted>"*"</span> card_2_iff' card_geq_2_iff_contains_2_elems le_cases3 not_less_eq_eq numeral_2_eq_2 numeral_3_eq_3<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"finite <span class=free>A</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>x</span> <span class=bound>y</span> <span class=bound>z</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>z</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>≠</span> <span class=bound>z</span> <span class=main>∧</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free>A</span> <span class=main>∧</span> <span class=bound>z</span> <span class=main>∈</span> <span class=free>A</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"card <span class=free>A</span> <span class=main>≥</span> <span class=numeral>3</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> One_nat_def Suc_le_eq card_2_iff' card_le_Suc0_iff_eq leI numeral_3_eq_3 one_add_one order_class.order.eq_iff plus_1_eq_Suc<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Set cardinality of A is equal to 2 if and only if A={x, y} for two different elements x and y›</span></span>
<span class=keyword1 id=More_Set-card_eq_2_iff_doubleton><span class=command>lemma</span></span> card_eq_2_iff_doubleton<span class=main>:</span> <span class=quoted><span class=quoted>"card <span class=free>A</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span> <span class=main>≠</span> <span class=bound>y</span> <span class=main>∧</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>}</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> card_geq_2_iff_contains_2_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> card_geq_3_iff_contains_3_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>x</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>y</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=More_Set-card_eq_2_doubleton><span class=command>lemma</span></span> card_eq_2_doubleton<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"card <span class=free>A</span> <span class=main>=</span> <span class=numeral>2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> <span class=free>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>∈</span> <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms card_eq_2_iff_doubleton<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Bijections map singleton to singleton sets›</span></span>

<span class=keyword1 id=More_Set-bij_image_singleton><span class=command>lemma</span></span> bij_image_singleton<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟦</span><span class=free>f</span> <span class=main>`</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=free>b</span><span class=main>}</span><span class=main>;</span> <span class=free>f</span> <span class=free>a</span> <span class=main>=</span> <span class=free>b</span><span class=main>;</span> bij <span class=free>f</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>A</span> <span class=main>=</span> <span class=main>{</span><span class=free>a</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> bij_betw_def image_empty image_insert inj_image_eq_iff<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span></pre>
</div><div id=Linear_Systems>
<div class=head>
<h1>Theory Linear_Systems</h1>
</div>
<pre class=source><span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Systems of linear equations›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=comment1>(* TODO: merge with matrices *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In this section some simple properties of systems of linear equations with two or three unknowns are derived.
Existence and uniqueness of solutions of regular and singular homogenous and non-homogenous systems is characterized.›</span></span>

<span class=keyword1><span class=command>theory</span></span> Linear_Systems
<span class=keyword2><span class=keyword>imports</span></span> <a href=https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL/Main.html>Main</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Determinant of 2x2 matrix›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>det2</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=tfree>'a</span><span class=main>::</span>field<span class=main>)</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span> <span class=main>⇒</span> <span class=tfree>'a</span>"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>det2</span> <span class=free><span class=bound><span class=entity>a11</span></span></span> <span class=free><span class=bound><span class=entity>a12</span></span></span> <span class=free><span class=bound><span class=entity>a21</span></span></span> <span class=free><span class=bound><span class=entity>a22</span></span></span> <span class=main>≡</span> <span class=free><span class=bound><span class=entity>a11</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>a22</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>a12</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>a21</span></span></span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Regular homogenous system has only trivial solution›</span></span>
<span class=keyword1 id=Linear_Systems-regular_homogenous_system><span class=command>lemma</span></span> regular_homogenous_system<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a11</span> <span class=free>a12</span> <span class=free>a21</span> <span class=free>a22</span> <span class=free>x1</span> <span class=free>x2</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>field"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"det2 <span class=free>a11</span> <span class=free>a12</span> <span class=free>a21</span> <span class=free>a22</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a11</span><span class=main>*</span><span class=free>x1</span> <span class=main>+</span> <span class=free>a12</span><span class=main>*</span><span class=free>x2</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
          <span class=quoted><span class=quoted>"<span class=free>a21</span><span class=main>*</span><span class=free>x1</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>x2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>x2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>a11</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>with</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a12</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>a21</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a11</span> <span class=main>=</span> <span class=main>0</span>›</span></span> assms<span class=main>(</span>2<span class=main>)</span> assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>x1</span> <span class=main>=</span> <span class=main>-</span> <span class=free>a12</span><span class=main>*</span><span class=free>x2</span> <span class=main>/</span> <span class=free>a11</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> eq_neg_iff_add_eq_0 mult_minus_left nonzero_mult_div_cancel_left<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>a21</span> <span class=main>*</span> <span class=main>(</span><span class=main>-</span> <span class=free>a12</span> <span class=main>*</span> <span class=free>x2</span> <span class=main>/</span> <span class=free>a11</span><span class=main>)</span> <span class=main>+</span> <span class=free>a22</span> <span class=main>*</span> <span class=free>x2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>a21</span> <span class=main>*</span> <span class=main>(</span><span class=main>-</span> <span class=free>a12</span> <span class=main>*</span> <span class=free>x2</span><span class=main>)</span> <span class=main>+</span> <span class=free>a22</span> <span class=main>*</span> <span class=free>x2</span> <span class=main>*</span> <span class=free>a11</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span>  <span class=quoted><span class=quoted>‹<span class=free>a11</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a11</span><span class=main>*</span><span class=free>a22</span> <span class=main>-</span> <span class=free>a12</span><span class=main>*</span><span class=free>a21</span><span class=main>)</span><span class=main>*</span><span class=free>x2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> assms<span class=main>(</span>2<span class=main>)</span> <span class=quoted><span class=quoted>‹<span class=free>a11</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Regular system has a unique solution›</span></span>
<span class=keyword1 id=Linear_Systems-regular_system><span class=command>lemma</span></span> regular_system<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a11</span> <span class=free>a12</span> <span class=free>a21</span> <span class=free>a22</span> <span class=free>b1</span> <span class=free>b2</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>field"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"det2 <span class=free>a11</span> <span class=free>a12</span> <span class=free>a21</span> <span class=free>a22</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>x</span><span class=main>.</span> <span class=free>a11</span><span class=main>*</span><span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span> <span class=main>+</span> <span class=free>a12</span><span class=main>*</span><span class=main>(</span>snd <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>b1</span> <span class=main>∧</span>
               <span class=free>a21</span><span class=main>*</span><span class=main>(</span>fst <span class=bound>x</span><span class=main>)</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=main>(</span>snd <span class=bound>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>b2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?d</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>a11</span><span class=main>*</span><span class=free>a22</span> <span class=main>-</span> <span class=free>a12</span><span class=main>*</span><span class=free>a21</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?d1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>b1</span><span class=main>*</span><span class=free>a22</span> <span class=main>-</span> <span class=free>b2</span><span class=main>*</span><span class=free>a12</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?d2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>b2</span><span class=main>*</span><span class=free>a11</span> <span class=main>-</span> <span class=free>b1</span><span class=main>*</span><span class=free>a21</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?x</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?d1</span> <span class=main>/</span> <span class=var>?d</span><span class=main>,</span> <span class=var>?d2</span> <span class=main>/</span> <span class=var>?d</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a11</span> <span class=main>*</span> <span class=var>?d1</span> <span class=main>+</span> <span class=free>a12</span> <span class=main>*</span> <span class=var>?d2</span> <span class=main>=</span> <span class=free>b1</span><span class=main>*</span><span class=var>?d</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>a21</span> <span class=main>*</span> <span class=var>?d1</span> <span class=main>+</span> <span class=free>a22</span> <span class=main>*</span> <span class=var>?d2</span> <span class=main>=</span> <span class=free>b2</span><span class=main>*</span><span class=var>?d</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>a11</span> <span class=main>*</span> fst <span class=var>?x</span> <span class=main>+</span> <span class=free>a12</span> <span class=main>*</span> snd <span class=var>?x</span> <span class=main>=</span> <span class=free>b1</span> <span class=main>∧</span> <span class=free>a21</span> <span class=main>*</span> fst <span class=var>?x</span> <span class=main>+</span> <span class=free>a22</span> <span class=main>*</span> snd <span class=var>?x</span> <span class=main>=</span> <span class=free>b2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>hide_lams<span class=main><span class=main>,</span></span> no_types<span class=main><span class=main>)</span></span> det2_def add_divide_distrib eq_divide_imp fst_eqD snd_eqD times_divide_eq_right<span class=main>)</span>

  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>a11</span> <span class=main>*</span> fst <span class=skolem>x'</span> <span class=main>+</span> <span class=free>a12</span> <span class=main>*</span> snd <span class=skolem>x'</span> <span class=main>=</span> <span class=free>b1</span> <span class=main>∧</span> <span class=free>a21</span> <span class=main>*</span> fst <span class=skolem>x'</span> <span class=main>+</span> <span class=free>a22</span> <span class=main>*</span> snd <span class=skolem>x'</span> <span class=main>=</span> <span class=free>b2</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> <span class=quoted><span class=quoted>‹<span class=free>a11</span> <span class=main>*</span> fst <span class=var>?x</span> <span class=main>+</span> <span class=free>a12</span> <span class=main>*</span> snd <span class=var>?x</span> <span class=main>=</span> <span class=free>b1</span> <span class=main>∧</span> <span class=free>a21</span> <span class=main>*</span> fst <span class=var>?x</span> <span class=main>+</span> <span class=free>a22</span> <span class=main>*</span> snd <span class=var>?x</span> <span class=main>=</span> <span class=free>b2</span>›</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a11</span> <span class=main>*</span> <span class=main>(</span>fst <span class=skolem>x'</span> <span class=main>-</span> fst <span class=var>?x</span><span class=main>)</span> <span class=main>+</span> <span class=free>a12</span> <span class=main>*</span> <span class=main>(</span>snd <span class=skolem>x'</span> <span class=main>-</span> snd <span class=var>?x</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>a21</span> <span class=main>*</span> <span class=main>(</span>fst <span class=skolem>x'</span> <span class=main>-</span> fst <span class=var>?x</span><span class=main>)</span> <span class=main>+</span> <span class=free>a22</span> <span class=main>*</span> <span class=main>(</span>snd <span class=skolem>x'</span> <span class=main>-</span> snd <span class=var>?x</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x'</span> <span class=main>=</span> <span class=var>?x</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> regular_homogenous_system<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"fst <span class=skolem>x'</span> <span class=main>-</span> fst <span class=var>?x</span>"</span></span> <span class=quoted><span class=quoted>"snd <span class=skolem>x'</span> <span class=main>-</span> snd <span class=var>?x</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>x'</span></span><span class=main>)</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Singular system does not have a unique solution›</span></span>
<span class=keyword1 id=Linear_Systems-singular_system><span class=command>lemma</span></span> singular_system<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a11</span> <span class=free>a12</span> <span class=free>a21</span> <span class=free>a22</span> <span class=main>::</span><span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>field"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"det2 <span class=free>a11</span> <span class=free>a12</span> <span class=free>a21</span> <span class=free>a22</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a11</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>a12</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> x0<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a11</span><span class=main>*</span>fst <span class=free>x0</span> <span class=main>+</span> <span class=free>a12</span><span class=main>*</span>snd <span class=free>x0</span> <span class=main>=</span> <span class=free>b1</span>"</span></span>
              <span class=quoted><span class=quoted>"<span class=free>a21</span><span class=main>*</span>fst <span class=free>x0</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span>snd <span class=free>x0</span> <span class=main>=</span> <span class=free>b2</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> x<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a11</span><span class=main>*</span>fst <span class=free>x</span> <span class=main>+</span> <span class=free>a12</span><span class=main>*</span>snd <span class=free>x</span> <span class=main>=</span> <span class=free>b1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a21</span><span class=main>*</span>fst <span class=free>x</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span>snd <span class=free>x</span> <span class=main>=</span> <span class=free>b2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>a11</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>with</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a21</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>a12</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?k</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>a22</span> <span class=main>/</span> <span class=free>a12</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>b2</span> <span class=main>=</span> <span class=var>?k</span> <span class=main>*</span> <span class=free>b1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> x0 <span class=quoted><span class=quoted>‹<span class=free>a11</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a21</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a12</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a11</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a21</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a12</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> x
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?k</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>a21</span> <span class=main>/</span> <span class=free>a11</span>"</span></span>
  <span class=keyword1><span class=command>from</span></span> x
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?k</span> <span class=main>*</span> <span class=free>a11</span> <span class=main>*</span> fst <span class=free>x</span> <span class=main>+</span> <span class=var>?k</span> <span class=main>*</span> <span class=free>a12</span> <span class=main>*</span> snd <span class=free>x</span> <span class=main>=</span> <span class=var>?k</span> <span class=main>*</span> <span class=free>b1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a11</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a21</span> <span class=main>=</span> <span class=var>?k</span> <span class=main>*</span> <span class=free>a11</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>a22</span> <span class=main>=</span> <span class=var>?k</span> <span class=main>*</span> <span class=free>a12</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>b2</span> <span class=main>=</span> <span class=var>?k</span> <span class=main>*</span> <span class=free>b1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> x0 <span class=quoted><span class=quoted>‹<span class=free>a11</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹All solutions of a homogenous system of 2 equations with 3 unknows are proportional›</span></span>
<span class=keyword1 id=Linear_Systems-linear_system_homogenous_3_2><span class=command>lemma</span></span> linear_system_homogenous_3_2<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a11</span> <span class=free>a12</span> <span class=free>a13</span> <span class=free>a21</span> <span class=free>a22</span> <span class=free>a23</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>z1</span> <span class=free>x2</span> <span class=free>y2</span> <span class=free>z2</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=tfree>'a</span><span class=main>::</span>field"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>f1</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span> <span class=bound>z</span><span class=main>.</span> <span class=free>a11</span> <span class=main>*</span> <span class=bound>x</span> <span class=main>+</span> <span class=free>a12</span> <span class=main>*</span> <span class=bound>y</span> <span class=main>+</span> <span class=free>a13</span> <span class=main>*</span> <span class=bound>z</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>f2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span> <span class=bound>z</span><span class=main>.</span> <span class=free>a21</span> <span class=main>*</span> <span class=bound>x</span> <span class=main>+</span> <span class=free>a22</span> <span class=main>*</span> <span class=bound>y</span> <span class=main>+</span> <span class=free>a23</span> <span class=main>*</span> <span class=bound>z</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>f1</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>z1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>f2</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>z1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>f1</span> <span class=free>x2</span> <span class=free>y2</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>f2</span> <span class=free>x2</span> <span class=free>y2</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>y2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"det2 <span class=free>a11</span> <span class=free>a12</span> <span class=free>a21</span> <span class=free>a22</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> det2 <span class=free>a11</span> <span class=free>a13</span> <span class=free>a21</span> <span class=free>a23</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> det2 <span class=free>a12</span> <span class=free>a13</span> <span class=free>a22</span> <span class=free>a23</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>.</span> <span class=free>x1</span> <span class=main>=</span> <span class=bound>k</span> <span class=main>*</span> <span class=free>x2</span> <span class=main>∧</span> <span class=free>y1</span> <span class=main>=</span> <span class=bound>k</span> <span class=main>*</span> <span class=free>y2</span> <span class=main>∧</span> <span class=free>z1</span> <span class=main>=</span> <span class=bound>k</span> <span class=main>*</span> <span class=free>z2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Dz</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"det2 <span class=free>a11</span> <span class=free>a12</span> <span class=free>a21</span> <span class=free>a22</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Dy</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"det2 <span class=free>a11</span> <span class=free>a13</span> <span class=free>a21</span> <span class=free>a23</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Dx</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"det2 <span class=free>a12</span> <span class=free>a13</span> <span class=free>a22</span> <span class=free>a23</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a21</span> <span class=main>*</span> <span class=main>(</span><span class=free>f1</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>z1</span><span class=main>)</span> <span class=main>-</span> <span class=free>a11</span> <span class=main>*</span> <span class=main>(</span><span class=free>f2</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> yz1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?Dz</span><span class=main>*</span><span class=free>y1</span> <span class=main>+</span> <span class=var>?Dy</span><span class=main>*</span><span class=free>z1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a21</span> <span class=main>*</span> <span class=main>(</span><span class=free>f1</span> <span class=free>x2</span> <span class=free>y2</span> <span class=free>z2</span><span class=main>)</span> <span class=main>-</span> <span class=free>a11</span> <span class=main>*</span> <span class=main>(</span><span class=free>f2</span> <span class=free>x2</span> <span class=free>y2</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> yz2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?Dz</span><span class=main>*</span><span class=free>y2</span> <span class=main>+</span> <span class=var>?Dy</span><span class=main>*</span><span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
                                     
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a22</span> <span class=main>*</span> <span class=main>(</span><span class=free>f1</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>z1</span><span class=main>)</span> <span class=main>-</span> <span class=free>a12</span> <span class=main>*</span> <span class=main>(</span><span class=free>f2</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>                          
  <span class=keyword1><span class=command>hence</span></span> xz1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=var>?Dz</span><span class=main>*</span><span class=free>x1</span> <span class=main>+</span> <span class=var>?Dx</span><span class=main>*</span><span class=free>z1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a22</span> <span class=main>*</span> <span class=main>(</span><span class=free>f1</span> <span class=free>x2</span> <span class=free>y2</span> <span class=free>z2</span><span class=main>)</span> <span class=main>-</span> <span class=free>a12</span> <span class=main>*</span> <span class=main>(</span><span class=free>f2</span> <span class=free>x2</span> <span class=free>y2</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>                          
  <span class=keyword1><span class=command>hence</span></span> xz2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=var>?Dz</span><span class=main>*</span><span class=free>x2</span> <span class=main>+</span> <span class=var>?Dx</span><span class=main>*</span><span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a23</span> <span class=main>*</span> <span class=main>(</span><span class=free>f1</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>z1</span><span class=main>)</span> <span class=main>-</span> <span class=free>a13</span> <span class=main>*</span> <span class=main>(</span><span class=free>f2</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>                          
  <span class=keyword1><span class=command>hence</span></span> xy1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?Dy</span><span class=main>*</span><span class=free>x1</span> <span class=main>+</span> <span class=var>?Dx</span><span class=main>*</span><span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a23</span> <span class=main>*</span> <span class=main>(</span><span class=free>f1</span> <span class=free>x2</span> <span class=free>y2</span> <span class=free>z2</span><span class=main>)</span> <span class=main>-</span> <span class=free>a13</span> <span class=main>*</span> <span class=main>(</span><span class=free>f2</span> <span class=free>x2</span> <span class=free>y2</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>                          
  <span class=keyword1><span class=command>hence</span></span> xy2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?Dy</span><span class=main>*</span><span class=free>x2</span> <span class=main>+</span> <span class=var>?Dx</span><span class=main>*</span><span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=var>?Dz</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=var>?Dy</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=var>?Dx</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?Dz</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    
    <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span>
      <span class=quoted><span class=quoted>"<span class=free>x2</span> <span class=main>=</span> <span class=main>(</span><span class=var>?Dx</span> <span class=main>/</span> <span class=var>?Dz</span><span class=main>)</span> <span class=main>*</span> <span class=free>z2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>y2</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=var>?Dy</span> <span class=main>/</span> <span class=var>?Dz</span><span class=main>)</span> <span class=main>*</span> <span class=free>z2</span>"</span></span>
      <span class=quoted><span class=quoted>"<span class=free>x1</span> <span class=main>=</span> <span class=main>(</span><span class=var>?Dx</span> <span class=main>/</span> <span class=var>?Dz</span><span class=main>)</span> <span class=main>*</span> <span class=free>z1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>y1</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=var>?Dy</span> <span class=main>/</span> <span class=var>?Dz</span><span class=main>)</span> <span class=main>*</span> <span class=free>z1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> xy2 xz2 xy1 xz1 yz1 yz2
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>     

    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>y2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=var>?Dz</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>z1</span><span class=main>/</span><span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?Dy</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span>
      <span class=quoted><span class=quoted>"<span class=free>x2</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=var>?Dx</span> <span class=main>/</span> <span class=var>?Dy</span><span class=main>)</span> <span class=main>*</span> <span class=free>y2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=var>?Dz</span> <span class=main>/</span> <span class=var>?Dy</span><span class=main>)</span> <span class=main>*</span> <span class=free>y2</span>"</span></span>
      <span class=quoted><span class=quoted>"<span class=free>x1</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=var>?Dx</span> <span class=main>/</span> <span class=var>?Dy</span><span class=main>)</span> <span class=main>*</span> <span class=free>y1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=var>?Dz</span> <span class=main>/</span> <span class=var>?Dy</span><span class=main>)</span> <span class=main>*</span> <span class=free>y1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> xy2 xz2 xy1 xz1 yz1 yz2
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>     

    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>y2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>y2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=var>?Dy</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>y1</span><span class=main>/</span><span class=free>y2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?Dx</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span>
      <span class=quoted><span class=quoted>"<span class=free>y2</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=var>?Dy</span> <span class=main>/</span> <span class=var>?Dx</span><span class=main>)</span> <span class=main>*</span> <span class=free>x2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>=</span> <span class=main>(</span><span class=var>?Dz</span> <span class=main>/</span> <span class=var>?Dx</span><span class=main>)</span> <span class=main>*</span> <span class=free>x2</span>"</span></span>
      <span class=quoted><span class=quoted>"<span class=free>y1</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span><span class=var>?Dy</span> <span class=main>/</span> <span class=var>?Dx</span><span class=main>)</span> <span class=main>*</span> <span class=free>x1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>=</span> <span class=main>(</span><span class=var>?Dz</span> <span class=main>/</span> <span class=var>?Dx</span><span class=main>)</span> <span class=main>*</span> <span class=free>x1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> xy2 xz2 xy1 xz1 yz1 yz2
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>     

    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>x2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>y2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=var>?Dx</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>x1</span><span class=main>/</span><span class=free>x2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Quadratic>
<div class=head>
<h1>Theory Quadratic</h1>
</div>
<pre class=source><span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Quadratic equations›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In this section some simple properties of quadratic equations and their roots are derived.
Quadratic equations over reals and over complex numbers, but also systems of quadratic equations and
systems of quadratic and linear equations are analysed.›</span></span>

<span class=keyword1><span class=command>theory</span></span> Quadratic
  <span class=keyword2><span class=keyword>imports</span></span> <a href=#More_Complex>More_Complex</a> <span class=quoted>"<a href=https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Library/Quadratic_Discriminant.html>HOL-Library.Quadratic_Discriminant</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Real quadratic equations, Viette rules›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id=Quadratic-viette2_monic><span class=command>lemma</span></span> viette2_monic<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>b</span> <span class=free>c</span> <span class=free>ξ1</span> <span class=free>ξ2</span> <span class=main>::</span> <span class=quoted>real</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span> <span class=main>≥</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span><span class=main>*</span><span class=free>ξ1</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span><span class=main>*</span><span class=free>ξ2</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ1</span> <span class=main>≠</span> <span class=free>ξ2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ1</span><span class=main>*</span><span class=free>ξ2</span> <span class=main>=</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>algebra</span>

<span class=keyword1 id=Quadratic-viette2><span class=command>lemma</span></span> viette2<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>ξ1</span> <span class=free>ξ2</span> <span class=main>::</span> <span class=quoted>real</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>a</span><span class=main>*</span><span class=free>c</span> <span class=main>≥</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span><span class=main>*</span><span class=free>ξ1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span><span class=main>*</span><span class=free>ξ1</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span><span class=main>*</span><span class=free>ξ2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span><span class=main>*</span><span class=free>ξ2</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ1</span> <span class=main>≠</span> <span class=free>ξ2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ1</span><span class=main>*</span><span class=free>ξ2</span> <span class=main>=</span> <span class=free>c</span><span class=main>/</span><span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> viette2_monic<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>b</span></span><span class=main><span class=main>/</span></span><span class=free><span class=free>a</span></span>"</span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>c</span></span><span class=main><span class=main>/</span></span><span class=free><span class=free>a</span></span>"</span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>ξ1</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>ξ2</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>c</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>a</span><span class=main>*</span><span class=free>c</span><span class=main>)</span> <span class=main>/</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>c</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>a</span><span class=main>*</span><span class=free>c</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span> <span class=main>/</span> <span class=free>a</span> <span class=main>*</span> <span class=free>ξ1</span> <span class=main>+</span> <span class=free>c</span> <span class=main>/</span> <span class=free>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span> <span class=main>/</span> <span class=free>a</span> <span class=main>*</span> <span class=free>ξ2</span> <span class=main>+</span> <span class=free>c</span> <span class=main>/</span> <span class=free>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ1</span> <span class=main>≠</span> <span class=free>ξ2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fact</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Quadratic-viette2'_monic"><span class=command>lemma</span></span> viette2'_monic<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>b</span> <span class=free>c</span> <span class=free>ξ</span> <span class=main>::</span> <span class=quoted>real</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span><span class=main>*</span><span class=free>ξ</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span><span class=main>*</span><span class=free>ξ</span> <span class=main>=</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>algebra</span>

<span class=keyword1 id="Quadratic-viette2'"><span class=command>lemma</span></span> viette2'<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>ξ</span> <span class=main>::</span> <span class=quoted>real</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>a</span><span class=main>*</span><span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span><span class=main>*</span><span class=free>ξ</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span><span class=main>*</span><span class=free>ξ</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span><span class=main>*</span><span class=free>ξ</span> <span class=main>=</span> <span class=free>c</span><span class=main>/</span><span class=free>a</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> viette2'_monic<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>c</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>a</span><span class=main>*</span><span class=free>c</span><span class=main>)</span> <span class=main>/</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>c</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>a</span><span class=main>*</span><span class=free>c</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span> <span class=main>/</span> <span class=free>a</span> <span class=main>*</span> <span class=free>ξ</span> <span class=main>+</span> <span class=free>c</span> <span class=main>/</span> <span class=free>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Complex quadratic equations›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id=Quadratic-complex_quadratic_equation_monic_only_two_roots><span class=command>lemma</span></span> complex_quadratic_equation_monic_only_two_roots<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>ξ</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span> <span class=main>*</span> <span class=free>ξ</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=free>b</span> <span class=main>+</span> ccsqrt<span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span> <span class=main>∨</span> <span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=free>b</span> <span class=main>-</span> ccsqrt<span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>ξ</span> <span class=main>+</span> <span class=free>b</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
       <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> distrib_right_numeral mult.assoc mult_zero_left<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>ξ</span> <span class=main>+</span> <span class=free>b</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span> <span class=main>=</span> ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span><span class=main>)</span> <span class=main>∨</span> <span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>ξ</span> <span class=main>+</span> <span class=free>b</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ccsqrt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>ξ</span> <span class=main>+</span> <span class=free>b</span> <span class=main>/</span> <span class=numeral>2</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>c</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> mult_cancel_right<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>+</span> <span class=free>ξ</span> <span class=main>*</span> <span class=numeral>2</span>"</span></span> <span class=quoted><span class=numeral>2</span></span> <span class=quoted><span class=quoted>"ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> mult_cancel_right<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>+</span> <span class=free>ξ</span> <span class=main>*</span> <span class=numeral>2</span>"</span></span> <span class=quoted><span class=numeral>2</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> add_diff_cancel diff_minus_eq_add minus_diff_eq<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Quadratic-complex_quadratic_equation_monic_roots><span class=command>lemma</span></span> complex_quadratic_equation_monic_roots<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>ξ</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=free>b</span> <span class=main>+</span> ccsqrt<span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span> <span class=main>∨</span>
           <span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=free>b</span> <span class=main>-</span> ccsqrt<span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=free>ξ</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span> <span class=main>*</span> <span class=free>ξ</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> <span class=free>b</span> <span class=main>+</span> ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>subst</span> power_divide<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> power2_sum<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> <span class=free>b</span> <span class=main>-</span> ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> power_divide<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> power2_diff<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Quadratic-complex_quadratic_equation_monic_distinct_roots><span class=command>lemma</span></span> complex_quadratic_equation_monic_distinct_roots<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>b</span> <span class=free>c</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∧</span> <span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span><span class=main>*</span><span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span><span class=main>*</span><span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ξ1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=free>b</span> <span class=main>+</span> ccsqrt<span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?ξ2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=free>b</span> <span class=main>-</span> ccsqrt<span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?ξ1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?ξ2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> assms 
    <span class=keyword1><span class=command>using</span></span> complex_quadratic_equation_monic_roots<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?ξ1</span></span></span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>c</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> complex_quadratic_equation_monic_roots<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?ξ2</span></span></span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>c</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Quadratic-complex_quadratic_equation_two_roots><span class=command>lemma</span></span> complex_quadratic_equation_two_roots<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>ξ</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span><span class=main>*</span><span class=free>ξ</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span> <span class=main>*</span> <span class=free>ξ</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=free>b</span> <span class=main>+</span> ccsqrt<span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>a</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=free>a</span><span class=main>)</span> <span class=main>∨</span>
         <span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=free>b</span> <span class=main>-</span> ccsqrt<span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=free>a</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=free>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=free>b</span><span class=main>/</span><span class=free>a</span><span class=main>)</span> <span class=main>*</span> <span class=free>ξ</span> <span class=main>+</span> <span class=main>(</span><span class=free>c</span><span class=main>/</span><span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>(</span><span class=free>b</span><span class=main>/</span><span class=free>a</span><span class=main>)</span> <span class=main>+</span> ccsqrt<span class=main>(</span><span class=main>(</span><span class=free>b</span><span class=main>/</span><span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=main>(</span><span class=free>c</span><span class=main>/</span><span class=free>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span> <span class=main>∨</span> <span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>(</span><span class=free>b</span><span class=main>/</span><span class=free>a</span><span class=main>)</span> <span class=main>-</span> ccsqrt<span class=main>(</span><span class=main>(</span><span class=free>b</span><span class=main>/</span><span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=main>(</span><span class=free>c</span><span class=main>/</span><span class=free>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_quadratic_equation_monic_only_two_roots<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>ξ</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span><span class=main>/</span><span class=free>a</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>c</span><span class=main>/</span><span class=free>a</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>.</span> <span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>(</span><span class=free>b</span><span class=main>/</span><span class=free>a</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>^</span><span class=bound>k</span> <span class=main>*</span> ccsqrt<span class=main>(</span><span class=main>(</span><span class=free>b</span><span class=main>/</span><span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=main>(</span><span class=free>c</span><span class=main>/</span><span class=free>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>safe</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k1</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>(</span><span class=free>b</span><span class=main>/</span><span class=free>a</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>^</span><span class=skolem>k1</span> <span class=main>*</span> ccsqrt<span class=main>(</span><span class=main>(</span><span class=free>b</span><span class=main>/</span><span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=main>(</span><span class=free>c</span><span class=main>/</span><span class=free>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>c</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>a</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ccsqrt <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>c</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>a</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> ccsqrt <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>∨</span>
         ccsqrt <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>c</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>a</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> ccsqrt <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ccsqrt_mult<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>a</span> <span class=main>*</span> <span class=free>c</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>.</span>  ccsqrt <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>c</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>^</span><span class=bound>k</span> <span class=main>*</span> ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>a</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> ccsqrt <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>safe</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"ccsqrt <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>c</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>^</span><span class=skolem>k2</span> <span class=main>*</span> ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>a</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> ccsqrt <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"ccsqrt <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span><span class=main>/</span><span class=free>a</span> <span class=main>∨</span> ccsqrt <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span><span class=main>/</span><span class=free>a</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ccsqrt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=free>a</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>/</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>.</span> ccsqrt <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>^</span><span class=bound>k</span> <span class=main>*</span> <span class=main>1</span><span class=main>/</span><span class=free>a</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>safe</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k3</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"ccsqrt <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>^</span><span class=skolem>k3</span> <span class=main>*</span> <span class=main>1</span><span class=main>/</span><span class=free>a</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>^</span> <span class=skolem>k1</span> <span class=main>*</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>^</span> <span class=skolem>k2</span> <span class=main>*</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>^</span> <span class=skolem>k3</span><span class=main>)</span> <span class=main>*</span> ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>a</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> <span class=main>1</span><span class=main>/</span><span class=free>a</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=main>(</span><span class=main>1</span><span class=main>::</span>complex<span class=main>)</span><span class=main>)</span> <span class=main>^</span> <span class=skolem>k1</span> <span class=main>*</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>^</span> <span class=skolem>k2</span> <span class=main>*</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>^</span> <span class=skolem>k3</span> <span class=main>=</span> <span class=main>1</span> <span class=main>∨</span> <span class=main>(</span><span class=main>-</span><span class=main>(</span><span class=main>1</span><span class=main>::</span>complex<span class=main>)</span><span class=main>)</span> <span class=main>^</span> <span class=skolem>k1</span> <span class=main>*</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>^</span> <span class=skolem>k2</span> <span class=main>*</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>^</span> <span class=skolem>k3</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> neg_one_even_power<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>k1</span> <span class=main>+</span> <span class=skolem>k2</span> <span class=main>+</span> <span class=skolem>k3</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> neg_one_odd_power<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>k1</span> <span class=main>+</span> <span class=skolem>k2</span> <span class=main>+</span> <span class=skolem>k3</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> power_add<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span> <span class=main>+</span> ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>a</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> <span class=main>1</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span> <span class=main>∨</span> <span class=free>ξ</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=free>b</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span> <span class=main>-</span> ccsqrt <span class=main>(</span><span class=free>b</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>a</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> <span class=main>1</span> <span class=main>/</span> <span class=free>a</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Quadratic-complex_quadratic_equation_only_two_roots><span class=command>lemma</span></span> complex_quadratic_equation_only_two_roots<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span><span class=main>.</span> <span class=free>a</span><span class=main>*</span><span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=free>x1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=free>x2</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x1</span> <span class=main>≠</span> <span class=free>x2</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>x1</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> complex_quadratic_equation_two_roots
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>


<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Intersections of linear and quadratic forms›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=comment1>(* These lemmas are not used *)</span>

<span class=keyword1 id=Quadratic-quadratic_linear_at_most_2_intersections_help><span class=command>lemma</span></span> quadratic_linear_at_most_2_intersections_help<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a11</span><span class=main>,</span> <span class=free>a12</span><span class=main>,</span> <span class=free>a22</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>a11</span><span class=main>*</span><span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=bound>x</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>lf</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>k1</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>k2</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>lf</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>pf</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=free>a11</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>*</span><span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k2</span>  <span class=main>+</span> <span class=free>b1</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=numeral>2</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>b2</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>n</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>b2</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k2</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>yf</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=bound>x</span><span class=main>)</span> <span class=main>/</span> <span class=free>k2</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>pf</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=free>yf</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>-</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=free>yf</span> <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span> eq_neg_iff_add_eq_0<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>x</span><span class=main>*</span><span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=free>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main>*</span><span class=free>x</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>algebra</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a22</span><span class=main>*</span><span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=free>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=free>a22</span><span class=main>*</span><span class=free>n</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=free>a22</span><span class=main>*</span><span class=numeral>2</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_divide<span class=main>)</span> <span class=operator>algebra</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>x</span><span class=main>*</span><span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=free>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main>*</span><span class=free>x</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>algebra</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>b2</span><span class=main>*</span><span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=free>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span> <span class=main>=</span> <span class=main>-</span><span class=free>b2</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k2</span> <span class=main>-</span> <span class=main>(</span><span class=free>b2</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main>*</span><span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>algebra</span>

  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=free>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>,</span> 4<span class=main>,</span> 6<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span> eq_neg_iff_add_eq_0<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=free>a11</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>x</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>c</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=free>a11</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>x</span><span class=main>*</span><span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=free>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=free>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=free>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span> <span class=main>+</span> <span class=free>c</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> *<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=main>(</span><span class=free>a11</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k2</span>  <span class=main>+</span> <span class=free>b1</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=numeral>2</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>b2</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>n</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span><span class=free>b2</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k2</span> <span class=main>+</span> <span class=free>c</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>x</span><span class=main>*</span><span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=free>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main>*</span><span class=free>x</span> <span class=main>-</span> <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a22</span><span class=main>*</span><span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=free>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=free>a22</span><span class=main>*</span><span class=free>n</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=free>a22</span><span class=main>*</span><span class=numeral>2</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>b2</span><span class=main>*</span><span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=free>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span> <span class=main>=</span> <span class=main>-</span><span class=free>b2</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k2</span> <span class=main>-</span> <span class=main>(</span><span class=free>b2</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main>*</span><span class=free>x</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>pf</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>7<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Quadratic-quadratic_linear_at_most_2_intersections_help'"><span class=command>lemma</span></span> quadratic_linear_at_most_2_intersections_help'<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>a11</span><span class=main>*</span><span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=bound>x</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>yf</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>y</span><span class=main>.</span> <span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>*</span><span class=free>a22</span><span class=main>*</span><span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>a11</span><span class=main>*</span><span class=free>n</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>b1</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>yf</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=free>a11</span><span class=main>*</span><span class=free>n</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>y</span><span class=main>/</span><span class=free>k1</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>b1</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>c</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>,</span> 4<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_divide<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=free>a11</span><span class=main>*</span><span class=free>n</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>b1</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>algebra</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span> 4<span class=main>,</span> 5<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Quadratic-quadratic_linear_at_most_2_intersections><span class=command>lemma</span></span> quadratic_linear_at_most_2_intersections<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a11</span><span class=main>,</span> <span class=free>a12</span><span class=main>,</span> <span class=free>a22</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k1</span><span class=main>,</span> <span class=free>k2</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a11</span><span class=main>*</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>k1</span><span class=main>*</span><span class=free>k2</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>a11</span><span class=main>*</span><span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=bound>x</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>lf</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>k1</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>k2</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>n</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=free>x1</span> <span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>lf</span> <span class=free>x1</span> <span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>lf</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x1</span><span class=main>,</span> <span class=free>y1</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=free>x2</span><span class=main>,</span> <span class=free>y2</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>lf</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x1</span><span class=main>,</span> <span class=free>y1</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x2</span><span class=main>,</span> <span class=free>y2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>k2</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span> True
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x1</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> assms<span class=main>(</span>5<span class=main>,</span> 7<span class=main>)</span> True
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.right_neutral add_eq_0_iff2 mult_zero_left nonzero_mult_div_cancel_left<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x2</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> assms<span class=main>(</span>5<span class=main>,</span> 9<span class=main>)</span> True
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.right_neutral add_eq_0_iff2 mult_zero_left nonzero_mult_div_cancel_left<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> assms<span class=main>(</span>5<span class=main>,</span> 12<span class=main>)</span> True
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add.right_neutral add_eq_0_iff2 mult_zero_left nonzero_mult_div_cancel_left<span class=main>)</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?yf</span></span></span> <span class=main>=</span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span> <span class=bound>y</span><span class=main>.</span> <span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>*</span><span class=free>a22</span><span class=main>*</span><span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>a11</span><span class=main>*</span><span class=free>n</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>b1</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?yf</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> quadratic_linear_at_most_2_intersections_help'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>qf</span></span> <span class=quoted><span class=free>a11</span></span> <span class=quoted><span class=free>a12</span></span> <span class=quoted><span class=free>a22</span></span> <span class=quoted><span class=free>b1</span></span> <span class=quoted><span class=free>b2</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>k1</span></span> <span class=quoted><span class=free>y</span></span> <span class=var><span class=quoted><span class=var>?yf</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>,</span> 11<span class=main>)</span> <span class=quoted><span class=quoted>‹<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?yf</span> <span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> quadratic_linear_at_most_2_intersections_help'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>qf</span></span> <span class=quoted><span class=free>a11</span></span> <span class=quoted><span class=free>a12</span></span> <span class=quoted><span class=free>a22</span></span> <span class=quoted><span class=free>b1</span></span> <span class=quoted><span class=free>b2</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>x1</span></span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>k1</span></span> <span class=quoted><span class=free>y1</span></span> <span class=var><span class=quoted><span class=var>?yf</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>,</span> 6<span class=main>)</span> <span class=quoted><span class=quoted>‹<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>x1</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?yf</span> <span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> quadratic_linear_at_most_2_intersections_help'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>qf</span></span> <span class=quoted><span class=free>a11</span></span> <span class=quoted><span class=free>a12</span></span> <span class=quoted><span class=free>a22</span></span> <span class=quoted><span class=free>b1</span></span> <span class=quoted><span class=free>b2</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>x2</span></span> <span class=quoted><span class=free>n</span></span> <span class=quoted><span class=free>k1</span></span> <span class=quoted><span class=free>y2</span></span> <span class=var><span class=quoted><span class=var>?yf</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>,</span> 8<span class=main>)</span> <span class=quoted><span class=quoted>‹<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>x2</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>y1</span> <span class=main>≠</span> <span class=free>y2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>10<span class=main>)</span> <span class=quoted><span class=quoted>‹<span class=free>x1</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>x2</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=free>y1</span> <span class=main>∨</span> <span class=free>y</span> <span class=main>=</span> <span class=free>y2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_quadratic_equation_only_two_roots<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=var><span class=quoted><span class=var>?yf</span></span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>a11</span><span class=main>*</span><span class=free>n</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>b1</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span> <span class=main>+</span> <span class=free>c</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
                                                        <span class=quoted><span class=free>y1</span></span> <span class=quoted><span class=free>y2</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=var>?yf</span> <span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>y1</span> <span class=main>≠</span> <span class=free>y2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=var>?yf</span> <span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=var>?yf</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x1</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>x2</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>›</span></span>  <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>=</span> <span class=main>-</span><span class=free>n</span><span class=main>/</span><span class=free>k1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?py</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span> <span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=main>-</span><span class=free>n</span> <span class=main>-</span> <span class=free>k1</span><span class=main>*</span><span class=bound>x</span><span class=main>)</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?pf</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span> <span class=bound>x</span><span class=main>.</span> <span class=main>(</span><span class=free>a11</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>*</span><span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=main>-</span><span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k2</span>  <span class=main>+</span> <span class=free>b1</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=numeral>2</span><span class=main>*</span><span class=free>n</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>b2</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span><span class=main>)</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>n</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span><span class=free>b2</span><span class=main>*</span><span class=free>n</span><span class=main>/</span><span class=free>k2</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?pf</span> <span class=free>x1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>y1</span> <span class=main>=</span> <span class=var>?py</span> <span class=free>x1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> quadratic_linear_at_most_2_intersections_help<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a11</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a12</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a22</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>k2</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>qf</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b1</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b2</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>c</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>lf</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>k1</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>x1</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>y1</span></span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span> 4<span class=main>,</span> 5<span class=main>,</span> 6<span class=main>,</span> 7<span class=main>)</span> False
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?pf</span> <span class=free>x2</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>y2</span> <span class=main>=</span> <span class=var>?py</span> <span class=free>x2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> quadratic_linear_at_most_2_intersections_help<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a11</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a12</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a22</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>k2</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>qf</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b1</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b2</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>c</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>lf</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>k1</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>x2</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>y2</span></span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span> 4<span class=main>,</span> 5<span class=main>,</span> 8<span class=main>,</span> 9<span class=main>)</span> False
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?pf</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=var>?py</span> <span class=free>x</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> quadratic_linear_at_most_2_intersections_help<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>a11</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a12</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>a22</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>k2</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>qf</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b1</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>b2</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>c</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>lf</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>k1</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>n</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>y</span></span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span> 4<span class=main>,</span> 5<span class=main>,</span> 11<span class=main>,</span> 12<span class=main>)</span> False
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x1</span> <span class=main>≠</span> <span class=free>x2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>10<span class=main>)</span> <span class=quoted><span class=quoted>‹<span class=free>y1</span> <span class=main>=</span> <span class=var>?py</span> <span class=free>x1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>y2</span> <span class=main>=</span> <span class=var>?py</span> <span class=free>x2</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a11</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>(</span><span class=free>a11</span> <span class=main>*</span> <span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>a12</span> <span class=main>*</span> <span class=free>k1</span> <span class=main>*</span> <span class=free>k2</span> <span class=main>+</span> <span class=free>a22</span> <span class=main>*</span> <span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> False power2_eq_square add_divide_distrib diff_divide_distrib<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span>  <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> False assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a11</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>.</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>x1</span> <span class=main>∨</span> <span class=free>x</span> <span class=main>=</span> <span class=free>x2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_quadratic_equation_only_two_roots<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>a11</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span><span class=free>a12</span><span class=main>*</span><span class=free>k1</span><span class=main>/</span><span class=free>k2</span> <span class=main>+</span> <span class=free>a22</span><span class=main>*</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=var><span class=quoted><span class=var>?pf</span></span></span>
                                                       <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>a12</span> <span class=main>*</span> <span class=free>n</span> <span class=main>/</span> <span class=free>k2</span> <span class=main>+</span> <span class=free>b1</span> <span class=main>+</span> <span class=free>a22</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>n</span> <span class=main>*</span> <span class=free>k1</span> <span class=main>/</span> <span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>b2</span> <span class=main>*</span> <span class=free>k1</span> <span class=main>/</span> <span class=free>k2</span><span class=main>)</span>"</span></span>
                                                       <span class=quoted><span class=quoted>"<span class=free>a22</span> <span class=main>*</span> <span class=free>n</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>b2</span> <span class=main>*</span> <span class=free>n</span> <span class=main>/</span> <span class=free>k2</span> <span class=main>+</span> <span class=free>c</span>"</span></span> <span class=quoted><span class=free>x1</span></span> <span class=quoted><span class=free>x2</span></span> <span class=quoted><span class=free>x</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=var>?pf</span> <span class=free>x2</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=var>?pf</span> <span class=free>x1</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=var>?pf</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a11</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>a12</span> <span class=main>*</span> <span class=free>k1</span> <span class=main>/</span> <span class=free>k2</span> <span class=main>+</span> <span class=free>a22</span> <span class=main>*</span> <span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x1</span> <span class=main>≠</span> <span class=free>x2</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>y</span> <span class=main>=</span> <span class=var>?py</span> <span class=free>x</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>y1</span> <span class=main>=</span> <span class=var>?py</span> <span class=free>x1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>y2</span> <span class=main>=</span> <span class=var>?py</span> <span class=free>x2</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>x1</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Quadratic-quadratic_quadratic_at_most_2_intersections'"><span class=command>lemma</span></span> quadratic_quadratic_at_most_2_intersections'<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>b2</span> <span class=main>≠</span> <span class=free>B2</span> <span class=main>∨</span> <span class=free>b1</span> <span class=main>≠</span> <span class=free>B1</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>qf1</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B1</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>B2</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>C</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf1</span> <span class=free>x1</span> <span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>qf2</span> <span class=free>x1</span> <span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf1</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>qf2</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x1</span><span class=main>,</span> <span class=free>y1</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=free>x2</span><span class=main>,</span> <span class=free>y2</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf1</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>qf2</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x1</span><span class=main>,</span> <span class=free>y1</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x2</span><span class=main>,</span> <span class=free>y2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B1</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>B2</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>C</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=main>(</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B1</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>B2</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>C</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>)</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=free>C</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span>  <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span> 
  
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x1</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y1</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B1</span><span class=main>*</span><span class=free>x1</span> <span class=main>+</span> <span class=free>B2</span><span class=main>*</span><span class=free>y1</span> <span class=main>+</span> <span class=free>C</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=free>x1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x1</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y1</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=main>(</span><span class=free>x1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B1</span><span class=main>*</span><span class=free>x1</span> <span class=main>+</span> <span class=free>B2</span><span class=main>*</span><span class=free>y1</span> <span class=main>+</span> <span class=free>C</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x1</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y1</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>)</span><span class=main>*</span><span class=free>x1</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span><span class=main>*</span><span class=free>y1</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=free>C</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span>  <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span> 

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x2</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y2</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B1</span><span class=main>*</span><span class=free>x2</span> <span class=main>+</span> <span class=free>B2</span><span class=main>*</span><span class=free>y2</span> <span class=main>+</span> <span class=free>C</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=free>x2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x2</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y2</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=main>(</span><span class=free>x2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B1</span><span class=main>*</span><span class=free>x2</span> <span class=main>+</span> <span class=free>B2</span><span class=main>*</span><span class=free>y2</span> <span class=main>+</span> <span class=free>C</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x2</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y2</span> <span class=main>+</span> <span class=free>c</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>)</span><span class=main>*</span><span class=free>x2</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span><span class=main>*</span><span class=free>y2</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=free>C</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span>  <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>  

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>,</span> <span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?lf</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>)</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=free>C</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?lf</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?lf</span> <span class=free>x1</span> <span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?lf</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>)</span><span class=main>*</span><span class=free>x2</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span><span class=main>*</span><span class=free>y2</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=free>C</span>›</span></span>
          <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>)</span><span class=main>*</span><span class=free>x1</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span><span class=main>*</span><span class=free>y1</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=free>C</span>›</span></span>
          <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>=</span> <span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>)</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=free>C</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> quadratic_linear_at_most_2_intersections<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>1</span></span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=main>1</span></span> <span class=quoted><span class=quoted>"<span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span>"</span></span> <span class=quoted><span class=free>qf1</span></span> <span class=quoted><span class=free>b1</span></span> <span class=quoted><span class=free>b2</span></span> <span class=quoted><span class=free>c</span></span> <span class=var><span class=quoted><span class=var>?lf</span></span></span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>-</span> <span class=free>C</span>"</span></span> <span class=quoted><span class=free>x1</span></span> <span class=quoted><span class=free>y1</span></span> <span class=quoted><span class=free>x2</span></span> <span class=quoted><span class=free>y2</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>,</span> <span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>,</span> <span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>)</span> <span class=main>*</span> <span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span> <span class=main>*</span> <span class=free>y</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=free>C</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>b1</span> <span class=main>-</span> <span class=free>B1</span><span class=main>)</span> <span class=main>*</span> <span class=free>x1</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>)</span> <span class=main>*</span> <span class=free>y1</span> <span class=main>+</span> <span class=free>c</span> <span class=main>-</span> <span class=free>C</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add_diff_eq<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Quadratic-quadratic_change_coefficients><span class=command>lemma</span></span> quadratic_change_coefficients<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>A1</span><span class=main>*</span><span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>A1</span><span class=main>*</span><span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf_1</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=free>b1</span><span class=main>/</span><span class=free>A1</span><span class=main>)</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span><span class=main>/</span><span class=free>A1</span><span class=main>)</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>c</span><span class=main>/</span><span class=free>A1</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>qf_1</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=free>A1</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>A1</span><span class=main>*</span><span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>c</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span><span class=main>/</span><span class=free>A1</span> <span class=main>=</span> <span class=main>(</span><span class=free>A1</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>A1</span><span class=main>*</span><span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span><span class=main>/</span><span class=free>A1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=free>A1</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>A1</span> <span class=main>+</span> <span class=free>A1</span><span class=main>*</span><span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>/</span><span class=free>A1</span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=free>x</span><span class=main>/</span><span class=free>A1</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=free>y</span><span class=main>/</span><span class=free>A1</span> <span class=main>+</span> <span class=free>c</span><span class=main>/</span><span class=free>A1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add_divide_distrib<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=free>b1</span><span class=main>/</span><span class=free>A1</span><span class=main>)</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span><span class=main>/</span><span class=free>A1</span><span class=main>)</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>c</span><span class=main>/</span><span class=free>A1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>=</span> <span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=free>b1</span><span class=main>/</span><span class=free>A1</span><span class=main>)</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span><span class=main>/</span><span class=free>A1</span><span class=main>)</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>c</span><span class=main>/</span><span class=free>A1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Quadratic-quadratic_quadratic_at_most_2_intersections><span class=command>lemma</span></span> quadratic_quadratic_at_most_2_intersections<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>x1</span> <span class=free>y1</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>A2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>qf1</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>A1</span><span class=main>*</span><span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>A1</span><span class=main>*</span><span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>b2</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>c</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf2</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=free>A2</span><span class=main>*</span><span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>A2</span><span class=main>*</span><span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B1</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=free>B2</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>C</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf1</span> <span class=free>x1</span> <span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>qf2</span> <span class=free>x1</span> <span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf1</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>qf2</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
          <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x1</span><span class=main>,</span> <span class=free>y1</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=free>x2</span><span class=main>,</span> <span class=free>y2</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
          <span class=quoted><span class=quoted>"<span class=free>qf1</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>qf2</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b2</span><span class=main>*</span><span class=free>A2</span> <span class=main>-</span> <span class=free>B2</span><span class=main>*</span><span class=free>A1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=free>b1</span><span class=main>*</span><span class=free>A2</span> <span class=main>-</span> <span class=free>B1</span><span class=main>*</span><span class=free>A1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
          <span class=quoted><span class=quoted>"<span class=free>b2</span><span class=main>*</span><span class=free>A2</span> <span class=main>≠</span> <span class=free>B2</span><span class=main>*</span><span class=free>A1</span> <span class=main>∨</span> <span class=free>b1</span><span class=main>*</span><span class=free>A2</span> <span class=main>≠</span> <span class=free>B1</span><span class=main>*</span><span class=free>A1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x1</span><span class=main>,</span> <span class=free>y1</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=free>x</span><span class=main>,</span> <span class=free>y</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x2</span><span class=main>,</span> <span class=free>y2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>b2</span> <span class=main>/</span> <span class=free>A1</span> <span class=main>≠</span> <span class=free>B2</span> <span class=main>/</span> <span class=free>A2</span> <span class=main>∨</span> <span class=free>b1</span> <span class=main>/</span> <span class=free>A1</span> <span class=main>≠</span> <span class=free>B1</span> <span class=main>/</span> <span class=free>A2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span> assms<span class=main>(</span>13<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>b2</span> <span class=main>/</span> <span class=free>A1</span> <span class=main>-</span> <span class=free>B2</span> <span class=main>/</span> <span class=free>A2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=free>b1</span> <span class=main>/</span> <span class=free>A1</span> <span class=main>-</span> <span class=free>B1</span> <span class=main>/</span> <span class=free>A2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>,</span> 2<span class=main>)</span> assms<span class=main>(</span>12<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span><span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?qf_1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=free>b1</span><span class=main>/</span><span class=free>A1</span><span class=main>)</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>b2</span><span class=main>/</span><span class=free>A1</span><span class=main>)</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>c</span><span class=main>/</span><span class=free>A1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?qf_2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span> <span class=bound>x</span> <span class=bound>y</span><span class=main>.</span> <span class=bound>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=bound>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=free>B1</span><span class=main>/</span><span class=free>A2</span><span class=main>)</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=main>(</span><span class=free>B2</span><span class=main>/</span><span class=free>A2</span><span class=main>)</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=free>C</span><span class=main>/</span><span class=free>A2</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?qf_1</span> <span class=free>x1</span> <span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?qf_1</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?qf_1</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
       <span class=quoted><span class=quoted>"<span class=var>?qf_2</span> <span class=free>x1</span> <span class=free>y1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?qf_2</span> <span class=free>x2</span> <span class=free>y2</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?qf_2</span> <span class=free>x</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms quadratic_change_coefficients<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A1</span></span> <span class=quoted><span class=free>qf1</span></span> <span class=quoted><span class=free>b1</span></span> <span class=quoted><span class=free>b2</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>x2</span></span> <span class=quoted><span class=free>y2</span></span> <span class=var><span class=quoted><span class=var>?qf_1</span></span></span><span class=main>]</span>
          quadratic_change_coefficients<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A1</span></span> <span class=quoted><span class=free>qf1</span></span> <span class=quoted><span class=free>b1</span></span> <span class=quoted><span class=free>b2</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>x1</span></span> <span class=quoted><span class=free>y1</span></span> <span class=var><span class=quoted><span class=var>?qf_1</span></span></span><span class=main>]</span>
          quadratic_change_coefficients<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A2</span></span> <span class=quoted><span class=free>qf2</span></span> <span class=quoted><span class=free>B1</span></span> <span class=quoted><span class=free>B2</span></span> <span class=quoted><span class=free>C</span></span> <span class=quoted><span class=free>x1</span></span> <span class=quoted><span class=free>y1</span></span> <span class=var><span class=quoted><span class=var>?qf_2</span></span></span><span class=main>]</span>
          quadratic_change_coefficients<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A2</span></span> <span class=quoted><span class=free>qf2</span></span> <span class=quoted><span class=free>B1</span></span> <span class=quoted><span class=free>B2</span></span> <span class=quoted><span class=free>C</span></span> <span class=quoted><span class=free>x2</span></span> <span class=quoted><span class=free>y2</span></span> <span class=var><span class=quoted><span class=var>?qf_2</span></span></span><span class=main>]</span>
          quadratic_change_coefficients<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A1</span></span> <span class=quoted><span class=free>qf1</span></span> <span class=quoted><span class=free>b1</span></span> <span class=quoted><span class=free>b2</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>y</span></span> <span class=var><span class=quoted><span class=var>?qf_1</span></span></span><span class=main>]</span>
          quadratic_change_coefficients<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A2</span></span> <span class=quoted><span class=free>qf2</span></span> <span class=quoted><span class=free>B1</span></span> <span class=quoted><span class=free>B2</span></span> <span class=quoted><span class=free>C</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>y</span></span> <span class=var><span class=quoted><span class=var>?qf_2</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> quadratic_quadratic_at_most_2_intersections'
              <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>b2</span> <span class=main>/</span> <span class=free>A1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>B2</span> <span class=main>/</span> <span class=free>A2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>b1</span> <span class=main>/</span> <span class=free>A1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>B1</span> <span class=main>/</span> <span class=free>A2</span>"</span></span> <span class=var><span class=quoted><span class=var>?qf_1</span></span></span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>/</span> <span class=free>A1</span>"</span></span> <span class=var><span class=quoted><span class=var>?qf_2</span></span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>/</span> <span class=free>A2</span>"</span></span> <span class=quoted><span class=free>x1</span></span> <span class=quoted><span class=free>y1</span></span> <span class=quoted><span class=free>x2</span></span> <span class=quoted><span class=free>y2</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> * ** <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>x1</span><span class=main>,</span> <span class=free>y1</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=free>x2</span><span class=main>,</span> <span class=free>y2</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Matrices>
<div class=head>
<h1>Theory Matrices</h1>
</div>
<pre class=source><span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Vectors and Matrices in $\mathbb{C}^2$›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Representing vectors and matrices of arbitrary dimensions pose a challenge in formal theorem
proving \cite{harrison05}, but we only need to consider finite dimension spaces $\mathbb{C}^2$ and
$\mathbb{R}^3$.›</span></span>

<span class=keyword1><span class=command>theory</span></span> Matrices
<span class=keyword2><span class=keyword>imports</span></span> <a href=#More_Complex>More_Complex</a> <a href=#Linear_Systems>Linear_Systems</a> <a href=#Quadratic>Quadratic</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Vectors in $\mathbb{C}^2$›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Type of complex vector›</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> complex_vec <span class=main>=</span> <span class=quoted><span class=quoted>"complex <span class=main>×</span> complex"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>vec_zero</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>vec_zero</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Vector scalar multiplication›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mult_sv</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex_vec <span class=main>⇒</span> complex_vec"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span>"</span> 100<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>k</span></span></span> <span class=keyword1><span class=free>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Matrices-fst_mult_sv><span class=command>lemma</span></span> fst_mult_sv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"fst <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> fst <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-snd_mult_sv><span class=command>lemma</span></span> snd_mult_sv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"snd <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> snd <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-mult_sv_mult_sv><span class=command>lemma</span></span> mult_sv_mult_sv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>k1</span><span class=main>*</span><span class=free>k2</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-one_mult_sv><span class=command>lemma</span></span> one_mult_sv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span> <span class=main>=</span>  <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-mult_sv_ex_id1><span class=command>lemma</span></span> mult_sv_ex_id1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>complex<span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span> <span class=main>=</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Matrices-mult_sv_ex_id2><span class=command>lemma</span></span> mult_sv_ex_id2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>complex<span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Scalar product of two vectors›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mult_vv</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>×</span> complex <span class=main>⇒</span> complex <span class=main>×</span> complex <span class=main>⇒</span> complex"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span>"</span> 100<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span> <span class=keyword1><span class=free>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>b</span></span></span>"</span></span>

<span class=keyword1 id=Matrices-mult_vv_commute><span class=command>lemma</span></span> mult_vv_commute<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span> <span class=main>=</span> <span class=free>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v2</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mult_vv_scale_sv1><span class=command>lemma</span></span> mult_vv_scale_sv1<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> <span class=main>(</span><span class=free>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v2</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-mult_vv_scale_sv2><span class=command>lemma</span></span> mult_vv_scale_sv2<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> <span class=main>(</span><span class=free>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v2</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Conjugate vector›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>vec_map</span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>vec_map</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>vec_cnj</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>vec_cnj</span> <span class=main>=</span> vec_map cnj"</span></span>

<span class=keyword1 id=Matrices-vec_cnj_vec_cnj><span class=command>lemma</span></span> vec_cnj_vec_cnj <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"vec_cnj <span class=main>(</span>vec_cnj <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-cnj_mult_vv><span class=command>lemma</span></span> cnj_mult_vv<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnj <span class=main>(</span><span class=free>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>vec_cnj <span class=free>v1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>vec_cnj <span class=free>v2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v2</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-vec_cnj_sv><span class=command>lemma</span></span> vec_cnj_sv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"vec_cnj <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> cnj <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> vec_cnj <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-scalsquare_vv_zero><span class=command>lemma</span></span> scalsquare_vv_zero<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>vec_cnj <span class=free>v</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>v</span> <span class=main>=</span> vec_zero"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span> complex_mult_cnj_cmod power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>)</span></span> norm_eq_zero of_real_0 of_real_add of_real_eq_iff of_real_mult sum_squares_eq_zero_iff<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Matrices in $\mathbb{C}^2$›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Type of complex matrices›</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> complex_mat <span class=main>=</span> <span class=quoted><span class=quoted>"complex <span class=main>×</span> complex <span class=main>×</span> complex <span class=main>×</span> complex"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Matrix scalar multiplication›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mult_sm</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span>"</span> 100<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>k</span></span></span> <span class=keyword1><span class=free>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Matrices-mult_sm_distribution><span class=command>lemma</span></span> mult_sm_distribution <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>k1</span><span class=main>*</span><span class=free>k2</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mult_sm_neutral><span class=command>lemma</span></span> mult_sm_neutral <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span> <span class=main>=</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mult_sm_inv_l><span class=command>lemma</span></span> mult_sm_inv_l<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span> <span class=main>=</span> <span class=free>B</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=free>k</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mult_sm_ex_id1><span class=command>lemma</span></span> mult_sm_ex_id1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>complex<span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Matrices-mult_sm_ex_id2><span class=command>lemma</span></span> mult_sm_ex_id2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>complex<span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>M</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Matrix addition and subtraction›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mat_zero</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>mat_zero</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mat_plus</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>+<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span>"</span> 100<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mat_plus</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d1</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d2</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a1</span></span></span><span class=main>+</span><span class=free><span class=bound><span class=entity>a2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b1</span></span></span><span class=main>+</span><span class=free><span class=bound><span class=entity>b2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c1</span></span></span><span class=main>+</span><span class=free><span class=bound><span class=entity>c2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d1</span></span></span><span class=main>+</span><span class=free><span class=bound><span class=entity>d2</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mat_minus</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>-<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span>"</span> 100<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mat_minus</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d1</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d2</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a1</span></span></span><span class=main>-</span><span class=free><span class=bound><span class=entity>a2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b1</span></span></span><span class=main>-</span><span class=free><span class=bound><span class=entity>b2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c1</span></span></span><span class=main>-</span><span class=free><span class=bound><span class=entity>c2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d1</span></span></span><span class=main>-</span><span class=free><span class=bound><span class=entity>d2</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mat_uminus</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mat_uminus</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>-</span><span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=main>-</span><span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=main>-</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Matrices-nonzero_mult_real><span class=command>lemma</span></span> nonzero_mult_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Matrix multiplication.›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mult_mm</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span>"</span> 100<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>a1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d1</span></span></span><span class=main>)</span> <span class=keyword1><span class=free>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d2</span></span></span><span class=main>)</span> <span class=main>=</span>
   <span class=main>(</span><span class=free><span class=bound><span class=entity>a1</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>a2</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>b1</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>c2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a1</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>b2</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>b1</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>d2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c1</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>a2</span></span></span><span class=main>+</span><span class=free><span class=bound><span class=entity>d1</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>c2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c1</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>b2</span></span></span><span class=main>+</span><span class=free><span class=bound><span class=entity>d1</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>d2</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Matrices-mult_mm_assoc><span class=command>lemma</span></span> mult_mm_assoc<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>B</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>C</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>C</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>C</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-mult_assoc_5><span class=command>lemma</span></span> mult_assoc_5<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>B</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>C</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>D</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>E</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>C</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>D</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>E</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mult_mm_assoc<span class=main>)</span>

<span class=keyword1 id=Matrices-mat_zero_r><span class=command>lemma</span></span> mat_zero_r <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_zero <span class=main>=</span> mat_zero"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-mat_zero_l><span class=command>lemma</span></span> mat_zero_l <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_zero <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span> <span class=main>=</span> mat_zero"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>eye</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>eye</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Matrices-mat_eye_l><span class=command>lemma</span></span> mat_eye_l<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"eye <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span> <span class=main>=</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mat_eye_r><span class=command>lemma</span></span> mat_eye_r<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> eye <span class=main>=</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mult_mm_sm><span class=command>lemma</span></span> mult_mm_sm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-mult_sm_mm><span class=command>lemma</span></span> mult_sm_mm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-mult_sm_eye_mm><span class=command>lemma</span></span> mult_sm_eye_mm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Matrix determinant›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mat_det</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>mat_det</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>d</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>c</span></span></span>"</span></span>

<span class=keyword1 id=Matrices-mat_det_mult><span class=command>lemma</span></span> mat_det_mult <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> mat_det <span class=free>A</span> <span class=main>*</span> mat_det <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-mat_det_mult_sm><span class=command>lemma</span></span> mat_det_mult_sm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>k</span><span class=main>*</span><span class=free>k</span><span class=main>)</span> <span class=main>*</span> mat_det <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Matrix inverse›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mat_inv</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mat_inv</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>d</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>,</span> <span class=main>-</span><span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=main>-</span><span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Matrices-mat_inv_r><span class=command>lemma</span></span> mat_inv_r<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_inv <span class=free>A</span><span class=main>)</span> <span class=main>=</span> eye"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span> <span class=skolem>d</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> <span class=skolem>d</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=skolem>b</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>b</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>c</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>b</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>c</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span> <span class=main>-</span> <span class=skolem>b</span><span class=main>*</span><span class=skolem>c</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span> <span class=main>-</span> <span class=skolem>b</span><span class=main>*</span><span class=skolem>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span> <span class=main>-</span> <span class=skolem>b</span><span class=main>*</span><span class=skolem>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span> <span class=main>≠</span> <span class=skolem>b</span><span class=main>*</span><span class=skolem>c</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> * <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Matrices-mat_inv_l><span class=command>lemma</span></span> mat_inv_l<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>mat_inv <span class=free>A</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span>  <span class=main>=</span> eye"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span> <span class=skolem>d</span> <span class=main>::</span> <span class=quoted>complex</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> <span class=skolem>d</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=skolem>b</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>b</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>c</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>a</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>b</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>c</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> <span class=numeral>2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span> <span class=main>-</span> <span class=skolem>b</span><span class=main>*</span><span class=skolem>c</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span> <span class=main>-</span> <span class=skolem>b</span><span class=main>*</span><span class=skolem>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span> <span class=main>-</span> <span class=skolem>b</span><span class=main>*</span><span class=skolem>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span> <span class=main>≠</span> <span class=skolem>b</span><span class=main>*</span><span class=skolem>c</span>"</span></span>
  <span class=keyword1><span class=command>with</span></span> * <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Matrices-mat_det_inv><span class=command>lemma</span></span> mat_det_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>mat_inv <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> mat_det <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_det eye <span class=main>=</span> mat_det <span class=free>A</span> <span class=main>*</span> mat_det <span class=main>(</span>mat_inv <span class=free>A</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> mat_inv_l<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Matrices-mult_mm_inv_l><span class=command>lemma</span></span> mult_mm_inv_l<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span> <span class=main>=</span> <span class=free>C</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>=</span> mat_inv <span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>C</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms mat_eye_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>B</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_mm_assoc mat_inv_l<span class=main>)</span>

<span class=keyword1 id=Matrices-mult_mm_inv_r><span class=command>lemma</span></span> mult_mm_inv_r<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span> <span class=main>=</span> <span class=free>C</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=free>C</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_inv <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms mat_eye_r<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_mm_assoc<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> mat_inv_r<span class=main>)</span>

<span class=keyword1 id=Matrices-mult_mm_non_zero_l><span class=command>lemma</span></span> mult_mm_non_zero_l<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms mat_zero_r
  <span class=keyword1><span class=command>using</span></span> mult_mm_inv_l<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>B</span></span> <span class=quoted>mat_zero</span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mat_inv_mult_mm><span class=command>lemma</span></span> mat_inv_mult_mm<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_inv <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> mat_inv <span class=free>B</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_inv <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_inv <span class=free>B</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_inv <span class=free>A</span><span class=main>)</span> <span class=main>=</span> eye"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mat_inv_r mult_mm_assoc mult_mm_inv_r<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> mult_mm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span>"</span></span> <span class=quoted><span class=quoted>"mat_inv <span class=free>B</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_inv <span class=free>A</span>"</span></span> <span class=quoted>eye</span><span class=main>]</span> assms mat_eye_r
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Matrices-mult_mm_cancel_l><span class=command>lemma</span></span> mult_mm_cancel_l<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span> <span class=main>=</span> <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mult_mm_inv_l<span class=main>)</span>

<span class=keyword1 id=Matrices-mult_mm_cancel_r><span class=command>lemma</span></span> mult_mm_cancel_r<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> <span class=free>B</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mult_mm_inv_r<span class=main>)</span>

<span class=keyword1 id=Matrices-mult_mm_non_zero_r><span class=command>lemma</span></span> mult_mm_non_zero_r<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms mat_zero_l
  <span class=keyword1><span class=command>using</span></span> mult_mm_inv_r<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>A</span></span> <span class=quoted>mat_zero</span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mat_inv_mult_sm><span class=command>lemma</span></span> mat_inv_mult_sm<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_inv <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>k</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_inv <span class=free>A</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>subst</span> mult.assoc<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>k</span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>a</span></span></span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free><span class=free>k</span></span></span><span class=main><span class=main><span class=main>*</span></span></span><span class=skolem><span class=skolem><span class=skolem>d</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mult.assoc<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>k</span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>b</span></span></span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free><span class=free>k</span></span></span><span class=main><span class=main><span class=main>*</span></span></span><span class=skolem><span class=skolem><span class=skolem>c</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> right_diff_distrib<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>k</span></span></span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=skolem><span class=skolem><span class=skolem>a</span></span></span><span class=main><span class=main><span class=main>*</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>k</span></span></span><span class=main><span class=main><span class=main>*</span></span></span><span class=skolem><span class=skolem><span class=skolem>d</span></span></span><span class=main><span class=main><span class=main>)</span></span></span>"</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=skolem><span class=skolem><span class=skolem>b</span></span></span><span class=main><span class=main><span class=main>*</span></span></span><span class=main><span class=main><span class=main>(</span></span></span><span class=free><span class=free><span class=free>k</span></span></span><span class=main><span class=main><span class=main>*</span></span></span><span class=skolem><span class=skolem><span class=skolem>c</span></span></span><span class=main><span class=main><span class=main>)</span></span></span>"</span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Matrices-mat_inv_inv><span class=command>lemma</span></span> mat_inv_inv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_inv <span class=main>(</span>mat_inv <span class=free>M</span><span class=main>)</span> <span class=main>=</span> <span class=free>M</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_inv <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> eye"</span></span>
    <span class=keyword1><span class=command>using</span></span> mat_inv_l<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms mat_det_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> mult_mm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_inv <span class=free>M</span>"</span></span> <span class=quoted><span class=free>M</span></span> <span class=quoted>eye</span><span class=main>]</span> mat_eye_r
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> eye_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Matrix transpose›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mat_transpose</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mat_transpose</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Matrices-mat_t_mat_t><span class=command>lemma</span></span> mat_t_mat_t <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_transpose <span class=main>(</span>mat_transpose <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mat_t_mult_sm><span class=command>lemma</span></span> mat_t_mult_sm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_transpose <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_transpose <span class=free>A</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-mat_t_mult_mm><span class=command>lemma</span></span> mat_t_mult_mm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_transpose <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> mat_transpose <span class=free>B</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_transpose <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mat_inv_transpose><span class=command>lemma</span></span> mat_inv_transpose<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_transpose <span class=main>(</span>mat_inv <span class=free>M</span><span class=main>)</span> <span class=main>=</span> mat_inv <span class=main>(</span>mat_transpose <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mat_det_transpose><span class=command>lemma</span></span> mat_det_transpose <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>M</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>mat_transpose <span class=free>M</span><span class=main>)</span> <span class=main>=</span> mat_det <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Diagonal matrices definition›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mat_diagonal</span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>mat_diagonal</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>B</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>C</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>D</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>B</span></span></span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>C</span></span></span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Matrix conjugate›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mat_map</span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>mat_map</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mat_cnj</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mat_cnj</span> <span class=main>=</span> mat_map cnj"</span></span>

<span class=keyword1 id=Matrices-mat_cnj_cnj><span class=command>lemma</span></span> mat_cnj_cnj <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_cnj <span class=main>(</span>mat_cnj <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mat_cnj_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mat_cnj_sm><span class=command>lemma</span></span> mat_cnj_sm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_cnj <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> cnj <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_cnj <span class=free>A</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-mat_det_cnj><span class=command>lemma</span></span> mat_det_cnj <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>mat_cnj <span class=free>A</span><span class=main>)</span> <span class=main>=</span> cnj <span class=main>(</span>mat_det <span class=free>A</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-nonzero_mat_cnj><span class=command>lemma</span></span> nonzero_mat_cnj<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_cnj <span class=free>A</span> <span class=main>=</span> mat_zero <span class=main>⟷</span> <span class=free>A</span> <span class=main>=</span> mat_zero"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-mat_inv_cnj><span class=command>lemma</span></span> mat_inv_cnj<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_cnj <span class=main>(</span>mat_inv <span class=free>M</span><span class=main>)</span> <span class=main>=</span> mat_inv <span class=main>(</span>mat_cnj <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mat_cnj_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Matrix adjoint - the conjugate traspose matrix ($A^* = \overline{A^t}$)›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mat_adj</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mat_adj</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>=</span> mat_cnj <span class=main>(</span>mat_transpose <span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Matrices-mat_adj_mult_mm><span class=command>lemma</span></span> mat_adj_mult_mm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> mat_adj <span class=free>B</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_adj <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-mat_adj_mult_sm><span class=command>lemma</span></span> mat_adj_mult_sm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> cnj <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_adj <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-mat_det_adj><span class=command>lemma</span></span> mat_det_adj<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>mat_adj <span class=free>A</span><span class=main>)</span> <span class=main>=</span> cnj <span class=main>(</span>mat_det <span class=free>A</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-mat_adj_inv><span class=command>lemma</span></span> mat_adj_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=main>(</span>mat_inv <span class=free>M</span><span class=main>)</span> <span class=main>=</span> mat_inv <span class=main>(</span>mat_adj <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-mat_transpose_mat_cnj><span class=command>lemma</span></span> mat_transpose_mat_cnj<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_transpose <span class=main>(</span>mat_cnj <span class=free>A</span><span class=main>)</span> <span class=main>=</span> mat_adj <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span>  <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-mat_adj_adj><span class=command>lemma</span></span> mat_adj_adj <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=main>(</span>mat_adj <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> mat_adj_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> mat_transpose_mat_cnj<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-mat_adj_eye><span class=command>lemma</span></span> mat_adj_eye <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_adj eye <span class=main>=</span> eye"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Matrix trace›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mat_trace</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mat_trace</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>d</span></span></span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Multiplication of matrix and a vector›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mult_mv</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_vec <span class=main>⇒</span> complex_vec"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span>"</span> 100<span class=main>)</span>  <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span> <span class=keyword1><span class=free>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>c</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mult_vm</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_mat <span class=main>⇒</span> complex_vec"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span>"</span> 100<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span> <span class=keyword1><span class=free>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span>  <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>x</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Matrices-eye_mv_l><span class=command>lemma</span></span> eye_mv_l <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"eye <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span> <span class=main>=</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-mult_mv_mv><span class=command>lemma</span></span> mult_mv_mv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>B</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-mult_vm_vm><span class=command>lemma</span></span> mult_vm_vm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span> <span class=main>=</span> <span class=free>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-mult_mv_inv><span class=command>lemma</span></span> mult_mv_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span>  <span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=main>(</span>mat_inv <span class=free>A</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>y</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_inv_l<span class=main>)</span>

<span class=keyword1 id=Matrices-mult_vm_inv><span class=command>lemma</span></span> mult_vm_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span>  <span class=free>y</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_inv <span class=free>A</span><span class=main>)</span> "</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>y</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_inv_r<span class=main>)</span>

<span class=keyword1 id=Matrices-mult_mv_cancel_l><span class=command>lemma</span></span> mult_mv_cancel_l<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span> <span class=main>=</span> <span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>=</span> <span class=free>v'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> mult_mv_inv
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Matrices-mult_vm_cancel_r><span class=command>lemma</span></span> mult_vm_cancel_r<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span> <span class=main>=</span> <span class=free>v'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>=</span> <span class=free>v'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> mult_vm_inv
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Matrices-vec_zero_l><span class=command>lemma</span></span> vec_zero_l <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> vec_zero <span class=main>=</span> vec_zero"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-vec_zero_r><span class=command>lemma</span></span> vec_zero_r <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"vec_zero <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span> <span class=main>=</span> vec_zero"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-mult_mv_nonzero><span class=command>lemma</span></span> mult_mv_nonzero<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> assms mult_mv_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted>vec_zero</span> <span class=quoted><span class=free>A</span></span> <span class=quoted><span class=free>v</span></span><span class=main>]</span> mat_inv_l vec_zero_l
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mult_vm_nonzero><span class=command>lemma</span></span> mult_vm_nonzero<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> assms mult_vm_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted>vec_zero</span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=free>A</span></span><span class=main>]</span> mat_inv_r vec_zero_r
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mult_sv_mv><span class=command>lemma</span></span> mult_sv_mv<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-mult_mv_mult_vm><span class=command>lemma</span></span> mult_mv_mult_vm<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_transpose <span class=free>A</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>x</span></span><span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Matrices-mult_mv_vv><span class=command>lemma</span></span> mult_mv_vv<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span> <span class=main>=</span> <span class=free>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>mat_transpose <span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v2</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-mult_vv_mv><span class=command>lemma</span></span> mult_vv_mv<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>y</span><span class=main>)</span>  <span class=main>=</span> <span class=main>(</span><span class=free>x</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>x</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>y</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-vec_cnj_mult_mv><span class=command>lemma</span></span> vec_cnj_mult_mv<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"vec_cnj <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>x</span><span class=main>)</span> <span class=main>=</span>  <span class=main>(</span>mat_cnj <span class=free>A</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>vec_cnj <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>x</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-vec_cnj_mult_vm><span class=command>lemma</span></span> vec_cnj_mult_vm<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"vec_cnj <span class=main>(</span><span class=free>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> vec_cnj <span class=free>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_cnj <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> vec_cnj_def mat_cnj_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Eigenvalues and eigenvectors›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>eigenpair</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>eigenpair</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>⟷</span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>≠</span> vec_zero <span class=main>∧</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free><span class=bound><span class=entity>v</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>eigenval</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>eigenval</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero <span class=main>∧</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=bound>v</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>k</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=bound>v</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Matrices-eigen_equation><span class=command>lemma</span></span> eigen_equation<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"eigenval <span class=free>k</span> <span class=free>H</span> <span class=main>⟷</span> <span class=free>k</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> mat_trace <span class=free>H</span> <span class=main>*</span> <span class=free>k</span> <span class=main>+</span> mat_det <span class=free>H</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>⟷</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> eigenval_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v1</span></span> <span class=skolem><span class=skolem>v2</span></span> <span class=keyword2><span class=keyword>where</span></span> vv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v1</span><span class=main>,</span> <span class=skolem>v2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>v</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>H</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span> <span class=main>=</span> vec_zero"</span></span>
      <span class=keyword1><span class=command>using</span></span> HH vv
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>H</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>v</span> <span class=main>≠</span> vec_zero›</span></span> vv HH
      <span class=keyword1><span class=command>using</span></span> regular_homogenous_system<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>-</span> <span class=free>k</span>"</span></span> <span class=quoted><span class=skolem>B</span></span> <span class=quoted><span class=skolem>C</span></span> <span class=quoted><span class=quoted>"<span class=skolem>D</span> <span class=main>-</span> <span class=free>k</span>"</span></span> <span class=quoted><span class=skolem>v1</span></span> <span class=quoted><span class=skolem>v2</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> det2_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
      <span class=keyword1><span class=command>using</span></span> HH
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>H</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> HH
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span> <span class=main>=</span> mat_zero"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> HH
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span><span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=free>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=free>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>C</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> HH
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>proof</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>-</span> <span class=free>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>*</span> <span class=skolem>B</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=free>k</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> * singular_system<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>A</span><span class=main>-</span><span class=free>k</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>D</span><span class=main>-</span><span class=free>k</span>"</span></span> <span class=quoted><span class=skolem>B</span></span> <span class=quoted><span class=skolem>C</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=main>0</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>B</span><span class=main>,</span> <span class=free>k</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span>"</span></span><span class=main>]</span> HH
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>B</span><span class=main>,</span> <span class=free>k</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>H</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=skolem>B</span><span class=main>,</span> <span class=free>k</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span> <span class=main>=</span> vec_zero"</span></span>
          <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>-</span> <span class=free>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero <span class=main>∧</span> <span class=main>(</span><span class=free>H</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span> <span class=main>=</span> vec_zero"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> HH
          <span class=keyword1><span class=command>unfolding</span></span> eigenval_def
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>v</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=skolem>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>D</span> <span class=main>-</span> <span class=free>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>C</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>*</span> <span class=skolem>B</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=free>k</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=free>k</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> * singular_system<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>D</span><span class=main>-</span><span class=free>k</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span><span class=main>-</span><span class=free>k</span>"</span></span> <span class=quoted><span class=skolem>C</span></span> <span class=quoted><span class=skolem>B</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=main>0</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>C</span><span class=main>,</span> <span class=free>k</span><span class=main>-</span><span class=skolem>D</span><span class=main>)</span>"</span></span><span class=main>]</span> HH
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k</span><span class=main>-</span><span class=skolem>D</span><span class=main>,</span> <span class=skolem>C</span><span class=main>)</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>H</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>k</span><span class=main>-</span><span class=skolem>D</span><span class=main>,</span> <span class=skolem>C</span><span class=main>)</span> <span class=main>=</span> vec_zero"</span></span>
          <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹<span class=skolem>D</span> <span class=main>-</span> <span class=free>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>C</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero <span class=main>∧</span> <span class=main>(</span><span class=free>H</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span> <span class=main>=</span> vec_zero"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> HH
          <span class=keyword1><span class=command>unfolding</span></span> eigenval_def
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>v</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=skolem>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Bilinear and Quadratic forms, Congruence, and Similarity›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Bilinear forms›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>bilinear_form</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>bilinear_form</span> <span class=free><span class=bound><span class=entity>v1</span></span></span> <span class=free><span class=bound><span class=entity>v2</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>(</span>vec_cnj <span class=free><span class=bound><span class=entity>v1</span></span></span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free><span class=bound><span class=entity>v2</span></span></span>"</span></span>

<span class=keyword1 id=Matrices-bilinear_form_scale_m><span class=command>lemma</span></span> bilinear_form_scale_m<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bilinear_form <span class=free>v1</span> <span class=free>v2</span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> bilinear_form <span class=free>v1</span> <span class=free>v2</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v2</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-bilinear_form_scale_v1><span class=command>lemma</span></span> bilinear_form_scale_v1<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bilinear_form <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span><span class=main>)</span> <span class=free>v2</span> <span class=free>H</span> <span class=main>=</span> cnj <span class=free>k</span> <span class=main>*</span> bilinear_form <span class=free>v1</span> <span class=free>v2</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v2</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-bilinear_form_scale_v2><span class=command>lemma</span></span> bilinear_form_scale_v2<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bilinear_form  <span class=free>v1</span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span><span class=main>)</span> <span class=free>H</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> bilinear_form <span class=free>v1</span> <span class=free>v2</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v2</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Quadratic forms›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>quad_form</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>quad_form</span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>(</span>vec_cnj <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free><span class=bound><span class=entity>v</span></span></span>"</span></span>

<span class=keyword1 id=Matrices-quad_form_bilinear_form><span class=command>lemma</span></span> quad_form_bilinear_form<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"quad_form <span class=free>v</span> <span class=free>H</span> <span class=main>=</span> bilinear_form <span class=free>v</span> <span class=free>v</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-quad_form_scale_v><span class=command>lemma</span></span> quad_form_scale_v<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"quad_form <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v</span><span class=main>)</span> <span class=free>H</span> <span class=main>=</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=free>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> quad_form <span class=free>v</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bilinear_form_scale_v1 bilinear_form_scale_v2
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-quad_form_scale_m><span class=command>lemma</span></span> quad_form_scale_m<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"quad_form <span class=free>v</span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> quad_form <span class=free>v</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bilinear_form_scale_m
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-cnj_quad_form><span class=command>lemma</span></span> cnj_quad_form <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cnj <span class=main>(</span>quad_form <span class=free>z</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> quad_form <span class=free>z</span> <span class=main>(</span>mat_adj <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>z</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Matrix congruence›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Two matrices are congruent iff they represent the same quadratic form with respect to different
bases (for example if one circline can be transformed to another by a Möbius trasformation).›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>congruence</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>congruence</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>≡</span> mat_adj <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>M</span></span></span>"</span></span>

<span class=keyword1 id=Matrices-congruence_nonzero><span class=command>lemma</span></span> congruence_nonzero<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"congruence <span class=free>M</span> <span class=free>H</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> congruence_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> mult_mm_non_zero_r<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mult_mm_non_zero_l<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_adj<span class=main>)</span>

<span class=keyword1 id=Matrices-congruence_congruence><span class=command>lemma</span></span> congruence_congruence<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"congruence <span class=free>M1</span> <span class=main>(</span>congruence <span class=free>M2</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> congruence <span class=main>(</span><span class=free>M2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M1</span><span class=main>)</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> congruence_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_mm_assoc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_mm_assoc<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mat_adj_mult_mm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_mm_assoc<span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Matrices-congruence_eye><span class=command>lemma</span></span> congruence_eye <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"congruence eye <span class=free>H</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Matrices-congruence_congruence_inv><span class=command>lemma</span></span> congruence_congruence_inv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"congruence <span class=free>M</span> <span class=main>(</span>congruence <span class=main>(</span>mat_inv <span class=free>M</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms congruence_congruence<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=quoted>"mat_inv <span class=free>M</span>"</span></span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> mat_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span> mat_eye_l mat_eye_r
  <span class=keyword1><span class=command>unfolding</span></span> congruence_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> eye_def<span class=main>)</span>

<span class=keyword1 id=Matrices-congruence_inv><span class=command>lemma</span></span> congruence_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"congruence <span class=free>M</span> <span class=free>H</span> <span class=main>=</span> <span class=free>H'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"congruence <span class=main>(</span>mat_inv <span class=free>M</span><span class=main>)</span> <span class=free>H'</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> mult_mm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>H'</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> mult_mm_inv_r<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span>"</span></span> <span class=quoted><span class=quoted>"mat_inv <span class=main>(</span>mat_adj <span class=free>M</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H'</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_adj mult_mm_assoc mat_adj_inv<span class=main>)</span>

<span class=keyword1 id=Matrices-congruence_scale_m><span class=command>lemma</span></span> congruence_scale_m <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"congruence <span class=free>M</span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>congruence <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-inj_congruence><span class=command>lemma</span></span> inj_congruence<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"congruence <span class=free>M</span> <span class=free>H</span> <span class=main>=</span> congruence <span class=free>M</span> <span class=free>H'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> <span class=free>H'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> <span class=free>H'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> "</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> mult_mm_cancel_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>H'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_adj mult_mm_assoc<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> mult_mm_cancel_r<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>H'</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Matrices-mat_det_congruence><span class=command>lemma</span></span> mat_det_congruence <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>congruence <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cor <span class=main>(</span><span class=main>(</span>cmod <span class=main>(</span>mat_det <span class=free>M</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> mat_det <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_adj <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Matrices-det_sgn_congruence><span class=command>lemma</span></span> det_sgn_congruence <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>mat_det <span class=main>(</span>congruence <span class=free>M</span> <span class=free>H</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>mat_det <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> mat_det_congruence<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_mult power2_eq_square<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_of_real<span class=main>)</span>

<span class=keyword1 id=Matrices-Re_det_sgn_congruence><span class=command>lemma</span></span> Re_det_sgn_congruence <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=main>(</span>congruence <span class=free>M</span> <span class=free>H</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=free>H</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>mat_det <span class=main>(</span>congruence <span class=free>M</span> <span class=free>H</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cmod <span class=main>(</span>mat_det <span class=free>M</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> Re <span class=main>(</span>mat_det <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> mat_det_congruence<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Re_mult_real<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> Im_complex_of_real<span class=main>)</span> <span class=main>(</span><span class=operator>subst</span> Re_complex_of_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_mult<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Transforming a matrix $H$ by a regular matrix $M$ preserves its bilinear and quadratic forms.›</span></span>

<span class=keyword1 id=Matrices-bilinear_form_congruence><span class=command>lemma</span></span> bilinear_form_congruence <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bilinear_form <span class=main>(</span><span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span><span class=main>)</span> <span class=main>(</span><span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span><span class=main>)</span> <span class=main>(</span>congruence <span class=main>(</span>mat_inv <span class=free>M</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span>
         bilinear_form <span class=free>v1</span> <span class=free>v2</span> <span class=free>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>mat_adj <span class=free>M</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_adj<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> bilinear_form_def congruence_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_mv_mult_vm<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> vec_cnj_mult_vm<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mat_adj_def<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_vm_vm<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_vv_mv<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_vm_vm<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mat_adj_inv<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult_assoc_5<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mat_inv_r<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹mat_det <span class=main>(</span>mat_adj <span class=free>M</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mat_inv_l<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mat_eye_l<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mat_eye_r<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Matrices-quad_form_congruence><span class=command>lemma</span></span> quad_form_congruence <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"quad_form <span class=main>(</span><span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>z</span><span class=main>)</span> <span class=main>(</span>congruence <span class=main>(</span>mat_inv <span class=free>M</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> quad_form <span class=free>z</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bilinear_form_congruence<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Similar matrices›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Two matrices are similar iff they represent the same linear operator with respect to (possibly)
different bases (e.g., if they represent the same Möbius transformation after changing the
coordinate system)›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>similarity</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>similarity</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>=</span> mat_inv <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>A</span></span></span>"</span></span>

<span class=keyword1 id=Matrices-mat_det_similarity><span class=command>lemma</span></span> mat_det_similarity <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>similarity <span class=free>A</span> <span class=free>M</span><span class=main>)</span> <span class=main>=</span> mat_det <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_inv<span class=main>)</span>

<span class=keyword1 id=Matrices-mat_trace_similarity><span class=command>lemma</span></span> mat_trace_similarity <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_trace <span class=main>(</span>similarity <span class=free>A</span> <span class=free>M</span><span class=main>)</span> <span class=main>=</span> mat_trace <span class=free>M</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> AA<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>mA</span></span> <span class=skolem><span class=skolem>mB</span></span> <span class=skolem><span class=skolem>mC</span></span> <span class=skolem><span class=skolem>mD</span></span> <span class=keyword2><span class=keyword>where</span></span> MM<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>mA</span><span class=main>,</span> <span class=skolem>mB</span><span class=main>,</span> <span class=skolem>mC</span><span class=main>,</span> <span class=skolem>mD</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>mA</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> <span class=skolem>d</span> <span class=main>-</span> <span class=skolem>b</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span> <span class=main>+</span> <span class=skolem>mD</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> <span class=skolem>d</span> <span class=main>-</span> <span class=skolem>b</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span> <span class=main>=</span>
        <span class=skolem>mA</span> <span class=main>+</span> <span class=skolem>mD</span> <span class=main>+</span> <span class=skolem>mA</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>b</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> <span class=skolem>d</span> <span class=main>-</span> <span class=skolem>b</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span> <span class=main>+</span> <span class=skolem>mD</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>b</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> <span class=skolem>d</span> <span class=main>-</span> <span class=skolem>b</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms AA
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> AA MM
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> similarity_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Matrices-similarity_eye><span class=command>lemma</span></span> similarity_eye <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"similarity eye <span class=free>M</span> <span class=main>=</span> <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> similarity_def
  <span class=keyword1><span class=command>using</span></span> mat_eye_l mat_eye_r
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>


<span class=keyword1 id="Matrices-similarity_eye'"><span class=command>lemma</span></span> similarity_eye' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"similarity <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=free>M</span> <span class=main>=</span> <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> eye_def<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> eye_def<span class=main>)</span>

<span class=keyword1 id=Matrices-similarity_comp><span class=command>lemma</span></span> similarity_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"similarity <span class=free>A1</span> <span class=main>(</span>similarity <span class=free>A2</span> <span class=free>M</span><span class=main>)</span> <span class=main>=</span> similarity <span class=main>(</span><span class=free>A2</span><span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span><span class=free>A1</span><span class=main>)</span> <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_mm_assoc mat_inv_mult_mm<span class=main>)</span>

<span class=keyword1 id=Matrices-similarity_inv><span class=command>lemma</span></span> similarity_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"similarity <span class=free>A</span> <span class=free>M1</span> <span class=main>=</span> <span class=free>M2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"similarity <span class=main>(</span>mat_inv <span class=free>A</span><span class=main>)</span> <span class=free>M2</span> <span class=main>=</span> <span class=free>M1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mat_det_mult mult_mm_assoc mult_mm_inv_l mult_mm_inv_r mult_zero_left<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Unitary_Matrices>
<div class=head>
<h1>Theory Unitary_Matrices</h1>
</div>
<pre class=source><span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Generalized Unitary Matrices›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>theory</span></span> Unitary_Matrices
<span class=keyword2><span class=keyword>imports</span></span> <a href=#Matrices>Matrices</a> <a href=#More_Complex>More_Complex</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In this section (generalized) $2\times 2$ unitary matrices are introduced.›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Unitary matrices›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>unitary</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>unitary</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>⟷</span> mat_adj <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>=</span> eye"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Generalized unitary matrices›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>unitary_gen</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>unitary_gen</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>⟷</span>
   <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>complex<span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_adj <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Scalar can be always be a positive real›</span></span>
<span class=keyword1 id=Unitary_Matrices-unitary_gen_real><span class=command>lemma</span></span> unitary_gen_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>real<span class=main>.</span> <span class=bound>k</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> cor <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary_gen_def<span class=main>)</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>+</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span>  complex_mult_cnj_cmod<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>k</span> <span class=main>∧</span> Re <span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> add_cancel_left_left arg_0_iff arg_complex_of_real_positive not_sum_power2_lt_zero of_real_0 plus_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> plus_complex.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Generalized unitary matrices can be factored into a product of a unitary matrix and a real
positive scalar multiple of the identity matrix›</span></span>
<span class=keyword1 id=Unitary_Matrices-unitary_gen_unitary><span class=command>lemma</span></span> unitary_gen_unitary<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=free>M</span> <span class=main>⟷</span>
         <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span> <span class=bound>M'</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> unitary <span class=bound>M'</span> <span class=main>∧</span> <span class=free>M</span> <span class=main>=</span> <span class=main>(</span>cor <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=bound>M'</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span><span class=main>&gt;</span><span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary_gen_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?k'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>sqrt <span class=skolem>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?k'</span> <span class=main>*</span> cnj <span class=var>?k'</span> <span class=main>=</span> cor <span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=var>?k'</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=var>?k'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?k'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> * mat_eye_l
    <span class=keyword1><span class=command>unfolding</span></span> unitary_gen_def unitary_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re <span class=var>?k'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=var>?k'</span><span class=main>)</span><span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span><span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_sm_mm<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>M'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"unitary <span class=skolem>M'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span>cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>M'</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>M'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> mult_sm_mm<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span>"</span></span> <span class=quoted>eye</span> <span class=quoted><span class=skolem>M'</span></span><span class=main>]</span> mat_eye_l
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹unitary <span class=skolem>M'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary_gen_def unitary_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹When they represent Möbius transformations, eneralized unitary matrices fix the imaginary unit circle. Therefore, they
fix a Hermitean form with (2, 0) signature (two positive and no negative diagonal elements).›</span></span>
<span class=keyword1 id="Unitary_Matrices-unitary_gen_iff'"><span class=command>lemma</span></span> unitary_gen_iff'<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=free>M</span> <span class=main>⟷</span> 
         <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>complex<span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> congruence <span class=free>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> unitary_gen_def
  <span class=keyword1><span class=command>using</span></span> mat_eye_r
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult.assoc<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Unitary matrices are special cases of general unitary matrices›</span></span>
<span class=keyword1 id=Unitary_Matrices-unitary_unitary_gen><span class=command>lemma</span></span> unitary_unitary_gen <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary <span class=free>M</span>"</span></span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> unitary_gen_def unitary_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Generalized unitary matrices are regular›</span></span>
<span class=keyword1 id=Unitary_Matrices-unitary_gen_regular><span class=command>lemma</span></span> unitary_gen_regular<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary_gen_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_adj<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemmas</span></span> unitary_regular <span class=main>=</span> unitary_gen_regular<span class=main>[</span><span class=operator>OF</span> unitary_unitary_gen<span class=main>]</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Group properties›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Generalized $2\times 2$ unitary matrices form a group under
multiplication (usually denoted by $GU(2, \mathbb{C})$). The group is closed
under non-zero complex scalar multiplication. Since these matrices are
always regular, they form a subgroup of general linear group (usually
denoted by $GL(2, \mathbb{C})$) of all regular matrices.›</span></span>

<span class=keyword1 id=Unitary_Matrices-unitary_gen_scale><span class=command>lemma</span></span> unitary_gen_scale <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> unitary_gen_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Unitary_Matrices-unitary_comp><span class=command>lemma</span></span> unitary_comp<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary <span class=free>M1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"unitary <span class=free>M2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary <span class=main>(</span><span class=free>M1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> unitary_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mat_adj_mult_mm mat_eye_l mult_mm_assoc<span class=main>)</span>

<span class=keyword1 id=Unitary_Matrices-unitary_gen_comp><span class=command>lemma</span></span> unitary_gen_comp<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=free>M1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=free>M2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=main>(</span><span class=free>M1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k1</span></span> <span class=skolem><span class=skolem>k2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k1</span> <span class=main>*</span> <span class=skolem>k2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M1</span> <span class=main>=</span> <span class=skolem>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye"</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M2</span> <span class=main>=</span> <span class=skolem>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> unitary_gen_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_adj <span class=free>M1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>M1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M2</span><span class=main>)</span> <span class=main>=</span> mat_adj <span class=free>M2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_adj <span class=free>M1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_mm_assoc<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> mat_adj <span class=free>M2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>(</span><span class=skolem>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_mm_assoc<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> mat_adj <span class=free>M2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> mult_sm_eye_mm<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k1</span></span> <span class=quoted><span class=free>M2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> eye_def<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=skolem>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye<span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>unfolding</span></span> unitary_gen_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k1</span><span class=main>*</span><span class=skolem>k2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> eye_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unitary_Matrices-unitary_adj_eq_inv><span class=command>lemma</span></span> unitary_adj_eq_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary <span class=free>M</span> <span class=main>⟷</span> mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_adj <span class=free>M</span> <span class=main>=</span> mat_inv <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span>  unitary_regular<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span> mult_mm_inv_r<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span>"</span></span> <span class=quoted>eye</span><span class=main>]</span>  mat_eye_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_inv <span class=free>M</span>"</span></span><span class=main>]</span> mat_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> unitary_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>rule</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=keyword1 id=Unitary_Matrices-unitary_inv><span class=command>lemma</span></span> unitary_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary <span class=main>(</span>mat_inv <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> unitary_adj_eq_inv
  <span class=keyword1><span class=command>using</span></span> mat_adj_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span> mat_det_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Unitary_Matrices-unitary_gen_inv><span class=command>lemma</span></span> unitary_gen_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=main>(</span>mat_inv <span class=free>M</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>M'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"unitary <span class=skolem>M'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>M'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> unitary_gen_unitary<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span> assms
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_inv <span class=free>M</span> <span class=main>=</span> cor <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=skolem>k</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_inv <span class=skolem>M'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mat_inv_mult_sm mult_sm_eye_mm norm_not_less_zero of_real_1 of_real_divide of_real_eq_0_iff sgn_1_neg sgn_greater sgn_if sgn_pos sgn_sgn<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹unitary <span class=skolem>M'</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> unitary_gen_unitary<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"mat_inv <span class=free><span class=free><span class=free>M</span></span></span>"</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"mat_inv <span class=skolem>M'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> divide_pos_pos mult_sm_eye_mm unitary_inv zero_less_one<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹The characterization in terms of matrix elements›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Special matrices are those having the determinant equal to 1. We first give their characterization.›</span></span>
<span class=keyword1 id=Unitary_Matrices-unitary_special><span class=command>lemma</span></span> unitary_special<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary <span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=main>=</span> mat_inv <span class=free>M</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms mult_mm_inv_r<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span>"</span></span> <span class=quoted><span class=quoted>"eye"</span></span><span class=main>]</span> mat_eye_r mat_eye_l
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary_def<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=free>M</span> <span class=main>=</span> <span class=main>1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unitary_Matrices-unitary_gen_special><span class=command>lemma</span></span> unitary_gen_special<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary_gen_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>k</span><span class=main>*</span><span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span><span class=main>*</span><span class=skolem>k</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_adj<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> <span class=main>1</span> <span class=main>∨</span> <span class=skolem>k</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> square_eq_1_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_inv <span class=free>M</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>using</span></span> assms mult_mm_inv_r<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye"</span></span><span class=main>]</span> mat_eye_r mat_eye_l
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> mult_sm_eye_mm *<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>∨</span> <span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>-</span> <span class=main>(</span>cor <span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cor <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> cmod_square complex_norm_square minus_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> of_real_power realpow_square_minus_le uminus_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>cor <span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cor <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>≠</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=free>M</span> <span class=main>=</span> <span class=main>1</span>›</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>a</span></span><span class=main>]</span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>b</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹A characterization of all generalized unitary matrices›</span></span>
<span class=keyword1 id=Unitary_Matrices-unitary_gen_iff><span class=command>lemma</span></span> unitary_gen_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=free>M</span> <span class=main>⟷</span> 
         <span class=main>(</span><span class=main>∃</span> <span class=bound>a</span> <span class=bound>b</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span>
                           <span class=free>M</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>d</span><span class=main>*</span><span class=skolem>d</span> <span class=main>=</span> mat_det <span class=free>M</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_complex_sqrt
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary_gen_regular<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹unitary_gen <span class=free>M</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹unitary_gen <span class=free>M</span>›</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary_gen_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=main>(</span><span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=skolem>d</span><span class=main>)</span><span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span><span class=free>M</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=skolem>d</span><span class=main>)</span><span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span><span class=free>M</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>d</span><span class=main>*</span>cnj <span class=skolem>d</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=skolem>d</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary_gen_special<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=skolem>d</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span><span class=main>]</span>  <span class=quoted><span class=quoted>‹unitary_gen <span class=free>M</span>›</span></span> *  unitary_gen_regular<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary_gen_regular<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹unitary_gen <span class=free>M</span>›</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>d</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> mult_sm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>d</span>"</span></span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary_gen_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> mult_eq_0_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cnj <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"cnj <span class=skolem>a</span> <span class=main>*</span> <span class=skolem>a</span> <span class=main>+</span> cnj <span class=skolem>b</span> <span class=main>*</span> <span class=skolem>b</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹A characterization of unitary matrices›</span></span>

<span class=keyword1 id=Unitary_Matrices-unitary_iff><span class=command>lemma</span></span> unitary_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary <span class=free>M</span> <span class=main>⟷</span>
         <span class=main>(</span><span class=main>∃</span> <span class=bound>a</span> <span class=bound>b</span> <span class=bound>k</span><span class=main>.</span> <span class=main>(</span>cmod <span class=bound>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span>cmod <span class=bound>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> 
                           <span class=main>(</span>cmod <span class=bound>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> <span class=main>(</span><span class=main>(</span>cmod <span class=bound>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span>cmod <span class=bound>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>∧</span>
                           <span class=free>M</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary_gen_iff  unitary_unitary_gen<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹unitary <span class=free>M</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>have</span></span> md<span class=main>:</span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>k</span> <span class=main>*</span> mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹unitary <span class=free>M</span>›</span></span> *
    <span class=keyword1><span class=command>unfolding</span></span> unitary_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>mono_tags<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> complex_norm_square md of_real_1 of_real_eq_iff of_real_mult<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> * mat_eye_l
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted><span class=quoted>‹<span class=main>(</span>cmod <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>›</span></span> mult_eq_0_iff nonzero_eq_divide_eq zero_neq_one<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span>  *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>k</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>k</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>b</span> <span class=main>*</span> cnj <span class=skolem>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> complex_mult_cnj_cmod<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>using</span></span> *<span class=main>(</span>1-2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> distrib_left nonzero_eq_divide_eq of_real_1 of_real_add of_real_divide of_real_eq_0_iff<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>unfolding</span></span> unitary_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Unitary11_Matrices>
<div class=head>
<h1>Theory Unitary11_Matrices</h1>
</div>
<pre class=source><span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Generalized unitary matrices with signature $(1, 1)$›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>theory</span></span> Unitary11_Matrices
<span class=keyword2><span class=keyword>imports</span></span> <a href=#Matrices>Matrices</a> <a href=#More_Complex>More_Complex</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ When acting as Möbius transformations in the extended
complex plane, generalized complex $2\times 2$ unitary matrices fix
the imaginary unit circle (a Hermitean form with (2, 0) signature). We
now describe matrices that fix the ordinary unit circle (a Hermitean
form with (1, 1) signature, i.e., one positive and one negative
element on the diagonal). These are extremely important for further
formalization, since they will represent disc automorphisims and
isometries of the Poincar\'e disc. The development of this theory
follows the development of the theory of generalized unitary matrices.
›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Unitary11 matrices›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>unitary11</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>unitary11</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>⟷</span> congruence <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Generalized unitary11 matrices›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>unitary11_gen</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>unitary11_gen</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> congruence <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Scalar can always be a non-zero real number›</span></span>
<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_real><span class=command>lemma</span></span> unitary11_gen_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> congruence <span class=free>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> cor <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> unitary11_gen_def
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> congruence_def<span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>k</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"congruence <span class=free>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span> <span class=skolem>k</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>congruence <span class=free>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=skolem>k</span><span class=main>*</span><span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>mat_det <span class=main>(</span>congruence <span class=free>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>mat_det <span class=main>(</span>congruence <span class=free>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_adj<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span><span class=skolem>k</span><span class=main>*</span><span class=skolem>k</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>-</span><span class=skolem>k</span><span class=main>*</span><span class=skolem>k</span><span class=main>)</span> <span class=main>≤</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span><span class=skolem>k</span><span class=main>*</span><span class=skolem>k</span><span class=main>)</span> <span class=main>∧</span> Re <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> <span class=skolem>k</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> complex_eq_if_Re_eq mult_eq_0_iff mult_minus_left uminus_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> zero_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> zero_complex.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>ka</span><span class=main>.</span> <span class=bound>ka</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>k</span> <span class=main>=</span> cor <span class=bound>ka</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re <span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>k</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Unitary11 matrices are special cases of generalized unitary 11 matrices›</span></span>
<span class=keyword1 id=Unitary11_Matrices-unitary11_unitary11_gen><span class=command>lemma</span></span> unitary11_unitary11_gen <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary11 <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> unitary11_gen_def unitary11_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹All generalized unitary11 matrices are regular›</span></span>
<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_regular><span class=command>lemma</span></span> unitary11_gen_regular<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary11_gen_real
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_adj<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemmas</span></span> unitary11_regular <span class=main>=</span> unitary11_gen_regular<span class=main>[</span><span class=operator>OF</span> unitary11_unitary11_gen<span class=main>]</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹The characterization in terms of matrix elements›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Special matrices are those having the determinant equal to 1. We first give their characterization.›</span></span>
<span class=keyword1 id=Unitary11_Matrices-unitary11_special><span class=command>lemma</span></span> unitary11_special<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary11 <span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_inv <span class=free>M</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms mult_mm_inv_r
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary11_def<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_special><span class=command>lemma</span></span> unitary11_gen_special<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span> <span class=main>∨</span> <span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=bound>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=bound>a</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary11_gen_real
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span>  cor <span class=skolem>k</span><span class=main>*</span> cor <span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span>mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span> <span class=main>=</span> cor <span class=skolem>k</span><span class=main>*</span> cor <span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span><span class=main>*</span> cor <span class=skolem>k</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_adj<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span> <span class=main>=</span> <span class=main>1</span> <span class=main>∨</span> cor <span class=skolem>k</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> square_eq_1_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_inv <span class=free>M</span> "</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>using</span></span> assms mult_mm_inv_r mat_eye_r mat_eye_l
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>∨</span> <span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹A characterization of all generalized unitary11 matrices›</span></span>
<span class=keyword1 id="Unitary11_Matrices-unitary11_gen_iff'"><span class=command>lemma</span></span> unitary11_gen_iff'<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M</span> <span class=main>⟷</span>
         <span class=main>(</span><span class=main>∃</span> <span class=bound>a</span> <span class=bound>b</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span>
                           <span class=main>(</span><span class=free>M</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span> <span class=main>∨</span> 
                            <span class=free>M</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>d</span><span class=main>*</span><span class=skolem>d</span> <span class=main>=</span> mat_det <span class=free>M</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_complex_sqrt
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_regular<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹unitary11_gen <span class=free>M</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹unitary11_gen <span class=free>M</span>›</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary11_gen_real
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=main>(</span><span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=skolem>d</span><span class=main>)</span><span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span><span class=free>M</span><span class=main>)</span><span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=skolem>d</span><span class=main>)</span><span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span><span class=free>M</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>d</span><span class=main>*</span>cnj <span class=skolem>d</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> cnj <span class=skolem>d</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex_In_mult_cnj_zero div_reals Im_complex_of_real<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>Re <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> cnj <span class=skolem>d</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> cnj <span class=skolem>d</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=main>(</span><span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=skolem>d</span><span class=main>)</span><span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span><span class=free>M</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary11_gen_real
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cor <span class=main>(</span>Re <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> cnj <span class=skolem>d</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> cnj <span class=skolem>d</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> cnj <span class=skolem>d</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> *<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=skolem>d</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * unitary11_gen_regular<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹unitary11_gen <span class=free>M</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=skolem>d</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=skolem>d</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_special<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=skolem>d</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=skolem>d</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> unitary11_gen_regular<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹unitary11_gen <span class=free>M</span>›</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>d</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=skolem>d</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>" <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=skolem>d</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> <span class=skolem>d</span><span class=main>,</span> <span class=skolem>b</span> <span class=main>*</span> <span class=skolem>d</span><span class=main>,</span> <span class=main>-</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> cnj <span class=skolem>b</span><span class=main>)</span><span class=main>,</span> <span class=main>-</span> <span class=main>(</span><span class=skolem>d</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> mult_sm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>d</span>"</span></span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>a</span><span class=main>)</span>"</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>b</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * unitary11_gen_regular<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹unitary11_gen <span class=free>M</span>›</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=skolem>d</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>∨</span> <span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?x</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"cnj <span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>+</span> <span class=main>-</span> <span class=main>(</span>cnj <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>b</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k</span><span class=main>*</span>cnj <span class=skolem>k</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=skolem>a</span><span class=main>*</span>cnj <span class=skolem>a</span> <span class=main>-</span> <span class=skolem>b</span><span class=main>*</span>cnj <span class=skolem>b</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=var>?x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>Re <span class=var>?x</span><span class=main>)</span> <span class=main>=</span> <span class=var>?x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> complex_of_real_Re<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?x</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> mult_eq_0_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cnj <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cnj <span class=skolem>a</span> <span class=main>*</span> <span class=skolem>a</span> <span class=main>+</span> <span class=main>-</span> cnj <span class=skolem>b</span> <span class=main>*</span> <span class=skolem>b</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=var>?x</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=var>?x</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> calculation<span class=main><span class=main>(</span></span>4<span class=main><span class=main>)</span></span> of_real_0<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary11_gen_real
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re <span class=var>?x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Another characterization of all generalized unitary11 matrices. They are products of 
rotation and Blaschke factor matrices.›</span></span>
<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_cis_blaschke><span class=command>lemma</span></span> unitary11_gen_cis_blaschke<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 
          <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k'</span> <span class=bound>φ</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>k'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>*</span> cnj <span class=bound>a'</span> <span class=main>≠</span> <span class=main>1</span> <span class=main>∧</span> 
                                 <span class=free>M</span> <span class=main>=</span> <span class=bound>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>cis <span class=bound>φ</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>-</span><span class=bound>a'</span><span class=main>,</span> <span class=main>-</span>cnj <span class=bound>a'</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> cnj <span class=free>a</span> <span class=main>*</span> cis <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> arg <span class=free>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span> rcis_cnj<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> cis_rcis_eq rcis_mult
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>k</span><span class=main>*</span>cnj <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span>arg <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span> <span class=free>b</span> <span class=main>/</span> <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Unitary11_Matrices-unitary11_gen_cis_blaschke'"><span class=command>lemma</span></span> unitary11_gen_cis_blaschke'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
          <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k'</span> <span class=bound>φ</span> <span class=bound>a'</span><span class=main>.</span> <span class=bound>k'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>a'</span> <span class=main>*</span> cnj <span class=bound>a'</span> <span class=main>≠</span> <span class=main>1</span> <span class=main>∧</span>
                                 <span class=free>M</span> <span class=main>=</span> <span class=bound>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>cis <span class=bound>φ</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>-</span><span class=bound>a'</span><span class=main>,</span> <span class=main>-</span>cnj <span class=bound>a'</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=skolem><span class=skolem>φ</span></span> <span class=skolem><span class=skolem>a'</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>cis <span class=skolem>φ</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>-</span><span class=skolem>a'</span><span class=main>,</span> <span class=main>-</span>cnj <span class=skolem>a'</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>*</span> cnj <span class=skolem>a'</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_cis_blaschke<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> _ <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cis <span class=skolem>φ</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cis <span class=main>(</span><span class=skolem>φ</span> <span class=main>+</span> pi<span class=main>)</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
   <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_def complex.corec Complex_eq<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=free>M</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>φ</span> <span class=main>+</span> pi"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>a'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_cis_blaschke_rev><span class=command>lemma</span></span> unitary11_gen_cis_blaschke_rev<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=free>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>cis <span class=free>φ</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>-</span><span class=free>a'</span><span class=main>,</span> <span class=main>-</span>cnj <span class=free>a'</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
          <span class=quoted><span class=quoted>"<span class=free>a'</span> <span class=main>*</span> cnj <span class=free>a'</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>  <span class=main>∧</span>
                          <span class=free>M</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>k'</span><span class=main>*</span>cis<span class=main>(</span><span class=free>φ</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"cis<span class=main>(</span><span class=free>φ</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>a'</span><span class=main>*</span>cis<span class=main>(</span><span class=free>φ</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_mult mult.commute mult.left_commute<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_cis_inversion><span class=command>lemma</span></span> unitary11_gen_cis_inversion<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k'</span> <span class=bound>φ</span><span class=main>.</span> <span class=bound>k'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span>
                              <span class=free>M</span> <span class=main>=</span> <span class=bound>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>cis <span class=bound>φ</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>using</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>b</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> rcis_cnj<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>b</span></span><span class=main>]</span> cis_rcis_eq
<span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span>arg <span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> rcis_mult<span class=main>)</span>

<span class=keyword1 id="Unitary11_Matrices-unitary11_gen_cis_inversion'"><span class=command>lemma</span></span> unitary11_gen_cis_inversion'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k'</span> <span class=bound>φ</span><span class=main>.</span> <span class=bound>k'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span>
                   <span class=free>M</span> <span class=main>=</span> <span class=bound>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>cis <span class=bound>φ</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=skolem><span class=skolem>φ</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>cis <span class=skolem>φ</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_cis_inversion<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> _ <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cis <span class=skolem>φ</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cis <span class=main>(</span><span class=skolem>φ</span> <span class=main>+</span> pi<span class=main>)</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_def complex.corec Complex_eq<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=free>M</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>φ</span> <span class=main>+</span> pi"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_cis_inversion_rev><span class=command>lemma</span></span> unitary11_gen_cis_inversion_rev<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=free>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>cis <span class=free>φ</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span>
                          <span class=free>M</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>k'</span><span class=main>*</span>cis<span class=main>(</span><span class=free>φ</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>0</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"cis<span class=main>(</span><span class=free>φ</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_mult<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Another characterization of generalized unitary11 matrices›</span></span>
<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_iff><span class=command>lemma</span></span> unitary11_gen_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M</span> <span class=main>⟷</span> 
         <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span>
                           <span class=free>M</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>∨</span> <span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_iff'
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> *
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> unitary11_gen_cis_inversion_rev<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> ** <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> unitary11_gen_cis_inversion'<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> _ <span class=quoted><span class=quoted>‹<span class=skolem>b</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> unitary11_gen_cis_blaschke_rev<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> **
        <span class=keyword1><span class=command>using</span></span> unitary11_gen_cis_blaschke'<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> _ <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=skolem>b</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_iff'
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_iff><span class=command>lemma</span></span> unitary11_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary11 <span class=free>M</span> <span class=main>⟷</span>
         <span class=main>(</span><span class=main>∃</span> <span class=bound>a</span> <span class=bound>b</span> <span class=bound>k</span><span class=main>.</span> <span class=main>(</span>cmod <span class=bound>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>&gt;</span> <span class=main>(</span>cmod <span class=bound>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>∧</span>
                           <span class=main>(</span>cmod <span class=bound>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> <span class=main>(</span><span class=main>(</span>cmod <span class=bound>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cmod <span class=bound>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>∧</span>
                           <span class=free>M</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span>
    <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span><span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_iff unitary11_unitary11_gen<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹unitary11 <span class=free>M</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>have</span></span> md<span class=main>:</span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>k</span> <span class=main>*</span> mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹unitary11 <span class=free>M</span>›</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary11_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex_mult_cnj_cmod md of_real_1 of_real_eq_iff of_real_mult<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> <span class=main>(</span>cmod <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span><span class=main>=</span><span class=main>0</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cmod <span class=skolem>a</span> <span class=main>^</span> <span class=numeral>2</span> <span class=main>=</span> cmod <span class=skolem>b</span> <span class=main>^</span> <span class=numeral>2</span> <span class=main>+</span> <span class=main>1</span> <span class=main>/</span> cmod <span class=skolem>k</span> <span class=main>^</span> <span class=numeral>2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>›</span></span> ** mat_eye_l
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
       <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod <span class=quasi_keyword>intro</span><span class=main><span class=main>!</span></span><span class=main><span class=main>:</span></span> <span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>&lt;</span> <span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>∧</span> <span class=main>(</span>cmod <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>∧</span> <span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnj <span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>+</span> <span class=main>-</span> <span class=main>(</span>cnj <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>b</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>b</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cor <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnj <span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>=</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span>cmod <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>a</span></span><span class=main>]</span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnj <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>b</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>b</span><span class=main>)</span> <span class=main>=</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span>cmod <span class=skolem>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>b</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary11_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Group properties›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Generalized unitary11 matrices form a group under
multiplication (it is sometimes denoted by $GU_{1, 1}(2,
\mathbb{C})$). The group is also closed under non-zero complex scalar
multiplication. Since these matrices are always regular, they form a
subgroup of general linear group (usually denoted by $GL(2,
\mathbb{C})$) of all regular matrices.›</span></span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_mult_sm><span class=command>lemma</span></span> unitary11_gen_mult_sm<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>*</span> cnj <span class=free>k</span> <span class=main>=</span> cor <span class=main>(</span>Re <span class=main>(</span><span class=free>k</span> <span class=main>*</span> cnj <span class=free>k</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_of_real_Re<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> unitary11_gen_real
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>k</span><span class=main>*</span>cnj <span class=free>k</span><span class=main>)</span> <span class=main>*</span> <span class=improper>ka</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_div_sm><span class=command>lemma</span></span> unitary11_gen_div_sm<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms unitary11_gen_mult_sm<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=free>k</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


<span class=keyword1 id=Unitary11_Matrices-unitary11_inv><span class=command>lemma</span></span> unitary11_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k'</span> <span class=bound>a'</span> <span class=bound>b'</span><span class=main>.</span> <span class=bound>k'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_inv <span class=free>M</span> <span class=main>=</span> <span class=bound>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=bound>a'</span><span class=main>,</span> <span class=bound>b'</span><span class=main>,</span> cnj <span class=bound>b'</span><span class=main>,</span> cnj <span class=bound>a'</span><span class=main>)</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=bound>a'</span><span class=main>,</span> <span class=bound>b'</span><span class=main>,</span> cnj <span class=bound>b'</span><span class=main>,</span> cnj <span class=bound>a'</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> assms<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mat_inv_mult_sm<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
     <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=main>(</span><span class=free>k</span> <span class=main>*</span> mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"cnj <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_comp><span class=command>lemma</span></span> unitary11_comp<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M1</span> <span class=main>=</span> <span class=free>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>a1</span><span class=main>,</span> <span class=free>b1</span><span class=main>,</span> cnj <span class=free>b1</span><span class=main>,</span> cnj <span class=free>a1</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>a1</span><span class=main>,</span> <span class=free>b1</span><span class=main>,</span> cnj <span class=free>b1</span><span class=main>,</span> cnj <span class=free>a1</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=free>k2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>M2</span> <span class=main>=</span> <span class=free>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>a2</span><span class=main>,</span> <span class=free>b2</span><span class=main>,</span> cnj <span class=free>b2</span><span class=main>,</span> cnj <span class=free>a2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>a2</span><span class=main>,</span> <span class=free>b2</span><span class=main>,</span> cnj <span class=free>b2</span><span class=main>,</span> cnj <span class=free>a2</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>M1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M2</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>k1</span><span class=main>*</span><span class=free>k2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>a1</span><span class=main>*</span><span class=free>a2</span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span>cnj <span class=free>b2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=free>a1</span><span class=main>*</span><span class=free>b2</span> <span class=main>+</span> <span class=free>b1</span><span class=main>*</span>cnj <span class=free>a2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>algebra_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a1</span> <span class=main>*</span> <span class=main>(</span><span class=free>a2</span> <span class=main>*</span> <span class=main>(</span>cnj <span class=free>a1</span> <span class=main>*</span> cnj <span class=free>a2</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=free>b1</span> <span class=main>*</span> <span class=main>(</span><span class=free>b2</span> <span class=main>*</span> <span class=main>(</span>cnj <span class=free>b1</span> <span class=main>*</span> cnj <span class=free>b2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
            <span class=free>a1</span> <span class=main>*</span> <span class=main>(</span><span class=free>b2</span> <span class=main>*</span> <span class=main>(</span>cnj <span class=free>a1</span> <span class=main>*</span> cnj <span class=free>b2</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=free>a2</span> <span class=main>*</span> <span class=main>(</span><span class=free>b1</span> <span class=main>*</span> <span class=main>(</span>cnj <span class=free>a2</span> <span class=main>*</span> cnj <span class=free>b1</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
         **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a1</span><span class=main>*</span>cnj <span class=free>a1</span> <span class=main>≠</span> <span class=free>b1</span> <span class=main>*</span> cnj <span class=free>b1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>a2</span><span class=main>*</span>cnj <span class=free>a2</span> <span class=main>≠</span> <span class=free>b2</span><span class=main>*</span>cnj <span class=free>b2</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a1</span><span class=main>*</span>cnj <span class=free>a1</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=free>a2</span><span class=main>*</span>cnj <span class=free>a2</span> <span class=main>-</span> <span class=free>b2</span><span class=main>*</span>cnj <span class=free>b2</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>b1</span><span class=main>*</span>cnj <span class=free>b1</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=free>a2</span><span class=main>*</span>cnj <span class=free>a2</span> <span class=main>-</span> <span class=free>b2</span><span class=main>*</span>cnj <span class=free>b2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>a1</span><span class=main>*</span>cnj <span class=free>a1</span> <span class=main>=</span> <span class=free>b1</span><span class=main>*</span>cnj <span class=free>b1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> **<span class=main>(</span>2<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
    <span class=keyword1><span class=command>using</span></span> **<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_mat_inv><span class=command>lemma</span></span> unitary11_gen_mat_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=main>(</span>mat_inv <span class=free>M</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms unitary11_gen_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=skolem><span class=skolem>a'</span></span> <span class=skolem><span class=skolem>b'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_inv <span class=free>M</span> <span class=main>=</span> <span class=skolem>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a'</span><span class=main>,</span> <span class=skolem>b'</span><span class=main>,</span> cnj <span class=skolem>b'</span><span class=main>,</span> cnj <span class=skolem>a'</span><span class=main>)</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=skolem>a'</span><span class=main>,</span> <span class=skolem>b'</span><span class=main>,</span> cnj <span class=skolem>b'</span><span class=main>,</span> cnj <span class=skolem>a'</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_inv <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>b</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_inv <span class=free>M</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_gen_comp><span class=command>lemma</span></span> unitary11_gen_comp<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M2</span>"</span></span>  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>M2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=main>(</span><span class=free>M1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k1</span></span> <span class=skolem><span class=skolem>k2</span></span> <span class=skolem><span class=skolem>a1</span></span> <span class=skolem><span class=skolem>a2</span></span> <span class=skolem><span class=skolem>b1</span></span> <span class=skolem><span class=skolem>b2</span></span> <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=skolem>k1</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=skolem>a1</span><span class=main>,</span> <span class=skolem>b1</span><span class=main>,</span> cnj <span class=skolem>b1</span><span class=main>,</span> cnj <span class=skolem>a1</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>M1</span> <span class=main>=</span> <span class=skolem>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a1</span><span class=main>,</span> <span class=skolem>b1</span><span class=main>,</span> cnj <span class=skolem>b1</span><span class=main>,</span> cnj <span class=skolem>a1</span><span class=main>)</span>"</span></span>
    <span class=quoted><span class=quoted>"<span class=skolem>k2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=skolem>a2</span><span class=main>,</span> <span class=skolem>b2</span><span class=main>,</span> cnj <span class=skolem>b2</span><span class=main>,</span> cnj <span class=skolem>a2</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>M2</span> <span class=main>=</span> <span class=skolem>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a2</span><span class=main>,</span> <span class=skolem>b2</span><span class=main>,</span> cnj <span class=skolem>b2</span><span class=main>,</span> cnj <span class=skolem>a2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M1</span></span><span class=main>]</span>  unitary11_gen_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>M1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M2</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k1</span></span> <span class=quoted><span class=free>M1</span></span> <span class=quoted><span class=skolem>a1</span></span> <span class=quoted><span class=skolem>b1</span></span> <span class=quoted><span class=skolem>k2</span></span> <span class=quoted><span class=free>M2</span></span> <span class=quoted><span class=skolem>a2</span></span> <span class=quoted><span class=skolem>b2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>M1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M2</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Classification into orientation-preserving and orientation-reversing matrices›</span></span>
<span class=keyword1 id=Unitary11_Matrices-unitary11_sgn_det_orientation><span class=command>lemma</span></span> unitary11_sgn_det_orientation<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k'</span><span class=main>.</span> sgn <span class=bound>k'</span> <span class=main>=</span> sgn <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> congruence <span class=free>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> cor <span class=bound>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?x</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"cnj <span class=free>k</span> <span class=main>*</span> cnj <span class=free>a</span> <span class=main>*</span> <span class=main>(</span><span class=free>k</span> <span class=main>*</span> <span class=free>a</span><span class=main>)</span> <span class=main>-</span> <span class=main>(</span>cnj <span class=free>k</span> <span class=main>*</span> <span class=free>b</span> <span class=main>*</span> <span class=main>(</span><span class=free>k</span> <span class=main>*</span> cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?x</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> cnj <span class=free>k</span> <span class=main>*</span> <span class=main>(</span><span class=free>a</span> <span class=main>*</span> cnj <span class=free>a</span> <span class=main>-</span> <span class=free>b</span> <span class=main>*</span> cnj <span class=free>b</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=var>?x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>Re <span class=var>?x</span><span class=main>)</span> <span class=main>=</span> <span class=var>?x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> complex_of_real_Re<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>Re <span class=var>?x</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>Re <span class=main>(</span><span class=free>a</span> <span class=main>*</span> cnj <span class=free>a</span> <span class=main>-</span> <span class=free>b</span> <span class=main>*</span> cnj <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"Re <span class=var>?x</span> <span class=main>=</span> <span class=main>(</span>cmod <span class=free>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> Re <span class=main>(</span><span class=free>a</span> <span class=main>*</span> cnj <span class=free>a</span> <span class=main>-</span> <span class=free>b</span> <span class=main>*</span> cnj <span class=free>b</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> complex_mult_cnj_cmod<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Re_mult_real<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> Im_complex_of_real<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> Re_complex_of_real<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_mult<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re <span class=var>?x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_sgn_det><span class=command>lemma</span></span> unitary11_sgn_det<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> cnj <span class=free>b</span><span class=main>,</span> cnj <span class=free>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free>b</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>1</span> <span class=keyword1>else</span> sgn <span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>B</span><span class=main>*</span><span class=free>C</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mat_det.simps<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> complex_mult_cnj_cmod<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> minus_complex.sel<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Re_complex_of_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span>  <span class=free>k</span> <span class=main>*</span> <span class=free>a</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>=</span>  <span class=free>k</span> <span class=main>*</span> <span class=free>b</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span>  <span class=free>k</span> <span class=main>*</span> cnj <span class=free>b</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>D</span> <span class=main>=</span>  <span class=free>k</span> <span class=main>*</span> cnj <span class=free>a</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>B</span><span class=main>*</span><span class=free>C</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>*</span>cnj <span class=free>a</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>b</span><span class=main>*</span>cnj <span class=free>b</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>b</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> mat_det.simps<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> complex_mult_cnj_cmod<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=main>(</span><span class=operator>subst</span> Re_complex_of_real<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> minus_complex.sel<span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>subst</span> Re_complex_of_real<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> sgn_if<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unitary11_Matrices-unitary11_orientation><span class=command>lemma</span></span> unitary11_orientation<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k'</span><span class=main>.</span> sgn <span class=bound>k'</span> <span class=main>=</span> sgn <span class=main>(</span><span class=keyword1>if</span> <span class=free>B</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>1</span> <span class=keyword1>else</span> sgn <span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>B</span><span class=main>*</span><span class=free>C</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> congruence <span class=free>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> cor <span class=bound>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹unitary11_gen <span class=free>M</span>›</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span><span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=free>B</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span>›</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_sgn_det_orientation<span class=main>[</span><span class=operator>OF</span> *<span class=main>]</span> unitary11_sgn_det<span class=main>[</span><span class=operator>OF</span> * <span class=quoted><span class=quoted>‹<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Unitary11_Matrices-unitary11_sgn_det_orientation'"><span class=command>lemma</span></span> unitary11_sgn_det_orientation'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"congruence <span class=free>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> cor <span class=free>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>a</span> <span class=bound>b</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>M</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span> <span class=main>∧</span> sgn <span class=free>k'</span> <span class=main>=</span> sgn <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>b</span><span class=main>,</span> cnj <span class=bound>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> unitary11_gen_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sgn <span class=free>k'</span> <span class=main>=</span> sgn <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?x</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"cnj <span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>-</span> <span class=main>(</span>cnj <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>b</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?x</span> <span class=main>=</span> <span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>k</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>-</span> <span class=skolem>b</span> <span class=main>*</span> cnj <span class=skolem>b</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=var>?x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>Re <span class=var>?x</span><span class=main>)</span> <span class=main>=</span> <span class=var>?x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> complex_of_real_Re<span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>Re <span class=var>?x</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>Re <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>-</span> <span class=skolem>b</span> <span class=main>*</span> cnj <span class=skolem>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
      <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"Re <span class=var>?x</span> <span class=main>=</span> <span class=main>(</span>cmod <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> Re <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>-</span> <span class=skolem>b</span> <span class=main>*</span> cnj <span class=skolem>b</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> complex_mult_cnj_cmod<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Re_mult_real<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> Im_complex_of_real<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> Re_complex_of_real<span class=main>)</span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_mult<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?x</span> <span class=main>=</span> cor <span class=free>k'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>›</span></span> assms
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>Re <span class=var>?x</span><span class=main>)</span> <span class=main>=</span> sgn <span class=free>k'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cor <span class=main>(</span>Re <span class=var>?x</span><span class=main>)</span> <span class=main>=</span> <span class=var>?x</span>›</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> complex_of_real_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>  <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Hermitean_Matrices>
<div class=head>
<h1>Theory Hermitean_Matrices</h1>
</div>
<pre class=source><span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Hermitean matrices›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Hermitean matrices over $\mathbb{C}$ generalize symmetric matrices over $\mathbb{R}$. Quadratic
forms with Hermitean matrices represent circles and lines in the extended complex plane (when
applied to homogenous coordinates).›</span></span>

<span class=keyword1><span class=command>theory</span></span> Hermitean_Matrices
<span class=keyword2><span class=keyword>imports</span></span> <a href=#Unitary_Matrices>Unitary_Matrices</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>hermitean</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>hermitean</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>⟷</span> mat_adj <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>A</span></span></span>"</span></span>

<span class=keyword1 id=Hermitean_Matrices-hermitean_transpose><span class=command>lemma</span></span> hermitean_transpose<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>A</span> <span class=main>⟷</span> mat_transpose <span class=free>A</span> <span class=main>=</span> mat_cnj <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> hermitean_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Characterization of 2x2 Hermitean matrices elements. 
All 2x2 Hermitean matrices are of the form 
$$
\left(
\begin{array}{cc}
A &amp; B\\
\overline{B} &amp; D
\end{array}
\right),
$$
for real $A$ and $D$ and complex $B$.
›</span></span>

<span class=keyword1 id=Hermitean_Matrices-hermitean_mk_circline><span class=command>lemma</span></span> hermitean_mk_circline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span>cor <span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> cnj <span class=free>B</span><span class=main>,</span> cor <span class=free>D</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> hermitean_def mat_adj_def mat_cnj_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id="Hermitean_Matrices-hermitean_mk_circline'"><span class=command>lemma</span></span> hermitean_mk_circline' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>D</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> cnj <span class=free>B</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms eq_cnj_iff_real
  <span class=keyword1><span class=command>unfolding</span></span> hermitean_def mat_adj_def mat_cnj_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Hermitean_Matrices-hermitean_elems><span class=command>lemma</span></span> hermitean_elems<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>D</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>=</span> cnj <span class=free>C</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cnj <span class=free>B</span> <span class=main>=</span> <span class=free>C</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main>]</span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>D</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Operations that preserve the Hermitean property›</span></span>

<span class=keyword1 id=Hermitean_Matrices-hermitean_mat_cnj><span class=command>lemma</span></span> hermitean_mat_cnj<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span> <span class=main>⟷</span> hermitean <span class=main>(</span>mat_cnj <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>  hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Hermitean_Matrices-hermitean_mult_real><span class=command>lemma</span></span> hermitean_mult_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=main>(</span>cor <span class=free>k</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> hermitean_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Hermitean_Matrices-hermitean_congruence><span class=command>lemma</span></span> hermitean_congruence<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span>congruence <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> hermitean_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_mm_assoc<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Identity matrix is Hermitean›</span></span>

<span class=keyword1 id=Hermitean_Matrices-hermitean_eye><span class=command>lemma</span></span> hermitean_eye <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"hermitean eye"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>  hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id="Hermitean_Matrices-hermitean_eye'"><span class=command>lemma</span></span> hermitean_eye' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>  hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Unit circle matrix is Hermitean›</span></span>

<span class=keyword1 id=Hermitean_Matrices-hermitean_unit_circle><span class=command>lemma</span></span> hermitean_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>  hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Hermitean matrices have real determinant›</span></span>
<span class=keyword1 id=Hermitean_Matrices-mat_det_hermitean_real><span class=command>lemma</span></span> mat_det_hermitean_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>mat_det <span class=free>A</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> hermitean_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> eq_cnj_iff_real mat_det_adj<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Zero matrix is the only Hermitean matrix with both determinant and trace equal
to zero›</span></span>
<span class=keyword1 id=Hermitean_Matrices-hermitean_det_zero_trace_zero><span class=command>lemma</span></span> hermitean_det_zero_trace_zero<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>A</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_trace <span class=free>A</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>complex<span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> mat_zero"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>d</span> <span class=skolem>c</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>*</span> <span class=skolem>d</span> <span class=main>=</span> cnj <span class=skolem>c</span> <span class=main>*</span> <span class=skolem>c</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>+</span> <span class=skolem>d</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"cnj <span class=skolem>a</span> <span class=main>=</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>+</span> <span class=skolem>d</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>d</span> <span class=main>=</span> <span class=main>-</span><span class=skolem>a</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_eq_0_iff<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>cor <span class=main>(</span>Re <span class=skolem>a</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>  <span class=main>=</span> <span class=main>(</span>cor <span class=main>(</span>cmod <span class=skolem>c</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cnj <span class=skolem>a</span> <span class=main>=</span> <span class=skolem>a</span>›</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>a</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span> <span class=main>=</span> cnj <span class=skolem>c</span> <span class=main>*</span> <span class=skolem>c</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cnj <span class=skolem>c</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>Re <span class=skolem>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> zero_le_power2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=skolem>c</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Re_complex_of_real of_real_minus of_real_power<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> zero_le_power2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=skolem>a</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cnj <span class=skolem>a</span> <span class=main>=</span> <span class=skolem>a</span>›</span></span>  eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>a</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_eq_if_Re_eq<span class=main>)</span>
  <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> * <span class=main>=</span> this
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> *<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>d</span></span> <span class=quoted><span class=skolem>c</span></span><span class=main>]</span>  *<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>d</span></span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>c</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Bilinear and quadratic forms with Hermitean matrices›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹A Hermitean matrix $(A, B, \overline{B}, D)$, for real $A$ and $D$, gives rise to bilinear form
$A\cdot \overline{v_{11}} \cdot v_{21}+\overline{B} \cdot \overline{v_{12}} \cdot v_{21} +
B \cdot \overline{v_{11}} \cdot v_{22}+D\cdot \overline{v_{12}}\cdot v_{22}$ (acting on vectors $(v_{11}, v_{12})$ and
$(v_{21}, v_{22})$) and to the quadratic form $A \cdot \overline{v_1} \cdot v_1+\overline{B}\cdot \overline{v_2}\cdot v_1 +
B\cdot \overline{v_1}\cdot v_2 + D\cdot \overline{v_2} \cdot v_2$ (acting on the vector $(v_1, v_2)$).›</span></span>

<span class=keyword1 id=Hermitean_Matrices-bilinear_form_hermitean_commute><span class=command>lemma</span></span> bilinear_form_hermitean_commute<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bilinear_form <span class=free>v1</span> <span class=free>v2</span> <span class=free>H</span> <span class=main>=</span> cnj <span class=main>(</span>bilinear_form <span class=free>v2</span> <span class=free>v1</span> <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_cnj <span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> vec_cnj <span class=free>v1</span> <span class=main>=</span> vec_cnj <span class=free>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>mat_adj <span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> mult_vv_commute<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mult_mv_mult_vm<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_transpose_mat_cnj<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>…</span> <span class=main>=</span> bilinear_form <span class=free>v1</span> <span class=free>v2</span> <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_vv_mv hermitean_def<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cnj_mult_vv vec_cnj_mult_vm<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Hermitean_Matrices-quad_form_hermitean_real><span class=command>lemma</span></span> quad_form_hermitean_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>quad_form <span class=free>z</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> eq_cnj_iff_real<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>  <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> quad_form_def <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def<span class=main>)</span>

<span class=keyword1 id=Hermitean_Matrices-quad_form_vec_cnj_mat_cnj><span class=command>lemma</span></span> quad_form_vec_cnj_mat_cnj<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"quad_form <span class=main>(</span>vec_cnj <span class=free>z</span><span class=main>)</span> <span class=main>(</span>mat_cnj <span class=free>H</span><span class=main>)</span> <span class=main>=</span> quad_form <span class=free>z</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> cnj_mult_vv cnj_quad_form hermitean_def vec_cnj_mult_vm <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Eigenvalues, eigenvectors and diagonalization of Hermitean matrices›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Hermitean matrices have real eigenvalues›</span></span>
<span class=keyword1 id=Hermitean_Matrices-hermitean_eigenval_real><span class=command>lemma</span></span> hermitean_eigenval_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"eigenval <span class=free>k</span> <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>k</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> eigenval_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> vec_cnj <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>vec_cnj <span class=skolem>v</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_vv_scale_sv1<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=main>(</span><span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>vec_cnj <span class=skolem>v</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span>  <span class=skolem>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>mat_transpose <span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>vec_cnj <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_mv_vv<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=skolem>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>vec_cnj <span class=main>(</span>mat_cnj <span class=main>(</span>mat_transpose <span class=free>H</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_mult_mv<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=skolem>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>vec_cnj <span class=main>(</span><span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹hermitean <span class=free>H</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> <span class=skolem>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>vec_cnj <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> vec_cnj <span class=skolem>v</span><span class=main>)</span> <span class=main>=</span> cnj <span class=free>k</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>v</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> vec_cnj <span class=skolem>v</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_vv_scale_sv2<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>=</span> cnj <span class=free>k</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>v</span> <span class=main>≠</span> vec_zero›</span></span>
    <span class=keyword1><span class=command>using</span></span> scalsquare_vv_zero<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>v</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_vv_commute<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> eq_cnj_iff_real<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Non-diagonal Hermitean matrices have distinct eigenvalues›</span></span>
<span class=keyword1 id=Hermitean_Matrices-hermitean_distinct_eigenvals><span class=command>lemma</span></span> hermitean_distinct_eigenvals<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span> <span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∧</span> eigenval <span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>H</span> <span class=main>∧</span> eigenval <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span> <span class=free>H</span><span class=main>)</span> <span class=main>∨</span> mat_diagonal <span class=free>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹hermitean <span class=free>H</span>›</span></span> hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span> HH
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>mat_trace <span class=free>H</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=numeral>4</span> <span class=main>*</span> mat_det <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> hermitean_elems HH <span class=quoted><span class=quoted>‹hermitean <span class=free>H</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=var>?thesis</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span> <span class=main>+</span> <span class=skolem>D</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=numeral>4</span><span class=main>*</span><span class=main>(</span><span class=skolem>A</span><span class=main>*</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>B</span><span class=main>*</span><span class=skolem>C</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> HH
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>-</span> <span class=numeral>4</span><span class=main>*</span><span class=skolem>B</span><span class=main>*</span>cnj <span class=skolem>B</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span><span class=numeral>4</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>B</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Re <span class=skolem>A</span> <span class=main>-</span> Re <span class=skolem>D</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=main>(</span>cmod <span class=skolem>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>-</span><span class=numeral>4</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> Re_divide_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cor <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> abs_neg_numeral abs_power2 neg_numeral_neq_numeral power_divide<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> disjI1<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> eigen_equation<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>using</span></span> complex_quadratic_equation_monic_distinct_roots<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span>mat_trace <span class=free>H</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=free>H</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=main>(</span>mat_trace <span class=free>H</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=numeral>4</span> <span class=main>*</span> mat_det <span class=free>H</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Eigenvectors corresponding to different eigenvalues of Hermitean matrices are
orthogonal›</span></span>
<span class=keyword1 id=Hermitean_Matrices-hermitean_ortho_eigenvecs><span class=command>lemma</span></span> hermitean_ortho_eigenvecs<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"eigenpair <span class=free>k1</span> <span class=free>v1</span> <span class=free>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"eigenpair <span class=free>k2</span> <span class=free>v2</span> <span class=free>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k1</span> <span class=main>≠</span> <span class=free>k2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"vec_cnj <span class=free>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"vec_cnj <span class=free>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>v1</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span> <span class=main>=</span> <span class=free>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span>"</span></span>
       <span class=quoted><span class=quoted>"<span class=free>v2</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span> <span class=main>=</span> <span class=free>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> eigenpair_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> real_k<span class=main>:</span> <span class=quoted><span class=quoted>"is_real <span class=free>k1</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>k2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> hermitean_eigenval_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span> <span class=quoted><span class=free>k1</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> hermitean_eigenval_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span> <span class=quoted><span class=free>k2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> eigenpair_def eigenval_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"vec_cnj <span class=main>(</span><span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span><span class=main>)</span> <span class=main>=</span> vec_cnj <span class=main>(</span><span class=free>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span> <span class=main>=</span> <span class=free>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"vec_cnj <span class=free>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H</span>  <span class=main>=</span> <span class=free>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> vec_cnj <span class=free>v2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹hermitean <span class=free>H</span>›</span></span> real_k eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>k1</span></span><span class=main>]</span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>k2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> hermitean_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v2</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def vec_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>k2</span> <span class=main>*</span> <span class=main>(</span>vec_cnj <span class=free>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span><span class=main>)</span> <span class=main>=</span> <span class=free>k1</span> <span class=main>*</span> <span class=main>(</span>vec_cnj <span class=free>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span> <span class=main>=</span> <span class=free>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹vec_cnj <span class=free>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H</span>  <span class=main>=</span> <span class=free>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> vec_cnj <span class=free>v2</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>v2</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span>
       <span class=main>(</span><span class=operator>metis</span> mult_vv_mv mult_vv_scale_sv1 mult_vv_scale_sv2<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"vec_cnj <span class=free>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>k1</span> <span class=main>≠</span> <span class=free>k2</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cnj <span class=main>(</span>vec_cnj <span class=free>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"vec_cnj <span class=free>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>v2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cnj_mult_vv mult_vv_commute<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Hermitean matrices are diagonizable by unitary matrices. Diagonal entries are
real and the sign of the determinant is preserved.›</span></span>
<span class=keyword1 id=Hermitean_Matrices-hermitean_diagonizable><span class=command>lemma</span></span> hermitean_diagonizable<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k1</span> <span class=bound>k2</span> <span class=bound>M</span><span class=main>.</span> mat_det <span class=bound>M</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> unitary <span class=bound>M</span> <span class=main>∧</span> congruence <span class=bound>M</span> <span class=free>H</span> <span class=main>=</span> <span class=main>(</span><span class=bound>k1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=bound>k2</span><span class=main>)</span> <span class=main>∧</span>
                    is_real <span class=bound>k1</span> <span class=main>∧</span> is_real <span class=bound>k2</span> <span class=main>∧</span> sgn <span class=main>(</span>Re <span class=bound>k1</span> <span class=main>*</span> Re <span class=bound>k2</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=free>H</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span><span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∧</span> eigenval <span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>H</span> <span class=main>∧</span> eigenval <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span> <span class=free>H</span><span class=main>)</span> <span class=main>∨</span> mat_diagonal <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hermitean_distinct_eigenvals<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span><span class=main>.</span> <span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=main>≠</span> <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span> <span class=main>∧</span> eigenval <span class=bound>k<span class=hidden>⇩</span><sub>1</sub></span> <span class=free>H</span> <span class=main>∧</span> eigenval <span class=bound>k<span class=hidden>⇩</span><sub>2</sub></span> <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span>  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k1</span></span> <span class=skolem><span class=skolem>k2</span></span> <span class=keyword2><span class=keyword>where</span></span>  <span class=quoted><span class=quoted>"<span class=skolem>k1</span> <span class=main>≠</span> <span class=skolem>k2</span>"</span></span> <span class=quoted><span class=quoted>"eigenval <span class=skolem>k1</span> <span class=free>H</span>"</span></span> <span class=quoted><span class=quoted>"eigenval <span class=skolem>k2</span> <span class=free>H</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hermitean_distinct_eigenvals
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v1</span></span> <span class=skolem><span class=skolem>v2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"eigenpair <span class=skolem>k1</span> <span class=skolem>v1</span> <span class=free>H</span>"</span></span> <span class=quoted><span class=quoted>"eigenpair <span class=skolem>k2</span> <span class=skolem>v2</span> <span class=free>H</span>"</span></span>
      <span class=quoted><span class=quoted>"<span class=skolem>v1</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v2</span> <span class=main>≠</span> vec_zero"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> eigenval_def eigenpair_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"vec_cnj <span class=skolem>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v1</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"vec_cnj <span class=skolem>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k1</span> <span class=main>≠</span> <span class=skolem>k2</span>›</span></span> hermitean_ortho_eigenvecs <span class=quoted><span class=quoted>‹hermitean <span class=free>H</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v11</span></span> <span class=skolem><span class=skolem>v12</span></span> <span class=skolem><span class=skolem>v21</span></span> <span class=skolem><span class=skolem>v22</span></span> <span class=keyword2><span class=keyword>where</span></span> vv<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v1</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v11</span><span class=main>,</span> <span class=skolem>v12</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v2</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v21</span><span class=main>,</span> <span class=skolem>v22</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span>  <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>v1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>v2</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?nv1'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"vec_cnj <span class=skolem>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?nv2'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"vec_cnj <span class=skolem>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v2</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?nv1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=var>?nv1'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?nv2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=var>?nv2'</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?nv1'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=var>?nv2'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>v1</span> <span class=main>≠</span> vec_zero›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>v2</span> <span class=main>≠</span> vec_zero›</span></span> vv
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> scalsquare_vv_zero<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=var>?nv1'</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=var>?nv2'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> vv
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?nv1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=var>?nv2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> complex_eq_if_Re_eq
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=var>?nv1'</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=var>?nv2'</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> vv
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>nv1</span></span> <span class=skolem><span class=skolem>nv2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>nv1</span> <span class=main>=</span> <span class=var>?nv1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>nv1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=skolem>nv2</span> <span class=main>=</span> <span class=var>?nv2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>nv2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=var>?nv1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>  <span class=quoted><span class=quoted>‹<span class=var>?nv2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=skolem>nv1</span> <span class=main>*</span> <span class=skolem>v11</span><span class=main>,</span> <span class=main>1</span><span class=main>/</span><span class=skolem>nv2</span> <span class=main>*</span> <span class=skolem>v21</span><span class=main>,</span> <span class=main>1</span><span class=main>/</span><span class=skolem>nv1</span> <span class=main>*</span> <span class=skolem>v12</span><span class=main>,</span> <span class=main>1</span><span class=main>/</span><span class=skolem>nv2</span> <span class=main>*</span> <span class=skolem>v22</span><span class=main>)</span>"</span></span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>k1</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>k2</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span>  <span class=quoted><span class=quoted>‹eigenval <span class=skolem>k1</span> <span class=free>H</span>›</span></span> <span class=quoted><span class=quoted>‹eigenval <span class=skolem>k2</span> <span class=free>H</span>›</span></span> <span class=quoted><span class=quoted>‹hermitean <span class=free>H</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_eigenval_real<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_det <span class=var>?M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=var>?thesis</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v11</span> <span class=main>*</span> <span class=skolem>v22</span> <span class=main>=</span> <span class=skolem>v12</span> <span class=main>*</span> <span class=skolem>v21</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>nv1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>nv2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>v2</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v1</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> vv <span class=quoted><span class=quoted>‹<span class=skolem>v1</span> <span class=main>≠</span> vec_zero›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>v2</span> <span class=main>≠</span> vec_zero›</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>v21</span><span class=main>/</span><span class=skolem>v11</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>v21</span><span class=main>/</span><span class=skolem>v11</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>v22</span><span class=main>/</span><span class=skolem>v12</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>v22</span><span class=main>/</span><span class=skolem>v12</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
        <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹vec_cnj <span class=skolem>v1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v2</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹vec_cnj <span class=skolem>v2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> vv <span class=quoted><span class=quoted>‹<span class=var>?nv1'</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mult_vv_scale_sv2 mult_zero_right<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"unitary <span class=var>?M</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
      <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"cnj <span class=skolem>nv1</span> <span class=main>*</span> <span class=skolem>nv1</span> <span class=main>=</span> <span class=var>?nv1'</span>"</span></span>  <span class=quoted><span class=quoted>"cnj <span class=skolem>nv2</span> <span class=main>*</span> <span class=skolem>nv2</span> <span class=main>=</span> <span class=var>?nv2'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>nv1</span> <span class=main>=</span> <span class=var>?nv1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>nv1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>  <span class=quoted><span class=quoted>‹<span class=skolem>nv2</span> <span class=main>=</span> <span class=var>?nv2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>nv2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=var>?nv1'</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=var>?nv2'</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=var>?nv1'</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>  <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=var>?nv2'</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>have</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"cnj <span class=skolem>nv1</span> <span class=main>*</span> <span class=skolem>nv2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"cnj <span class=skolem>nv2</span> <span class=main>*</span> <span class=skolem>nv1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> vv <span class=quoted><span class=quoted>‹<span class=skolem>nv1</span> <span class=main>=</span> <span class=var>?nv1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>nv1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>  <span class=quoted><span class=quoted>‹<span class=skolem>nv2</span> <span class=main>=</span> <span class=var>?nv2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>nv2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=var>?nv1'</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=var>?nv2'</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>           

      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>unfolding</span></span> unitary_def
        <span class=keyword1><span class=command>using</span></span> vv ** <span class=quoted><span class=quoted>‹<span class=var>?nv1'</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=var>?nv2'</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> * ***
        <span class=keyword1><span class=command>unfolding</span></span> mat_adj_def mat_cnj_def vec_cnj_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> add_divide_distrib divide_eq_0_iff divide_eq_1_iff<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"congruence <span class=var>?M</span> <span class=free>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>k2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_inv <span class=var>?M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>k2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
        <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?M</span> <span class=main>=</span> <span class=var>?M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>k1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>k2</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹eigenpair <span class=skolem>k1</span> <span class=skolem>v1</span> <span class=free>H</span>›</span></span> <span class=quoted><span class=quoted>‹eigenpair <span class=skolem>k2</span> <span class=skolem>v2</span> <span class=free>H</span>›</span></span> vv <span class=quoted><span class=quoted>‹<span class=var>?nv1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=var>?nv2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>unfolding</span></span> eigenpair_def vec_cnj_def
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>smt</span> mult_mm.simps vec_map.simps add.right_neutral add_cancel_left_left distrib_left fst_mult_sv mult.commute mult.left_commute mult_mv.simps mult_zero_right prod.sel<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> prod.sel<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> snd_mult_sv<span class=main>)</span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> mult_mm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>k2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?M</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> <span class=quoted><span class=quoted>‹mat_det <span class=var>?M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> *<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_mm_assoc<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_inv <span class=var>?M</span> <span class=main>=</span> mat_adj <span class=var>?M</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=var>?M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹unitary <span class=var>?M</span>›</span></span> mult_mm_inv_r<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=quoted><span class=quoted>"mat_adj <span class=var>?M</span>"</span></span> <span class=quoted>eye</span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary_def<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>Re <span class=skolem>k1</span> <span class=main>*</span> Re <span class=skolem>k2</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=free>H</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹congruence <span class=var>?M</span> <span class=free>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>k2</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>k1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>k2</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> Re_det_sgn_congruence<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=quoted><span class=free>H</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹mat_det <span class=var>?M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹hermitean <span class=free>H</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?M</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_diagonal <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹hermitean <span class=free>H</span>›</span></span> hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span></span></span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>A</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>D</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"eye"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary_def mat_adj_def mat_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Elementary_Complex_Geometry>
<div class=head>
<h1>Theory Elementary_Complex_Geometry</h1>
</div>
<pre class=source><span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Elementary complex geometry›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In this section equations and basic properties of the most fundamental objects and relations in
geometry -- collinearity, lines, circles and circlines. These are defined by equations in
$\mathbb{C}$ (not extended by an infinite point). Later these equations will be generalized to
equations in the extended complex plane, over homogenous coordinates.›</span></span>

<span class=keyword1><span class=command>theory</span></span> Elementary_Complex_Geometry
<span class=keyword2><span class=keyword>imports</span></span> <a href=#More_Complex>More_Complex</a> <a href=#Linear_Systems>Linear_Systems</a> <a href=#Angles>Angles</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Collinear points›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>collinear</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>collinear</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=free><span class=bound><span class=entity>z3</span></span></span> <span class=main>⟷</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>∨</span> Im <span class=main>(</span><span class=main>(</span><span class=free><span class=bound><span class=entity>z3</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>z1</span></span></span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>z1</span></span></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-collinear_ex_real><span class=command>lemma</span></span> collinear_ex_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"collinear <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span> <span class=main>⟷</span>
         <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>real<span class=main>.</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>z2</span> <span class=main>∨</span> <span class=free>z3</span> <span class=main>-</span> <span class=free>z1</span> <span class=main>=</span> complex_of_real <span class=bound>k</span> <span class=main>*</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> collinear_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Im_complex_of_real add_diff_cancel_right' complex_eq diff_zero legacy_Complex_simps<span class=main><span class=main>(</span></span>15<span class=main><span class=main>)</span></span> nonzero_mult_div_cancel_right right_minus_eq times_divide_eq_left zero_complex.code<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Collinearity characterization using determinants›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-collinear_det><span class=command>lemma</span></span> collinear_det<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> collinear <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"det2 <span class=main>(</span><span class=free>z3</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span> <span class=main>(</span>cnj <span class=main>(</span><span class=free>z3</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>z1</span> <span class=main>-</span> <span class=free>z2</span><span class=main>)</span> <span class=main>(</span>cnj <span class=main>(</span><span class=free>z1</span> <span class=main>-</span> <span class=free>z2</span><span class=main>)</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=free>z3</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> cnj <span class=main>(</span><span class=main>(</span><span class=free>z3</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z1</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> collinear_def
    <span class=keyword1><span class=command>using</span></span> Complex_Im_express_cnj<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z3</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Properties of three collinear points›</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-collinear_sym1><span class=command>lemma</span></span> collinear_sym1<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"collinear <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span> <span class=main>⟷</span> collinear <span class=free>z1</span> <span class=free>z3</span> <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> collinear_def
  <span class=keyword1><span class=command>using</span></span> div_reals<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z3</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span><span class=main>]</span>  div_reals<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>z3</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id="Elementary_Complex_Geometry-collinear_sym2'"><span class=command>lemma</span></span> collinear_sym2'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"collinear <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"collinear <span class=free>z2</span> <span class=free>z1</span> <span class=free>z3</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>=</span> <span class=free>z2</span> <span class=main>∨</span> <span class=free>z3</span> <span class=main>-</span> <span class=free>z1</span> <span class=main>=</span> complex_of_real <span class=skolem>k</span> <span class=main>*</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> collinear_ex_real
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>z3</span> <span class=main>-</span> <span class=free>z1</span> <span class=main>=</span> complex_of_real <span class=skolem>k</span> <span class=main>*</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> collinear_ex_real
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>-</span><span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> collinear_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-collinear_sym2><span class=command>lemma</span></span> collinear_sym2<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"collinear <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span> <span class=main>⟷</span> collinear <span class=free>z2</span> <span class=free>z1</span> <span class=free>z3</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> collinear_sym2'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=free>z3</span></span><span class=main>]</span> collinear_sym2'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z3</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Properties of four collinear points›</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-collinear_trans1><span class=command>lemma</span></span> collinear_trans1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"collinear <span class=free>z0</span> <span class=free>z2</span> <span class=free>z1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"collinear <span class=free>z0</span> <span class=free>z3</span> <span class=free>z1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z0</span> <span class=main>≠</span> <span class=free>z1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"collinear <span class=free>z0</span> <span class=free>z2</span> <span class=free>z3</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> collinear_ex_real
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z0</span> <span class=main>=</span> <span class=free>z2</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>k</span><span class=main>/</span><span class=improper>ka</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>ka</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>


<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Euclidean line›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Line is defined by using collinearity›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>line</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex set"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>line</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> collinear <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=bound>z</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-line_points_collinear><span class=command>lemma</span></span> line_points_collinear<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>∈</span> line <span class=free>z</span> <span class=free>z'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>∈</span> line <span class=free>z</span> <span class=free>z'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z3</span> <span class=main>∈</span> line <span class=free>z</span> <span class=free>z'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=free>z'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"collinear <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> line_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> collinear_sym1 collinear_sym2' collinear_trans1 mem_Collect_eq<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Parametric equation of a line›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-line_param><span class=command>lemma</span></span> line_param<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>+</span> cor <span class=free>k</span> <span class=main>*</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span> <span class=main>∈</span> line <span class=free>z1</span> <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> line_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> collinear_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Equation of the line containing two different given points›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-line_equation><span class=command>lemma</span></span> line_equation<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>μ</span> <span class=main>=</span> rot90 <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"line <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cnj <span class=free>μ</span><span class=main>*</span><span class=bound>z</span> <span class=main>+</span> <span class=free>μ</span><span class=main>*</span>cnj <span class=bound>z</span> <span class=main>-</span> <span class=main>(</span>cnj <span class=free>μ</span> <span class=main>*</span> <span class=free>z1</span> <span class=main>+</span> <span class=free>μ</span> <span class=main>*</span> cnj <span class=free>z1</span><span class=main>)</span>  <span class=main>=</span> <span class=main>0</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> line <span class=free>z1</span> <span class=free>z2</span> <span class=main>⟷</span> Im <span class=main>(</span><span class=main>(</span><span class=skolem>z</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> line_def collinear_def<span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>⟷</span> <span class=main>(</span><span class=skolem>z</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> cnj <span class=main>(</span><span class=main>(</span><span class=skolem>z</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> complex_diff_cnj<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>z</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>⟷</span> <span class=main>(</span><span class=skolem>z</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>*</span><span class=main>(</span>cnj <span class=free>z2</span> <span class=main>-</span> cnj <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cnj <span class=skolem>z</span> <span class=main>-</span> cnj <span class=free>z1</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>z</span> <span class=main>∈</span> line <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> is_real <span class=main>(</span><span class=main>(</span><span class=skolem>z</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span>›</span></span> calculation is_real_div
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>⟷</span> cnj<span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>*</span><span class=skolem>z</span> <span class=main>-</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>*</span>cnj <span class=skolem>z</span> <span class=main>-</span> <span class=main>(</span>cnj<span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>*</span><span class=free>z1</span> <span class=main>-</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>*</span>cnj <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>⟷</span> cnj <span class=free>μ</span> <span class=main>*</span> <span class=skolem>z</span> <span class=main>+</span> <span class=free>μ</span> <span class=main>*</span> cnj <span class=skolem>z</span>  <span class=main>-</span> <span class=main>(</span>cnj <span class=free>μ</span> <span class=main>*</span> <span class=free>z1</span> <span class=main>+</span> <span class=free>μ</span> <span class=main>*</span> cnj <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> assms<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> cnj_mix_minus<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> line <span class=free>z1</span> <span class=free>z2</span> <span class=main>⟷</span> cnj <span class=free>μ</span> <span class=main>*</span> <span class=skolem>z</span> <span class=main>+</span> <span class=free>μ</span> <span class=main>*</span> cnj <span class=skolem>z</span>  <span class=main>-</span> <span class=main>(</span>cnj <span class=free>μ</span> <span class=main>*</span> <span class=free>z1</span> <span class=main>+</span> <span class=free>μ</span> <span class=main>*</span> cnj <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>.</span></span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Euclidean circle›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Definition of the circle with given center and radius. It consists of all
points on the distance $r$ from the center $\mu$.›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>circle</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> real <span class=main>⇒</span> complex set"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>circle</span> <span class=free><span class=bound><span class=entity>μ</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cmod <span class=main>(</span><span class=bound>z</span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>μ</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Equation of the circle centered at $\mu$ with the radius $r$.›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-circle_equation><span class=command>lemma</span></span> circle_equation<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circle <span class=free>μ</span> <span class=free>r</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> <span class=bound>z</span><span class=main>*</span>cnj <span class=bound>z</span> <span class=main>-</span> <span class=bound>z</span><span class=main>*</span>cnj <span class=free>μ</span> <span class=main>-</span> cnj <span class=bound>z</span><span class=main>*</span><span class=free>μ</span> <span class=main>+</span> <span class=free>μ</span><span class=main>*</span>cnj <span class=free>μ</span> <span class=main>-</span> cor <span class=main>(</span><span class=free>r</span><span class=main>*</span><span class=free>r</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> circle <span class=free>μ</span> <span class=free>r</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>z</span> <span class=main>-</span> <span class=free>μ</span><span class=main>)</span><span class=main>*</span>cnj <span class=main>(</span><span class=skolem>z</span> <span class=main>-</span> <span class=free>μ</span><span class=main>)</span> <span class=main>=</span> complex_of_real <span class=main>(</span><span class=free>r</span><span class=main>*</span><span class=free>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> circle_def
    <span class=keyword1><span class=command>using</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>-</span> <span class=free>μ</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>*</span> cnj <span class=skolem>z</span> <span class=main>-</span> <span class=skolem>z</span> <span class=main>*</span> cnj <span class=free>μ</span> <span class=main>-</span> cnj <span class=skolem>z</span> <span class=main>*</span> <span class=free>μ</span> <span class=main>+</span> <span class=free>μ</span> <span class=main>*</span> cnj <span class=free>μ</span> <span class=main>-</span> cor <span class=main>(</span><span class=free>r</span> <span class=main>*</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>*</span> cnj <span class=skolem>z</span> <span class=main>-</span> <span class=skolem>z</span> <span class=main>*</span> cnj <span class=free>μ</span> <span class=main>-</span> cnj <span class=skolem>z</span> <span class=main>*</span> <span class=free>μ</span> <span class=main>+</span> <span class=free>μ</span> <span class=main>*</span> cnj <span class=free>μ</span> <span class=main>-</span> cor <span class=main>(</span><span class=free>r</span> <span class=main>*</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>z</span> <span class=main>-</span> <span class=free>μ</span><span class=main>)</span><span class=main>*</span>cnj <span class=main>(</span><span class=skolem>z</span> <span class=main>-</span> <span class=free>μ</span><span class=main>)</span> <span class=main>=</span> cor <span class=main>(</span><span class=free>r</span><span class=main>*</span><span class=free>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> circle <span class=free>μ</span> <span class=free>r</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>-</span> <span class=free>μ</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> power2_eq_imp_eq<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=skolem>z</span> <span class=main>-</span> <span class=free>μ</span><span class=main>)</span>"</span></span> <span class=quoted><span class=free>r</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> circle_def power2_eq_square<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> complex_of_real_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Circline›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹A very important property of the extended complex plane is that it is possible to treat circles
and lines in a uniform way. The basic object is \emph{generalized circle}, or \emph{circline} for
short. We introduce circline equation given in $\mathbb{C}$, and it will later be generalized to an
equation in the extended complex plane $\overline{\mathbb{C}}$ given in matrix form using a
Hermitean matrix and a quadratic form over homogenous coordinates.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>circline</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>circline</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>BC</span></span></span> <span class=free><span class=bound><span class=entity>D</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cor <span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>*</span><span class=bound>z</span><span class=main>*</span>cnj <span class=bound>z</span> <span class=main>+</span> cnj <span class=free><span class=bound><span class=entity>BC</span></span></span><span class=main>*</span><span class=bound>z</span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>BC</span></span></span><span class=main>*</span>cnj <span class=bound>z</span> <span class=main>+</span> cor <span class=free><span class=bound><span class=entity>D</span></span></span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Connection between circline and Euclidean circle›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Every circline with positive determinant and $A \neq 0$ represents an Euclidean circle›</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-circline_circle><span class=command>lemma</span></span> circline_circle<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>*</span> <span class=free>D</span> <span class=main>≤</span> <span class=main>(</span>cmod <span class=free>BC</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> circline <span class=free>A</span> <span class=free>BC</span> <span class=free>D</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  <span class=quoted><span class=quoted>"<span class=free>μ</span> <span class=main>=</span> <span class=main>-</span><span class=free>BC</span><span class=main>/</span>cor <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>r2</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span>cmod <span class=free>BC</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span> <span class=main>/</span> <span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>=</span> sqrt <span class=free>r2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> circle <span class=free>μ</span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> <span class=bound>z</span> <span class=main>*</span> cnj <span class=bound>z</span> <span class=main>+</span> cnj <span class=main>(</span><span class=free>BC</span> <span class=main>/</span> cor <span class=free>A</span><span class=main>)</span> <span class=main>*</span> <span class=bound>z</span> <span class=main>+</span> <span class=main>(</span><span class=free>BC</span> <span class=main>/</span> cor <span class=free>A</span><span class=main>)</span> <span class=main>*</span> cnj <span class=bound>z</span> <span class=main>+</span> cor <span class=main>(</span><span class=free>D</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>cl</span> <span class=main>=</span> circline <span class=free>A</span> <span class=free>BC</span> <span class=free>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> circline_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>r2</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=free>BC</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>A</span> <span class=main>*</span> <span class=free>D</span> <span class=main>≥</span>  <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>*</span> <span class=free>D</span> <span class=main>≤</span> <span class=main>(</span>cmod <span class=free>BC</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>r2</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span>cmod <span class=free>BC</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span> <span class=main>/</span> <span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> zero_le_divide_iff zero_le_power2<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>*</span> <span class=free>r</span> <span class=main>=</span> <span class=free>r2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>=</span> sqrt <span class=free>r2</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> real_sqrt_mult<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=free>μ</span> <span class=main>*</span> <span class=main>-</span> cnj <span class=free>μ</span> <span class=main>-</span> cor <span class=free>r2</span> <span class=main>=</span> cor <span class=main>(</span><span class=free>D</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>μ</span> <span class=main>=</span> <span class=main>-</span> <span class=free>BC</span> <span class=main>/</span> complex_of_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>r2</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span>cmod <span class=free>BC</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>A</span> <span class=main>*</span> <span class=free>D</span><span class=main>)</span> <span class=main>/</span> <span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square complex_mult_cnj_cmod <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
       <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add_divide_eq_iff assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>r2</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span>cmod <span class=free>BC</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span> <span class=main>/</span> <span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>μ</span> <span class=main>=</span> <span class=main>-</span> <span class=free>BC</span> <span class=main>/</span> cor <span class=free>A</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> circle_equation<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>r</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>μ</span></span></span></span></span></span><span class=main><span class=main>,</span></span> <span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>›</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> **<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-circline_ex_circle><span class=command>lemma</span></span> circline_ex_circle<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>*</span> <span class=free>D</span> <span class=main>≤</span> <span class=main>(</span>cmod <span class=free>BC</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> circline <span class=free>A</span> <span class=free>BC</span> <span class=free>D</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>μ</span> <span class=bound>r</span><span class=main>.</span> <span class=free>cl</span> <span class=main>=</span> circle <span class=bound>μ</span> <span class=bound>r</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> circline_circle<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Every Euclidean circle can be represented by a circline›</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-circle_circline><span class=command>lemma</span></span> circle_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> circle <span class=free>μ</span> <span class=free>r</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> circline <span class=main>1</span> <span class=main>(</span><span class=main>-</span><span class=free>μ</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span>cmod <span class=free>μ</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"complex_of_real <span class=main>(</span><span class=main>(</span>cmod <span class=free>μ</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=free>μ</span> <span class=main>*</span> cnj <span class=free>μ</span> <span class=main>-</span> complex_of_real <span class=main>(</span><span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> circline <span class=main>1</span> <span class=main>(</span><span class=main>-</span> <span class=free>μ</span><span class=main>)</span> <span class=main>(</span><span class=main>(</span>cmod <span class=free>μ</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> circle_equation<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>r</span></span> <span class=quoted><span class=free>μ</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> circline_def power2_eq_square
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-circle_ex_circline><span class=command>lemma</span></span> circle_ex_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> circle <span class=free>μ</span> <span class=free>r</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>A</span> <span class=bound>BC</span> <span class=bound>D</span><span class=main>.</span> <span class=bound>A</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>A</span><span class=main>*</span><span class=bound>D</span> <span class=main>≤</span> <span class=main>(</span>cmod <span class=bound>BC</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>∧</span> <span class=free>cl</span> <span class=main>=</span> circline <span class=bound>A</span> <span class=bound>BC</span> <span class=bound>D</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> circle_circline<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>μ</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>μ</span> <span class=main>*</span> cnj <span class=free>μ</span><span class=main>)</span> <span class=main>-</span> <span class=main>(</span><span class=free>r</span> <span class=main>*</span> <span class=free>r</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod power2_eq_square<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Connection between circline and Euclidean line›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Every circline with a positive determinant and $A = 0$ represents an Euclidean line›</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-circline_line><span class=command>lemma</span></span> circline_line<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>BC</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> circline <span class=free>A</span> <span class=free>BC</span> <span class=free>D</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>=</span> <span class=main>-</span> cor <span class=free>D</span> <span class=main>*</span> <span class=free>BC</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>BC</span> <span class=main>*</span> cnj <span class=free>BC</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>=</span> <span class=free>z1</span> <span class=main>+</span> <span class=keyword1>𝗂</span> <span class=main>*</span> sgn <span class=main>(</span><span class=keyword1>if</span> arg <span class=free>BC</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>-</span><span class=free>BC</span> <span class=keyword1>else</span> <span class=free>BC</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>
    <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> line <span class=free>z1</span> <span class=free>z2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cnj <span class=free>BC</span><span class=main>*</span><span class=bound>z</span> <span class=main>+</span> <span class=free>BC</span><span class=main>*</span>cnj <span class=bound>z</span> <span class=main>+</span> complex_of_real <span class=free>D</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> circline_def<span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>z</span><span class=main>.</span> cnj <span class=free>BC</span><span class=main>*</span><span class=bound>z</span> <span class=main>+</span> <span class=free>BC</span><span class=main>*</span>cnj <span class=bound>z</span> <span class=main>+</span> complex_of_real <span class=free>D</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span> <span class=main>=</span>
          <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cnj <span class=free>BC</span><span class=main>*</span><span class=bound>z</span> <span class=main>+</span> <span class=free>BC</span><span class=main>*</span>cnj <span class=bound>z</span> <span class=main>-</span> <span class=main>(</span>cnj <span class=free>BC</span><span class=main>*</span><span class=free>z1</span> <span class=main>+</span> <span class=free>BC</span><span class=main>*</span>cnj <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span>  <span class=quoted><span class=quoted>‹<span class=free>BC</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> assms
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>BC</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> assms
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_eq<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>BC</span> <span class=main>=</span> cor <span class=bound>k</span><span class=main>*</span>rot90 <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"arg <span class=free>BC</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> assms
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=free>BC</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_scale4<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> assms
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>(</span>cmod <span class=free>BC</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
           <span class=main>(</span><span class=operator>smt</span> Complex.Re_sgn Im_sgn cis_arg complex_minus complex_surj mult_minus_right rcis_cmod_arg rcis_def<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>BC</span> <span class=main>=</span> cor <span class=skolem>k</span><span class=main>*</span>rot90 <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>z</span><span class=main>.</span> cnj_mix <span class=main>(</span><span class=free>BC</span> <span class=main>/</span> cor <span class=skolem>k</span><span class=main>)</span> <span class=bound>z</span> <span class=main>-</span> cnj_mix <span class=main>(</span><span class=free>BC</span> <span class=main>/</span> cor <span class=skolem>k</span><span class=main>)</span> <span class=free>z1</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span>cor <span class=skolem>k</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>cnj_mix <span class=free>BC</span> <span class=bound>z</span> <span class=main>-</span> cnj_mix <span class=free>BC</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cor <span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>z</span><span class=main>.</span> cnj_mix <span class=free>BC</span> <span class=bound>z</span> <span class=main>-</span> cnj_mix <span class=free>BC</span> <span class=free>z1</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cnj_mix <span class=main>(</span><span class=free>BC</span> <span class=main>/</span> cor <span class=skolem>k</span><span class=main>)</span> <span class=bound>z</span> <span class=main>-</span> cnj_mix <span class=main>(</span><span class=free>BC</span> <span class=main>/</span> cor <span class=skolem>k</span><span class=main>)</span> <span class=free>z1</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cor <span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> line <span class=free>z1</span> <span class=free>z2</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> line_equation<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=quoted>"<span class=free>BC</span><span class=main>/</span>cor <span class=skolem>k</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=free>cl</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cnj <span class=free>BC</span><span class=main>*</span><span class=bound>z</span> <span class=main>+</span> <span class=free>BC</span><span class=main>*</span>cnj <span class=bound>z</span> <span class=main>+</span> complex_of_real <span class=free>D</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-circline_ex_line><span class=command>lemma</span></span> circline_ex_line<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>BC</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> circline <span class=free>A</span> <span class=free>BC</span> <span class=free>D</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>z1</span> <span class=bound>z2</span><span class=main>.</span> <span class=bound>z1</span> <span class=main>≠</span> <span class=bound>z2</span> <span class=main>∧</span> <span class=free>cl</span> <span class=main>=</span> line <span class=bound>z1</span> <span class=bound>z2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?z1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>-</span> cor <span class=free>D</span> <span class=main>*</span> <span class=free>BC</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>BC</span> <span class=main>*</span> cnj <span class=free>BC</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?z2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?z1</span> <span class=main>+</span> <span class=keyword1>𝗂</span> <span class=main>*</span> sgn <span class=main>(</span><span class=keyword1>if</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=free>BC</span> <span class=keyword1>then</span> <span class=main>-</span> <span class=free>BC</span> <span class=keyword1>else</span> <span class=free>BC</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?z1</span> <span class=main>≠</span> <span class=var>?z2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>BC</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_eq<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> circline_line<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>of</span> <span class=var><span class=quoted><span class=var>?z1</span></span></span> <span class=var><span class=quoted><span class=var>?z2</span></span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=free>BC</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?z1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?z2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Every Euclidean line can be represented by a circline›</span></span>

<span class=keyword1 id=Elementary_Complex_Geometry-line_ex_circline><span class=command>lemma</span></span> line_ex_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> line <span class=free>z1</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>BC</span> <span class=bound>D</span><span class=main>.</span> <span class=bound>BC</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>cl</span> <span class=main>=</span> circline <span class=main>0</span> <span class=bound>BC</span> <span class=bound>D</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?BC</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"rot90 <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> scalprod <span class=free>z1</span> <span class=var>?BC</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?BC</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?D</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> conjI<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?BC</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> rot90_ii<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"complex_of_real <span class=main>(</span>Re <span class=main>(</span><span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> scalprod <span class=free>z1</span> <span class=main>(</span>rot90 <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> <span class=main>(</span>cnj_mix <span class=free>z1</span> <span class=main>(</span>rot90 <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> rot90_ii<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>z2</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>cl</span> <span class=main>=</span> circline <span class=main>0</span> <span class=var>?BC</span> <span class=var>?D</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> assms<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> line_equation<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>z1</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>z2</span></span></span></span> <span class=var><span class=quoted><span class=var><span class=quoted><span class=var>?BC</span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>unfolding</span></span> circline_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>fact</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Elementary_Complex_Geometry-circline_line'"><span class=command>lemma</span></span> circline_line'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline <span class=main>0</span> <span class=main>(</span><span class=keyword1>𝗂</span> <span class=main>*</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>Re <span class=main>(</span><span class=main>-</span> cnj_mix <span class=main>(</span><span class=keyword1>𝗂</span> <span class=main>*</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> line <span class=free>z1</span> <span class=free>z2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>𝗂</span> <span class=main>*</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>-</span> cnj_mix <span class=var>?B</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"circline <span class=main>0</span> <span class=var>?B</span> <span class=var>?D</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cnj <span class=var>?B</span><span class=main>*</span><span class=bound>z</span> <span class=main>+</span> <span class=var>?B</span><span class=main>*</span>cnj <span class=bound>z</span> <span class=main>+</span> complex_of_real <span class=var>?D</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> circline_def<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span><span class=main>-</span> cnj_mix <span class=main>(</span><span class=keyword1>𝗂</span> <span class=main>*</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cnj_mix_real<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>z</span><span class=main>.</span> cnj <span class=var>?B</span><span class=main>*</span><span class=bound>z</span> <span class=main>+</span> <span class=var>?B</span><span class=main>*</span>cnj <span class=bound>z</span> <span class=main>+</span> complex_of_real <span class=var>?D</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span> <span class=main>=</span>
         <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cnj <span class=var>?B</span><span class=main>*</span><span class=bound>z</span> <span class=main>+</span> <span class=var>?B</span><span class=main>*</span>cnj <span class=bound>z</span> <span class=main>-</span> <span class=main>(</span>cnj <span class=var>?B</span><span class=main>*</span><span class=free>z1</span> <span class=main>+</span> <span class=var>?B</span><span class=main>*</span>cnj <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> complex_of_real_Re<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> diff_conv_add_uminus
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"line <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cnj_mix <span class=main>(</span><span class=keyword1>𝗂</span> <span class=main>*</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span> <span class=bound>z</span> <span class=main>-</span> cnj_mix <span class=main>(</span><span class=keyword1>𝗂</span> <span class=main>*</span> <span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span><span class=main>)</span> <span class=free>z1</span> <span class=main>=</span> <span class=main>0</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> line_equation<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>unfolding</span></span> rot90_ii
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Angle between two circles›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Given a center $\mu$ of an Euclidean circle and a point $E$ on it, we define the tangent vector
in $E$ as the radius vector $\overrightarrow{\mu E}$, rotated by $\pi/2$, clockwise or
counterclockwise, depending on the circle orientation. The Boolean <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>p</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> encodes the orientation
of the circle, and the function <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=free>sgn_bool</span></span> <span class=free><span class=free>p</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> returns $1$ when <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>p</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> is true, and
$-1$ when <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>p</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> is false.›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>sgn_bool</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>sgn_bool</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>≡</span> <span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=keyword1>then</span> <span class=main>1</span> <span class=keyword1>else</span> <span class=main>-</span><span class=main>1</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>circ_tang_vec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> bool <span class=main>⇒</span> complex"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>circ_tang_vec</span> <span class=free><span class=bound><span class=entity>μ</span></span></span> <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>=</span> sgn_bool <span class=free><span class=bound><span class=entity>p</span></span></span> <span class=main>*</span> <span class=keyword1>𝗂</span> <span class=main>*</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>E</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>μ</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Tangent vector is orthogonal to the radius.›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-circ_tang_vec_ortho><span class=command>lemma</span></span> circ_tang_vec_ortho<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"scalprod <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ</span><span class=main>)</span> <span class=main>(</span>circ_tang_vec <span class=free>μ</span> <span class=free>E</span> <span class=free>p</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> circ_tang_vec_def Let_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Changing the circle orientation gives the opposite tangent vector.›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-circ_tang_vec_opposite_orient><span class=command>lemma</span></span> circ_tang_vec_opposite_orient<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circ_tang_vec <span class=free>μ</span> <span class=free>E</span> <span class=free>p</span> <span class=main>=</span> <span class=main>-</span> circ_tang_vec <span class=free>μ</span> <span class=free>E</span> <span class=main>(</span><span class=main>¬</span> <span class=free>p</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> circ_tang_vec_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Angle between two oriented circles at their common point $E$ is defined as the angle between
tangent vectors at $E$. Again we define three different angle measures.›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The oriented angle between two circles at the point $E$. The first circle is
centered at $\mu_1$ and its orientation is given by the Boolean $p_1$, 
while the second circle is centered at $\mu_2$ and its orientation is given by 
the Boolea $p_2$.›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>ang_circ</span> <span class=keyword2><span class=keyword>where</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>ang_circ</span> <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>μ1</span></span></span> <span class=free><span class=bound><span class=entity>μ2</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span> <span class=main>=</span> <span class=main>∠</span> <span class=main>(</span>circ_tang_vec <span class=free><span class=bound><span class=entity>μ1</span></span></span> <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span><span class=main>)</span> <span class=main>(</span>circ_tang_vec <span class=free><span class=bound><span class=entity>μ2</span></span></span> <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The unoriented angle between the two circles›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>ang_circ_c</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ang_circ_c</span> <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>μ1</span></span></span> <span class=free><span class=bound><span class=entity>μ2</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span> <span class=main>=</span> <span class=keyword1>∠c</span> <span class=main>(</span>circ_tang_vec <span class=free><span class=bound><span class=entity>μ1</span></span></span> <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span><span class=main>)</span> <span class=main>(</span>circ_tang_vec <span class=free><span class=bound><span class=entity>μ2</span></span></span> <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The acute angle between the two circles›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>ang_circ_a</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ang_circ_a</span> <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>μ1</span></span></span> <span class=free><span class=bound><span class=entity>μ2</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span> <span class=main>=</span> <span class=keyword1>∠a</span> <span class=main>(</span>circ_tang_vec <span class=free><span class=bound><span class=entity>μ1</span></span></span> <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>p1</span></span></span><span class=main>)</span> <span class=main>(</span>circ_tang_vec <span class=free><span class=bound><span class=entity>μ2</span></span></span> <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>p2</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Explicit expression for oriented angle between two circles›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-ang_circ_simp><span class=command>lemma</span></span> ang_circ_simp<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ang_circ <span class=free>E</span> <span class=free>μ1</span> <span class=free>μ2</span> <span class=free>p1</span> <span class=free>p2</span> <span class=main>=</span>
         <span class=main>⇂</span>arg <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ2</span><span class=main>)</span> <span class=main>-</span> arg <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ1</span><span class=main>)</span> <span class=main>+</span> sgn_bool <span class=free>p1</span> <span class=main>*</span> pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>-</span> sgn_bool <span class=free>p2</span> <span class=main>*</span> pi <span class=main>/</span> <span class=numeral>2</span><span class=main>⇃</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ang_circ_def ang_vec_def circ_tang_vec_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> canon_ang_eq<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> arg_mult_2kpi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"sgn_bool <span class=free>p2</span><span class=main>*</span><span class=keyword1>𝗂</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>-</span> <span class=free>μ2</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> arg_mult_2kpi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"sgn_bool <span class=free>p1</span><span class=main>*</span><span class=keyword1>𝗂</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>-</span> <span class=free>μ1</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
     <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>x</span><span class=main>-</span><span class=improper>xa</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span><span class=main>+</span><span class=improper>x</span><span class=main>-</span><span class=improper>xa</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>+</span><span class=improper>x</span><span class=main>-</span><span class=improper>xa</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>x</span><span class=main>-</span><span class=improper>xa</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Explicit expression for the cosine of angle between two circles›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-cos_ang_circ_simp><span class=command>lemma</span></span> cos_ang_circ_simp<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span>ang_circ <span class=free>E</span> <span class=free>μ1</span> <span class=free>μ2</span> <span class=free>p1</span> <span class=free>p2</span><span class=main>)</span> <span class=main>=</span>
         sgn_bool <span class=main>(</span><span class=free>p1</span> <span class=main>=</span> <span class=free>p2</span><span class=main>)</span> <span class=main>*</span> cos <span class=main>(</span>arg <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ2</span><span class=main>)</span> <span class=main>-</span> arg <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ1</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> cos_periodic_pi2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ2</span><span class=main>)</span> <span class=main>-</span> arg <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ1</span><span class=main>)</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> cos_minus_pi<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ2</span><span class=main>)</span> <span class=main>-</span> arg <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ1</span><span class=main>)</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> ang_circ_simp<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>p1</span></span> <span class=quoted><span class=free>p2</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Explicit expression for the unoriented angle between two circles›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-ang_circ_c_simp><span class=command>lemma</span></span> ang_circ_c_simp<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ang_circ_c <span class=free>E</span> <span class=free>μ1</span> <span class=free>μ2</span> <span class=free>p1</span> <span class=free>p2</span> <span class=main>=</span> 
        <span class=main>¦</span><span class=main>⇂</span>arg <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ2</span><span class=main>)</span> <span class=main>-</span> arg <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ1</span><span class=main>)</span> <span class=main>+</span> sgn_bool <span class=free>p1</span> <span class=main>*</span> pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>-</span> sgn_bool <span class=free>p2</span> <span class=main>*</span> pi <span class=main>/</span> <span class=numeral>2</span><span class=main>⇃</span><span class=main>¦</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ang_circ_c_def ang_vec_c_def
  <span class=keyword1><span class=command>using</span></span> ang_circ_simp<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> ang_circ_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Explicit expression for the acute angle between two circles›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-ang_circ_a_simp><span class=command>lemma</span></span> ang_circ_a_simp<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ang_circ_a <span class=free>E</span> <span class=free>μ1</span> <span class=free>μ2</span> <span class=free>p1</span> <span class=free>p2</span> <span class=main>=</span> 
         acute_ang <span class=main>(</span>abs <span class=main>(</span>canon_ang <span class=main>(</span>arg<span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ2</span><span class=main>)</span> <span class=main>-</span> arg<span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ1</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span>sgn_bool <span class=free>p1</span><span class=main>)</span> <span class=main>*</span> pi<span class=main>/</span><span class=numeral>2</span> <span class=main>-</span> <span class=main>(</span>sgn_bool <span class=free>p2</span><span class=main>)</span> <span class=main>*</span> pi<span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ang_circ_a_def ang_vec_a_def
  <span class=keyword1><span class=command>using</span></span> ang_circ_c_simp<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> ang_circ_c_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Acute angle between two circles does not depend on the circle orientation.›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-ang_circ_a_pTrue><span class=command>lemma</span></span> ang_circ_a_pTrue<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ang_circ_a <span class=free>E</span> <span class=free>μ1</span> <span class=free>μ2</span> <span class=free>p1</span> <span class=free>p2</span> <span class=main>=</span> ang_circ_a <span class=free>E</span> <span class=free>μ1</span> <span class=free>μ2</span> True True"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>p1</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>p2</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>p1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>p2</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>p1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=free>p2</span>›</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ang_circ_a_def
      <span class=keyword1><span class=command>using</span></span> circ_tang_vec_opposite_orient<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>μ2</span></span> <span class=quoted><span class=free>E</span></span> <span class=quoted><span class=free>p2</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> ang_vec_a_opposite2
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>p2</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=free>p1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>p2</span>›</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ang_circ_a_def
      <span class=keyword1><span class=command>using</span></span> circ_tang_vec_opposite_orient<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>μ1</span></span> <span class=quoted><span class=free>E</span></span> <span class=quoted><span class=free>p1</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> ang_vec_a_opposite1
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=free>p1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=free>p2</span>›</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> ang_circ_a_def
      <span class=keyword1><span class=command>using</span></span> circ_tang_vec_opposite_orient<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>μ1</span></span> <span class=quoted><span class=free>E</span></span> <span class=quoted><span class=free>p1</span></span><span class=main>]</span> circ_tang_vec_opposite_orient<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>μ2</span></span> <span class=quoted><span class=free>E</span></span> <span class=quoted><span class=free>p2</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> ang_vec_a_opposite1  ang_vec_a_opposite2
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Definition of the acute angle between the two unoriented circles ›</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>ang_circ_a'</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ang_circ_a'</span> <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>μ1</span></span></span> <span class=free><span class=bound><span class=entity>μ2</span></span></span> <span class=main>≡</span> ang_circ_a <span class=free><span class=bound><span class=entity>E</span></span></span> <span class=free><span class=bound><span class=entity>μ1</span></span></span> <span class=free><span class=bound><span class=entity>μ2</span></span></span> True True"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹A very simple expression for the acute angle between the two circles›</span></span>
<span class=keyword1 id=Elementary_Complex_Geometry-ang_circ_a_simp1><span class=command>lemma</span></span> ang_circ_a_simp1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ang_circ_a <span class=free>E</span> <span class=free>μ1</span> <span class=free>μ2</span> <span class=free>p1</span> <span class=free>p2</span> <span class=main>=</span> <span class=keyword1>∠a</span> <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ1</span><span class=main>)</span> <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ang_vec_a_def ang_vec_c_def ang_vec_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> ang_circ_a_pTrue<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>p1</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>p2</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> ang_circ_a_simp<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>,</span></span> <span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>True</span></span></span> <span class=quoted><span class=quoted><span class=quoted>True</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> add_diff_cancel<span class=main>)</span>

<span class=keyword1 id="Elementary_Complex_Geometry-ang_circ_a'_simp"><span class=command>lemma</span></span> ang_circ_a'_simp<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>μ2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ang_circ_a' <span class=free>E</span> <span class=free>μ1</span> <span class=free>μ2</span> <span class=main>=</span> <span class=keyword1>∠a</span> <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ1</span><span class=main>)</span> <span class=main>(</span><span class=free>E</span> <span class=main>-</span> <span class=free>μ2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ang_circ_a_simp1<span class=main><span class=main>[</span></span><span class=operator>OF</span> assms<span class=main><span class=main>]</span></span><span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Homogeneous_Coordinates>
<div class=head>
<h1>Theory Homogeneous_Coordinates</h1>
</div>
<pre class=source><span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Homogeneous coordinates in extended complex plane›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Extended complex plane $\mathbb{\overline{C}}$ is complex plane with an additional element 
(treated as the infinite point). The extended complex plane $\mathbb{\overline{C}}$ is identified 
with a complex projective line (the one-dimensional projective space over the complex field, sometimes denoted by $\mathbb{C}P^1$).
Each point of $\mathbb{\overline{C}}$ is represented by a pair of complex homogeneous coordinates (not
both equal to zero), and two pairs of homogeneous coordinates represent the same
point in $\mathbb{\overline{C}}$ iff they are proportional by a non-zero complex factor.›</span></span>

<span class=keyword1><span class=command>theory</span></span> Homogeneous_Coordinates
<span class=keyword2><span class=keyword>imports</span></span> <a href=#More_Complex>More_Complex</a> <a href=#Matrices>Matrices</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Definition of homogeneous coordinates›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Two complex vectors are equivalent iff they are proportional.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>complex_cvec_eq</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_vec <span class=main>⇒</span> bool"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infix</span></span> <span class=quoted>"<span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span>"</span> 50<span class=main>)</span>  <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=keyword1><span class=free>≈<span class=hidden>⇩</span><sub>v</sub></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>complex<span class=main>)</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free><span class=bound><span class=entity>z1</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_cvec_eq_mix><span class=command>lemma</span></span> complex_cvec_eq_mix<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=main>≠</span> vec_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>w1</span><span class=main>,</span> <span class=free>w2</span><span class=main>)</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>w1</span><span class=main>,</span> <span class=free>w2</span><span class=main>)</span> <span class=main>⟷</span> <span class=free>z1</span><span class=main>*</span><span class=free>w2</span> <span class=main>=</span> <span class=free>z2</span><span class=main>*</span><span class=free>w1</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>w1</span><span class=main>,</span> <span class=free>w2</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>*</span> <span class=free>w2</span> <span class=main>=</span> <span class=free>z2</span> <span class=main>*</span> <span class=free>w1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>*</span> <span class=free>w2</span> <span class=main>=</span> <span class=free>z2</span> <span class=main>*</span> <span class=free>w1</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>w1</span><span class=main>,</span> <span class=free>w2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> * assms
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>w1</span> <span class=main>=</span> <span class=main>(</span><span class=free>w2</span><span class=main>/</span><span class=free>z2</span><span class=main>)</span><span class=main>*</span><span class=free>z1</span> <span class=main>∧</span> <span class=free>w2</span> <span class=main>=</span> <span class=main>(</span><span class=free>w2</span><span class=main>/</span><span class=free>z2</span><span class=main>)</span><span class=main>*</span><span class=free>z2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>w2</span><span class=main>/</span><span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * assms
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>w1</span><span class=main>,</span> <span class=free>w2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex_cvec_eq_def mult_sv.simps<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_eq_cvec_reflp><span class=command>lemma</span></span> complex_eq_cvec_reflp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"reflp <span class=keyword1>(≈<span class=hidden>⇩</span><sub>v</sub>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> reflp_def complex_cvec_eq_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>safe</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_eq_cvec_symp><span class=command>lemma</span></span> complex_eq_cvec_symp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"symp <span class=keyword1>(≈<span class=hidden>⇩</span><sub>v</sub>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> symp_def complex_cvec_eq_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>safe</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=improper>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_eq_cvec_transp><span class=command>lemma</span></span> complex_eq_cvec_transp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"transp <span class=keyword1>(≈<span class=hidden>⇩</span><sub>v</sub>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> transp_def complex_cvec_eq_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>safe</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>k</span><span class=main>*</span><span class=improper>ka</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_eq_cvec_equivp><span class=command>lemma</span></span> complex_eq_cvec_equivp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"equivp <span class=keyword1>(≈<span class=hidden>⇩</span><sub>v</sub>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> equivpI<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Non-zero pairs of complex numbers (also treated as non-zero complex vectors)›</span></span>

<span class=keyword1><span class=command>typedef</span></span> complex_homo_coords <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>v</span><span class=main>::</span>complex_vec<span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>setup_lifting</span></span> type_definition_complex_homo_coords

<span class=keyword1><span class=command>lift_definition</span></span> complex_homo_coords_eq <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> bool"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infix</span></span> <span class=quoted>"<span class=keyword1>≈</span>"</span> 50<span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>complex_cvec_eq</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_homo_coords_eq_reflp><span class=command>lemma</span></span> complex_homo_coords_eq_reflp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"reflp <span class=main>(≈)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> complex_eq_cvec_reflp
  <span class=keyword1><span class=command>unfolding</span></span> reflp_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>blast</span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_homo_coords_eq_symp><span class=command>lemma</span></span> complex_homo_coords_eq_symp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"symp <span class=main>(≈)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> complex_eq_cvec_symp
  <span class=keyword1><span class=command>unfolding</span></span> symp_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>blast</span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_homo_coords_eq_transp><span class=command>lemma</span></span> complex_homo_coords_eq_transp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"transp <span class=main>(≈)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> complex_eq_cvec_transp
  <span class=keyword1><span class=command>unfolding</span></span> transp_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>blast</span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_homo_coords_eq_equivp><span class=command>lemma</span></span> complex_homo_coords_eq_equivp<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"equivp <span class=main>(≈)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>intro</span><span class=main><span class=main>:</span></span> equivpI<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_homo_coords_eq_refl><span class=command>lemma</span></span> complex_homo_coords_eq_refl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≈</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> complex_homo_coords_eq_reflp
  <span class=keyword1><span class=command>unfolding</span></span> reflp_def refl_on_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_homo_coords_eq_sym><span class=command>lemma</span></span> complex_homo_coords_eq_sym<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≈</span> <span class=free>z2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≈</span> <span class=free>z1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms complex_homo_coords_eq_symp
  <span class=keyword1><span class=command>unfolding</span></span> symp_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Homogeneous_Coordinates-complex_homo_coords_eq_trans><span class=command>lemma</span></span> complex_homo_coords_eq_trans<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≈</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≈</span> <span class=free>z3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≈</span> <span class=free>z3</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms complex_homo_coords_eq_transp
  <span class=keyword1><span class=command>unfolding</span></span> transp_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Quotient type of homogeneous coordinates›</span></span>
<span class=keyword1><span class=command>quotient_type</span></span>
  complex_homo <span class=main>=</span> <span class=quoted>complex_homo_coords</span> <span class=main>/</span> <span class=quoted><span class=quoted>"complex_homo_coords_eq"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> complex_homo_coords_eq_equivp<span class=main>)</span>


<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Some characteristic points in $\mathbb{C}P^1$›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Infinite point›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>inf_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>inf_cvec</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> inf_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords"</span></span>  <span class=main>(</span><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub><span class=hidden>⇩</span><sub>c</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>inf_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lift_definition</span></span> inf <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo"</span></span>  <span class=main>(</span><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span><span class=main>)</span>  <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>inf_hcoords</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Homogeneous_Coordinates-inf_cvec_z2_zero_iff><span class=command>lemma</span></span> inf_cvec_z2_zero_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>⟷</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Zero›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>zero_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>zero_cvec</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> zero_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub><span class=hidden>⇩</span><sub>c</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>zero_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lift_definition</span></span> zero <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>zero_hcoords</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Homogeneous_Coordinates-zero_cvec_z1_zero_iff><span class=command>lemma</span></span> zero_cvec_z1_zero_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>⟷</span> <span class=free>z1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹One›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>one_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>v</sub></span>"</span><span class=main>)</span><span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>one_cvec</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> one_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub><span class=hidden>⇩</span><sub>c</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>one_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lift_definition</span></span> one <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>one_hcoords</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Homogeneous_Coordinates-zero_one_infty_not_equal><span class=command>lemma</span></span> zero_one_infty_not_equal <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>≠</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>≠</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Imaginary unit›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>ii_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>ii<span class=hidden>⇩</span><sub>v</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>ii_cvec</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>𝗂</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> ii_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub><span class=hidden>⇩</span><sub>c</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>ii_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lift_definition</span></span> ii <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>ii_hcoords</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Homogeneous_Coordinates-ex_3_different_points><span class=command>lemma</span></span> ex_3_different_points<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>z</span><span class=main>::</span><span class=quoted>complex_homo</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>z1</span> <span class=bound>z2</span><span class=main>.</span> <span class=free>z</span> <span class=main>≠</span> <span class=bound>z1</span> <span class=main>∧</span> <span class=bound>z1</span> <span class=main>≠</span> <span class=bound>z2</span> <span class=main>∧</span> <span class=free>z</span> <span class=main>≠</span> <span class=bound>z2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> <span class=free>z</span> <span class=main>≠</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∨</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Connection to ordinary complex plane $\mathbb{C}$›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Conversion from complex›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>of_complex_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex_vec"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>of_complex_cvec</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> of_complex_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex_homo_coords"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>of_complex_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lift_definition</span></span> of_complex <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex_homo"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>of_complex_hcoords</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_inj><span class=command>lemma</span></span> of_complex_inj<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>x</span> <span class=main>=</span> of_complex <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_image_inj><span class=command>lemma</span></span> of_complex_image_inj<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"of_complex <span class=main>`</span> <span class=free>A</span> <span class=main>=</span> of_complex <span class=main>`</span> <span class=free>B</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> of_complex_inj
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_not_inf><span class=command>lemma</span></span> of_complex_not_inf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>x</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-inf_not_of_complex><span class=command>lemma</span></span> inf_not_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>≠</span> of_complex <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-inf_or_of_complex><span class=command>lemma</span></span> inf_or_of_complex<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>x</span><span class=main>.</span> <span class=free>z</span> <span class=main>=</span> of_complex <span class=bound>x</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>∨</span> <span class=main>(</span><span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> of_complex_cvec <span class=bound>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_zero><span class=command>lemma</span></span> of_complex_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=main>0</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_one><span class=command>lemma</span></span> of_complex_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=main>1</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_ii><span class=command>lemma</span></span> of_complex_ii <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=keyword1>𝗂</span> <span class=main>=</span> <span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_zero_iff><span class=command>lemma</span></span> of_complex_zero_iff <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>x</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> of_complex_zero<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_complex_inj<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_one_iff><span class=command>lemma</span></span> of_complex_one_iff <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>x</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> of_complex_one<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_complex_inj<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_ii_iff><span class=command>lemma</span></span> of_complex_ii_iff <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>x</span> <span class=main>=</span> <span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>=</span> <span class=keyword1>𝗂</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> of_complex_ii<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_complex_inj<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Conversion to complex›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>to_complex_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>to_complex_cvec</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>z1</span><span class=main>,</span> <span class=bound>z2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=keyword1>in</span> <span class=bound>z1</span><span class=main>/</span><span class=bound>z2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> to_complex_homo_coords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> complex"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>to_complex_cvec</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>lift_definition</span></span> to_complex <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>to_complex_homo_coords</span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>w</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≈</span> <span class=skolem>w</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"to_complex_homo_coords <span class=skolem>z</span> <span class=main>=</span> to_complex_homo_coords <span class=skolem>w</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-to_complex_of_complex><span class=command>lemma</span></span> to_complex_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"to_complex <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_to_complex><span class=command>lemma</span></span> of_complex_to_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>of_complex <span class=main>(</span>to_complex <span class=free>z</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>z1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>of_complex_cvec <span class=main>(</span>to_complex_cvec <span class=skolem>z</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-to_complex_zero_zero><span class=command>lemma</span></span> to_complex_zero_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"to_complex <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> of_complex_zero to_complex_of_complex<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-to_complex_one_one><span class=command>lemma</span></span> to_complex_one_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"to_complex <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> of_complex_one to_complex_of_complex<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-to_complex_img_one><span class=command>lemma</span></span> to_complex_img_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"to_complex <span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>𝗂</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> of_complex_ii to_complex_of_complex<span class=main>)</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Arithmetic operations›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Due to the requirement of HOL that all functions are total, we could not define the function
only for the well-defined cases, and in the lifting proofs we must also handle the ill-defined
cases. For example, $\infty_h +_h \infty_h$ is ill-defined, but we must define it, so we define it
arbitrarily to be $\infty_h$.›</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Addition›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹$\infty_h\ +_h\ \infty_h$ is ill-defined. Since functions must be total, for formal reasons we
define it arbitrarily to be $\infty_h$.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>add_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_vec <span class=main>⇒</span> complex_vec"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span>"</span> 60<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>add_cvec</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>z1</span><span class=main>,</span> <span class=bound>z2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>;</span> <span class=main>(</span><span class=bound>w1</span><span class=main>,</span> <span class=bound>w2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>w</span></span></span>
                                <span class=keyword1>in</span> <span class=keyword1>if</span> <span class=bound>z2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=bound>w2</span> <span class=main>≠</span> <span class=main>0</span> <span class=keyword1>then</span>
                                      <span class=main>(</span><span class=bound>z1</span><span class=main>*</span><span class=bound>w2</span> <span class=main>+</span> <span class=bound>w1</span><span class=main>*</span><span class=bound>z2</span><span class=main>,</span> <span class=bound>z2</span><span class=main>*</span><span class=bound>w2</span><span class=main>)</span>
                                   <span class=keyword1>else</span>
                                      <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> add_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> complex_homo_coords"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub><span class=hidden>⇩</span><sub>c</sub></span>"</span> 60<span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>add_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> add <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex_homo <span class=main>⇒</span> complex_homo"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span>"</span> 60<span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>add_hcoords</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>w</span> <span class=skolem>z'</span> <span class=skolem>w'</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span> <span class=skolem><span class=skolem>z'1</span></span> <span class=skolem><span class=skolem>z'2</span></span> <span class=skolem><span class=skolem>w'1</span></span> <span class=skolem><span class=skolem>w'2</span></span> <span class=keyword2><span class=keyword>where</span></span>
    *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z'1</span><span class=main>,</span> <span class=skolem>z'2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w'1</span><span class=main>,</span> <span class=skolem>w'2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>z'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> **<span class=main>:</span>
         <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z'</span>"</span></span>
         <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w'</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z'</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>w2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>w'2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>w2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z'2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>w'2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>k</span><span class=main>*</span><span class=improper>ka</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'2</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>w'2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=main>(</span><span class=skolem>z2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>w2</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z'2</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>w'2</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-add_commute><span class=command>lemma</span></span> add_commute<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span> <span class=main>=</span> <span class=free>w</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command>unfolding</span></span> complex_cvec_eq_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-add_zero_right><span class=command>lemma</span></span> add_zero_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-add_zero_left><span class=command>lemma</span></span> add_zero_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> add_commute<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_add_of_complex><span class=command>lemma</span></span> of_complex_add_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>of_complex <span class=free>x</span><span class=main>)</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>y</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_add_inf><span class=command>lemma</span></span> of_complex_add_inf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>of_complex <span class=free>x</span><span class=main>)</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-inf_add_of_complex><span class=command>lemma</span></span> inf_add_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> add_commute<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-inf_add_right><span class=command>lemma</span></span> inf_add_right<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Homogeneous_Coordinates-inf_add_left><span class=command>lemma</span></span> inf_add_left<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> add_commute<span class=main>)</span> <span class=main>(</span><span class=operator>rule</span> inf_add_right<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹This is ill-defined, but holds by our definition›</span></span>
<span class=keyword1 id=Homogeneous_Coordinates-inf_add_inf><span class=command>lemma</span></span> inf_add_inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Unary minus›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>uminus_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_vec"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>~<span class=hidden>⇩</span><sub>v</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1><span class=free>~<span class=hidden>⇩</span><sub>v</sub></span></span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>z1</span><span class=main>,</span> <span class=bound>z2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=keyword1>in</span> <span class=main>(</span><span class=main>-</span><span class=bound>z1</span><span class=main>,</span> <span class=bound>z2</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> uminus_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> complex_homo_coords"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>~<span class=hidden>⇩</span><sub>h</sub><span class=hidden>⇩</span><sub>c</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>uminus_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>lift_definition</span></span> uminus <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex_homo"</span></span> <span class=main>(</span><span class=quoted>"<span class=keyword1>~<span class=hidden>⇩</span><sub>h</sub></span>"</span><span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>uminus_hcoords</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>

<span class=keyword1 id=Homogeneous_Coordinates-uminus_of_complex><span class=command>lemma</span></span> uminus_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>~<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=main>-</span><span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-uminus_zero><span class=command>lemma</span></span> uminus_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>~<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-uminus_inf><span class=command>lemma</span></span> uminus_inf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>~<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command>unfolding</span></span> complex_cvec_eq_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-uminus_inf_iff><span class=command>lemma</span></span> uminus_inf_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>~<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span><span class=main>/</span><span class=improper>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-uminus_id_iff><span class=command>lemma</span></span> uminus_id_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>~<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=main>=</span> <span class=free>z</span> <span class=main>⟷</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∨</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=improper>a</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Subtraction›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Operation $\infty_h\ -_h\ \infty_h$ is ill-defined, but we define it arbitrarily to $0_h$. It breaks the connection between
   subtraction with addition and unary minus, but seems more intuitive.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>sub</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex_homo <span class=main>⇒</span> complex_homo"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span>"</span> 60<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>z</span></span></span> <span class=keyword1><span class=free>-<span class=hidden>⇩</span><sub>h</sub></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>then</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>else</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span><span class=keyword1>~<span class=hidden>⇩</span><sub>h</sub></span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_sub_of_complex><span class=command>lemma</span></span> of_complex_sub_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>of_complex <span class=free>x</span><span class=main>)</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>y</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> sub_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-zero_sub_right><span class=command>lemma</span></span> zero_sub_right<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> sub_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-zero_sub_left><span class=command>lemma</span></span> zero_sub_left<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> of_complex <span class=free>x</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=main>-</span><span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> of_complex_zero<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> of_complex_zero<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-zero_sub_one><span class=command>lemma</span></span> zero_sub_one<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> of_complex <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> of_complex_one zero_sub_left<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_sub_one><span class=command>lemma</span></span> of_complex_sub_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>x</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> of_complex <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> of_complex_one of_complex_sub_of_complex<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-sub_eq_zero><span class=command>lemma</span></span> sub_eq_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Homogeneous_Coordinates-sub_eq_zero_iff><span class=command>lemma</span></span> sub_eq_zero_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∨</span> <span class=free>w</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> <span class=free>z</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> sub_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>w</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>∨</span> <span class=main>¬</span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
           **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=keyword1>if</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>∧</span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>then</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>else</span> <span class=skolem>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>~<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>w2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>∨</span> <span class=main>¬</span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>≠</span> vec_zero›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>w</span> <span class=main>≠</span> vec_zero›</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>z1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>w1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>w2</span><span class=main>/</span><span class=skolem>z2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> sub_eq_zero<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-inf_sub_left><span class=command>lemma</span></span> inf_sub_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> uminus_inf_iff
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex
  <span class=keyword1><span class=command>unfolding</span></span> sub_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Homogeneous_Coordinates-inf_sub_right><span class=command>lemma</span></span> inf_sub_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex
  <span class=keyword1><span class=command>unfolding</span></span> sub_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹This is ill-defined, but holds by our definition›</span></span>
<span class=keyword1 id=Homogeneous_Coordinates-inf_sub_inf><span class=command>lemma</span></span> inf_sub_inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> sub_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-sub_noteq_inf><span class=command>lemma</span></span> sub_noteq_inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> of_complex_sub_of_complex
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Homogeneous_Coordinates-sub_eq_inf><span class=command>lemma</span></span> sub_eq_inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∨</span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms sub_noteq_inf
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Multiplication›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Operations $0_h \cdot_h \infty_h$ and $\infty_h \cdot_h 0_h$ are ill defined. Since all
functions must be total, for formal reasons we define it arbitrarily to be $1_h$.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mult_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_vec <span class=main>⇒</span> complex_vec"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span>"</span> 70<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>z</span></span></span> <span class=keyword1><span class=free>*<span class=hidden>⇩</span><sub>v</sub></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>z1</span><span class=main>,</span> <span class=bound>z2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>;</span> <span class=main>(</span><span class=bound>w1</span><span class=main>,</span> <span class=bound>w2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>w</span></span></span>
                     <span class=keyword1>in</span> <span class=keyword1>if</span> <span class=main>(</span><span class=bound>z1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>w2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=bound>w1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>z2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=keyword1>then</span>
                          <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>
                        <span class=keyword1>else</span>
                          <span class=main>(</span><span class=bound>z1</span><span class=main>*</span><span class=bound>w1</span><span class=main>,</span> <span class=bound>z2</span><span class=main>*</span><span class=bound>w2</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> mult_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> complex_homo_coords"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub><span class=hidden>⇩</span><sub>c</sub></span>"</span> 70<span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mult_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> mult <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex_homo <span class=main>⇒</span> complex_homo"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span>"</span> 70<span class=main>)</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mult_hcoords</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>w</span> <span class=skolem>z'</span> <span class=skolem>w'</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span> <span class=skolem><span class=skolem>z'1</span></span> <span class=skolem><span class=skolem>z'2</span></span> <span class=skolem><span class=skolem>w'1</span></span> <span class=skolem><span class=skolem>w'2</span></span> <span class=keyword2><span class=keyword>where</span></span>
    *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z'1</span><span class=main>,</span> <span class=skolem>z'2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w'1</span><span class=main>,</span> <span class=skolem>w'2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>z'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> **<span class=main>:</span>
         <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z'</span>"</span></span>
         <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w'</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>z1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>w2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>w1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>z2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>z'1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>w'2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>w'1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>z'2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>z1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>w2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>w1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>z2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>z'1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>w'2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>w'1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>z'2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span><span class=main>(</span><span class=main>(</span><span class=skolem>z'1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>w'2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>w'1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>z'2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>*</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>*</span><span class=skolem>w2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z'1</span><span class=main>*</span><span class=skolem>w'1</span><span class=main>,</span> <span class=skolem>z'2</span><span class=main>*</span><span class=skolem>w'2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span><span class=main>(</span><span class=main>(</span><span class=skolem>z1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>w2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>w1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>z2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span><span class=main>(</span><span class=main>(</span><span class=skolem>z'1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>w'2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=skolem>w'1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>z'2</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> ***<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>k</span><span class=main>*</span><span class=improper>ka</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_mult_of_complex><span class=command>lemma</span></span> of_complex_mult_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>of_complex <span class=free>z1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=free>z1</span> <span class=main>*</span> <span class=free>z2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-mult_commute><span class=command>lemma</span></span> mult_commute<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z2</span> <span class=main>=</span> <span class=free>z2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z1</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command>unfolding</span></span> complex_cvec_eq_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-mult_zero_left><span class=command>lemma</span></span> mult_zero_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-mult_zero_right><span class=command>lemma</span></span> mult_zero_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> mult_zero_left<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_commute<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-mult_inf_right><span class=command>lemma</span></span> mult_inf_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-mult_inf_left><span class=command>lemma</span></span> mult_inf_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> mult_inf_right<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_commute<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-mult_one_left><span class=command>lemma</span></span> mult_one_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-mult_one_right><span class=command>lemma</span></span> mult_one_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> mult_one_left<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_commute<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹This is ill-defined, but holds by our definition›</span></span>
<span class=keyword1 id=Homogeneous_Coordinates-inf_mult_zero><span class=command>lemma</span></span> inf_mult_zero<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1 id=Homogeneous_Coordinates-zero_mult_inf><span class=command>lemma</span></span> zero_mult_inf<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-mult_eq_inf><span class=command>lemma</span></span> mult_eq_inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∨</span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> of_complex_mult_of_complex
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Homogeneous_Coordinates-mult_noteq_inf><span class=command>lemma</span></span> mult_noteq_inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms mult_eq_inf
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Reciprocal›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>reciprocal_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_vec"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>reciprocal_cvec</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>z1</span><span class=main>,</span> <span class=bound>z2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=keyword1>in</span> <span class=main>(</span><span class=bound>z2</span><span class=main>,</span> <span class=bound>z1</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> reciprocal_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> complex_homo_coords"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>reciprocal_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>lift_definition</span></span> reciprocal <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex_homo"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>reciprocal_hcoords</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>

<span class=keyword1 id=Homogeneous_Coordinates-reciprocal_involution><span class=command>lemma</span></span> reciprocal_involution <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"reciprocal <span class=main>(</span>reciprocal <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-reciprocal_zero><span class=command>lemma</span></span> reciprocal_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"reciprocal <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-reciprocal_inf><span class=command>lemma</span></span> reciprocal_inf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"reciprocal <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-reciprocal_one><span class=command>lemma</span></span> reciprocal_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"reciprocal <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-reciprocal_inf_iff><span class=command>lemma</span></span> reciprocal_inf_iff <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"reciprocal <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-reciprocal_zero_iff><span class=command>lemma</span></span> reciprocal_zero_iff <span class=main>[</span><span class=operator>iff</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"reciprocal <span class=free>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-reciprocal_of_complex><span class=command>lemma</span></span> reciprocal_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"reciprocal <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-reciprocal_real><span class=command>lemma</span></span> reciprocal_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=free>z</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>to_complex <span class=main>(</span>reciprocal <span class=free>z</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> Re <span class=main>(</span>to_complex <span class=free>z</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>c</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>c</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Re_divide_real<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-reciprocal_id_iff><span class=command>lemma</span></span> reciprocal_id_iff<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"reciprocal <span class=free>z</span> <span class=main>=</span> <span class=free>z</span> <span class=main>⟷</span> <span class=free>z</span> <span class=main>=</span> of_complex <span class=main>1</span> <span class=main>∨</span> <span class=free>z</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inf_not_of_complex of_complex_zero_iff reciprocal_inf_iff zero_neq_neg_one zero_neq_one<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> complex_sqrt_1 of_complex_zero_iff reciprocal_inf_iff reciprocal_of_complex to_complex_of_complex<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Division›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Operations $0_h :_h 0_h$ and $\infty_h :_h \infty_h$ are ill-defined. For formal reasons they
are defined to be $1_h$ (by the definition of multiplication).›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>divide</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex_homo <span class=main>⇒</span> complex_homo"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span>"</span> 70<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1><span class=free>:<span class=hidden>⇩</span><sub>h</sub></span></span> <span class=free><span class=bound><span class=entity>y</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>x</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>reciprocal <span class=free><span class=bound><span class=entity>y</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-divide_zero_right><span class=command>lemma</span></span> divide_zero_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-divide_zero_left><span class=command>lemma</span></span> divide_zero_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-divide_inf_right><span class=command>lemma</span></span> divide_inf_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-divide_inf_left><span class=command>lemma</span></span> divide_inf_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms reciprocal_zero_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> mult_inf_left
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-divide_eq_inf><span class=command>lemma</span></span> divide_eq_inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∨</span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> reciprocal_inf_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span><span class=main>]</span> mult_eq_inf
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Homogeneous_Coordinates-inf_divide_zero><span class=command>lemma</span></span> inf_divide_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-zero_divide_inf><span class=command>lemma</span></span> zero_divide_inf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span>  <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-divide_one_right><span class=command>lemma</span></span> divide_one_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-of_complex_divide_of_complex><span class=command>lemma</span></span> of_complex_divide_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>of_complex <span class=free>z1</span><span class=main>)</span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=free>z1</span> <span class=main>/</span> <span class=free>z2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=improper>z2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-one_div_of_complex><span class=command>lemma</span></span> one_div_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> of_complex <span class=free>x</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=free>x</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ This is ill-defined, but holds by our definition›</span></span>
<span class=keyword1 id=Homogeneous_Coordinates-inf_divide_inf><span class=command>lemma</span></span> inf_divide_inf<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_mult_zero<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹ This is ill-defined, but holds by our definition›</span></span>
<span class=keyword1 id=Homogeneous_Coordinates-zero_divide_zero><span class=command>lemma</span></span> zero_divide_zero<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zero_mult_inf<span class=main>)</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Conjugate›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>conjugate_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_vec"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>conjugate_cvec</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> vec_cnj <span class=free><span class=bound><span class=entity>z</span></span></span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> conjugate_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> complex_homo_coords"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>conjugate_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>lift_definition</span></span> conjugate <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex_homo"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>conjugate_hcoords</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-conjugate_involution><span class=command>lemma</span></span> conjugate_involution <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>(</span>conjugate <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-conjugate_conjugate_comp><span class=command>lemma</span></span> conjugate_conjugate_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>∘</span> conjugate <span class=main>=</span> id"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-inv_conjugate><span class=command>lemma</span></span> inv_conjugate <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inv conjugate <span class=main>=</span> conjugate"</span></span>
  <span class=keyword1><span class=command>using</span></span> inv_unique_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted>conjugate</span> <span class=quoted>conjugate</span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-conjugate_of_complex><span class=command>lemma</span></span> conjugate_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span>cnj <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-conjugate_inf><span class=command>lemma</span></span> conjugate_inf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-conjugate_zero><span class=command>lemma</span></span> conjugate_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-conjugate_one><span class=command>lemma</span></span> conjugate_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-conjugate_inj><span class=command>lemma</span></span> conjugate_inj<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"conjugate <span class=free>x</span> <span class=main>=</span> conjugate <span class=free>y</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=free>y</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> conjugate_involution<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span> conjugate_involution<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1 id=Homogeneous_Coordinates-bij_conjugate><span class=command>lemma</span></span> bij_conjugate <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bij conjugate"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> bij_def inj_on_def
<span class=keyword1><span class=command>proof</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"conjugate <span class=skolem>x</span> <span class=main>=</span> conjugate <span class=skolem>y</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=skolem>y</span>"</span></span>
   <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> conjugate_inj<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> range conjugate"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> conjugate_involution range_eqI<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-conjugate_id_iff><span class=command>lemma</span></span> conjugate_id_iff<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=free>a</span> <span class=main>=</span> <span class=free>a</span> <span class=main>⟷</span> is_real <span class=main>(</span>to_complex <span class=free>a</span><span class=main>)</span> <span class=main>∨</span> <span class=free>a</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> conjugate_inf conjugate_of_complex eq_cnj_iff_real to_complex_of_complex<span class=main>)</span>

<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Inversion›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Geometric inversion wrt. the unit circle›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>inversion</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>inversion</span> <span class=main>=</span> conjugate <span class=main>∘</span> reciprocal"</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-inversion_sym><span class=command>lemma</span></span> inversion_sym<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inversion <span class=main>=</span> reciprocal <span class=main>∘</span> conjugate"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> inversion_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> one_neq_zero
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-inversion_involution><span class=command>lemma</span></span> inversion_involution <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inversion <span class=main>(</span>inversion <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"conjugate <span class=main>∘</span> reciprocal <span class=main>=</span> reciprocal <span class=main>∘</span> conjugate"</span></span>
    <span class=keyword1><span class=command>using</span></span> inversion_sym
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inversion_def<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> inversion_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-inversion_inversion_id><span class=command>lemma</span></span> inversion_inversion_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inversion <span class=main>∘</span> inversion <span class=main>=</span> id"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-inversion_zero><span class=command>lemma</span></span> inversion_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inversion <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inversion_def<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-inversion_infty><span class=command>lemma</span></span> inversion_infty <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inversion <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inversion_def<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-inversion_of_complex><span class=command>lemma</span></span> inversion_of_complex <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inversion <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=main>1</span> <span class=main>/</span> cnj <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inversion_def<span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-is_real_inversion><span class=command>lemma</span></span> is_real_inversion<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>x</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=main>(</span>inversion <span class=main>(</span>of_complex <span class=free>x</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Homogeneous_Coordinates-inversion_id_iff><span class=command>lemma</span></span> inversion_id_iff<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> inversion <span class=free>a</span> <span class=main>⟷</span> <span class=free>a</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> <span class=main>(</span>to_complex <span class=free>a</span><span class=main>)</span> <span class=main>*</span> cnj <span class=main>(</span>to_complex <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> inversion <span class=free>a</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> inversion_def
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>full_types<span class=main><span class=main>)</span></span> comp_apply complex_cnj_cancel_iff complex_cnj_zero inversion_def inversion_infty inversion_of_complex inversion_sym nonzero_eq_divide_eq of_complex_zero reciprocal_zero to_complex_of_complex zero_one_infty_not_equal<span class=main><span class=main>(</span></span>5<span class=main><span class=main>)</span></span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inversion_of_complex mult_not_zero nonzero_mult_div_cancel_right one_neq_zero to_complex_of_complex<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Ratio and cross-ratio›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Ratio›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Ratio of points $z$, $v$ and $w$ is usually defined as
$\frac{z-v}{z-w}$. Our definition introduces it in homogeneous
coordinates. It is well-defined if $z_1 \neq z_2 \vee z_1 \neq z_3$ and $z_1 \neq \infty_h$ and 
$z_2 \neq \infty_h \vee z_3 \neq \infty_h$›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>ratio</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex_homo <span class=main>⇒</span> complex_homo <span class=main>⇒</span> complex_homo"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ratio</span> <span class=free><span class=bound><span class=entity>za</span></span></span> <span class=free><span class=bound><span class=entity>zb</span></span></span> <span class=free><span class=bound><span class=entity>zc</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>za</span></span></span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free><span class=bound><span class=entity>zb</span></span></span><span class=main>)</span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>za</span></span></span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free><span class=bound><span class=entity>zc</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹This is ill-defined, but holds by our definition›</span></span>
<span class=keyword1><span class=command>lemma</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>zb</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>zc</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ratio <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>zb</span> <span class=free>zc</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> inf_sub_left<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> inf_sub_left<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> ratio_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_divide_inf<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>za</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>zc</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ratio <span class=free>za</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>zc</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> ratio_def
  <span class=keyword1><span class=command>using</span></span> inf_sub_right<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> sub_noteq_inf<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> divide_inf_left
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>za</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>zb</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ratio <span class=free>za</span> <span class=free>zb</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ratio_def
  <span class=keyword1><span class=command>using</span></span> sub_noteq_inf<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> inf_sub_right<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> divide_inf_right
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lemma</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ratio <span class=free>z1</span> <span class=free>z2</span> <span class=free>z1</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> ratio_def
  <span class=keyword1><span class=command>using</span></span> divide_zero_right<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z2</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> sub_eq_zero_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Cross-ratio›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The cross-ratio is defined over 4 points $(z, u, v, w)$, usually as
$\frac{(z-u)(v-w)}{(z-w)(v-u)}$. We define it using homogeneous coordinates. Cross ratio is
ill-defined when $z = u \vee v = w$ and $z = w$ and $v = u$ i.e. when 3 points are equal. Since
function must be total, in that case we define it arbitrarily to 1.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>cross_ratio_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_vec <span class=main>⇒</span> complex_vec <span class=main>⇒</span> complex_vec <span class=main>⇒</span> complex_vec"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>cross_ratio_cvec</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=free><span class=bound><span class=entity>u</span></span></span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span>
     <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>z'</span><span class=main>,</span> <span class=bound>z''</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>;</span>
          <span class=main>(</span><span class=bound>u'</span><span class=main>,</span> <span class=bound>u''</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>u</span></span></span><span class=main>;</span>
          <span class=main>(</span><span class=bound>v'</span><span class=main>,</span> <span class=bound>v''</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>v</span></span></span><span class=main>;</span>
          <span class=main>(</span><span class=bound>w'</span><span class=main>,</span> <span class=bound>w''</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>w</span></span></span><span class=main>;</span>
          <span class=bound>n1</span> <span class=main>=</span> <span class=bound>z'</span><span class=main>*</span><span class=bound>u''</span> <span class=main>-</span> <span class=bound>u'</span><span class=main>*</span><span class=bound>z''</span><span class=main>;</span>
          <span class=bound>n2</span> <span class=main>=</span> <span class=bound>v'</span><span class=main>*</span><span class=bound>w''</span> <span class=main>-</span> <span class=bound>w'</span><span class=main>*</span><span class=bound>v''</span><span class=main>;</span>
          <span class=bound>d1</span> <span class=main>=</span> <span class=bound>z'</span><span class=main>*</span><span class=bound>w''</span> <span class=main>-</span> <span class=bound>w'</span><span class=main>*</span><span class=bound>z''</span><span class=main>;</span>
          <span class=bound>d2</span> <span class=main>=</span> <span class=bound>v'</span><span class=main>*</span><span class=bound>u''</span> <span class=main>-</span> <span class=bound>u'</span><span class=main>*</span><span class=bound>v''</span>
       <span class=keyword1>in</span>
         <span class=keyword1>if</span> <span class=bound>n1</span> <span class=main>*</span> <span class=bound>n2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=bound>d1</span> <span class=main>*</span> <span class=bound>d2</span> <span class=main>≠</span> <span class=main>0</span> <span class=keyword1>then</span>
              <span class=main>(</span><span class=bound>n1</span> <span class=main>*</span> <span class=bound>n2</span><span class=main>,</span> <span class=bound>d1</span> <span class=main>*</span> <span class=bound>d2</span><span class=main>)</span>
         <span class=keyword1>else</span>
              <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> cross_ratio_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> complex_homo_coords"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>cross_ratio_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> cross_ratio <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex_homo <span class=main>⇒</span> complex_homo <span class=main>⇒</span> complex_homo <span class=main>⇒</span> complex_homo"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>cross_ratio_hcoords</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=skolem>z'</span> <span class=skolem>u'</span> <span class=skolem>v'</span> <span class=skolem>w'</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=skolem><span class=skolem>u1</span></span> <span class=skolem><span class=skolem>u2</span></span> <span class=skolem><span class=skolem>v1</span></span> <span class=skolem><span class=skolem>v2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span> <span class=skolem><span class=skolem>z'1</span></span> <span class=skolem><span class=skolem>z'2</span></span> <span class=skolem><span class=skolem>u'1</span></span> <span class=skolem><span class=skolem>u'2</span></span> <span class=skolem><span class=skolem>v'1</span></span> <span class=skolem><span class=skolem>v'2</span></span> <span class=skolem><span class=skolem>w'1</span></span> <span class=skolem><span class=skolem>w'2</span></span>
    <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>u1</span><span class=main>,</span> <span class=skolem>u2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v1</span><span class=main>,</span> <span class=skolem>v2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span>
             <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z'1</span><span class=main>,</span> <span class=skolem>z'2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>u'1</span><span class=main>,</span> <span class=skolem>u'2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v'1</span><span class=main>,</span> <span class=skolem>v'2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w'1</span><span class=main>,</span> <span class=skolem>w'2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>u</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span>
        <span class=operator>cases</span> <span class=quoted><span class=skolem>z'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>u'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>v'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?n1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span><span class=main>*</span><span class=skolem>u2</span> <span class=main>-</span> <span class=skolem>u1</span><span class=main>*</span><span class=skolem>z2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?n2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>v1</span><span class=main>*</span><span class=skolem>w2</span> <span class=main>-</span> <span class=skolem>w1</span><span class=main>*</span><span class=skolem>v2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?d1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span><span class=main>*</span><span class=skolem>w2</span> <span class=main>-</span> <span class=skolem>w1</span><span class=main>*</span><span class=skolem>z2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?d2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>v1</span><span class=main>*</span><span class=skolem>u2</span> <span class=main>-</span> <span class=skolem>u1</span><span class=main>*</span><span class=skolem>v2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?n1'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z'1</span><span class=main>*</span><span class=skolem>u'2</span> <span class=main>-</span> <span class=skolem>u'1</span><span class=main>*</span><span class=skolem>z'2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?n2'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>v'1</span><span class=main>*</span><span class=skolem>w'2</span> <span class=main>-</span> <span class=skolem>w'1</span><span class=main>*</span><span class=skolem>v'2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?d1'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z'1</span><span class=main>*</span><span class=skolem>w'2</span> <span class=main>-</span> <span class=skolem>w'1</span><span class=main>*</span><span class=skolem>z'2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?d2'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>v'1</span><span class=main>*</span><span class=skolem>u'2</span> <span class=main>-</span> <span class=skolem>u'1</span><span class=main>*</span><span class=skolem>v'2</span>"</span></span>

  <span class=keyword3><span class=command>assume</span></span> **<span class=main>:</span>
         <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span>
         <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u'</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v'</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w'</span> <span class=main>≠</span> vec_zero"</span></span>
         <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>u'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w'</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> cross_ratio_cvec <span class=skolem>z'</span> <span class=skolem>u'</span> <span class=skolem>v'</span> <span class=skolem>w'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=var>?n1</span><span class=main>*</span><span class=var>?n2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=var>?d1</span><span class=main>*</span><span class=var>?d2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?n1'</span><span class=main>*</span><span class=var>?n2'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=var>?d1'</span><span class=main>*</span><span class=var>?d2'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=var>?n1</span><span class=main>*</span><span class=var>?n2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=var>?d1</span><span class=main>*</span><span class=var>?d2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=var>?n1'</span><span class=main>*</span><span class=var>?n2'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=var>?d1'</span><span class=main>*</span><span class=var>?d2'</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>k</span><span class=main>*</span><span class=improper>ka</span><span class=main>*</span><span class=improper>kb</span><span class=main>*</span><span class=improper>kc</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=var>?n1'</span><span class=main>*</span><span class=var>?n2'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=var>?d1'</span><span class=main>*</span><span class=var>?d2'</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=main>(</span><span class=var>?n1</span><span class=main>*</span><span class=var>?n2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=var>?d1</span><span class=main>*</span><span class=var>?d2</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=main>(</span><span class=var>?n1'</span><span class=main>*</span><span class=var>?n2'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=var>?d1'</span><span class=main>*</span><span class=var>?d2'</span> <span class=main>≠</span> <span class=main>0</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-cross_ratio_01inf_id><span class=command>lemma</span></span> cross_ratio_01inf_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=free>z</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>z</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>z</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-cross_ratio_0><span class=command>lemma</span></span> cross_ratio_0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=free>u</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span>  <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>u1</span></span> <span class=skolem><span class=skolem>u2</span></span> <span class=skolem><span class=skolem>v1</span></span> <span class=skolem><span class=skolem>v2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span>
    <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>u1</span><span class=main>,</span> <span class=skolem>u2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v1</span><span class=main>,</span> <span class=skolem>v2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>u</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>u</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>u</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>u</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>u1</span></span> <span class=quoted><span class=skolem>u2</span></span> <span class=quoted><span class=skolem>v1</span></span> <span class=quoted><span class=skolem>v2</span></span><span class=main>]</span> complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>u1</span></span> <span class=quoted><span class=skolem>u2</span></span> <span class=quoted><span class=skolem>w1</span></span> <span class=quoted><span class=skolem>w2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult.commute<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-cross_ratio_1><span class=command>lemma</span></span> cross_ratio_1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=free>v</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span>  <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>u1</span></span> <span class=skolem><span class=skolem>u2</span></span> <span class=skolem><span class=skolem>v1</span></span> <span class=skolem><span class=skolem>v2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span>
    <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>u1</span><span class=main>,</span> <span class=skolem>u2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v1</span><span class=main>,</span> <span class=skolem>v2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>u</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?n1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>v1</span><span class=main>*</span><span class=skolem>u2</span> <span class=main>-</span> <span class=skolem>u1</span><span class=main>*</span><span class=skolem>v2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?n2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>v1</span><span class=main>*</span><span class=skolem>w2</span> <span class=main>-</span> <span class=skolem>w1</span><span class=main>*</span><span class=skolem>v2</span>"</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>u</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>v</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?n1</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=var>?n2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>u1</span></span> <span class=quoted><span class=skolem>u2</span></span> <span class=quoted><span class=skolem>v1</span></span> <span class=quoted><span class=skolem>v2</span></span><span class=main>]</span> complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>v1</span></span> <span class=quoted><span class=skolem>v2</span></span> <span class=quoted><span class=skolem>w1</span></span> <span class=quoted><span class=skolem>w2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>v</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>/</span> <span class=main>(</span><span class=var>?n1</span> <span class=main>*</span> <span class=var>?n2</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-cross_ratio_inf><span class=command>lemma</span></span> cross_ratio_inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=free>w</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span>  <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>u1</span></span> <span class=skolem><span class=skolem>u2</span></span> <span class=skolem><span class=skolem>v1</span></span> <span class=skolem><span class=skolem>v2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span>
    <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>u1</span><span class=main>,</span> <span class=skolem>u2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v1</span><span class=main>,</span> <span class=skolem>v2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>u</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?n1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>w1</span><span class=main>*</span><span class=skolem>u2</span> <span class=main>-</span> <span class=skolem>u1</span><span class=main>*</span><span class=skolem>w2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?n2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>v1</span><span class=main>*</span><span class=skolem>w2</span> <span class=main>-</span> <span class=skolem>w1</span><span class=main>*</span><span class=skolem>v2</span>"</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>u</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>v</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?n1</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=var>?n2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>u1</span></span> <span class=quoted><span class=skolem>u2</span></span> <span class=quoted><span class=skolem>w1</span></span> <span class=quoted><span class=skolem>w2</span></span><span class=main>]</span> complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>v1</span></span> <span class=quoted><span class=skolem>v2</span></span> <span class=quoted><span class=skolem>w1</span></span> <span class=quoted><span class=skolem>w2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>w</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-cross_ratio_0inf><span class=command>lemma</span></span> cross_ratio_0inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=main>(</span>of_complex <span class=free>x</span><span class=main>)</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>y</span><span class=main>)</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=main>(</span>of_complex <span class=main>(</span><span class=free>x</span> <span class=main>/</span> <span class=free>y</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span><span class=main>/</span><span class=improper>y</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-cross_ratio_commute_13><span class=command>lemma</span></span> cross_ratio_commute_13<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=free>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>=</span> reciprocal <span class=main>(</span>cross_ratio <span class=free>v</span> <span class=free>u</span> <span class=free>z</span> <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>u</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-cross_ratio_commute_24><span class=command>lemma</span></span> cross_ratio_commute_24<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=free>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>=</span> reciprocal <span class=main>(</span>cross_ratio <span class=free>z</span> <span class=free>w</span> <span class=free>v</span> <span class=free>u</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>u</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-cross_ratio_not_inf><span class=command>lemma</span></span> cross_ratio_not_inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=free>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=free>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span>
  <span class=keyword3><span class=command>assume</span></span> nz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=skolem><span class=skolem>u1</span></span> <span class=skolem><span class=skolem>u2</span></span> <span class=skolem><span class=skolem>v1</span></span> <span class=skolem><span class=skolem>v2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>u1</span><span class=main>,</span> <span class=skolem>u2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v1</span><span class=main>,</span> <span class=skolem>v2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>u</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x1</span></span> <span class=skolem><span class=skolem>x2</span></span> <span class=keyword2><span class=keyword>where</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x1</span><span class=main>,</span> <span class=skolem>x2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>u</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span><span class=main>*</span><span class=skolem>w2</span> <span class=main>≠</span> <span class=skolem>z2</span><span class=main>*</span><span class=skolem>w1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u1</span><span class=main>*</span><span class=skolem>v2</span> <span class=main>≠</span> <span class=skolem>u2</span><span class=main>*</span><span class=skolem>v1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * nz complex_cvec_eq_mix
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * **
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> cross_ratio_cvec <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inf_cvec_z2_zero_iff * **
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-cross_ratio_not_zero><span class=command>lemma</span></span> cross_ratio_not_zero<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=free>u</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=free>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span>
  <span class=keyword3><span class=command>assume</span></span> nz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=skolem><span class=skolem>u1</span></span> <span class=skolem><span class=skolem>u2</span></span> <span class=skolem><span class=skolem>v1</span></span> <span class=skolem><span class=skolem>v2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>u1</span><span class=main>,</span> <span class=skolem>u2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v1</span><span class=main>,</span> <span class=skolem>v2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>u</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x1</span></span> <span class=skolem><span class=skolem>x2</span></span> <span class=keyword2><span class=keyword>where</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x1</span><span class=main>,</span> <span class=skolem>x2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>u</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>v</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span><span class=main>*</span><span class=skolem>u2</span> <span class=main>≠</span> <span class=skolem>z2</span><span class=main>*</span><span class=skolem>u1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v1</span><span class=main>*</span><span class=skolem>w2</span> <span class=main>≠</span> <span class=skolem>v2</span><span class=main>*</span><span class=skolem>w1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * nz complex_cvec_eq_mix
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * **
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> cross_ratio_cvec <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> zero_cvec_z1_zero_iff * **
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Homogeneous_Coordinates-cross_ratio_real><span class=command>lemma</span></span> cross_ratio_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>u</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>v</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>w</span>"</span></span> 
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=free>u</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>≠</span> <span class=free>w</span> <span class=main>∨</span> <span class=free>z</span> <span class=main>≠</span> <span class=free>w</span> <span class=main>∧</span> <span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=main>(</span>cross_ratio <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span> <span class=main>(</span>of_complex <span class=free>u</span><span class=main>)</span> <span class=main>(</span>of_complex <span class=free>v</span><span class=main>)</span> <span class=main>(</span>of_complex <span class=free>w</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Homogeneous_Coordinates-cross_ratio><span class=command>lemma</span></span> cross_ratio<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z</span> <span class=main>≠</span> <span class=free>u</span> <span class=main>∧</span> <span class=free>v</span> <span class=main>≠</span> <span class=free>w</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=free>z</span> <span class=main>≠</span> <span class=free>w</span> <span class=main>∧</span> <span class=free>u</span> <span class=main>≠</span> <span class=free>v</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
          <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>  <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=free>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>z</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>u</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span><span class=free>v</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span><span class=main>(</span><span class=free>z</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>w</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span><span class=free>v</span> <span class=keyword1>-<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>u</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> sub_def divide_def
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=skolem><span class=skolem>u1</span></span> <span class=skolem><span class=skolem>u2</span></span> <span class=skolem><span class=skolem>v1</span></span> <span class=skolem><span class=skolem>v2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span>
    <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>u1</span><span class=main>,</span> <span class=skolem>u2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v1</span><span class=main>,</span> <span class=skolem>v2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>u</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?n1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span><span class=main>*</span><span class=skolem>u2</span> <span class=main>-</span> <span class=skolem>u1</span><span class=main>*</span><span class=skolem>z2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?n2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>v1</span><span class=main>*</span><span class=skolem>w2</span> <span class=main>-</span> <span class=skolem>w1</span><span class=main>*</span><span class=skolem>v2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?d1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span><span class=main>*</span><span class=skolem>w2</span> <span class=main>-</span> <span class=skolem>w1</span><span class=main>*</span><span class=skolem>z2</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?d2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>v1</span><span class=main>*</span><span class=skolem>u2</span> <span class=main>-</span> <span class=skolem>u1</span><span class=main>*</span><span class=skolem>v2</span>"</span></span>
  <span class=keyword3><span class=command>assume</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span>
         <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>u</span> <span class=main>∧</span> <span class=main>¬</span> <span class=skolem>v</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span> <span class=main>∨</span> <span class=main>¬</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span> <span class=main>∧</span> <span class=main>¬</span> <span class=skolem>u</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v</span>"</span></span>
         <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>u</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>v</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>

  <span class=keyword1><span class=command>hence</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?n1</span> <span class=main>*</span> <span class=var>?n2</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=var>?d1</span> <span class=main>*</span> <span class=var>?d2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>using</span></span> complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z1</span></span> <span class=quoted><span class=skolem>z2</span></span> <span class=quoted><span class=skolem>u1</span></span> <span class=quoted><span class=skolem>u2</span></span><span class=main>]</span> complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>v1</span></span> <span class=quoted><span class=skolem>v2</span></span> <span class=quoted><span class=skolem>w1</span></span> <span class=quoted><span class=skolem>w2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z1</span></span> <span class=quoted><span class=skolem>z2</span></span> <span class=quoted><span class=skolem>w1</span></span> <span class=quoted><span class=skolem>w2</span></span><span class=main>]</span> complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>u1</span></span> <span class=quoted><span class=skolem>u2</span></span> <span class=quoted><span class=skolem>v1</span></span> <span class=quoted><span class=skolem>v2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> eq_iff_diff_eq_0 mult.commute mult_eq_0_iff<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> ****<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * **<span class=main>(</span>1-4<span class=main>)</span> **<span class=main>(</span>6-9<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> inf_cvec_z2_zero_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z1</span></span> <span class=quoted><span class=skolem>z2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> inf_cvec_z2_zero_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>u1</span></span> <span class=quoted><span class=skolem>u2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> inf_cvec_z2_zero_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>v1</span></span> <span class=quoted><span class=skolem>v2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> inf_cvec_z2_zero_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>w1</span></span> <span class=quoted><span class=skolem>w2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=var>?n1</span><span class=main>*</span><span class=var>?n2</span><span class=main>,</span> <span class=var>?d1</span><span class=main>*</span><span class=var>?d2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * ***
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?k</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span><span class=main>*</span><span class=skolem>u2</span><span class=main>*</span><span class=skolem>v2</span><span class=main>*</span><span class=skolem>w2</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>~<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>u</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=skolem>v</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>~<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> reciprocal_cvec <span class=main>(</span><span class=main>(</span><span class=skolem>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>~<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=skolem>v</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>~<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>u</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=var>?k</span> <span class=main>*</span> <span class=var>?n1</span> <span class=main>*</span> <span class=var>?n2</span><span class=main>,</span> <span class=var>?k</span> <span class=main>*</span> <span class=var>?d1</span> <span class=main>*</span> <span class=var>?d2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * *** ****
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>z</span> <span class=skolem>u</span> <span class=skolem>v</span> <span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span>
           <span class=main>(</span><span class=skolem>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>~<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>u</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=skolem>v</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>~<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> reciprocal_cvec <span class=main>(</span><span class=main>(</span><span class=skolem>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>~<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=skolem>v</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>~<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>u</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ****
    <span class=keyword1><span class=command>unfolding</span></span> complex_cvec_eq_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=comment1>(*
(* Although it seems useful, we did not use this. *)

text ‹Transfer extended complex plane to complex plane›

definition HC :: "complex_homo ⇒ complex ⇒ bool"
  where "HC = (λ h c. h = of_complex c)"

lemma Domainp_HC [transfer_domain_rule]: "Domainp HC = (λ x. x ≠ ∞<span class=hidden>⇩</span><sub>h</sub>)"
  unfolding HC_def Domainp_iff[abs_def]
  apply (rule ext)
  using inf_or_of_complex
  by auto

lemma bi_unique_HC [transfer_rule]: "bi_unique HC"
  using of_complex_inj
  unfolding HC_def bi_unique_def
  by auto

lemma right_total_HC [transfer_rule]: "right_total HC"
  unfolding HC_def right_total_def
  by auto

lemma HC_0 [transfer_rule]: "HC 0<span class=hidden>⇩</span><sub>h</sub> 0"
  unfolding HC_def
  by simp

lemma HC_1 [transfer_rule]: "HC 1<span class=hidden>⇩</span><sub>h</sub> 1"
  unfolding HC_def
  by simp

context includes lifting_syntax
begin
lemma HC_add [transfer_rule]: "(HC ===&gt; HC ===&gt; HC) (op +<span class=hidden>⇩</span><sub>h</sub>) (op +)"
  unfolding rel_fun_def HC_def
  by auto

lemma HC_mult [transfer_rule]: "(HC ===&gt; HC ===&gt; HC) (op *<span class=hidden>⇩</span><sub>h</sub>) ( op * )"
  unfolding rel_fun_def HC_def
  by auto

lemma HC_All [transfer_rule]:
  "((HC ===&gt; op =) ===&gt; op =) (Ball {z. z ≠ ∞<span class=hidden>⇩</span><sub>h</sub>}) All"
  using inf_or_of_complex
  unfolding rel_fun_def HC_def
  by auto

lemma HC_transfer_forall [transfer_rule]:
  "((HC ===&gt; op =) ===&gt; op =) (transfer_bforall (λx. x ≠ ∞<span class=hidden>⇩</span><sub>h</sub>)) transfer_forall"
  using inf_or_of_complex
  unfolding transfer_forall_def transfer_bforall_def
  unfolding rel_fun_def HC_def
  by auto
end
*)</span>
</pre>
</div><div id=Moebius>
<div class=head>
<h1>Theory Moebius</h1>
</div>
<pre class=source><span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Möbius transformations›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius transformations (also called homographic, linear fractional, or bilinear
transformations) are the fundamental transformations of the extended complex plane. Here they are
introduced algebraically. Each transformation is represented by a regular (non-singular,
non-degenerate) $2\times 2$ matrix that acts linearly on homogeneous coordinates. As proportional
homogeneous coordinates represent same points of $\mathbb{\overline{C}}$, proportional matrices will
represent the same Möbius transformation.›</span></span>

<span class=keyword1><span class=command>theory</span></span> Moebius
<span class=keyword2><span class=keyword>imports</span></span> <a href=#Homogeneous_Coordinates>Homogeneous_Coordinates</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Definition of Möbius transformations›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>typedef</span></span> moebius_mat <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>M</span><span class=main>::</span>complex_mat<span class=main>.</span> mat_det <span class=bound>M</span> <span class=main>≠</span> <span class=main>0</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"eye"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>setup_lifting</span></span> type_definition_moebius_mat

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_cmat_eq</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>                     
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>moebius_cmat_eq</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>B</span></span></span> <span class=main>⟷</span>  <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>complex<span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>B</span></span></span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_mat_eq <span class=main>::</span> <span class=quoted><span class=quoted>"moebius_mat <span class=main>⇒</span> moebius_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>moebius_cmat_eq</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Moebius-moebius_mat_eq_refl><span class=command>lemma</span></span> moebius_mat_eq_refl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_mat_eq <span class=free>x</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>quotient_type</span></span> moebius <span class=main>=</span> <span class=quoted>moebius_mat</span> <span class=main>/</span> <span class=quoted>moebius_mat_eq</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> equivpI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"reflp moebius_mat_eq"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> reflp_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"symp moebius_mat_eq"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> symp_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> symp_def<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=improper>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"transp moebius_mat_eq"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> transp_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> transp_def<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>ka</span><span class=main>*</span><span class=improper>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mk_moebius_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>mk_moebius_cmat</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=free><span class=bound><span class=entity>c</span></span></span> <span class=free><span class=bound><span class=entity>d</span></span></span> <span class=main>=</span>
           <span class=main>(</span><span class=keyword1>let</span> <span class=bound>M</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span>
             <span class=keyword1>in</span> <span class=keyword1>if</span> mat_det <span class=bound>M</span> <span class=main>≠</span> <span class=main>0</span> <span class=keyword1>then</span>
                <span class=bound>M</span>
             <span class=keyword1>else</span>
                eye<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> mk_moebius_mat <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> moebius_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mk_moebius_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lift_definition</span></span> mk_moebius <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> moebius"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mk_moebius_mat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Moebius-ex_mk_moebius><span class=command>lemma</span></span> ex_mk_moebius<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>a</span> <span class=bound>b</span> <span class=bound>c</span> <span class=bound>d</span><span class=main>.</span> <span class=free>M</span> <span class=main>=</span> mk_moebius <span class=bound>a</span> <span class=bound>b</span> <span class=bound>c</span> <span class=bound>d</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> <span class=bound>c</span><span class=main>,</span> <span class=bound>d</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>M</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=skolem>M</span> <span class=main>(</span>mk_moebius_cmat <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a</span> <span class=bound>b</span> <span class=bound>c</span> <span class=bound>d</span><span class=main>.</span> moebius_cmat_eq <span class=skolem>M</span> <span class=main>(</span>mk_moebius_cmat <span class=bound>a</span> <span class=bound>b</span> <span class=bound>c</span> <span class=bound>d</span><span class=main>)</span> <span class=main>∧</span> mat_det <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> <span class=bound>c</span><span class=main>,</span> <span class=bound>d</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Action on points›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius transformations are given as the action of Möbius group on the points of the
extended complex plane (in homogeneous coordinates).›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_pt_cmat_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_vec <span class=main>⇒</span> complex_vec"</span></span> <span class=keyword2><span class=keyword>where</span></span>
   <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>moebius_pt_cmat_cvec</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free><span class=bound><span class=entity>z</span></span></span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_pt_mmat_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"moebius_mat <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> complex_homo_coords"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>moebius_pt_cmat_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=operator>algebra</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_pt <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> complex_homo <span class=main>⇒</span> complex_homo"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>moebius_pt_mmat_hcoords</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>M'</span> <span class=skolem>x</span> <span class=skolem>x'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=skolem>M</span> <span class=skolem>M'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>x'</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=skolem>x</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> moebius_pt_cmat_cvec <span class=skolem>M'</span> <span class=skolem>x'</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>k</span><span class=main>*</span><span class=improper>ka</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-bij_moebius_pt><span class=command>lemma</span></span> bij_moebius_pt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bij <span class=main>(</span>moebius_pt <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> bij_def inj_on_def surj_def
<span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=skolem>x</span> <span class=main>=</span> moebius_pt <span class=free>M</span> <span class=skolem>y</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=skolem>y</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>x</span> <span class=skolem>y</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=skolem>x</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=skolem>y</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> mult_sv_mv<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=skolem>M</span></span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span> mult_mv_inv<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> moebius_pt_cmat_cvec_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex_cvec_eq_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>.</span> <span class=skolem>y</span> <span class=main>=</span> moebius_pt <span class=free>M</span> <span class=bound>x</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span> <span class=main>::</span> <span class=quoted>complex_vec</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?iM</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"mat_inv <span class=skolem>M</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?x</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?iM</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>y</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?x</span> <span class=main>≠</span> vec_zero"</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> mat_det_mult mat_eye_r mat_inv_r mult_cancel_right1 mult_mv_nonzero<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=var>?x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> eye_def <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_inv_r<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>x</span><span class=main>∈</span><span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span><span class=main>.</span> <span class=skolem>y</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=bound>x</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-moebius_pt_eq_I><span class=command>lemma</span></span> moebius_pt_eq_I<span class=main>:</span>                                          
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>z1</span> <span class=main>=</span> moebius_pt <span class=free>M</span> <span class=free>z2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>=</span> <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> bij_moebius_pt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> bij_def inj_on_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Moebius-moebius_pt_neq_I><span class=command>lemma</span></span> moebius_pt_neq_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>z1</span> <span class=main>≠</span> moebius_pt <span class=free>M</span> <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> moebius_pt_eq_I<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_moebius</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>complex_homo <span class=main>⇒</span> complex_homo<span class=main>)</span> <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>is_moebius</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> moebius_pt <span class=bound>M</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In the classic literature Möbius transformations are often expressed in the form
$\frac{az+b}{cz+d}$. The following lemma shows that when restricted to finite points, the action
of Möbius transformations is bilinear.›</span></span>

<span class=keyword1 id=Moebius-moebius_pt_bilinear><span class=command>lemma</span></span> moebius_pt_bilinear<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> <span class=free>c</span><span class=main>,</span> <span class=free>d</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>mk_moebius <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>d</span><span class=main>)</span> <span class=free>z</span> <span class=main>=</span>
            <span class=main>(</span><span class=keyword1>if</span> <span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>then</span>
                 <span class=main>(</span><span class=main>(</span>of_complex <span class=free>a</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>b</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span>
                 <span class=main>(</span><span class=main>(</span>of_complex <span class=free>c</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>d</span><span class=main>)</span><span class=main>)</span>
             <span class=keyword1>else</span>
                 <span class=main>(</span>of_complex <span class=free>a</span><span class=main>)</span> <span class=keyword1>:<span class=hidden>⇩</span><sub>h</sub></span>
                 <span class=main>(</span>of_complex <span class=free>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> divide_def
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span> <span class=skolem>d</span> <span class=main>::</span> <span class=quoted>complex</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=keyword2><span class=keyword>where</span></span> zz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?oc</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"of_complex_cvec"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"moebius_pt_cmat_cvec <span class=main>(</span>mk_moebius_cmat <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span> <span class=skolem>d</span><span class=main>)</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span>
       <span class=main>(</span><span class=keyword1>if</span> <span class=main>¬</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>
        <span class=keyword1>then</span> <span class=main>(</span><span class=var>?oc</span> <span class=skolem>a</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=var>?oc</span> <span class=skolem>b</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span>
             reciprocal_cvec <span class=main>(</span><span class=var>?oc</span> <span class=skolem>c</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>v</sub></span> <span class=var>?oc</span> <span class=skolem>d</span><span class=main>)</span>
        <span class=keyword1>else</span> <span class=var>?oc</span> <span class=skolem>a</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span>
             reciprocal_cvec <span class=main>(</span><span class=var>?oc</span> <span class=skolem>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> zz *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> zz inf_cvec_z2_zero_iff <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>≠</span> vec_zero›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> zz * False
      <span class=keyword1><span class=command>using</span></span> regular_homogenous_system<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>b</span></span> <span class=quoted><span class=skolem>c</span></span> <span class=quoted><span class=skolem>d</span></span> <span class=quoted><span class=skolem>z1</span></span> <span class=quoted><span class=skolem>z2</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Möbius group›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius elements form a group under composition. This group is called the \emph{projective
general linear group} and denoted by $PGL(2, \mathbb{C})$ (the group $SGL(2, \mathbb{C})$ containing elements
with the determinant $1$ can also be considered).›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Identity Möbius transformation is represented by the identity matrix.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>id_moebius_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>id_moebius_cmat</span> <span class=main>=</span> eye"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> id_moebius_mmat <span class=main>::</span> <span class=quoted><span class=quoted>"moebius_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>id_moebius_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lift_definition</span></span> id_moebius <span class=main>::</span> <span class=quoted><span class=quoted>"moebius"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>id_moebius_mmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Moebius-moebius_pt_moebius_id><span class=command>lemma</span></span> moebius_pt_moebius_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt id_moebius <span class=main>=</span> id"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> id_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> eye_mv_l
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-mk_moeibus_id><span class=command>lemma</span></span> mk_moeibus_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mk_moebius <span class=free>a</span> <span class=main>0</span> <span class=main>0</span> <span class=free>a</span> <span class=main>=</span> id_moebius"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The inverse Möbius transformation is obtained by taking the inverse representative matrix.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_inv_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>moebius_inv_cmat</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>=</span> mat_inv <span class=free><span class=bound><span class=entity>M</span></span></span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_inv_mmat <span class=main>::</span> <span class=quoted><span class=quoted>"moebius_mat <span class=main>⇒</span> moebius_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>moebius_inv_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_inv<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_inv <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> moebius"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"moebius_inv_mmat"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=skolem>x</span> <span class=skolem>y</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=main>(</span>moebius_inv_cmat <span class=skolem>x</span><span class=main>)</span> <span class=main>(</span>moebius_inv_cmat <span class=skolem>y</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_inv_mult_sm<span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=improper>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-moebius_inv><span class=command>lemma</span></span> moebius_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=main>=</span> inv <span class=main>(</span>moebius_pt <span class=free>M</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> inv_equality<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=skolem>x</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>x</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span><span class=main>::</span><span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>x</span><span class=main>::</span><span class=quoted>complex_vec</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>≠</span> vec_zero"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"moebius_pt_cmat_cvec <span class=main>(</span>moebius_inv_cmat <span class=skolem>M</span><span class=main>)</span> <span class=main>(</span>moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=skolem>x</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> eye_mv_l
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_inv_l<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=skolem>y</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>y</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span><span class=main>::</span><span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>y</span><span class=main>::</span><span class=quoted>complex_vec</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>≠</span> vec_zero"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=main>(</span>moebius_pt_cmat_cvec <span class=main>(</span>moebius_inv_cmat <span class=skolem>M</span><span class=main>)</span> <span class=skolem>y</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> eye_mv_l
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_inv_r<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-is_moebius_inv><span class=command>lemma</span></span> is_moebius_inv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_moebius <span class=free>m</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_moebius <span class=main>(</span>inv <span class=free>m</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> moebius_inv
  <span class=keyword1><span class=command>unfolding</span></span> is_moebius_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1 id=Moebius-moebius_inv_mk_moebus><span class=command>lemma</span></span> moebius_inv_mk_moebus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> <span class=free>c</span><span class=main>,</span> <span class=free>d</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_inv <span class=main>(</span>mk_moebius <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>d</span><span class=main>)</span> <span class=main>=</span>
         mk_moebius <span class=main>(</span><span class=free>d</span><span class=main>/</span><span class=main>(</span><span class=free>a</span><span class=main>*</span><span class=free>d</span><span class=main>-</span><span class=free>b</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span><span class=free>b</span><span class=main>/</span><span class=main>(</span><span class=free>a</span><span class=main>*</span><span class=free>d</span><span class=main>-</span><span class=free>b</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span><span class=free>c</span><span class=main>/</span><span class=main>(</span><span class=free>a</span><span class=main>*</span><span class=free>d</span><span class=main>-</span><span class=free>b</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=free>a</span><span class=main>/</span><span class=main>(</span><span class=free>a</span><span class=main>*</span><span class=free>d</span><span class=main>-</span><span class=free>b</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Composition of Möbius elements is obtained by multiplying their representing matrices.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_comp_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>moebius_comp_cmat</span> <span class=free><span class=bound><span class=entity>M1</span></span></span> <span class=free><span class=bound><span class=entity>M2</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>M1</span></span></span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>M2</span></span></span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_comp_mmat <span class=main>::</span> <span class=quoted><span class=quoted>"moebius_mat <span class=main>⇒</span> moebius_mat <span class=main>⇒</span> moebius_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>moebius_comp_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_comp <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> moebius <span class=main>⇒</span> moebius"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>moebius_comp_mmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>k</span><span class=main>*</span><span class=improper>ka</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_comp><span class=command>lemma</span></span> moebius_comp<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_comp <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span> <span class=main>=</span> moebius_pt <span class=free>M1</span> <span class=main>∘</span> moebius_pt <span class=free>M2</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> comp_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_pt_comp><span class=command>lemma</span></span> moebius_pt_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_comp <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span> <span class=free>z</span> <span class=main>=</span> moebius_pt <span class=free>M1</span> <span class=main>(</span>moebius_pt <span class=free>M2</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> moebius_comp<span class=main>)</span>

<span class=keyword1 id=Moebius-is_moebius_comp><span class=command>lemma</span></span> is_moebius_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_moebius <span class=free>m1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_moebius <span class=free>m2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_moebius <span class=main>(</span><span class=free>m1</span> <span class=main>∘</span> <span class=free>m2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> is_moebius_def
  <span class=keyword1><span class=command>using</span></span> moebius_comp
  <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1 id=Moebius-moebius_comp_mk_moebius><span class=command>lemma</span></span> moebius_comp_mk_moebius <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> <span class=free>c</span><span class=main>,</span> <span class=free>d</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>a'</span><span class=main>,</span> <span class=free>b'</span><span class=main>,</span> <span class=free>c'</span><span class=main>,</span> <span class=free>d'</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_comp <span class=main>(</span>mk_moebius <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>d</span><span class=main>)</span> <span class=main>(</span>mk_moebius <span class=free>a'</span> <span class=free>b'</span> <span class=free>c'</span> <span class=free>d'</span><span class=main>)</span> <span class=main>=</span>
           mk_moebius <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>a'</span> <span class=main>+</span> <span class=free>b</span> <span class=main>*</span> <span class=free>c'</span><span class=main>)</span> <span class=main>(</span><span class=free>a</span> <span class=main>*</span> <span class=free>b'</span> <span class=main>+</span> <span class=free>b</span> <span class=main>*</span> <span class=free>d'</span><span class=main>)</span> <span class=main>(</span><span class=free>c</span> <span class=main>*</span> <span class=free>a'</span> <span class=main>+</span> <span class=free>d</span> <span class=main>*</span> <span class=free>c'</span><span class=main>)</span> <span class=main>(</span><span class=free>c</span> <span class=main>*</span> <span class=free>b'</span> <span class=main>+</span> <span class=free>d</span> <span class=main>*</span> <span class=free>d'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> mat_det_mult<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>b</span><span class=main>,</span> <span class=free>c</span><span class=main>,</span> <span class=free>d</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a'</span><span class=main>,</span> <span class=free>b'</span><span class=main>,</span> <span class=free>c'</span><span class=main>,</span> <span class=free>d'</span><span class=main>)</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>instantiation</span></span> moebius <span class=main>::</span> <span class=quoted>group_add</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity><span class=class_parameter>plus_moebius</span></span> <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> moebius <span class=main>⇒</span> moebius"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>plus_moebius</span> <span class=main>=</span> moebius_comp"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity><span class=class_parameter>uminus_moebius</span></span> <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> moebius"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>uminus_moebius</span> <span class=main>=</span> moebius_inv"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity><span class=class_parameter>zero_moebius</span></span> <span class=main>::</span> <span class=quoted><span class=quoted>"moebius"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>zero_moebius</span> <span class=main>=</span> id_moebius"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity><span class=class_parameter>minus_moebius</span></span> <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> moebius <span class=main>⇒</span> moebius"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>minus_moebius</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>B</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>+</span> <span class=main>(</span><span class=main>-</span><span class=free><span class=bound><span class=entity>B</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span> <span class=main>::</span> <span class=quoted>moebius</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>+</span> <span class=skolem>b</span> <span class=main>+</span> <span class=skolem>c</span> <span class=main>=</span> <span class=skolem>a</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>b</span> <span class=main>+</span> <span class=skolem>c</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> plus_moebius_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>b</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=main>(</span>moebius_comp_cmat <span class=main>(</span>moebius_comp_cmat <span class=skolem>a</span> <span class=skolem>b</span><span class=main>)</span> <span class=skolem>c</span><span class=main>)</span> <span class=main>(</span>moebius_comp_cmat <span class=skolem>a</span> <span class=main>(</span>moebius_comp_cmat <span class=skolem>b</span> <span class=skolem>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_mm_assoc<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=main>::</span> <span class=quoted>moebius</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>+</span> <span class=main>0</span> <span class=main>=</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> plus_moebius_def zero_moebius_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>A</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=main>(</span>moebius_comp_cmat <span class=skolem>A</span> id_moebius_cmat<span class=main>)</span> <span class=skolem>A</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> mat_eye_r
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=main>::</span> <span class=quoted>moebius</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>+</span> <span class=skolem>a</span> <span class=main>=</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> plus_moebius_def zero_moebius_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>A</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=main>(</span>moebius_comp_cmat id_moebius_cmat <span class=skolem>A</span><span class=main>)</span> <span class=skolem>A</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> mat_eye_l
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=main>::</span> <span class=quoted>moebius</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=skolem>a</span> <span class=main>+</span> <span class=skolem>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> plus_moebius_def uminus_moebius_def zero_moebius_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=main>(</span>moebius_comp_cmat <span class=main>(</span>moebius_inv_cmat <span class=skolem>a</span><span class=main>)</span> <span class=skolem>a</span><span class=main>)</span> id_moebius_cmat"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_inv_l<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=main>::</span> <span class=quoted>moebius</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>+</span> <span class=main>-</span> <span class=skolem>b</span> <span class=main>=</span> <span class=skolem>a</span> <span class=main>-</span> <span class=skolem>b</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> minus_moebius_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Composition with inverse›</span></span>

<span class=keyword1 id=Moebius-moebius_comp_inv_left><span class=command>lemma</span></span> moebius_comp_inv_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_comp <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=free>M</span> <span class=main>=</span> id_moebius"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> left_minus plus_moebius_def uminus_moebius_def zero_moebius_def<span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_comp_inv_right><span class=command>lemma</span></span> moebius_comp_inv_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_comp <span class=free>M</span> <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=main>=</span> id_moebius"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> right_minus plus_moebius_def uminus_moebius_def zero_moebius_def<span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_pt_comp_inv_left><span class=command>lemma</span></span> moebius_pt_comp_inv_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> moebius_pt_comp<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_pt_comp_inv_right><span class=command>lemma</span></span> moebius_pt_comp_inv_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> moebius_pt_comp<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_pt_comp_inv_image_left><span class=command>lemma</span></span> moebius_pt_comp_inv_image_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=main>`</span> moebius_pt <span class=free>M</span> <span class=main>`</span> <span class=free>A</span> <span class=main>=</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Moebius-moebius_pt_comp_inv_image_right><span class=command>lemma</span></span> moebius_pt_comp_inv_image_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=main>`</span> moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=main>`</span> <span class=free>A</span> <span class=main>=</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1 id=Moebius-moebius_pt_invert><span class=command>lemma</span></span> moebius_pt_invert<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>z2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>z1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_pt_moebius_inv_in_set><span class=command>lemma</span></span> moebius_pt_moebius_inv_in_set <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>z</span> <span class=main>∈</span> <span class=free>A</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=main>`</span> <span class=free>A</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> image_iff
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Special kinds of Möbius transformations›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Reciprocal (1/z) as a Möbius transformation›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_reciprocal</span> <span class=main>::</span> <span class=quoted><span class=quoted>"moebius"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>moebius_reciprocal</span> <span class=main>=</span> mk_moebius <span class=main>0</span> <span class=main>1</span> <span class=main>1</span> <span class=main>0</span>"</span></span>

<span class=keyword1 id=Moebius-moebius_reciprocal><span class=command>lemma</span></span> moebius_reciprocal <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt moebius_reciprocal <span class=main>=</span> reciprocal"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_reciprocal_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> split_def<span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_reciprocal_inv><span class=command>lemma</span></span> moebius_reciprocal_inv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_inv moebius_reciprocal <span class=main>=</span> moebius_reciprocal"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_reciprocal_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=operator>simp</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Euclidean similarities as a Möbius transform›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span><span class=quoted><span class=plain_text>‹Euclidean similarities include Euclidean isometries (translations and rotations) and 
dilatations.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_similarity</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> moebius"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>moebius_similarity</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>=</span> mk_moebius <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>b</span></span></span> <span class=main>0</span> <span class=main>1</span>"</span></span>

<span class=keyword1 id=Moebius-moebius_pt_moebius_similarity><span class=command>lemma</span></span> moebius_pt_moebius_similarity <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=free>z</span> <span class=main>=</span> <span class=main>(</span>of_complex <span class=free>a</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_similarity_def
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> mult_inf_right<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"of_complex <span class=free>a</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> moebius_pt_bilinear<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Their action is a linear transformation of $\mathbb{C}.$›</span></span>
<span class=keyword1 id="Moebius-moebius_pt_moebius_similarity'"><span class=command>lemma</span></span> moebius_pt_moebius_similarity'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> <span class=main>(</span>of_complex <span class=free>a</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=bound>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_pt_moebius_similarity<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id="Moebius-is_moebius_similarity'"><span class=command>lemma</span></span> is_moebius_similarity'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> <span class=free>a</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=bound>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> moebius_pt <span class=main>(</span>moebius_similarity <span class=main>(</span>to_complex <span class=free>a</span><span class=main>)</span> <span class=main>(</span>to_complex <span class=free>b</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>ka</span></span> <span class=skolem><span class=skolem>kb</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> of_complex <span class=skolem>ka</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=skolem>ka</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>=</span> of_complex <span class=skolem>kb</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>  inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>b</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> is_moebius_def
    <span class=keyword1><span class=command>using</span></span> moebius_pt_moebius_similarity'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>ka</span></span> <span class=quoted><span class=skolem>kb</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-is_moebius_similarity><span class=command>lemma</span></span> is_moebius_similarity<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>b</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_moebius <span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> <span class=free>a</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=bound>z</span> <span class=keyword1>+<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> is_moebius_similarity'<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> is_moebius_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Euclidean similarities form a group.›</span></span>

<span class=keyword1 id=Moebius-moebius_similarity_id><span class=command>lemma</span></span> moebius_similarity_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_similarity <span class=main>1</span> <span class=main>0</span> <span class=main>=</span> id_moebius"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_similarity_inv><span class=command>lemma</span></span> moebius_similarity_inv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_inv <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=main>=</span> moebius_similarity <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=free>a</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span><span class=free>b</span><span class=main>/</span><span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> moebius_similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_similarity_uminus><span class=command>lemma</span></span> moebius_similarity_uminus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> moebius_similarity <span class=free>a</span> <span class=free>b</span> <span class=main>=</span> moebius_similarity <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=free>a</span><span class=main>)</span> <span class=main>(</span><span class=main>-</span><span class=free>b</span><span class=main>/</span><span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_similarity_comp><span class=command>lemma</span></span> moebius_similarity_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_comp <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=main>(</span>moebius_similarity <span class=free>c</span> <span class=free>d</span><span class=main>)</span> <span class=main>=</span> moebius_similarity <span class=main>(</span><span class=free>a</span><span class=main>*</span><span class=free>c</span><span class=main>)</span> <span class=main>(</span><span class=free>a</span><span class=main>*</span><span class=free>d</span><span class=main>+</span><span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> moebius_similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_similarity_plus><span class=command>lemma</span></span> moebius_similarity_plus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_similarity <span class=free>a</span> <span class=free>b</span> <span class=main>+</span> moebius_similarity <span class=free>c</span> <span class=free>d</span> <span class=main>=</span> moebius_similarity <span class=main>(</span><span class=free>a</span><span class=main>*</span><span class=free>c</span><span class=main>)</span> <span class=main>(</span><span class=free>a</span><span class=main>*</span><span class=free>d</span><span class=main>+</span><span class=free>b</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Euclidean similarities are the only Möbius group elements such that their action leaves the
$\infty_{h}$ fixed.›</span></span>
<span class=keyword1 id=Moebius-moebius_similarity_inf><span class=command>lemma</span></span> moebius_similarity_inf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> moebius_similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_similarity_only_inf_to_inf><span class=command>lemma</span></span> moebius_similarity_only_inf_to_inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Moebius-moebius_similarity_inf_iff><span class=command>lemma</span></span> moebius_similarity_inf_iff <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> moebius_similarity_only_inf_to_inf<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Moebius-inf_fixed_only_moebius_similarity><span class=command>lemma</span></span> inf_fixed_only_moebius_similarity<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>M</span> <span class=main>=</span> moebius_similarity <span class=bound>a</span> <span class=bound>b</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> moebius_similarity_def
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> MM<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>M</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> MM
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> moebius_cmat_eq <span class=skolem>M</span> <span class=main>(</span>mk_moebius_cmat <span class=bound>a</span> <span class=bound>b</span> <span class=main>0</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>a</span><span class=main>/</span><span class=skolem>d</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>b</span><span class=main>/</span><span class=skolem>d</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span><span class=main>/</span><span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> moebius_cmat_eq <span class=skolem>M</span> <span class=main>(</span>mk_moebius_cmat <span class=main>(</span><span class=skolem>a</span> <span class=main>/</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>(</span><span class=skolem>b</span> <span class=main>/</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>0</span> <span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> MM *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>d</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Euclidean similarities include translations, rotations, and dilatations.›</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Translation›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_translation</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>moebius_translation</span> <span class=free><span class=bound><span class=entity>v</span></span></span> <span class=main>=</span> moebius_similarity <span class=main>1</span> <span class=free><span class=bound><span class=entity>v</span></span></span>"</span></span>

<span class=keyword1 id=Moebius-moebius_translation_comp><span class=command>lemma</span></span> moebius_translation_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_comp <span class=main>(</span>moebius_translation <span class=free>v1</span><span class=main>)</span> <span class=main>(</span>moebius_translation <span class=free>v2</span><span class=main>)</span> <span class=main>=</span> moebius_translation <span class=main>(</span><span class=free>v1</span> <span class=main>+</span> <span class=free>v2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_translation_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_translation_plus><span class=command>lemma</span></span> moebius_translation_plus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>moebius_translation <span class=free>v1</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span>moebius_translation <span class=free>v2</span><span class=main>)</span> <span class=main>=</span> moebius_translation <span class=main>(</span><span class=free>v1</span> <span class=main>+</span> <span class=free>v2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_translation_zero><span class=command>lemma</span></span> moebius_translation_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_translation <span class=main>0</span> <span class=main>=</span> id_moebius"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_translation_def moebius_similarity_id
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_translation_inv><span class=command>lemma</span></span> moebius_translation_inv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_inv <span class=main>(</span>moebius_translation <span class=free>v1</span><span class=main>)</span> <span class=main>=</span> moebius_translation <span class=main>(</span><span class=main>-</span><span class=free>v1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_translation_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>v1</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>v1</span>"</span></span><span class=main>]</span> moebius_translation_zero
  <span class=keyword1><span class=command>using</span></span> minus_unique<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_translation <span class=free>v1</span>"</span></span> <span class=quoted><span class=quoted>"moebius_translation <span class=main>(</span><span class=main>-</span><span class=free>v1</span><span class=main>)</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_translation_uminus><span class=command>lemma</span></span> moebius_translation_uminus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>moebius_translation <span class=free>v1</span><span class=main>)</span> <span class=main>=</span> moebius_translation <span class=main>(</span><span class=main>-</span><span class=free>v1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_translation_inv_translation><span class=command>lemma</span></span> moebius_translation_inv_translation <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_translation <span class=free>v</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_translation <span class=main>(</span><span class=main>-</span><span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_translation_inv<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>v</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> moebius_translation_inv<span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_inv_translation_translation><span class=command>lemma</span></span> moebius_inv_translation_translation <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_translation <span class=main>(</span><span class=main>-</span><span class=free>v</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_translation <span class=free>v</span><span class=main>)</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_translation_inv<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>v</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> moebius_translation_inv<span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_pt_moebius_translation><span class=command>lemma</span></span> moebius_pt_moebius_translation <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_translation <span class=free>v</span><span class=main>)</span> <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=free>z</span> <span class=main>+</span> <span class=free>v</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_translation_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_pt_moebius_translation_inf><span class=command>lemma</span></span> moebius_pt_moebius_translation_inf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_translation <span class=free>v</span><span class=main>)</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_translation_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Rotation›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_rotation</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>moebius_rotation</span> <span class=free><span class=bound><span class=entity>φ</span></span></span> <span class=main>=</span> moebius_similarity <span class=main>(</span>cis <span class=free><span class=bound><span class=entity>φ</span></span></span><span class=main>)</span> <span class=main>0</span>"</span></span>

<span class=keyword1 id=Moebius-moebius_rotation_comp><span class=command>lemma</span></span> moebius_rotation_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_comp <span class=main>(</span>moebius_rotation <span class=free>φ1</span><span class=main>)</span> <span class=main>(</span>moebius_rotation <span class=free>φ2</span><span class=main>)</span> <span class=main>=</span> moebius_rotation <span class=main>(</span><span class=free>φ1</span> <span class=main>+</span> <span class=free>φ2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def
  <span class=keyword1><span class=command>using</span></span> moebius_similarity_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cis <span class=free>φ1</span>"</span></span> <span class=quoted><span class=quoted>"cis <span class=free>φ2</span>"</span></span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=main>0</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_mult<span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_rotation_plus><span class=command>lemma</span></span> moebius_rotation_plus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>moebius_rotation <span class=free>φ1</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span>moebius_rotation <span class=free>φ2</span><span class=main>)</span> <span class=main>=</span> moebius_rotation <span class=main>(</span><span class=free>φ1</span> <span class=main>+</span> <span class=free>φ2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_rotation_zero><span class=command>lemma</span></span> moebius_rotation_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_rotation <span class=main>0</span> <span class=main>=</span> id_moebius"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def
  <span class=keyword1><span class=command>using</span></span> moebius_similarity_id
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_rotation_inv><span class=command>lemma</span></span> moebius_rotation_inv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_inv <span class=main>(</span>moebius_rotation <span class=free>φ</span><span class=main>)</span> <span class=main>=</span> moebius_rotation <span class=main>(</span><span class=main>-</span> <span class=free>φ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_rotation_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>φ</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>φ</span>"</span></span><span class=main>]</span> moebius_rotation_zero
  <span class=keyword1><span class=command>using</span></span> minus_unique<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_rotation <span class=free>φ</span>"</span></span> <span class=quoted><span class=quoted>"moebius_rotation <span class=main>(</span><span class=main>-</span><span class=free>φ</span><span class=main>)</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_rotation_uminus><span class=command>lemma</span></span> moebius_rotation_uminus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>moebius_rotation <span class=free>φ</span><span class=main>)</span> <span class=main>=</span> moebius_rotation <span class=main>(</span><span class=main>-</span> <span class=free>φ</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
                                                                                          
<span class=keyword1 id=Moebius-moebius_rotation_inv_rotation><span class=command>lemma</span></span> moebius_rotation_inv_rotation <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=free>φ</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_rotation <span class=main>(</span><span class=main>-</span><span class=free>φ</span><span class=main>)</span><span class=main>)</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_rotation_inv<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>φ</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> moebius_rotation_inv<span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_inv_rotation_rotation><span class=command>lemma</span></span> moebius_inv_rotation_rotation <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=main>(</span><span class=main>-</span><span class=free>φ</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_rotation <span class=free>φ</span><span class=main>)</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_rotation_inv<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>φ</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> moebius_rotation_inv<span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_pt_moebius_rotation><span class=command>lemma</span></span> moebius_pt_moebius_rotation <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=free>φ</span><span class=main>)</span> <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span>cis <span class=free>φ</span> <span class=main>*</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_pt_moebius_rotation_inf><span class=command>lemma</span></span> moebius_pt_moebius_rotation_inf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=free>v</span><span class=main>)</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_pt_rotation_inf_iff><span class=command>lemma</span></span> moebius_pt_rotation_inf_iff <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=free>v</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def
  <span class=keyword1><span class=command>using</span></span> cis_neq_zero moebius_similarity_only_inf_to_inf
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> moebius_pt_moebius_similarity<span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_pt_moebius_rotation_zero><span class=command>lemma</span></span> moebius_pt_moebius_rotation_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=free>φ</span><span class=main>)</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def 
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_pt_moebius_rotation_zero_iff><span class=command>lemma</span></span> moebius_pt_moebius_rotation_zero_iff <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=free>φ</span><span class=main>)</span> <span class=free>x</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_pt_invert<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_rotation <span class=free>φ</span>"</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Moebius-moebius_rotation_preserve_cmod><span class=command>lemma</span></span> moebius_rotation_preserve_cmod <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span>to_complex <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_rotation <span class=free>φ</span><span class=main>)</span> <span class=free>u</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> cmod <span class=main>(</span>to_complex <span class=free>u</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>u</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> norm_mult<span class=main>)</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Dilatation›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_dilatation</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>moebius_dilatation</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>=</span> moebius_similarity <span class=main>(</span>cor <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>)</span> <span class=main>0</span>"</span></span>

<span class=keyword1 id=Moebius-moebius_dilatation_comp><span class=command>lemma</span></span> moebius_dilatation_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a1</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_comp <span class=main>(</span>moebius_dilatation <span class=free>a1</span><span class=main>)</span> <span class=main>(</span>moebius_dilatation <span class=free>a2</span><span class=main>)</span> <span class=main>=</span> moebius_dilatation <span class=main>(</span><span class=free>a1</span> <span class=main>*</span> <span class=free>a2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms                                  
  <span class=keyword1><span class=command>unfolding</span></span> moebius_dilatation_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_dilatation_plus><span class=command>lemma</span></span> moebius_dilatation_plus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a1</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>moebius_dilatation <span class=free>a1</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span>moebius_dilatation <span class=free>a2</span><span class=main>)</span> <span class=main>=</span> moebius_dilatation <span class=main>(</span><span class=free>a1</span> <span class=main>*</span> <span class=free>a2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_dilatation_zero><span class=command>lemma</span></span> moebius_dilatation_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_dilatation <span class=main>1</span> <span class=main>=</span> id_moebius"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_dilatation_def
  <span class=keyword1><span class=command>using</span></span> moebius_similarity_id
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_dilatation_inverse><span class=command>lemma</span></span> moebius_dilatation_inverse <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_inv <span class=main>(</span>moebius_dilatation <span class=free>a</span><span class=main>)</span> <span class=main>=</span> moebius_dilatation <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> moebius_dilatation_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_dilatation_uminus><span class=command>lemma</span></span> moebius_dilatation_uminus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>moebius_dilatation <span class=free>a</span><span class=main>)</span> <span class=main>=</span> moebius_dilatation <span class=main>(</span><span class=main>1</span><span class=main>/</span><span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-moebius_pt_dilatation><span class=command>lemma</span></span> moebius_pt_dilatation <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_dilatation <span class=free>a</span><span class=main>)</span> <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span>cor <span class=free>a</span> <span class=main>*</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> moebius_dilatation_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Rotation-dilatation›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_rotation_dilatation</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>moebius_rotation_dilatation</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>=</span> moebius_similarity <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>0</span>"</span></span>

<span class=keyword1 id=Moebius-moebius_rotation_dilatation><span class=command>lemma</span></span> moebius_rotation_dilatation<span class=main>:</span>                                     
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_rotation_dilatation <span class=free>a</span> <span class=main>=</span> moebius_rotation <span class=main>(</span>arg <span class=free>a</span><span class=main>)</span> <span class=main>+</span> moebius_dilatation <span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_dilatation_def moebius_rotation_def moebius_dilatation_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Conjugate Möbius›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Conjugation is not a Möbius transformation, and conjugate Möbius transformations (obtained
by conjugating each matrix element) do not represent conjugation function (although they are
somewhat related).›</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> conjugate_moebius_mmat <span class=main>::</span> <span class=quoted><span class=quoted>"moebius_mat <span class=main>⇒</span> moebius_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mat_cnj</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>lift_definition</span></span> conjugate_moebius <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> moebius"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>conjugate_moebius_mmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Moebius-conjugate_moebius><span class=command>lemma</span></span> conjugate_moebius<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>∘</span> moebius_pt <span class=free>M</span> <span class=main>=</span> moebius_pt <span class=main>(</span>conjugate_moebius <span class=free>M</span><span class=main>)</span> <span class=main>∘</span> conjugate"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> vec_cnj_mult_mv <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>


<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Decomposition of M\"obius transformations›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Every Euclidean similarity can be decomposed using translations, rotations, and dilatations.›</span></span>
<span class=keyword1 id=Moebius-similarity_decomposition><span class=command>lemma</span></span> similarity_decomposition<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_similarity <span class=free>a</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span>moebius_translation <span class=free>b</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span>moebius_rotation <span class=main>(</span>arg <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span>moebius_dilatation <span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"moebius_similarity <span class=free>a</span> <span class=free>b</span> <span class=main>=</span> <span class=main>(</span>moebius_translation <span class=free>b</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span>moebius_rotation_dilatation <span class=free>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_dilatation_def moebius_translation_def moebius_similarity_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_rotation_dilatation <span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add.assoc <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> plus_moebius_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹A very important fact is that every Möbius transformation can be
composed of Euclidean similarities and a reciprocation.›</span></span>
<span class=keyword1 id=Moebius-moebius_decomposition><span class=command>lemma</span></span> moebius_decomposition<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span><span class=main>*</span><span class=free>d</span> <span class=main>-</span> <span class=free>b</span><span class=main>*</span><span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mk_moebius <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>d</span> <span class=main>=</span>
             moebius_translation <span class=main>(</span><span class=free>a</span><span class=main>/</span><span class=free>c</span><span class=main>)</span> <span class=main>+</span>
             moebius_rotation_dilatation <span class=main>(</span><span class=main>(</span><span class=free>b</span><span class=main>*</span><span class=free>c</span> <span class=main>-</span> <span class=free>a</span><span class=main>*</span><span class=free>d</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>c</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span>
             moebius_reciprocal <span class=main>+</span>
             moebius_translation <span class=main>(</span><span class=free>d</span><span class=main>/</span><span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_dilatation_def moebius_translation_def moebius_similarity_def plus_moebius_def moebius_reciprocal_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=improper>c</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Moebius-moebius_decomposition_similarity><span class=command>lemma</span></span> moebius_decomposition_similarity<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mk_moebius <span class=free>a</span> <span class=free>b</span> <span class=main>0</span> <span class=free>d</span> <span class=main>=</span> moebius_similarity <span class=main>(</span><span class=free>a</span><span class=main>/</span><span class=free>d</span><span class=main>)</span> <span class=main>(</span><span class=free>b</span><span class=main>/</span><span class=free>d</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> moebius_similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=improper>d</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Decomposition is used in many proofs. Namely, to show that every Möbius transformation has
some property, it suffices to show that reciprocation and all Euclidean similarities have that
property, and that the property is preserved under compositions.›</span></span>
<span class=keyword1 id=Moebius-wlog_moebius_decomposition><span class=command>lemma</span></span> wlog_moebius_decomposition<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    trans<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>v</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span>moebius_translation <span class=bound>v</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    rot<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>α</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span>moebius_rotation <span class=bound>α</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    dil<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>k</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span>moebius_dilatation <span class=bound>k</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    recip<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span>moebius_reciprocal<span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    comp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>M1</span> <span class=bound>M2</span><span class=main>.</span> <span class=main>⟦</span><span class=free>P</span> <span class=bound>M1</span><span class=main>;</span> <span class=free>P</span> <span class=bound>M2</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>M1</span> <span class=main>+</span> <span class=bound>M2</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>M</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> mk_moebius <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span> <span class=skolem>d</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ex_mk_moebius<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> moebius_decomposition<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>c</span></span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>d</span></span> <span class=quoted><span class=skolem>b</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>c</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>M</span> <span class=main>=</span> mk_moebius <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span> <span class=skolem>d</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> moebius_rotation_dilatation<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>b</span><span class=main>*</span><span class=skolem>c</span> <span class=main>-</span> <span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>c</span><span class=main>*</span><span class=skolem>c</span><span class=main>)</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> trans<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span><span class=main>/</span><span class=skolem>c</span>"</span></span><span class=main>]</span> rot<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=main>(</span><span class=skolem>b</span><span class=main>*</span><span class=skolem>c</span> <span class=main>-</span> <span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>c</span><span class=main>*</span><span class=skolem>c</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span> dil<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=main>(</span><span class=skolem>b</span><span class=main>*</span><span class=skolem>c</span> <span class=main>-</span> <span class=skolem>a</span><span class=main>*</span><span class=skolem>d</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>c</span><span class=main>*</span><span class=skolem>c</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span> recip
        <span class=keyword1><span class=command>using</span></span> comp
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> trans<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> moebius_similarity <span class=main>(</span><span class=skolem>a</span><span class=main>/</span><span class=skolem>d</span><span class=main>)</span> <span class=main>(</span><span class=skolem>b</span><span class=main>/</span><span class=skolem>d</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>M</span> <span class=main>=</span> mk_moebius <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span> <span class=skolem>d</span>›</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> moebius_decomposition_similarity
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>c</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> similarity_decomposition<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span><span class=main>/</span><span class=skolem>d</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>b</span><span class=main>/</span><span class=skolem>d</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> trans<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>b</span><span class=main>/</span><span class=skolem>d</span>"</span></span><span class=main>]</span> rot<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=main>(</span><span class=skolem>a</span><span class=main>/</span><span class=skolem>d</span><span class=main>)</span>"</span></span><span class=main>]</span> dil<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=skolem>a</span><span class=main>/</span><span class=skolem>d</span><span class=main>)</span>"</span></span><span class=main>]</span> comp
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Cross ratio and Möbius existence›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹For any fixed three points $z1$, $z2$ and $z3$, <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=free><span class=free>z</span></span> <span class=free><span class=free>z1</span></span> <span class=free><span class=free>z2</span></span> <span class=free><span class=free>z3</span></span>"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> can be seen as
a function of a single variable $z$.›</span></span>


<span class=keyword1 id=Moebius-is_moebius_cross_ratio><span class=command>lemma</span></span> is_moebius_cross_ratio<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>  <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_moebius <span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> <span class=main>∀</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span> <span class=main>=</span> moebius_pt <span class=bound>M</span> <span class=bound>z</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z1</span> <span class=skolem>z2</span> <span class=skolem>z3</span>
    <span class=keyword3><span class=command>assume</span></span> vz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z3</span> <span class=main>≠</span> vec_zero"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1'</span></span> <span class=skolem><span class=skolem>z1''</span></span> <span class=keyword2><span class=keyword>where</span></span> zz1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1'</span><span class=main>,</span> <span class=skolem>z1''</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z2'</span></span> <span class=skolem><span class=skolem>z2''</span></span> <span class=keyword2><span class=keyword>where</span></span> zz2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z2'</span><span class=main>,</span> <span class=skolem>z2''</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z2</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z3'</span></span> <span class=skolem><span class=skolem>z3''</span></span> <span class=keyword2><span class=keyword>where</span></span> zz3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z3</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z3'</span><span class=main>,</span> <span class=skolem>z3''</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z3</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m23</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z2'</span><span class=main>*</span><span class=skolem>z3''</span><span class=main>-</span><span class=skolem>z3'</span><span class=main>*</span><span class=skolem>z2''</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m21</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z2'</span><span class=main>*</span><span class=skolem>z1''</span><span class=main>-</span><span class=skolem>z1'</span><span class=main>*</span><span class=skolem>z2''</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m13</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z1'</span><span class=main>*</span><span class=skolem>z3''</span><span class=main>-</span><span class=skolem>z3'</span><span class=main>*</span><span class=skolem>z1''</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>z1''</span><span class=main>*</span><span class=var>?m23</span><span class=main>,</span> <span class=main>-</span><span class=skolem>z1'</span><span class=main>*</span><span class=var>?m23</span><span class=main>,</span> <span class=skolem>z3''</span><span class=main>*</span><span class=var>?m21</span><span class=main>,</span> <span class=main>-</span><span class=skolem>z3'</span><span class=main>*</span><span class=var>?m21</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>z1</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>z2</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z3</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>z1</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z3</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?m23</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?m21</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?m13</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> vz zz1 zz2 zz3
      <span class=keyword1><span class=command>using</span></span> complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z1'</span></span> <span class=quoted><span class=skolem>z1''</span></span> <span class=quoted><span class=skolem>z2'</span></span> <span class=quoted><span class=skolem>z2''</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z1'</span></span> <span class=quoted><span class=skolem>z1''</span></span> <span class=quoted><span class=skolem>z3'</span></span> <span class=quoted><span class=skolem>z3''</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z2'</span></span> <span class=quoted><span class=skolem>z2''</span></span> <span class=quoted><span class=skolem>z3'</span></span> <span class=quoted><span class=skolem>z3''</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> complex_cvec_eq_def <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_det <span class=var>?M</span> <span class=main>=</span> <span class=var>?m21</span><span class=main>*</span><span class=var>?m23</span><span class=main>*</span><span class=var>?m13</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_det <span class=var>?M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>z</span><span class=main>∈</span><span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span><span class=main>.</span> cross_ratio_cvec <span class=bound>z</span> <span class=skolem>z1</span> <span class=skolem>z2</span> <span class=skolem>z3</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> moebius_pt_cmat_cvec <span class=var>?M</span> <span class=bound>z</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z'</span></span> <span class=skolem><span class=skolem>z''</span></span> <span class=keyword2><span class=keyword>where</span></span> zz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z'</span><span class=main>,</span> <span class=skolem>z''</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m01</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span><span class=main>*</span><span class=skolem>z1''</span><span class=main>-</span><span class=skolem>z1'</span><span class=main>*</span><span class=skolem>z''</span>"</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?m03</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span><span class=main>*</span><span class=skolem>z3''</span><span class=main>-</span><span class=skolem>z3'</span><span class=main>*</span><span class=skolem>z''</span>"</span></span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?m01</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=var>?m03</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z''</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>z1''</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>z3''</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>≠</span> vec_zero›</span></span>  zz
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword1><span class=command>hence</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z''</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>z1''</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>z3''</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=var>?thesis</span>"</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>*</span> <span class=skolem>z1''</span> <span class=main>-</span> <span class=skolem>z1'</span> <span class=main>*</span> <span class=skolem>z''</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>*</span> <span class=skolem>z3''</span> <span class=main>-</span> <span class=skolem>z3'</span> <span class=main>*</span> <span class=skolem>z''</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z1'</span><span class=main>/</span><span class=skolem>z1''</span> <span class=main>=</span> <span class=skolem>z3'</span><span class=main>/</span><span class=skolem>z3''</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> 1 zz <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>≠</span> vec_zero›</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> frac_eq_eq right_minus_eq<span class=main>)</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
            <span class=keyword1><span class=command>using</span></span> * 1
            <span class=keyword1><span class=command>using</span></span> frac_eq_eq
            <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>note</span></span> * <span class=main>=</span> * this
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"cross_ratio_cvec <span class=skolem>z</span> <span class=skolem>z1</span> <span class=skolem>z2</span> <span class=skolem>z3</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> moebius_pt_cmat_cvec <span class=var>?M</span> <span class=skolem>z</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> * zz zz1 zz2 zz3 mult_mv_nonzero<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span>"</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹mat_det <span class=var>?M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>M</span><span class=main>∈</span><span class=main>{</span><span class=bound>M</span><span class=main>.</span> mat_det <span class=bound>M</span> <span class=main>≠</span> <span class=main>0</span><span class=main>}</span><span class=main>.</span>
              <span class=main>∀</span><span class=bound>z</span><span class=main>∈</span><span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span><span class=main>.</span> cross_ratio_cvec <span class=bound>z</span> <span class=skolem>z1</span> <span class=skolem>z2</span> <span class=skolem>z3</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> moebius_pt_cmat_cvec <span class=bound>M</span> <span class=bound>z</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_moebius_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Using properties of the cross-ratio, it is shown that there is a Möbius transformation
mapping any three different points to $0_{hc}$, $1_{hc}$ and $\infty_{hc}$, respectively.›</span></span>
<span class=keyword1 id=Moebius-ex_moebius_01inf><span class=command>lemma</span></span> ex_moebius_01inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=free>z1</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=free>z3</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> is_moebius_cross_ratio<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> cross_ratio_0<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span> cross_ratio_1<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span> cross_ratio_inf<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> is_moebius_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹There is a Möbius transformation mapping any three different points to any three different
points.›</span></span>
<span class=keyword1 id=Moebius-ex_moebius><span class=command>lemma</span></span> ex_moebius<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> 
          <span class=quoted><span class=quoted>"<span class=free>w1</span> <span class=main>≠</span> <span class=free>w2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>w1</span> <span class=main>≠</span> <span class=free>w3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>w2</span> <span class=main>≠</span> <span class=free>w3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>w1</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>w2</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>w3</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M1</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M1</span> <span class=free>z1</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> moebius_pt <span class=skolem>M1</span> <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> moebius_pt <span class=skolem>M1</span> <span class=free>z3</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_moebius_01inf<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1-3<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M2</span></span> <span class=keyword2><span class=keyword>where</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M2</span> <span class=free>w1</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> moebius_pt <span class=skolem>M2</span> <span class=free>w2</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> moebius_pt <span class=skolem>M2</span> <span class=free>w3</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_moebius_01inf<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>4-6<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_comp <span class=main>(</span>moebius_inv <span class=skolem>M2</span><span class=main>)</span> <span class=skolem>M1</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> * **
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?M</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> moebius_pt_invert<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-ex_moebius_1><span class=command>lemma</span></span> ex_moebius_1<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> moebius_pt <span class=bound>M</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>w1</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=skolem><span class=skolem>z3</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=skolem>z2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=skolem>z3</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>≠</span> <span class=skolem>z3</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_3_different_points<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>w2</span></span> <span class=skolem><span class=skolem>w3</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>w1</span> <span class=main>≠</span> <span class=skolem>w2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>w1</span> <span class=main>≠</span> <span class=skolem>w3</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w2</span> <span class=main>≠</span> <span class=skolem>w3</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_3_different_points<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w1</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> ex_moebius<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=skolem>z2</span></span> <span class=quoted><span class=skolem>z3</span></span> <span class=quoted><span class=free>w1</span></span> <span class=quoted><span class=skolem>w2</span></span> <span class=quoted><span class=skolem>w3</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The next lemma turns out to have very important applications in further proof development, as
it enables so called ,,without-loss-of-generality (wlog)'' reasoning \cite{wlog}. Namely, if the
property is preserved under Möbius transformations, then instead of three arbitrary different
points one can consider only the case of points $0_{hc}$, $1_{hc}$, and $\infty_{hc}$.›</span></span>
<span class=keyword1 id=Moebius-wlog_moebius_01inf><span class=command>lemma</span></span> wlog_moebius_01inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>M</span><span class=main>::</span><span class=quoted>moebius</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span>
   <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>M</span> <span class=bound>a</span> <span class=bound>b</span> <span class=bound>c</span><span class=main>.</span> <span class=free>P</span> <span class=bound>a</span> <span class=bound>b</span> <span class=bound>c</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=bound>a</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=bound>b</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=bound>c</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span>
    <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>z1</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>  <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>   <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>z3</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_moebius_01inf<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=free>z3</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>z1</span>"</span></span>  <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>z2</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>z3</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Fixed points and Möbius transformation uniqueness›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1 id=Moebius-three_fixed_points_01inf><span class=command>lemma</span></span> three_fixed_points_01inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> id_moebius"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Moebius-three_fixed_points><span class=command>lemma</span></span> three_fixed_points<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>z1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>z3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> id_moebius"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M'</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M'</span> <span class=free>z1</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>  <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M'</span> <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>   <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M'</span> <span class=free>z3</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_moebius_01inf<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span> <span class=quoted><span class=free>z2</span></span> <span class=quoted><span class=free>z3</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=skolem>M'</span><span class=main>)</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>z1</span>"</span></span>  <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=skolem>M'</span><span class=main>)</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>z2</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=skolem>M'</span><span class=main>)</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>z3</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M'</span> <span class=main>+</span> <span class=free>M</span> <span class=main>+</span> <span class=main>(</span><span class=main>-</span><span class=skolem>M'</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> zero_moebius_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> three_fixed_points_01inf<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> * ** assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> moebius_comp<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> eq_neg_iff_add_eq_0 minus_add_cancel zero_moebius_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-unique_moebius_three_points><span class=command>lemma</span></span> unique_moebius_three_points<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M1</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>w1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M1</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>w2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M1</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>w3</span>"</span></span>
          <span class=quoted><span class=quoted>"moebius_pt <span class=free>M2</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>w1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M2</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>w2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M2</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>w3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>M1</span> <span class=main>=</span> <span class=free>M2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_comp <span class=main>(</span>moebius_inv <span class=free>M2</span><span class=main>)</span> <span class=free>M1</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=var>?M</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>z1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹moebius_pt <span class=free>M1</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>w1</span>›</span></span> <span class=quoted><span class=quoted>‹moebius_pt <span class=free>M2</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>w1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> moebius_pt_invert<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=var>?M</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>z2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹moebius_pt <span class=free>M1</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>w2</span>›</span></span> <span class=quoted><span class=quoted>‹moebius_pt <span class=free>M2</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>w2</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> moebius_pt_invert<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=var>?M</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>z3</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹moebius_pt <span class=free>M1</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>w3</span>›</span></span> <span class=quoted><span class=quoted>‹moebius_pt <span class=free>M2</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>w3</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> moebius_pt_invert<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=main>=</span> id_moebius"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms three_fixed_points
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_minus_cancel left_minus plus_moebius_def uminus_moebius_def zero_moebius_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹There is a unique Möbius transformation mapping three different points to other three
different points.›</span></span>

<span class=keyword1 id=Moebius-ex_unique_moebius_three_points><span class=command>lemma</span></span> ex_unique_moebius_three_points<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> 
          <span class=quoted><span class=quoted>"<span class=free>w1</span> <span class=main>≠</span> <span class=free>w2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>w1</span> <span class=main>≠</span> <span class=free>w3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>w2</span> <span class=main>≠</span> <span class=free>w3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>M</span><span class=main>.</span> <span class=main>(</span><span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>w1</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>w2</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>w3</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>w1</span> <span class=main>∧</span> moebius_pt <span class=skolem>M</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>w2</span> <span class=main>∧</span> moebius_pt <span class=skolem>M</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>w3</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_moebius<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> Ex1_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>M</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span><span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>y</span><span class=main>.</span> moebius_pt <span class=bound>y</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>w1</span> <span class=main>∧</span> moebius_pt <span class=bound>y</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>w2</span> <span class=main>∧</span> moebius_pt <span class=bound>y</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>w3</span> <span class=main>⟶</span> <span class=bound>y</span> <span class=main>=</span> <span class=skolem>M</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>using</span></span> unique_moebius_three_points<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1-3<span class=main><span class=main>)</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> *<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-ex_unique_moebius_three_points_fun><span class=command>lemma</span></span> ex_unique_moebius_three_points_fun<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> 
          <span class=quoted><span class=quoted>"<span class=free>w1</span> <span class=main>≠</span> <span class=free>w2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>w1</span> <span class=main>≠</span> <span class=free>w3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>w2</span> <span class=main>≠</span> <span class=free>w3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>f</span><span class=main>.</span> is_moebius <span class=bound>f</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>f</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>w1</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>f</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>w2</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>f</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>w3</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>z1</span> <span class=main>=</span> <span class=free>w1</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>z2</span> <span class=main>=</span> <span class=free>w2</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>z3</span> <span class=main>=</span> <span class=free>w3</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_unique_moebius_three_points<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> ex_unique_moebius_three_points<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> Ex1_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_moebius_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Different Möbius transformations produce different actions.›</span></span>
<span class=keyword1 id=Moebius-unique_moebius_pt><span class=command>lemma</span></span> unique_moebius_pt<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M1</span> <span class=main>=</span> moebius_pt <span class=free>M2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>M1</span> <span class=main>=</span> <span class=free>M2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms unique_moebius_three_points<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Moebius-is_cross_ratio_01inf><span class=command>lemma</span></span> is_cross_ratio_01inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_moebius <span class=free>f</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=free>z1</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=free>z2</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=free>z3</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> cross_ratio_0<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span> cross_ratio_1<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span> cross_ratio_inf<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> is_moebius_cross_ratio<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> ex_unique_moebius_three_points_fun<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius transformations preserve cross-ratio.›</span></span>
<span class=keyword1 id=Moebius-moebius_preserve_cross_ratio><span class=command>lemma</span></span> moebius_preserve_cross_ratio <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=free>z</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=free>z1</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=free>z2</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=free>z3</span><span class=main>)</span> <span class=main>=</span>
         cross_ratio <span class=free>z</span> <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?iM</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"inv <span class=var>?M</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> bij_moebius_pt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span> cross_ratio_0<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bij_def<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> bij_moebius_pt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>  cross_ratio_1<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bij_def<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z3</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> bij_moebius_pt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span> cross_ratio_inf<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bij_def<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_moebius <span class=main>(</span><span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> is_moebius_comp<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> is_moebius_cross_ratio<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> is_moebius_inv<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_moebius_def<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z1</span> <span class=main>≠</span> <span class=var>?M</span> <span class=free>z2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z1</span> <span class=main>≠</span> <span class=var>?M</span> <span class=free>z3</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z2</span> <span class=main>≠</span> <span class=var>?M</span> <span class=free>z3</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z1</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z2</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z3</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> is_cross_ratio_01inf<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z3</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> cross_ratio <span class=free>z</span> <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> bij_moebius_pt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bij_def<span class=main>)</span>                             
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z1</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z2</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z3</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> cross_ratio <span class=main>(</span><span class=var>?M</span> <span class=free>z</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z1</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z2</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z3</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-conjugate_cross_ratio><span class=command>lemma</span></span> conjugate_cross_ratio <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>                                  
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=main>(</span>conjugate <span class=free>z</span><span class=main>)</span> <span class=main>(</span>conjugate <span class=free>z1</span><span class=main>)</span> <span class=main>(</span>conjugate <span class=free>z2</span><span class=main>)</span> <span class=main>(</span>conjugate <span class=free>z3</span><span class=main>)</span> <span class=main>=</span>
         conjugate <span class=main>(</span>cross_ratio <span class=free>z</span> <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?f</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"conjugate"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?iM</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"conjugate"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>conjugate <span class=main>∘</span> <span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cross_ratio_0<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>conjugate <span class=main>∘</span> <span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cross_ratio_1<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>conjugate <span class=main>∘</span> <span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z3</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> cross_ratio_inf<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_moebius <span class=main>(</span>conjugate <span class=main>∘</span> <span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=var>?f</span> <span class=main>=</span> moebius_pt <span class=skolem>M</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> is_moebius_cross_ratio<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z3</span>›</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_moebius_def<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> conjugate_moebius<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> comp_assoc is_moebius_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z1</span> <span class=main>≠</span> <span class=var>?M</span> <span class=free>z2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z1</span> <span class=main>≠</span> <span class=var>?M</span> <span class=free>z3</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z2</span> <span class=main>≠</span> <span class=var>?M</span> <span class=free>z3</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> conjugate_inj<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>∘</span> <span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z1</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z2</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z3</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> is_cross_ratio_01inf<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=free>z3</span>"</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>∘</span> <span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>conjugate <span class=main>∘</span> <span class=var>?f</span> <span class=main>∘</span> <span class=var>?iM</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> conjugate <span class=main>(</span>cross_ratio <span class=free>z</span> <span class=free>z1</span> <span class=free>z2</span> <span class=free>z3</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z1</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z2</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z3</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z</span><span class=main>)</span> <span class=main>=</span> cross_ratio <span class=main>(</span><span class=var>?M</span> <span class=free>z</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z1</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z2</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=free>z3</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-cross_ratio_reciprocal><span class=command>lemma</span></span> cross_ratio_reciprocal <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> <span class=free>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=main>(</span>reciprocal <span class=free>z</span><span class=main>)</span> <span class=main>(</span>reciprocal <span class=free>u</span><span class=main>)</span> <span class=main>(</span>reciprocal <span class=free>v</span><span class=main>)</span> <span class=main>(</span>reciprocal <span class=free>w</span><span class=main>)</span> <span class=main>=</span> 
         cross_ratio <span class=free>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> moebius_reciprocal<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> moebius_reciprocal<span class=main>)</span>                           

<span class=keyword1 id=Moebius-cross_ratio_inversion><span class=command>lemma</span></span> cross_ratio_inversion <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> <span class=free>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=main>(</span>inversion <span class=free>z</span><span class=main>)</span> <span class=main>(</span>inversion <span class=free>u</span><span class=main>)</span> <span class=main>(</span>inversion <span class=free>v</span><span class=main>)</span> <span class=main>(</span>inversion <span class=free>w</span><span class=main>)</span> <span class=main>=</span> 
         conjugate <span class=main>(</span>cross_ratio <span class=free>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>                                               
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"reciprocal <span class=free>u</span> <span class=main>≠</span> reciprocal <span class=free>v</span>"</span></span> <span class=quoted><span class=quoted>"reciprocal <span class=free>u</span> <span class=main>≠</span> reciprocal <span class=free>w</span>"</span></span> <span class=quoted><span class=quoted>"reciprocal <span class=free>v</span> <span class=main>≠</span> reciprocal <span class=free>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=main>(</span><span class=operator>subst</span> moebius_reciprocal<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> moebius_reciprocal<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> inversion_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1 id="Moebius-fixed_points_0inf'"><span class=command>lemma</span></span> fixed_points_0inf'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>complex_homo<span class=main>.</span> <span class=main>(</span><span class=bound>k</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> <span class=bound>k</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=main>∀</span> <span class=bound>z</span><span class=main>.</span> moebius_pt <span class=free>M</span> <span class=bound>z</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=bound>z</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> MM<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>M</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>c</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>d</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> MM
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?z</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?z</span> <span class=main>≠</span> vec_zero"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=var>?z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>∧</span> <span class=main>¬</span> <span class=var>?z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>z</span><span class=main>∈</span><span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span><span class=main>.</span> moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=bound>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=var>?z</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=bound>z</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> MM <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>∈</span><span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span><span class=main>.</span>
                   <span class=main>(</span><span class=main>¬</span> <span class=bound>k</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>∧</span> <span class=main>¬</span> <span class=bound>k</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span><span class=main>)</span> <span class=main>∧</span>
                   <span class=main>(</span><span class=main>∀</span><span class=bound>z</span><span class=main>∈</span><span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span><span class=main>.</span> moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=bound>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub></span> <span class=bound>z</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-fixed_points_0inf><span class=command>lemma</span></span> fixed_points_0inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>complex_homo<span class=main>.</span> <span class=main>(</span><span class=bound>k</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> <span class=bound>k</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>)</span> <span class=main>∧</span> moebius_pt <span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>h</sub></span> <span class=bound>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> fixed_points_0inf'<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Moebius-ex_cross_ratio><span class=command>lemma</span></span> ex_cross_ratio<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>=</span> <span class=free>c</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> moebius_pt <span class=skolem>M</span>"</span></span>    
    <span class=keyword1><span class=command>using</span></span> assms is_moebius_cross_ratio<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>u</span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=free>w</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> is_moebius_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>=</span> moebius_pt <span class=skolem>M</span> <span class=bound>z</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?z</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span><span class=main>-</span><span class=skolem>M</span><span class=main>)</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=var>?z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>=</span> <span class=free>c</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-unique_cross_ratio><span class=command>lemma</span></span> unique_cross_ratio<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> <span class=free>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cross_ratio <span class=free>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>=</span> cross_ratio <span class=free>z'</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=free>z'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>λ</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span><span class=main>)</span> <span class=main>=</span> moebius_pt <span class=skolem>M</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> is_moebius_cross_ratio<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1-3<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> is_moebius_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>z</span> <span class=main>=</span> moebius_pt <span class=skolem>M</span> <span class=free>z'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>4<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_pt_eq_I
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-ex1_cross_ratio><span class=command>lemma</span></span> ex1_cross_ratio<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>w</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> <span class=free>w</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>z</span><span class=main>.</span> cross_ratio <span class=bound>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span> <span class=main>=</span> <span class=free>c</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms ex_cross_ratio<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>c</span></span><span class=main>]</span> unique_cross_ratio<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>u</span></span> <span class=quoted><span class=free>v</span></span> <span class=quoted><span class=free>w</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Pole›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_pole</span> <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> complex_homo <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>is_pole</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>⟷</span> moebius_pt <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>

<span class=keyword1 id=Moebius-ex1_pole><span class=command>lemma</span></span> ex1_pole<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>z</span><span class=main>.</span> is_pole <span class=free>M</span> <span class=bound>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> bij_moebius_pt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> is_pole_def bij_def inj_on_def surj_def
  <span class=keyword1><span class=command>unfolding</span></span> Ex1_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> UNIV_I<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>pole</span> <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> complex_homo"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>pole</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>z</span><span class=main>.</span> is_pole <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=bound>z</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Moebius-pole_mk_moebius><span class=command>lemma</span></span> pole_mk_moebius<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_pole <span class=main>(</span>mk_moebius <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>d</span><span class=main>)</span> <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span><span class=main>*</span><span class=free>d</span> <span class=main>-</span> <span class=free>b</span><span class=main>*</span><span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=main>-</span><span class=free>d</span><span class=main>/</span><span class=free>c</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_translation <span class=main>(</span><span class=free>a</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?rd</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_rotation_dilatation <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>*</span> <span class=free>c</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> <span class=free>d</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=free>c</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?r</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_reciprocal"</span></span>                                                 
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_translation <span class=main>(</span><span class=free>d</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span><span class=var>?rd</span> <span class=main>+</span> <span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> is_pole_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> moebius_decomposition<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> moebius_comp<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> moebius_translation_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> moebius_similarity_only_inf_to_inf<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=main><span class=quoted><span class=main>1</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free>a</span></span><span class=main><span class=main>/</span></span><span class=free><span class=free>c</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span><span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span><span class=main>*</span><span class=free>d</span> <span class=main>-</span> <span class=free>b</span><span class=main>*</span><span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_dilatation_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> moebius_pt_moebius_similarity<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=var>?t2</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_pt_invert<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?t2</span></span></span> <span class=quoted><span class=free>z</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> of_complex_zero<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> of_complex_zero<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-pole_similarity><span class=command>lemma</span></span> pole_similarity<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_pole <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> is_pole_def
  <span class=keyword1><span class=command>using</span></span> moebius_similarity_only_inf_to_inf<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Homographies and antihomographies›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Inversion is not a Möbius transformation (it is a canonical example of so called
anti-Möbius transformations, or antihomographies). All antihomographies are compositions of
homographies and conjugation. The fundamental theorem of projective geometry (that we shall not
prove) states that all automorphisms (bijective functions that preserve the cross-ratio) of
$\mathbb{C}P^1$ are either homographies or antihomographies.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_homography</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>complex_homo <span class=main>⇒</span> complex_homo<span class=main>)</span> <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>is_homography</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>⟷</span> is_moebius <span class=free><span class=bound><span class=entity>f</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_antihomography</span> <span class=main>::</span> <span class=quoted><span class=quoted>"<span class=main>(</span>complex_homo <span class=main>⇒</span> complex_homo<span class=main>)</span> <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=quoted><span class=quoted>"<span class=free>is_antihomography</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>f'</span><span class=main>.</span> is_moebius <span class=bound>f'</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> <span class=bound>f'</span> <span class=main>∘</span> conjugate<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Conjugation is not a Möbius transformation, but is antihomograhpy.›</span></span>
<span class=keyword1 id=Moebius-not_moebius_conjugate><span class=command>lemma</span></span> not_moebius_conjugate<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> is_moebius conjugate"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"is_moebius conjugate"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=main>=</span> conjugate"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> is_moebius_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>=</span> id_moebius"</span></span>
    <span class=keyword1><span class=command>using</span></span> three_fixed_points_01inf
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>=</span> id"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"conjugate <span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>≠</span> <span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> of_complex_inj<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>𝗂</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=keyword1>𝗂</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> of_complex_ii<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> of_complex_ii<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted>False</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-conjugation_is_antihomography><span class=command>lemma</span></span> conjugation_is_antihomography<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_antihomography conjugate"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> is_antihomography_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"id"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> fun.map_id0 id_apply is_moebius_def moebius_pt_moebius_id<span class=main>)</span>

<span class=keyword1 id=Moebius-inversion_is_antihomography><span class=command>lemma</span></span> inversion_is_antihomography <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_antihomography inversion"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_reciprocal
  <span class=keyword1><span class=command>unfolding</span></span> inversion_sym is_antihomography_def is_moebius_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Functions cannot simultaneously be homographies and antihomographies - the disjunction is exclusive.›</span></span>
<span class=keyword1 id=Moebius-homography_antihomography_exclusive><span class=command>lemma</span></span> homography_antihomography_exclusive<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_antihomography <span class=free>f</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> is_homography <span class=free>f</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"is_homography <span class=free>f</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> moebius_pt <span class=skolem>M</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> is_homography_def is_moebius_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=main>=</span> moebius_pt <span class=skolem>M'</span> <span class=main>∘</span> conjugate"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> is_antihomography_def is_moebius_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>=</span> moebius_pt <span class=main>(</span><span class=main>-</span><span class=skolem>M'</span><span class=main>)</span> <span class=main>∘</span> moebius_pt <span class=skolem>M</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>=</span> moebius_pt <span class=main>(</span><span class=main>-</span><span class=skolem>M'</span> <span class=main>+</span> <span class=skolem>M</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> moebius_comp<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
    <span class=keyword1><span class=command>using</span></span> not_moebius_conjugate
    <span class=keyword1><span class=command>unfolding</span></span> is_moebius_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Classification of Möbius transformations›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius transformations can be classified to parabolic, elliptic and loxodromic. We do not
develop this part of the theory in depth.›</span></span>

<span class=keyword1 id=Moebius-similarity_scale_1><span class=command>lemma</span></span> similarity_scale_1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"similarity <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>I</span><span class=main>)</span> <span class=free>M</span> <span class=main>=</span> similarity <span class=free>I</span> <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> similarity_def
  <span class=keyword1><span class=command>using</span></span> mat_inv_mult_sm<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>k</span></span> <span class=quoted><span class=free>I</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Moebius-similarity_scale_2><span class=command>lemma</span></span> similarity_scale_2<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"similarity <span class=free>I</span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>similarity <span class=free>I</span> <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Moebius-mat_trace_mult_sm><span class=command>lemma</span></span> mat_trace_mult_sm <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_trace <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> mat_trace <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_mb_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>moebius_mb_cmat</span> <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>=</span> similarity <span class=free><span class=bound><span class=entity>I</span></span></span> <span class=free><span class=bound><span class=entity>M</span></span></span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_mb_mmat <span class=main>::</span> <span class=quoted><span class=quoted>"moebius_mat <span class=main>⇒</span> moebius_mat <span class=main>⇒</span> moebius_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>moebius_mb_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> similarity_def mat_det_inv<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_mb <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> moebius <span class=main>⇒</span> moebius"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>moebius_mb_mmat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>M'</span> <span class=skolem>I</span> <span class=skolem>I'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=skolem>M</span> <span class=skolem>M'</span>"</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=skolem>I</span> <span class=skolem>I'</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=main>(</span>moebius_mb_cmat <span class=skolem>I</span> <span class=skolem>M</span><span class=main>)</span> <span class=main>(</span>moebius_mb_cmat <span class=skolem>I'</span> <span class=skolem>M'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> similarity_scale_1 similarity_scale_2<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>similarity_invar_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>similarity_invar_cmat</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>=</span> <span class=main>(</span>mat_trace <span class=free><span class=bound><span class=entity>M</span></span></span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> mat_det <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>-</span> <span class=numeral>4</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> similarity_invar_mmat <span class=main>::</span> <span class=quoted><span class=quoted>"moebius_mat <span class=main>⇒</span> complex"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>similarity_invar_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> similarity_invar <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> complex"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>similarity_invar_mmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Moebius-similarity_invar_moeibus_mb><span class=command>lemma</span></span> similarity_invar_moeibus_mb<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"similarity_invar <span class=main>(</span>moebius_mb <span class=free>I</span> <span class=free>M</span><span class=main>)</span> <span class=main>=</span> similarity_invar <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>similar</span> <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> moebius <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>similar</span> <span class=free><span class=bound><span class=entity>M1</span></span></span> <span class=free><span class=bound><span class=entity>M2</span></span></span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>I</span><span class=main>.</span> moebius_mb <span class=bound>I</span> <span class=free><span class=bound><span class=entity>M1</span></span></span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>M2</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Moebius-similar_refl><span class=command>lemma</span></span> similar_refl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"similar <span class=free>M</span> <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> similar_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"id_moebius"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Moebius-similar_sym><span class=command>lemma</span></span> similar_sym<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"similar <span class=free>M1</span> <span class=free>M2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"similar <span class=free>M2</span> <span class=free>M1</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>I</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>M2</span> <span class=main>=</span> moebius_mb <span class=skolem>I</span> <span class=free>M1</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> similar_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>M1</span> <span class=main>=</span> moebius_mb <span class=main>(</span>moebius_inv <span class=skolem>I</span><span class=main>)</span> <span class=free>M2</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M2</span> <span class=skolem>I</span> <span class=skolem>M1</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=skolem>M2</span> <span class=main>(</span>moebius_mb_cmat <span class=skolem>I</span> <span class=skolem>M1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>I</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"similarity <span class=skolem>I</span> <span class=skolem>M1</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>M2</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=skolem>M1</span> <span class=main>(</span>moebius_mb_cmat <span class=main>(</span>moebius_inv_cmat <span class=skolem>I</span><span class=main>)</span> <span class=skolem>M2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> similarity_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>I</span></span> <span class=quoted><span class=skolem>M1</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>M2</span>"</span></span><span class=main>,</span> <span class=operator>OF</span> _ <span class=quoted><span class=quoted>‹mat_det <span class=skolem>I</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> similarity_scale_2<span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> similar_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Moebius-similar_trans><span class=command>lemma</span></span> similar_trans<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"similar <span class=free>M1</span> <span class=free>M2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"similar <span class=free>M2</span> <span class=free>M3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"similar <span class=free>M1</span> <span class=free>M3</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>I1</span></span> <span class=skolem><span class=skolem>I2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"moebius_mb <span class=skolem>I1</span> <span class=free>M1</span> <span class=main>=</span> <span class=free>M2</span>"</span></span> <span class=quoted><span class=quoted>"moebius_mb <span class=skolem>I2</span> <span class=free>M2</span> <span class=main>=</span> <span class=free>M3</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> similar_def<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> similar_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"moebius_comp <span class=skolem>I1</span> <span class=skolem>I2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>I1</span> <span class=skolem>I2</span> <span class=skolem>M1</span> <span class=skolem>M2</span> <span class=skolem>M3</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=main>(</span>moebius_mb_cmat <span class=skolem>I1</span> <span class=skolem>M1</span><span class=main>)</span> <span class=skolem>M2</span>"</span></span>
           <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=main>(</span>moebius_mb_cmat <span class=skolem>I2</span> <span class=skolem>M2</span><span class=main>)</span> <span class=skolem>M3</span>"</span></span>
           <span class=quoted><span class=quoted>"mat_det <span class=skolem>I1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>I2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=main>(</span>moebius_mb_cmat <span class=main>(</span>moebius_comp_cmat <span class=skolem>I1</span> <span class=skolem>I2</span><span class=main>)</span> <span class=skolem>M1</span><span class=main>)</span> <span class=skolem>M3</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> similarity_scale_2<span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>ka</span><span class=main>*</span><span class=improper>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Circlines>
<div class=head>
<h1>Theory Circlines</h1>
</div>
<pre class=source><span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Circlines›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>theory</span></span> Circlines
  <span class=keyword2><span class=keyword>imports</span></span> <a href=#More_Set>More_Set</a> <a href=#Moebius>Moebius</a> <a href=#Hermitean_Matrices>Hermitean_Matrices</a> <a href=#Elementary_Complex_Geometry>Elementary_Complex_Geometry</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Definition of circlines›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In our formalization we follow the approach described by Schwerdtfeger
\cite{schwerdtfeger} and represent circlines by Hermitean, non-zero
$2\times 2$ matrices. In the original formulation, a matrix
$\left(\begin{array}{cc}A &amp; B\\C &amp; D\end{array}\right)$ corresponds to
the equation $A\cdot z\cdot \overline{z} + B\cdot \overline{z} + C\cdot z + D = 0$,
where $C = \overline{B}$ and $A$ and $D$ are real (as the matrix is
Hermitean).›</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>hermitean_nonzero</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>hermitean_nonzero</span> <span class=main>≡</span> <span class=main>{</span><span class=bound>H</span><span class=main>.</span> hermitean <span class=bound>H</span> <span class=main>∧</span> <span class=bound>H</span> <span class=main>≠</span> mat_zero<span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>typedef</span></span> circline_mat <span class=main>=</span> <span class=quoted>hermitean_nonzero</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"eye"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1><span class=command>setup_lifting</span></span> type_definition_circline_mat


<span class=keyword1><span class=command>definition</span></span> <span class=entity>circline_eq_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>circline_eq_cmat</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>B</span></span></span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>real<span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>B</span></span></span> <span class=main>=</span> cor <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Circlines-symp_circline_eq_cmat><span class=command>lemma</span></span> symp_circline_eq_cmat<span class=main>:</span> <span class=quoted><span class=quoted>"symp circline_eq_cmat"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> symp_def
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=main>(</span><span class=operator>rule</span> allI<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> impI<span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=skolem>x</span> <span class=skolem>y</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>y</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span>  <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>/</span> <span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>x</span> <span class=main>=</span> cor <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=skolem>k</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>y</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=skolem>y</span> <span class=skolem>x</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> circline_eq_cmat_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span><span class=quoted><span class=plain_text>‹Hermitean non-zero matrices are equivalent only to such matrices›</span></span>
<span class=keyword1 id=Circlines-circline_eq_cmat_hermitean_nonzero><span class=command>lemma</span></span> circline_eq_cmat_hermitean_nonzero<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span> <span class=main>∧</span> <span class=free>H</span> <span class=main>≠</span> mat_zero"</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=free>H</span> <span class=free>H'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H'</span> <span class=main>∧</span> <span class=free>H'</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> circline_eq_cmat_def hermitean_mult_real nonzero_mult_real of_real_eq_0_iff<span class=main>)</span>


<span class=keyword1><span class=command>lift_definition</span></span> circline_eq_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> circline_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_eq_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Circlines-circline_eq_clmat_refl><span class=command>lemma</span></span> circline_eq_clmat_refl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"circline_eq_clmat <span class=free>H</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>quotient_type</span></span> circline <span class=main>=</span> <span class=quoted>circline_mat</span> <span class=main>/</span> <span class=quoted>circline_eq_clmat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> equivpI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"reflp circline_eq_clmat"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> reflp_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"symp circline_eq_clmat"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> symp_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>/</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper>k</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"transp circline_eq_clmat"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> transp_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper>ka</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>*</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper><span class=improper>k</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Circline with specified matrix›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹An auxiliary constructor <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>mk_circline</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> returns a circline (an
equivalence class) for given four complex numbers $A$, $B$, $C$ and
$D$ (provided that they form a Hermitean, non-zero matrix).›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>mk_circline_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>mk_circline_cmat</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>B</span></span></span> <span class=free><span class=bound><span class=entity>C</span></span></span> <span class=free><span class=bound><span class=entity>D</span></span></span> <span class=main>=</span>
          <span class=main>(</span><span class=keyword1>let</span> <span class=bound>M</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>B</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>C</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>D</span></span></span><span class=main>)</span>
            <span class=keyword1>in</span> <span class=keyword1>if</span> <span class=bound>M</span> <span class=main>∈</span> hermitean_nonzero <span class=keyword1>then</span>
                  <span class=bound>M</span>
               <span class=keyword1>else</span>
                  eye<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> mk_circline_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> circline_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mk_circline_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> mk_circline <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> circline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mk_circline_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Circlines-ex_mk_circline><span class=command>lemma</span></span> ex_mk_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>A</span> <span class=bound>B</span> <span class=bound>C</span> <span class=bound>D</span><span class=main>.</span> <span class=free>H</span> <span class=main>=</span> mk_circline <span class=bound>A</span> <span class=bound>B</span> <span class=bound>C</span> <span class=bound>D</span> <span class=main>∧</span> hermitean <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>≠</span> mat_zero"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>" <span class=skolem>H</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=skolem>H</span> <span class=main>(</span>mk_circline_cmat <span class=skolem>A</span> <span class=skolem>B</span> <span class=skolem>C</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>∧</span> hermitean <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>≠</span> mat_zero"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>A</span> <span class=bound>B</span> <span class=bound>C</span> <span class=bound>D</span><span class=main>.</span> circline_eq_cmat <span class=skolem>H</span> <span class=main>(</span>mk_circline_cmat <span class=bound>A</span> <span class=bound>B</span> <span class=bound>C</span> <span class=bound>D</span><span class=main>)</span> <span class=main>∧</span> hermitean <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>≠</span> mat_zero"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Circline type›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>circline_type_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>circline_type_cmat</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> sgn <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> circline_type_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_type_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> circline_type <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_type_clmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> exE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_mult<span class=main>)</span>

<span class=keyword1 id=Circlines-circline_type><span class=command>lemma</span></span> circline_type<span class=main>:</span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span> <span class=main>∨</span> circline_type <span class=free>H</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> circline_type <span class=free>H</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_if<span class=main>)</span>

<span class=keyword1 id=Circlines-circline_type_mk_circline><span class=command>lemma</span></span> circline_type_mk_circline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span> <span class=main>∈</span> hermitean_nonzero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"circline_type <span class=main>(</span>mk_circline <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>Re <span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>D</span> <span class=main>-</span> <span class=free>B</span><span class=main>*</span><span class=free>C</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Points on the circline›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Each circline determines a corresponding set of points. Again, a description given in
homogeneous coordinates is a bit better than the original description defined only for ordinary
complex numbers. The point with homogeneous coordinates $(z_1, z_2)$ will belong to the set of
circline points iff $A \cdot z_1\cdot \overline{z_1} + B\cdot \overline{z_1} \cdot z_2 + C\cdot z_1 \cdot\overline{z_2} +
D\cdot z_2 \cdot \overline{z_2} = 0$. Note that this is a quadratic form determined by a vector of
homogeneous coordinates and the Hermitean matrix.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>on_circline_cmat_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_vec <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>on_circline_cmat_cvec</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>⟷</span> quad_form <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>0</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> on_circline_clmat_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>on_circline_cmat_cvec</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> on_circline <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> complex_homo <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>on_circline_clmat_hcoords</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> quad_form_def<span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> quad_form_def <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> quad_form_scale_m quad_form_scale_v<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>circline_set</span> <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> complex_homo set"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>circline_set</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> on_circline <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=bound>z</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=Circlines-circline_set_I><span class=command>lemma</span></span> circline_set_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>circline_equation</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>circline_equation</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>B</span></span></span> <span class=free><span class=bound><span class=entity>C</span></span></span> <span class=free><span class=bound><span class=entity>D</span></span></span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>≡</span> <span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>z1</span></span></span><span class=main>*</span>cnj <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>B</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>z2</span></span></span><span class=main>*</span>cnj <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>C</span></span></span><span class=main>*</span>cnj <span class=free><span class=bound><span class=entity>z2</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>D</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>z2</span></span></span><span class=main>*</span>cnj <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>=</span> <span class=main>0</span>"</span></span>

<span class=keyword1 id=Circlines-on_circline_cmat_cvec_circline_equation><span class=command>lemma</span></span> on_circline_cmat_cvec_circline_equation<span class=main>:</span>
  <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span> <span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=main>⟷</span> circline_equation <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span> <span class=free>z1</span> <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Circlines-circline_equation><span class=command>lemma</span></span> circline_equation<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> mk_circline <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span> <span class=main>∈</span> hermitean_nonzero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>∈</span> circline_set <span class=free>H</span> <span class=main>⟷</span> circline_equation <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span> <span class=free>z</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Circlines trough 0 and inf.›</span></span>
<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The circline represents a line when $A=0$ or a circle, otherwise.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>circline_A0_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>circline_A0_cmat</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>⟷</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>in</span> <span class=bound>A</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> circline_A0_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_A0_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>lift_definition</span></span> circline_A0 <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_A0_clmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>is_line</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>is_line</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>≡</span> circline_A0 <span class=free><span class=bound><span class=entity>H</span></span></span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>is_circle</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>is_circle</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>≡</span> <span class=main>¬</span> circline_A0 <span class=free><span class=bound><span class=entity>H</span></span></span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>circline_D0_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>circline_D0_cmat</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>⟷</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>in</span> <span class=bound>D</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> circline_D0_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_D0_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>lift_definition</span></span> circline_D0 <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_D0_clmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-inf_on_circline><span class=command>lemma</span></span> inf_on_circline<span class=main>:</span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> circline_A0 <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Circlines-inf_in_circline_set><span class=command>lemma</span></span>
  inf_in_circline_set<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=free>H</span> <span class=main>⟷</span> is_line <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> inf_on_circline
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Circlines-zero_on_circline><span class=command>lemma</span></span> zero_on_circline<span class=main>:</span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> circline_D0 <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Circlines-zero_in_circline_set><span class=command>lemma</span></span>
  zero_in_circline_set<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=free>H</span> <span class=main>⟷</span> circline_D0 <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> zero_on_circline
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Connection with circles and lines in the classic complex plane›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Every Euclidean circle and Euclidean line can be represented by a
circline.›</span></span>

<span class=keyword1 id=Circlines-classic_circline><span class=command>lemma</span></span> classic_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> mk_circline <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=free>H</span> <span class=main>-</span> <span class=main>{</span><span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span> <span class=main>=</span> of_complex <span class=main>`</span> circline <span class=main>(</span>Re <span class=free>A</span><span class=main>)</span> <span class=free>B</span> <span class=main>(</span>Re <span class=free>D</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>unfolding</span></span> circline_set_def
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span> <span class=main>≠</span> mat_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> circline <span class=main>(</span>Re <span class=free>A</span><span class=main>)</span> <span class=free>B</span> <span class=main>(</span>Re <span class=free>D</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"on_circline <span class=main>(</span>mk_circline <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span><span class=main>)</span> <span class=main>(</span>of_complex <span class=skolem>z</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>D</span></span></span></span></span></span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> circline_def vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"of_complex <span class=skolem>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span> <span class=main>≠</span> mat_zero"</span></span> <span class=quoted><span class=quoted>"on_circline <span class=main>(</span>mk_circline <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span><span class=main>)</span> <span class=skolem>z</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∉</span> of_complex <span class=main>`</span> circline <span class=main>(</span>Re <span class=free>A</span><span class=main>)</span> <span class=free>B</span> <span class=main>(</span>Re <span class=free>D</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟶</span> <span class=skolem>z</span> <span class=main>∈</span> of_complex <span class=main>`</span> circline <span class=main>(</span>Re <span class=free>A</span><span class=main>)</span> <span class=free>B</span> <span class=main>(</span>Re <span class=free>D</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> of_complex <span class=main>`</span> circline <span class=main>(</span>Re <span class=free>A</span><span class=main>)</span> <span class=free>B</span> <span class=main>(</span>Re <span class=free>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> of_complex <span class=main>(</span>to_complex <span class=skolem>z</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"to_complex <span class=skolem>z</span> <span class=main>∈</span> circline <span class=main>(</span>Re <span class=free>A</span><span class=main>)</span> <span class=free>B</span> <span class=main>(</span>Re <span class=free>D</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹on_circline <span class=main>(</span>mk_circline <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span><span class=main>)</span> <span class=skolem>z</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹hermitean <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span> <span class=main>≠</span> mat_zero›</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>A</span> <span class=skolem>B</span> <span class=skolem>C</span> <span class=skolem>D</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
        <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=keyword2><span class=keyword>where</span></span> zz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
        <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span>  <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
                  <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=main>(</span>mk_circline_cmat <span class=skolem>A</span> <span class=skolem>B</span> <span class=skolem>C</span> <span class=skolem>D</span><span class=main>)</span> <span class=skolem>z</span>"</span></span>
                  <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>≠</span> mat_zero"</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>≠</span> vec_zero›</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>›</span></span>
          <span class=keyword1><span class=command>using</span></span> inf_cvec_z2_zero_iff zz
          <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"to_complex_cvec <span class=skolem>z</span> <span class=main>∈</span> circline <span class=main>(</span>Re <span class=skolem>A</span><span class=main>)</span> <span class=skolem>B</span> <span class=main>(</span>Re <span class=skolem>D</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> * zz
          <span class=keyword1><span class=command>using</span></span> hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def circline_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The matrix of the circline representing circle determined with center and radius.›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>mk_circle_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> real <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>mk_circle_cmat</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>-</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>-</span>cnj <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>*</span>cnj <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>-</span> cor <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>*</span>cor <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> mk_circle_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> real <span class=main>⇒</span> circline_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mk_circle_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> mk_circle <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> real <span class=main>⇒</span> circline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mk_circle_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Circlines-is_circle_mk_circle><span class=command>lemma</span></span> is_circle_mk_circle<span class=main>:</span> <span class=quoted><span class=quoted>"is_circle <span class=main>(</span>mk_circle <span class=free>a</span> <span class=free>r</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Circlines-circline_set_mk_circle><span class=command>lemma</span></span> circline_set_mk_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>mk_circle <span class=free>a</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>`</span> circle <span class=free>a</span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>-</span>cnj <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=free>a</span><span class=main>*</span>cnj <span class=free>a</span> <span class=main>-</span> cor <span class=free>r</span><span class=main>*</span>cor <span class=free>r</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?A</span><span class=main>,</span> <span class=var>?B</span><span class=main>,</span> <span class=var>?C</span><span class=main>,</span> <span class=var>?D</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>H</span><span class=main>.</span> hermitean <span class=bound>H</span> <span class=main>∧</span> <span class=bound>H</span> <span class=main>≠</span> mat_zero<span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mk_circle <span class=free>a</span> <span class=free>r</span> <span class=main>=</span> mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>mk_circle <span class=free>a</span> <span class=free>r</span><span class=main>)</span> <span class=main>-</span> <span class=main>{</span><span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span> <span class=main>=</span> of_complex <span class=main>`</span> circline <span class=var>?A</span> <span class=var>?B</span> <span class=main>(</span>Re <span class=var>?D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> classic_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mk_circle <span class=free>a</span> <span class=free>r</span>"</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span><span class=main>]</span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"circline <span class=var>?A</span> <span class=var>?B</span> <span class=main>(</span>Re <span class=var>?D</span><span class=main>)</span> <span class=main>=</span> circle <span class=free>a</span> <span class=free>r</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> circline_circle<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=var><span class=quoted><span class=var><span class=quoted><span class=var><span class=quoted><span class=var>?A</span></span></span></span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"Re <span class=var><span class=var><span class=var>?D</span></span></span>"</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=var><span class=var><span class=var>?B</span></span></span>"</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"circline <span class=var><span class=var><span class=var>?A</span></span></span> <span class=var><span class=var><span class=var>?B</span></span></span> <span class=main><span class=main><span class=main>(</span></span></span>Re <span class=var><span class=var><span class=var>?D</span></span></span><span class=main><span class=main><span class=main>)</span></span></span>"</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free><span class=free>a</span></span></span>"</span></span></span></span> <span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=free><span class=free><span class=free>r</span></span></span><span class=main><span class=main><span class=main>*</span></span></span><span class=free><span class=free><span class=free>r</span></span></span>"</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>r</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_square <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>›</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> circline_set <span class=main>(</span>mk_circle <span class=free>a</span> <span class=free>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inf_in_circline_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mk_circle <span class=free>a</span> <span class=free>r</span>"</span></span><span class=main>]</span> is_circle_mk_circle<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>r</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> circle_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The matrix of the circline representing line determined with two (not equal) complex points.›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>mk_line_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>mk_line_cmat</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>=</span>
    <span class=main>(</span><span class=keyword1>if</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=main>≠</span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=keyword1>then</span>
          <span class=keyword1>let</span> <span class=bound>B</span> <span class=main>=</span> <span class=keyword1>𝗂</span> <span class=main>*</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>z1</span></span></span><span class=main>)</span> <span class=keyword1>in</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> cnj <span class=bound>B</span><span class=main>,</span> <span class=main>-</span>cnj_mix <span class=bound>B</span> <span class=free><span class=bound><span class=entity>z1</span></span></span><span class=main>)</span>
    <span class=keyword1>else</span>
          eye<span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> mk_line_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> circline_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mk_line_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def hermitean_def mat_adj_def mat_cnj_def  <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> mk_line <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> circline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mk_line_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Circlines-circline_set_mk_line><span class=command>lemma</span></span> circline_set_mk_line <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>mk_line <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span> <span class=main>-</span> <span class=main>{</span><span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span> <span class=main>=</span> of_complex <span class=main>`</span> line <span class=free>z1</span> <span class=free>z2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=keyword1>𝗂</span><span class=main>*</span><span class=main>(</span><span class=free>z2</span> <span class=main>-</span> <span class=free>z1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"cnj <span class=var>?B</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>-</span>cnj_mix <span class=var>?B</span> <span class=free>z1</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?A</span><span class=main>,</span> <span class=var>?B</span><span class=main>,</span> <span class=var>?C</span><span class=main>,</span> <span class=var>?D</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>H</span><span class=main>.</span> hermitean <span class=bound>H</span> <span class=main>∧</span> <span class=bound>H</span> <span class=main>≠</span> mat_zero<span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mk_line <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>mk_line <span class=free>z1</span> <span class=free>z2</span><span class=main>)</span> <span class=main>-</span> <span class=main>{</span><span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span> <span class=main>=</span> of_complex <span class=main>`</span> circline <span class=var>?A</span> <span class=var>?B</span> <span class=main>(</span>Re <span class=var>?D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> classic_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mk_line <span class=free>z1</span> <span class=free>z2</span>"</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span><span class=main>]</span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"circline <span class=var>?A</span> <span class=var>?B</span> <span class=main>(</span>Re <span class=var>?D</span><span class=main>)</span> <span class=main>=</span> line <span class=free>z1</span> <span class=free>z2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z1</span> <span class=main>≠</span> <span class=free>z2</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_line'
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The set of points determined by a circline is always 
either an Euclidean circle or an Euclidean line. ›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Euclidean circle is determined by its center and radius.›</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> euclidean_circle <span class=main>=</span> <span class=quoted><span class=quoted>"complex <span class=main>×</span> real"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>euclidean_circle_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> euclidean_circle"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>euclidean_circle_cmat</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>in</span> <span class=main>(</span><span class=main>-</span><span class=bound>B</span><span class=main>/</span><span class=bound>A</span><span class=main>,</span> sqrt<span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=bound>B</span><span class=main>*</span><span class=bound>C</span> <span class=main>-</span> <span class=bound>A</span><span class=main>*</span><span class=bound>D</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=bound>A</span><span class=main>*</span><span class=bound>A</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> euclidean_circle_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> euclidean_circle"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>euclidean_circle_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> euclidean_circle <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> euclidean_circle"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>euclidean_circle_clmat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H1</span> <span class=skolem>H2</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H1</span> <span class=main>∧</span> <span class=skolem>H1</span> <span class=main>≠</span> mat_zero"</span></span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H2</span> <span class=main>∧</span> <span class=skolem>H2</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A1</span></span> <span class=skolem><span class=skolem>B1</span></span> <span class=skolem><span class=skolem>C1</span></span> <span class=skolem><span class=skolem>D1</span></span> <span class=keyword2><span class=keyword>where</span></span> HH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H1</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A1</span><span class=main>,</span> <span class=skolem>B1</span><span class=main>,</span> <span class=skolem>C1</span><span class=main>,</span> <span class=skolem>D1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>H1</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A2</span></span> <span class=skolem><span class=skolem>B2</span></span> <span class=skolem><span class=skolem>C2</span></span> <span class=skolem><span class=skolem>D2</span></span> <span class=keyword2><span class=keyword>where</span></span> HH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H2</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A2</span><span class=main>,</span> <span class=skolem>B2</span><span class=main>,</span> <span class=skolem>C2</span><span class=main>,</span> <span class=skolem>D2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>H2</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=skolem>H1</span> <span class=skolem>H2</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>A2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>A1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>B1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>C1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>D2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>D1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH1 HH2
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>B1</span> <span class=main>*</span> <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>C1</span><span class=main>)</span> <span class=main>-</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>A1</span> <span class=main>*</span> <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>D1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cor <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=skolem>B1</span><span class=main>*</span><span class=skolem>C1</span> <span class=main>-</span> <span class=skolem>A1</span><span class=main>*</span><span class=skolem>D1</span><span class=main>)</span>"</span></span>
    <span class=quoted><span class=quoted>"<span class=main>(</span>cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>A1</span> <span class=main>*</span> <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>A1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cor <span class=skolem>k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=skolem>A1</span><span class=main>*</span><span class=skolem>A1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>B1</span> <span class=main>*</span> <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>C1</span><span class=main>)</span> <span class=main>-</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>A1</span> <span class=main>*</span> <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>D1</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span>
         <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>A1</span> <span class=main>*</span> <span class=main>(</span>cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>A1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>B1</span><span class=main>*</span><span class=skolem>C1</span> <span class=main>-</span> <span class=skolem>A1</span><span class=main>*</span><span class=skolem>D1</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A1</span><span class=main>*</span><span class=skolem>A1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"euclidean_circle_cmat <span class=skolem>H1</span> <span class=main>=</span> euclidean_circle_cmat <span class=skolem>H2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH1 HH2 * hh
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-classic_circle><span class=command>lemma</span></span> classic_circle<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_circle <span class=free>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> euclidean_circle <span class=free>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>≤</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=free>H</span> <span class=main>=</span> of_complex <span class=main>`</span> circle <span class=free>a</span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> mk_circline <span class=skolem>A</span> <span class=skolem>B</span> <span class=skolem>C</span> <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>≠</span> mat_zero"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_mk_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * hermitean_elems
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=skolem>A</span><span class=main>*</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>B</span><span class=main>*</span><span class=skolem>C</span><span class=main>)</span> <span class=main>≤</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹circline_type <span class=free>H</span> <span class=main>≤</span> <span class=main>0</span>›</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>*</span> Re <span class=skolem>D</span> <span class=main>≤</span> <span class=main>(</span>cmod <span class=skolem>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_square<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_circle <span class=free>H</span>›</span></span> * <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex_surj zero_complex.code<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> circline_set <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * inf_in_circline_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹is_circle <span class=free>H</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?a</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=skolem>B</span><span class=main>/</span><span class=skolem>A</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?r2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span>cmod <span class=skolem>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> Re <span class=skolem>A</span> <span class=main>*</span> Re <span class=skolem>D</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>Re <span class=skolem>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?r</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt <span class=var>?r2</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?a</span> <span class=main>=</span> <span class=free>a</span> <span class=main>∧</span> <span class=var>?r</span> <span class=main>=</span> <span class=free>r</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> euclidean_circle <span class=free>H</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_square<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> * ** *** <span class=quoted><span class=quoted>‹Re <span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=var>?a</span> <span class=main>=</span> <span class=free>a</span> <span class=main>∧</span> <span class=var>?r</span> <span class=main>=</span> <span class=free>r</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> classic_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span> <span class=quoted><span class=skolem>A</span></span> <span class=quoted><span class=skolem>B</span></span> <span class=quoted><span class=skolem>C</span></span> <span class=quoted><span class=skolem>D</span></span><span class=main>]</span> assms circline_circle<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>D</span>"</span></span> <span class=quoted><span class=skolem>B</span></span> <span class=quoted><span class=quoted>"circline <span class=main>(</span>Re <span class=skolem>A</span><span class=main>)</span> <span class=skolem>B</span> <span class=main>(</span>Re <span class=skolem>D</span><span class=main>)</span>"</span></span> <span class=var><span class=quoted><span class=var>?a</span></span></span> <span class=var><span class=quoted><span class=var>?r2</span></span></span> <span class=var><span class=quoted><span class=var>?r</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> circle_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Euclidean line is represented by two points.›</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> euclidean_line <span class=main>=</span> <span class=quoted><span class=quoted>"complex <span class=main>×</span> complex"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>euclidean_line_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> euclidean_line"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>euclidean_line_cmat</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span>
         <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>;</span>
              <span class=bound>z1</span> <span class=main>=</span> <span class=main>-</span><span class=main>(</span><span class=bound>D</span><span class=main>*</span><span class=bound>B</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=bound>B</span><span class=main>*</span><span class=bound>C</span><span class=main>)</span><span class=main>;</span>
              <span class=bound>z2</span> <span class=main>=</span> <span class=bound>z1</span> <span class=main>+</span> <span class=keyword1>𝗂</span> <span class=main>*</span> sgn <span class=main>(</span><span class=keyword1>if</span> arg <span class=bound>B</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>-</span><span class=bound>B</span> <span class=keyword1>else</span> <span class=bound>B</span><span class=main>)</span>
           <span class=keyword1>in</span> <span class=main>(</span><span class=bound>z1</span><span class=main>,</span> <span class=bound>z2</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> euclidean_line_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> euclidean_line"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>euclidean_line_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> euclidean_line <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> complex <span class=main>×</span> complex"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>euclidean_line_clmat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H1</span> <span class=skolem>H2</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H1</span> <span class=main>∧</span> <span class=skolem>H1</span> <span class=main>≠</span> mat_zero"</span></span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H2</span> <span class=main>∧</span> <span class=skolem>H2</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A1</span></span> <span class=skolem><span class=skolem>B1</span></span> <span class=skolem><span class=skolem>C1</span></span> <span class=skolem><span class=skolem>D1</span></span> <span class=keyword2><span class=keyword>where</span></span> HH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H1</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A1</span><span class=main>,</span> <span class=skolem>B1</span><span class=main>,</span> <span class=skolem>C1</span><span class=main>,</span> <span class=skolem>D1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>H1</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A2</span></span> <span class=skolem><span class=skolem>B2</span></span> <span class=skolem><span class=skolem>C2</span></span> <span class=skolem><span class=skolem>D2</span></span> <span class=keyword2><span class=keyword>where</span></span> HH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H2</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A2</span><span class=main>,</span> <span class=skolem>B2</span><span class=main>,</span> <span class=skolem>C2</span><span class=main>,</span> <span class=skolem>D2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>H2</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=skolem>H1</span> <span class=skolem>H2</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>A2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>A1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>B1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>C1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>D2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>D1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH1 HH2
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>B1</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=skolem>B1</span> <span class=main>⟶</span> <span class=main>¬</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=main>(</span><span class=main>-</span> <span class=skolem>B1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_plus_pi1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=skolem>B1</span>"</span></span><span class=main>]</span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>B1</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> arg_uminus<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>B1</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=main>¬</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=skolem>B1</span> <span class=main>⟶</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=main>(</span><span class=main>-</span> <span class=skolem>B1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_plus_pi2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=skolem>B1</span>"</span></span><span class=main>]</span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>B1</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> arg_uminus<span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"euclidean_line_cmat <span class=skolem>H1</span> <span class=main>=</span> euclidean_line_cmat <span class=skolem>H2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH1 HH2 * <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> norm_mult sgn_eq 1 2<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-classic_line><span class=command>lemma</span></span> classic_line<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_line <span class=free>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> euclidean_line <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=free>H</span> <span class=main>-</span> <span class=main>{</span><span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span> <span class=main>=</span> of_complex <span class=main>`</span> line <span class=free>z1</span> <span class=free>z2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> mk_circline <span class=skolem>A</span> <span class=skolem>B</span> <span class=skolem>C</span> <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>≠</span> mat_zero"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_mk_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * hermitean_elems
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_line <span class=free>H</span>›</span></span> * <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=skolem>A</span> <span class=main>=</span> <span class=main>0</span>›</span></span>  <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span> * <span class=quoted><span class=quoted>‹circline_type <span class=free>H</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_type_mk_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>A</span></span> <span class=quoted><span class=skolem>B</span></span> <span class=quoted><span class=skolem>C</span></span> <span class=quoted><span class=skolem>D</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?z1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>-</span> cor <span class=main>(</span>Re <span class=skolem>D</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>B</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=skolem>B</span> <span class=main>*</span> cnj <span class=skolem>B</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?z2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?z1</span> <span class=main>+</span> <span class=keyword1>𝗂</span> <span class=main>*</span> sgn <span class=main>(</span><span class=keyword1>if</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=skolem>B</span> <span class=keyword1>then</span> <span class=main>-</span> <span class=skolem>B</span> <span class=keyword1>else</span> <span class=skolem>B</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>=</span> <span class=var>?z1</span> <span class=main>∧</span> <span class=free>z2</span> <span class=main>=</span> <span class=var>?z2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> euclidean_line <span class=free>H</span>›</span></span> * <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>using</span></span> classic_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span> <span class=quoted><span class=skolem>A</span></span> <span class=quoted><span class=skolem>B</span></span> <span class=quoted><span class=skolem>C</span></span> <span class=quoted><span class=skolem>D</span></span><span class=main>]</span> circline_line<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span>"</span></span> <span class=quoted><span class=skolem>B</span></span> <span class=quoted><span class=quoted>"circline <span class=main>(</span>Re <span class=skolem>A</span><span class=main>)</span> <span class=skolem>B</span> <span class=main>(</span>Re <span class=skolem>D</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>D</span>"</span></span> <span class=var><span class=quoted><span class=var>?z1</span></span></span> <span class=var><span class=quoted><span class=var>?z2</span></span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹Re <span class=skolem>A</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Some special circlines›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Unit circle›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>unit_circle_cmat</span> <span class=main>::</span> <span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>unit_circle_cmat</span> <span class=main>=</span>  <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> unit_circle_clmat <span class=main>::</span> <span class=quoted>circline_mat</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>unit_circle_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>lift_definition</span></span> unit_circle <span class=main>::</span> <span class=quoted>circline</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>unit_circle_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Circlines-on_circline_cmat_cvec_unit><span class=command>lemma</span></span> on_circline_cmat_cvec_unit<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec unit_circle_cmat <span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span> <span class=main>⟷</span> 
         <span class=free>z1</span> <span class=main>*</span> cnj <span class=free>z1</span> <span class=main>=</span> <span class=free>z2</span> <span class=main>*</span> cnj <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Circlines-one_on_unit_circle><span class=command>lemma</span></span>
  one_on_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"on_circline unit_circle <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>  <span class=keyword2><span class=keyword>and</span></span>
  ii_on_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"on_circline unit_circle <span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  not_zero_on_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> on_circline unit_circle <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Circlines-one_in_unit_circle_set><span class=command>lemma</span></span>  
  one_in_unit_circle_set <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set unit_circle"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  ii_in_unit_circle_set <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set unit_circle"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  zero_in_unit_circle_set <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> circline_set unit_circle"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

<span class=keyword1 id=Circlines-is_circle_unit_circle><span class=command>lemma</span></span> is_circle_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_circle unit_circle"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id="Circlines-not_inf_on_unit_circle'"><span class=command>lemma</span></span> not_inf_on_unit_circle' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> on_circline unit_circle <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> is_circle_unit_circle inf_on_circline
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id="Circlines-not_inf_on_unit_circle''"><span class=command>lemma</span></span> not_inf_on_unit_circle'' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> circline_set unit_circle"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inf_in_circline_set<span class=main>)</span>

<span class=keyword1 id=Circlines-euclidean_circle_unit_circle><span class=command>lemma</span></span> euclidean_circle_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"euclidean_circle unit_circle <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Circlines-circline_type_unit_circle><span class=command>lemma</span></span> circline_type_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_type unit_circle <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Circlines-on_circline_unit_circle><span class=command>lemma</span></span> on_circline_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline unit_circle <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span> <span class=main>⟷</span> cmod <span class=free>z</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def mult.commute<span class=main>)</span>

<span class=keyword1 id=Circlines-circline_set_unit_circle><span class=command>lemma</span></span> circline_set_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set unit_circle <span class=main>=</span> of_complex <span class=main>`</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cmod <span class=bound>z</span> <span class=main>=</span> <span class=main>1</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> circline_set unit_circle"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> of_complex <span class=skolem>x'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> of_complex <span class=main>`</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> cmod <span class=bound>z</span> <span class=main>=</span> <span class=main>1</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>x</span> <span class=main>∈</span> circline_set unit_circle›</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> circline_set_def              
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"cmod <span class=skolem>x</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"of_complex <span class=skolem>x</span> <span class=main>∈</span> circline_set unit_circle"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-circline_set_unit_circle_I><span class=command>lemma</span></span> circline_set_unit_circle_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>z</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>∈</span> circline_set unit_circle"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_unit_circle
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Circlines-inversion_unit_circle><span class=command>lemma</span></span> inversion_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"on_circline unit_circle <span class=free>x</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inversion <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> of_complex <span class=skolem>x'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=skolem>x'</span> <span class=main>*</span> cnj <span class=skolem>x'</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> circline_set_unit_circle
    <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>/</span> cnj <span class=skolem>x'</span> <span class=main>=</span> <span class=skolem>x'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>x'</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> inversion_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-inversion_id_iff_on_unit_circle><span class=command>lemma</span></span> inversion_id_iff_on_unit_circle<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inversion <span class=free>a</span> <span class=main>=</span> <span class=free>a</span> <span class=main>⟷</span> on_circline unit_circle <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> inversion_id_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-on_unit_circle_conjugate><span class=command>lemma</span></span> on_unit_circle_conjugate <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline unit_circle <span class=main>(</span>conjugate <span class=free>z</span><span class=main>)</span> <span class=main>⟷</span> on_circline unit_circle <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Circlines-conjugate_unit_circle_set><span class=command>lemma</span></span> conjugate_unit_circle_set <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>`</span> <span class=main>(</span>circline_set unit_circle<span class=main>)</span> <span class=main>=</span> circline_set unit_circle"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"conjugate <span class=improper>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹x-axis›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>x_axis_cmat</span> <span class=main>::</span> <span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x_axis_cmat</span> <span class=main>=</span>  <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=keyword1>𝗂</span><span class=main>,</span> <span class=main>-</span><span class=keyword1>𝗂</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> x_axis_clmat <span class=main>::</span> <span class=quoted>circline_mat</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>x_axis_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>lift_definition</span></span> x_axis <span class=main>::</span> <span class=quoted>circline</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>x_axis_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id="Circlines-special_points_on_x_axis'"><span class=command>lemma</span></span> special_points_on_x_axis' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline x_axis <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"on_circline x_axis <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"on_circline x_axis <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id="Circlines-special_points_on_x_axis''"><span class=command>lemma</span></span> special_points_on_x_axis'' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set x_axis"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set x_axis"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set x_axis"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-is_line_x_axis><span class=command>lemma</span></span> is_line_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_line x_axis"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Circlines-circline_type_x_axis><span class=command>lemma</span></span> circline_type_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_type x_axis <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Circlines-on_circline_x_axis><span class=command>lemma</span></span> on_circline_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline x_axis <span class=free>z</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>c</span><span class=main>.</span> is_real <span class=bound>c</span> <span class=main>∧</span> <span class=free>z</span> <span class=main>=</span> of_complex <span class=bound>c</span><span class=main>)</span> <span class=main>∨</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>c</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>c</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"on_circline x_axis <span class=main>(</span>of_complex <span class=skolem>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>c</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>c</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec x_axis_cmat <span class=main>(</span>of_complex_cvec <span class=skolem>c</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>c</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"on_circline x_axis <span class=skolem>z</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>c</span><span class=main>.</span> is_real <span class=bound>c</span> <span class=main>∧</span> <span class=skolem>z</span> <span class=main>=</span> of_complex <span class=bound>c</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>b</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>)</span> <span class=main>≠</span> vec_zero"</span></span>
      <span class=quoted><span class=quoted>"on_circline_cmat_cvec x_axis_cmat <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>)</span>"</span></span>
      <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"cnj <span class=skolem>a</span> <span class=main>*</span> <span class=skolem>b</span> <span class=main>=</span> cnj <span class=skolem>b</span> <span class=main>*</span> <span class=skolem>a</span>"</span></span> <span class=keyword1><span class=command>using</span></span> inf_cvec_z2_zero_iff
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>c</span><span class=main>.</span> is_real <span class=bound>c</span> <span class=main>∧</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> of_complex_cvec <span class=bound>c</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>a</span><span class=main>/</span><span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> is_real_div <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"on_circline x_axis <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-on_circline_x_axis_I><span class=command>lemma</span></span> on_circline_x_axis_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline x_axis <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> on_circline_x_axis
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-circline_set_x_axis><span class=command>lemma</span></span> circline_set_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set x_axis <span class=main>=</span> of_complex <span class=main>`</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> is_real <span class=bound>x</span><span class=main>}</span> <span class=main>∪</span> <span class=main>{</span><span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> on_circline_x_axis
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-circline_set_x_axis_I><span class=command>lemma</span></span> circline_set_x_axis_I<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>∈</span> circline_set x_axis"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_x_axis
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-circline_equation_x_axis><span class=command>lemma</span></span> circline_equation_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>∈</span> circline_set x_axis <span class=main>⟷</span> <span class=free>z</span> <span class=main>=</span> cnj <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_x_axis
<span class=keyword1><span class=command>proof</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>x</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>x</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=skolem>x</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> of_complex_inj<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> cnj <span class=free>z</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>x</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> cnj <span class=free>z</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>∈</span> of_complex <span class=main>`</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> is_real <span class=bound>x</span><span class=main>}</span> "</span></span>
    <span class=keyword1><span class=command>using</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Positive and negative part of x-axis›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>positive_x_axis</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>positive_x_axis</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> <span class=bound>z</span> <span class=main>∈</span> circline_set x_axis <span class=main>∧</span> <span class=bound>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> Re <span class=main>(</span>to_complex <span class=bound>z</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>negative_x_axis</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>negative_x_axis</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> <span class=bound>z</span> <span class=main>∈</span> circline_set x_axis <span class=main>∧</span> <span class=bound>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> Re <span class=main>(</span>to_complex <span class=bound>z</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=Circlines-circline_set_positive_x_axis_I><span class=command>lemma</span></span> circline_set_positive_x_axis_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Re <span class=free>z</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>∈</span> positive_x_axis"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> positive_x_axis_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Circlines-circline_set_negative_x_axis_I><span class=command>lemma</span></span> circline_set_negative_x_axis_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Re <span class=free>z</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>∈</span> negative_x_axis"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> negative_x_axis_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹y-axis›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>y_axis_cmat</span> <span class=main>::</span> <span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y_axis_cmat</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> y_axis_clmat <span class=main>::</span> <span class=quoted>circline_mat</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>y_axis_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>lift_definition</span></span> y_axis <span class=main>::</span> <span class=quoted>circline</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>y_axis_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id="Circlines-special_points_on_y_axis'"><span class=command>lemma</span></span> special_points_on_y_axis' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline y_axis <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"on_circline y_axis <span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"on_circline y_axis <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id="Circlines-special_points_on_y_axis''"><span class=command>lemma</span></span> special_points_on_y_axis'' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set y_axis"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set y_axis"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set y_axis"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-on_circline_y_axis><span class=command>lemma</span></span> on_circline_y_axis<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline y_axis <span class=free>z</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>c</span><span class=main>.</span> is_imag <span class=bound>c</span> <span class=main>∧</span> <span class=free>z</span> <span class=main>=</span> of_complex <span class=bound>c</span><span class=main>)</span> <span class=main>∨</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>c</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"is_imag <span class=skolem>c</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"on_circline y_axis <span class=main>(</span>of_complex <span class=skolem>c</span><span class=main>)</span>"</span></span>                                 
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>c</span>                                                       
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"is_imag <span class=skolem>c</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec y_axis_cmat <span class=main>(</span>of_complex_cvec <span class=skolem>c</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> eq_minus_cnj_iff_imag<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>c</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"on_circline y_axis <span class=skolem>z</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>c</span><span class=main>.</span> is_imag <span class=bound>c</span> <span class=main>∧</span> <span class=skolem>z</span> <span class=main>=</span> of_complex <span class=bound>c</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>b</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>)</span> <span class=main>≠</span> vec_zero"</span></span>
      <span class=quoted><span class=quoted>"on_circline_cmat_cvec y_axis_cmat <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>)</span>"</span></span>
      <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"cnj <span class=skolem>a</span> <span class=main>*</span> <span class=skolem>b</span> <span class=main>+</span> cnj <span class=skolem>b</span> <span class=main>*</span> <span class=skolem>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_cvec_z2_zero_iff
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>blast</span><span class=main><span class=keyword3>,</span></span> <span class=operator>smt</span> add.left_neutral add_cancel_right_right mult.commute mult.left_neutral mult_not_zero on_circline_cmat_cvec_circline_equation y_axis_cmat_def<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>c</span><span class=main>.</span> is_imag <span class=bound>c</span> <span class=main>∧</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>)</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> of_complex_cvec <span class=bound>c</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> eq_minus_cnj_iff_imag<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>/</span> <span class=skolem>b</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>a</span><span class=main>/</span><span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command>using</span></span> add_eq_0_iff <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>blast</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"on_circline y_axis <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-on_circline_y_axis_I><span class=command>lemma</span></span> on_circline_y_axis_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_imag <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline y_axis <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> on_circline_y_axis
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-circline_set_y_axis><span class=command>lemma</span></span> circline_set_y_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set y_axis <span class=main>=</span> of_complex <span class=main>`</span> <span class=main>{</span><span class=bound>x</span><span class=main>.</span> is_imag <span class=bound>x</span><span class=main>}</span> <span class=main>∪</span> <span class=main>{</span><span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> on_circline_y_axis
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-circline_set_y_axis_I><span class=command>lemma</span></span> circline_set_y_axis_I<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_imag <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>∈</span> circline_set y_axis"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_y_axis
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Positive and negative part of y-axis›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>positive_y_axis</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>positive_y_axis</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> <span class=bound>z</span> <span class=main>∈</span> circline_set y_axis <span class=main>∧</span> <span class=bound>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> Im <span class=main>(</span>to_complex <span class=bound>z</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>negative_y_axis</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>negative_y_axis</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> <span class=bound>z</span> <span class=main>∈</span> circline_set y_axis <span class=main>∧</span> <span class=bound>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> Im <span class=main>(</span>to_complex <span class=bound>z</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=Circlines-circline_set_positive_y_axis_I><span class=command>lemma</span></span> circline_set_positive_y_axis_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_imag <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Im <span class=free>z</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>∈</span> positive_y_axis"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> positive_y_axis_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Circlines-circline_set_negative_y_axis_I><span class=command>lemma</span></span> circline_set_negative_y_axis_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_imag <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Im <span class=free>z</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>∈</span> negative_y_axis"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> negative_y_axis_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Point zero as a circline›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>circline_point_0_cmat</span> <span class=main>::</span> <span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>circline_point_0_cmat</span> <span class=main>=</span>  <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> circline_point_0_clmat <span class=main>::</span> <span class=quoted>circline_mat</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_point_0_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>lift_definition</span></span> circline_point_0 <span class=main>::</span> <span class=quoted>circline</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_point_0_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Circlines-circline_type_circline_point_0><span class=command>lemma</span></span> circline_type_circline_point_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_type circline_point_0 <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Circlines-zero_in_circline_point_0><span class=command>lemma</span></span> zero_in_circline_point_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set circline_point_0"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Imaginary unit circle›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>imag_unit_circle_cmat</span> <span class=main>::</span> <span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>imag_unit_circle_cmat</span> <span class=main>=</span>  <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> imag_unit_circle_clmat <span class=main>::</span> <span class=quoted>circline_mat</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>imag_unit_circle_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>lift_definition</span></span> imag_unit_circle <span class=main>::</span> <span class=quoted>circline</span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>imag_unit_circle_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Circlines-circline_type_imag_unit_circle><span class=command>lemma</span></span> circline_type_imag_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_type imag_unit_circle <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Intersection of circlines›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>circline_intersection</span> <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> circline <span class=main>⇒</span> complex_homo set"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>circline_intersection</span> <span class=free><span class=bound><span class=entity>H1</span></span></span> <span class=free><span class=bound><span class=entity>H2</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> on_circline <span class=free><span class=bound><span class=entity>H1</span></span></span> <span class=bound>z</span> <span class=main>∧</span> on_circline <span class=free><span class=bound><span class=entity>H2</span></span></span> <span class=bound>z</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=Circlines-circline_equation_cancel_z2><span class=command>lemma</span></span> circline_equation_cancel_z2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_equation <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span> <span class=free>z1</span> <span class=free>z2</span> "</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_equation <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span> <span class=main>(</span><span class=free>z1</span><span class=main>/</span><span class=free>z2</span><span class=main>)</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Circlines-circline_equation_quadratic_equation><span class=command>lemma</span></span> circline_equation_quadratic_equation<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_equation <span class=free>A</span> <span class=free>B</span> <span class=main>(</span>cnj <span class=free>B</span><span class=main>)</span> <span class=free>D</span> <span class=free>z</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 
          <span class=quoted><span class=quoted>"Re <span class=free>z</span> <span class=main>=</span> <span class=free>x</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Im <span class=free>z</span> <span class=main>=</span> <span class=free>y</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Re <span class=free>B</span> <span class=main>=</span> <span class=free>bx</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Im <span class=free>B</span> <span class=main>=</span> <span class=free>by</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span><span class=main>*</span><span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>A</span><span class=main>*</span><span class=free>y</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>bx</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>by</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>D</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=free>x</span> <span class=main>+</span> <span class=keyword1>𝗂</span><span class=main>*</span><span class=free>y</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>=</span> <span class=free>bx</span> <span class=main>+</span> <span class=keyword1>𝗂</span><span class=main>*</span><span class=free>by</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms complex_eq
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-circline_intersection_symetry><span class=command>lemma</span></span> circline_intersection_symetry<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_intersection <span class=free>H1</span> <span class=free>H2</span> <span class=main>=</span> circline_intersection <span class=free>H2</span> <span class=free>H1</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> circline_intersection_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Möbius action on circlines›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>moebius_circline_cmat_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>moebius_circline_cmat_cmat</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> congruence <span class=main>(</span>mat_inv <span class=free><span class=bound><span class=entity>M</span></span></span><span class=main>)</span> <span class=free><span class=bound><span class=entity>H</span></span></span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_circline_mmat_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"moebius_mat <span class=main>⇒</span> circline_mat <span class=main>⇒</span> circline_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>moebius_circline_cmat_cmat</span>
  <span class=keyword1><span class=command>using</span></span> mat_det_inv congruence_nonzero hermitean_congruence
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_circline <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> circline <span class=main>⇒</span> circline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>moebius_circline_mmat_clmat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>M'</span> <span class=skolem>H</span> <span class=skolem>H'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=skolem>M</span> <span class=skolem>M'</span>"</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=skolem>H</span> <span class=skolem>H'</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H</span><span class=main>)</span> <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M'</span> <span class=skolem>H'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_inv_mult_sm<span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>ka</span> <span class=main>/</span> Re <span class=main>(</span><span class=improper>k</span> <span class=main>*</span> cnj <span class=improper>k</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod power2_eq_square<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-moebius_preserve_circline_type><span class=command>lemma</span></span> moebius_preserve_circline_type <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>                                
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_type <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> circline_type <span class=free>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>H</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"circline_type_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H</span><span class=main>)</span> <span class=main>=</span> circline_type_cmat <span class=skolem>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Re_det_sgn_congruence<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_inv <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span>"</span></span><span class=main>]</span> mat_det_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> congruence_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The central lemma in this section connects the action of Möbius transformations on points and
on circlines.›</span></span>

<span class=keyword1 id=Circlines-moebius_circline><span class=command>lemma</span></span> moebius_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=bound>z</span><span class=main>.</span> on_circline <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=bound>z</span><span class=main>}</span> <span class=main>=</span>
         moebius_pt <span class=free>M</span> <span class=main>`</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> on_circline <span class=free>H</span> <span class=bound>z</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=skolem>z</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"on_circline <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>M</span> <span class=skolem>H</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?z</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?H</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"mat_adj <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=skolem>H</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"quad_form <span class=skolem>z</span> <span class=skolem>H</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"quad_form <span class=var>?z</span> <span class=var>?H</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> quad_form_congruence<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span> <span class=quoted><span class=skolem>z</span></span> <span class=quoted><span class=skolem>H</span></span><span class=main>]</span> hh
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H</span><span class=main>)</span> <span class=main>(</span>moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"on_circline <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=skolem>z</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>z'</span><span class=main>.</span> <span class=skolem>z</span> <span class=main>=</span> moebius_pt <span class=free>M</span> <span class=bound>z'</span> <span class=main>∧</span> on_circline <span class=free>H</span> <span class=bound>z'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>M</span> <span class=skolem>H</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?iM</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"mat_inv <span class=skolem>M</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?z'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?iM</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H</span><span class=main>)</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?z'</span> <span class=main>≠</span> vec_zero"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh
      <span class=keyword1><span class=command>using</span></span> mat_det_inv mult_mv_nonzero
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=var>?z'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh eye_mv_l mat_inv_r
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=var>?iM</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>z</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh eye_mv_l mat_inv_r
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=skolem>H</span> <span class=var>?z'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh *
      <span class=keyword1><span class=command>using</span></span> quad_form_congruence<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span> <span class=quoted><span class=quoted>"<span class=var>?iM</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z</span>"</span></span> <span class=quoted><span class=skolem>H</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> moebius_circline_cmat_cmat_def
      <span class=keyword1><span class=command>unfolding</span></span> on_circline_cmat_cvec_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>z'</span><span class=main>∈</span><span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span><span class=main>.</span> <span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=bound>z'</span> <span class=main>∧</span> on_circline_cmat_cvec <span class=skolem>H</span> <span class=bound>z'</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> moebius_pt <span class=free>M</span> <span class=main>`</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> on_circline <span class=free>H</span> <span class=bound>z</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-on_circline_moebius_circline_I><span class=command>lemma</span></span> on_circline_moebius_circline_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms moebius_circline
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Circlines-circline_set_moebius_circline><span class=command>lemma</span></span> circline_set_moebius_circline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> moebius_pt <span class=free>M</span> <span class=main>`</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-circline_set_moebius_circline_I><span class=command>lemma</span></span> circline_set_moebius_circline_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Circlines-circline_set_moebius_circline_E><span class=command>lemma</span></span> circline_set_moebius_circline_E<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> moebius_pt_eq_I<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-circline_set_moebius_circline_iff><span class=command>lemma</span></span> circline_set_moebius_circline_iff <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>⟷</span> 
         <span class=free>z</span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_pt_eq_I<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-inj_moebius_circline><span class=command>lemma</span></span> inj_moebius_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inj <span class=main>(</span>moebius_circline <span class=free>M</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> inj_on_def
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=skolem>H'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=free>M</span> <span class=skolem>H</span> <span class=main>=</span> moebius_circline <span class=free>M</span> <span class=skolem>H'</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=skolem>H'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>H</span> <span class=skolem>H'</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?iM</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"mat_inv <span class=skolem>M</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H</span><span class=main>)</span> <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"congruence <span class=var>?iM</span> <span class=skolem>H'</span> <span class=main>=</span> congruence <span class=var>?iM</span> <span class=main>(</span>cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=skolem>H</span> <span class=skolem>H'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh inj_congruence<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?iM</span></span></span> <span class=quoted><span class=skolem>H'</span></span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H</span>"</span></span><span class=main>]</span> mat_det_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-moebius_circline_eq_I><span class=command>lemma</span></span> moebius_circline_eq_I<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=free>M</span> <span class=free>H1</span> <span class=main>=</span> moebius_circline <span class=free>M</span> <span class=free>H2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>H1</span> <span class=main>=</span> <span class=free>H2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms inj_moebius_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> inj_on_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Circlines-moebius_circline_neq_I><span class=command>lemma</span></span> moebius_circline_neq_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>H1</span> <span class=main>≠</span> <span class=free>H2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=free>M</span> <span class=free>H1</span> <span class=main>≠</span> moebius_circline <span class=free>M</span> <span class=free>H2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms inj_moebius_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> inj_on_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Group properties of Möbius action on ciclines›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius actions on circlines have similar properties as Möbius actions on points.›</span></span>

<span class=keyword1 id=Circlines-moebius_circline_id><span class=command>lemma</span></span> moebius_circline_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline id_moebius <span class=free>H</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Circlines-moebius_circline_comp><span class=command>lemma</span></span> moebius_circline_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>moebius_comp <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span> <span class=free>H</span> <span class=main>=</span> moebius_circline <span class=free>M1</span> <span class=main>(</span>moebius_circline <span class=free>M2</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_inv_mult_mm<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_mm_assoc<span class=main>)</span>

<span class=keyword1 id=Circlines-moebius_circline_comp_inv_left><span class=command>lemma</span></span> moebius_circline_comp_inv_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> moebius_circline_comp<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Circlines-moebius_circline_comp_inv_right><span class=command>lemma</span></span> moebius_circline_comp_inv_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=free>M</span> <span class=main>(</span>moebius_circline <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> moebius_circline_comp<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Action of Euclidean similarities on circlines›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id=Circlines-moebius_similarity_lines_to_lines><span class=command>lemma</span></span> moebius_similarity_lines_to_lines <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=main>(</span>moebius_circline <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span> <span class=main>⟷</span> 
         <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms       
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> circline_set_moebius_circline_iff moebius_similarity_inf<span class=main>)</span>

<span class=keyword1 id="Circlines-moebius_similarity_lines_to_lines'"><span class=command>lemma</span></span> moebius_similarity_lines_to_lines'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline <span class=main>(</span>moebius_circline <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span>
         <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_similarity_lines_to_lines assms
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Conjugation, recpiprocation and inversion of circlines›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Conjugation of circlines›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>conjugate_circline_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>conjugate_circline_cmat</span> <span class=main>=</span> mat_cnj"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> conjugate_circline_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> circline_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>conjugate_circline_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>lift_definition</span></span> conjugate_circline <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> circline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>conjugate_circline_clmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>metis</span> circline_eq_cmat_def conjugate_circline_cmat_def hermitean_transpose mat_t_mult_sm<span class=main>)</span>

<span class=keyword1 id="Circlines-conjugate_circline_set'"><span class=command>lemma</span></span> conjugate_circline_set'<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>`</span> circline_set <span class=free>H</span> <span class=main>⊆</span> circline_set <span class=main>(</span>conjugate_circline <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"conjugate <span class=skolem>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>conjugate_circline <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword1><span class=command>unfolding</span></span> on_circline_cmat_cvec_def conjugate_cvec_def conjugate_circline_cmat_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> quad_form_vec_cnj_mat_cnj<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-conjugate_conjugate_circline><span class=command>lemma</span></span> conjugate_conjugate_circline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate_circline <span class=main>(</span>conjugate_circline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main>)</span>

<span class=keyword1 id=Circlines-circline_set_conjugate_circline><span class=command>lemma</span></span> circline_set_conjugate_circline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>conjugate_circline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> conjugate <span class=main>`</span> circline_set <span class=free>H</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> <span class=var>?lhs</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> <span class=var>?rhs</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> conjugate <span class=main>(</span>conjugate <span class=skolem>z</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"conjugate <span class=skolem>z</span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>conjugate_circline <span class=free>H</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> conjugate_circline_set'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"conjugate_circline <span class=free>H</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"conjugate <span class=skolem>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>conjugate_circline <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> conjugate_circline_set'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-on_circline_conjugate_circline><span class=command>lemma</span></span> on_circline_conjugate_circline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline <span class=main>(</span>conjugate_circline <span class=free>H</span><span class=main>)</span> <span class=free>z</span> <span class=main>⟷</span> on_circline <span class=free>H</span> <span class=main>(</span>conjugate <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> circline_set_conjugate_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Inversion of circlines›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>circline_inversion_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=free>circline_inversion_cmat</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>in</span> <span class=main>(</span><span class=bound>D</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>A</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> circline_inversion_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> circline_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_inversion_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>lift_definition</span></span> circline_inversion <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> circline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_inversion_clmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-on_circline_circline_inversion><span class=command>lemma</span></span> on_circline_circline_inversion <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline <span class=main>(</span>circline_inversion <span class=free>H</span><span class=main>)</span> <span class=free>z</span> <span class=main>⟷</span> on_circline <span class=free>H</span> <span class=main>(</span>reciprocal <span class=main>(</span>conjugate <span class=free>z</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Circlines-circline_set_circline_inversion><span class=command>lemma</span></span> circline_set_circline_inversion <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>circline_inversion <span class=free>H</span><span class=main>)</span> <span class=main>=</span> inversion <span class=main>`</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def inversion_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> comp_def image_iff<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Reciprocal of circlines›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>circline_reciprocal</span> <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> circline"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>circline_reciprocal</span> <span class=main>=</span> conjugate_circline <span class=main>∘</span> circline_inversion"</span></span>

<span class=keyword1 id=Circlines-circline_set_circline_reciprocal><span class=command>lemma</span></span> circline_set_circline_reciprocal<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>circline_reciprocal <span class=free>H</span><span class=main>)</span> <span class=main>=</span> reciprocal <span class=main>`</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> circline_reciprocal_def comp_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inversion_def image_iff<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Rotation of circlines›</span></span>

<span class=keyword1 id=Circlines-rotation_pi_2_y_axis><span class=command>lemma</span></span> rotation_pi_2_y_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>moebius_rotation <span class=main>(</span>pi<span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>)</span> y_axis <span class=main>=</span> x_axis"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def moebius_similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Circlines-rotation_minus_pi_2_y_axis><span class=command>lemma</span></span> rotation_minus_pi_2_y_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>moebius_rotation <span class=main>(</span><span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>)</span> y_axis <span class=main>=</span> x_axis"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def moebius_similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Circlines-rotation_minus_pi_2_x_axis><span class=command>lemma</span></span> rotation_minus_pi_2_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>moebius_rotation <span class=main>(</span><span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>)</span> x_axis <span class=main>=</span> y_axis"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def moebius_similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Circlines-rotation_pi_2_x_axis><span class=command>lemma</span></span> rotation_pi_2_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>moebius_rotation <span class=main>(</span>pi<span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>)</span> x_axis <span class=main>=</span> y_axis"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def moebius_similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Circlines-rotation_minus_pi_2_positive_y_axis><span class=command>lemma</span></span> rotation_minus_pi_2_positive_y_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>moebius_pt <span class=main>(</span>moebius_rotation <span class=main>(</span><span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> positive_y_axis <span class=main>=</span> positive_x_axis"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
  <span class=keyword3><span class=command>assume</span></span> y<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>∈</span> positive_y_axis"</span></span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> <span class=keyword1>𝗂</span> <span class=main>/</span> <span class=skolem>b</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>⟷</span> Im <span class=main>(</span><span class=skolem>a</span> <span class=main>/</span> <span class=skolem>b</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>a</span> <span class=skolem>b</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> times_divide_eq_left <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mult.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Re_i_times<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>from</span></span> y * <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=main>(</span><span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>)</span> <span class=skolem>y</span> <span class=main>∈</span> positive_x_axis"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> positive_y_axis_def positive_x_axis_def circline_set_def
    <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def moebius_similarity_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span> add_eq_0_iff<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
  <span class=keyword3><span class=command>assume</span></span> x<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> positive_x_axis"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?y</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=main>(</span>pi<span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>)</span> <span class=skolem>x</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"Im <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> <span class=keyword1>𝗂</span> <span class=main>/</span> <span class=skolem>b</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟷</span> Re <span class=main>(</span><span class=skolem>a</span> <span class=main>/</span> <span class=skolem>b</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>for</span></span> <span class=skolem>a</span> <span class=skolem>b</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> times_divide_eq_left <span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mult.commute<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Im_i_times<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?y</span> <span class=main>∈</span> positive_y_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>x</span> <span class=main>∈</span> positive_x_axis›</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> positive_x_axis_def positive_y_axis_def
    <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def moebius_similarity_def
    <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span> add_eq_0_iff<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> moebius_pt <span class=main>(</span>moebius_rotation <span class=main>(</span><span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>)</span> <span class=main>`</span> positive_y_axis"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?y</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Circline uniqueness›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Zero type circline uniqueness›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id="Circlines-unique_circline_type_zero_0'"><span class=command>lemma</span></span> unique_circline_type_zero_0'<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>circline_type circline_point_0 <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set circline_point_0<span class=main>)</span> <span class=main>∧</span>
         <span class=main>(</span><span class=main>∀</span> <span class=bound>H</span><span class=main>.</span> circline_type <span class=bound>H</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>⟶</span> <span class=bound>H</span> <span class=main>=</span> circline_point_0<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> circline_set_def
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"circline_type circline_point_0 <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"on_circline circline_point_0 <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_set_def zero_in_circline_point_0
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_type <span class=skolem>H</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"on_circline <span class=skolem>H</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> circline_point_0"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_type_cmat <span class=skolem>H</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=skolem>H</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=skolem>H</span> circline_point_0_cmat"</span></span>
      <span class=keyword1><span class=command>using</span></span> HH hh *
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def sgn_minus sgn_mult sgn_zero_iff<span class=main>)</span>
         <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span>Re <span class=skolem>A</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>B</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq sgn_zero_iff<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-unique_circline_type_zero_0><span class=command>lemma</span></span> unique_circline_type_zero_0<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>H</span><span class=main>.</span> circline_type <span class=bound>H</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=bound>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> unique_circline_type_zero_0'
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Circlines-unique_circline_type_zero><span class=command>lemma</span></span> unique_circline_type_zero<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>H</span><span class=main>.</span> circline_type <span class=bound>H</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>z</span> <span class=main>∈</span> circline_set <span class=bound>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> ++<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_moebius_1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> +++<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> moebius_pt <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> ++<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>H0</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"circline_type <span class=skolem>H0</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=skolem>H0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span> <span class=bound>H'</span><span class=main>.</span> circline_type <span class=bound>H'</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=bound>H'</span> <span class=main>⟶</span> <span class=bound>H'</span> <span class=main>=</span> <span class=skolem>H0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unique_circline_type_zero_0
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?H'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> <span class=skolem>H0</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>unfolding</span></span> Ex1_def
    <span class=keyword1><span class=command>using</span></span> * +++
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?H'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H'</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_type <span class=skolem>H'</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=skolem>H'</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=main>(</span>moebius_circline <span class=skolem>M</span> <span class=skolem>H'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> ++ +++
      <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M</span> <span class=skolem>H'</span> <span class=main>=</span> <span class=skolem>H0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> **<span class=main>[</span><span class=operator>rule_format</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M</span> <span class=skolem>H'</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹circline_type <span class=skolem>H'</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H'</span> <span class=main>=</span> moebius_circline <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> <span class=skolem>H0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Negative type circline uniqueness›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id="Circlines-unique_circline_01inf'"><span class=command>lemma</span></span> unique_circline_01inf'<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set x_axis <span class=main>∧</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set x_axis <span class=main>∧</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set x_axis <span class=main>∧</span>
        <span class=main>(</span><span class=main>∀</span> <span class=bound>H</span><span class=main>.</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=bound>H</span>  <span class=main>⟶</span> <span class=bound>H</span> <span class=main>=</span> x_axis<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=skolem>H</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=skolem>H</span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=skolem>H</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> x_axis"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
    <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>D</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟶</span> <span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span> hh HH
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>Bx</span></span> <span class=skolem><span class=skolem>By</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>=</span> Complex <span class=skolem>Bx</span> <span class=skolem>By</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>B</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=skolem>H</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span>"</span></span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=skolem>H</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>v</sub></span>"</span></span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=skolem>H</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=skolem>H</span> x_axis_cmat"</span></span>
      <span class=keyword1><span class=command>using</span></span> * HH <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>=</span> Complex <span class=skolem>Bx</span> <span class=skolem>By</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def Complex_eq<span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>By</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=operator>simp_all</span>

<span class=keyword1 id=Circlines-unique_circline_set><span class=command>lemma</span></span> unique_circline_set<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> <span class=free>B</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> <span class=free>C</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>≠</span> <span class=free>C</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>H</span><span class=main>.</span> <span class=free>A</span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> <span class=free>B</span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> <span class=free>C</span> <span class=main>∈</span> circline_set <span class=bound>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?P</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>λ</span> <span class=bound>A</span> <span class=bound>B</span> <span class=bound>C</span><span class=main>.</span> <span class=bound>A</span> <span class=main>≠</span> <span class=bound>B</span> <span class=main>∧</span> <span class=bound>A</span> <span class=main>≠</span> <span class=bound>C</span> <span class=main>∧</span> <span class=bound>B</span> <span class=main>≠</span> <span class=bound>C</span> <span class=main>⟶</span> <span class=main>(</span><span class=main>∃!</span> <span class=bound>H</span><span class=main>.</span> <span class=bound>A</span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> <span class=bound>B</span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> <span class=bound>C</span> <span class=main>∈</span> circline_set <span class=bound>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=free>A</span> <span class=free>B</span> <span class=free>C</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> wlog_moebius_01inf<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=var><span class=quoted><span class=var><span class=quoted><span class=var>?P</span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=main>(</span><span class=var>?M</span> <span class=skolem>a</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=skolem>b</span><span class=main>)</span> <span class=main>(</span><span class=var>?M</span> <span class=skolem>c</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=skolem>a</span> <span class=main>≠</span> <span class=var>?M</span> <span class=skolem>b</span> <span class=main>∧</span> <span class=var>?M</span> <span class=skolem>a</span> <span class=main>≠</span> <span class=var>?M</span> <span class=skolem>c</span> <span class=main>∧</span> <span class=var>?M</span> <span class=skolem>b</span> <span class=main>≠</span> <span class=var>?M</span> <span class=skolem>c</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=skolem>b</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>≠</span> <span class=skolem>c</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=skolem>c</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span><span class=bound>H</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> <span class=skolem>b</span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> <span class=skolem>c</span> <span class=main>∈</span> circline_set <span class=bound>H</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=var>?P</span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>H</span></span> <span class=keyword2><span class=keyword>where</span></span>
        *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> circline_set <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>b</span> <span class=main>∈</span> circline_set <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>c</span> <span class=main>∈</span> circline_set <span class=skolem>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
        **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>H'</span><span class=main>.</span> <span class=skolem>a</span> <span class=main>∈</span> circline_set <span class=bound>H'</span> <span class=main>∧</span> <span class=skolem>b</span> <span class=main>∈</span> circline_set <span class=bound>H'</span> <span class=main>∧</span> <span class=skolem>c</span> <span class=main>∈</span> circline_set <span class=bound>H'</span> <span class=main>⟶</span> <span class=bound>H'</span> <span class=main>=</span> <span class=skolem>H</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> Ex1_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?H'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M</span> <span class=skolem>H</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>H</span><span class=main>.</span> <span class=var>?M</span> <span class=skolem>a</span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> moebius_pt <span class=skolem>M</span> <span class=skolem>b</span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> moebius_pt <span class=skolem>M</span> <span class=skolem>c</span> <span class=main>∈</span> circline_set <span class=bound>H</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> Ex1_def
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?H'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span><span class=main>)</span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=skolem>a</span> <span class=main>∈</span> circline_set <span class=var>?H'</span> <span class=main>∧</span> <span class=var>?M</span> <span class=skolem>b</span> <span class=main>∈</span> circline_set <span class=var>?H'</span> <span class=main>∧</span> <span class=var>?M</span> <span class=skolem>c</span> <span class=main>∈</span> circline_set <span class=var>?H'</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> * 
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>H'</span><span class=main>.</span> <span class=var>?M</span> <span class=skolem>a</span> <span class=main>∈</span> circline_set <span class=bound>H'</span> <span class=main>∧</span> <span class=var>?M</span> <span class=skolem>b</span> <span class=main>∈</span> circline_set <span class=bound>H'</span> <span class=main>∧</span> <span class=var>?M</span> <span class=skolem>c</span> <span class=main>∈</span> circline_set <span class=bound>H'</span> <span class=main>⟶</span> <span class=bound>H'</span> <span class=main>=</span> <span class=var>?H'</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
          <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H'</span>
          <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?iH'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> <span class=skolem>H'</span>"</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=skolem>a</span> <span class=main>∈</span> circline_set <span class=skolem>H'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=skolem>b</span> <span class=main>∈</span> circline_set <span class=skolem>H'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=skolem>c</span> <span class=main>∈</span> circline_set <span class=skolem>H'</span>"</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> circline_set <span class=var>?iH'</span> <span class=main>∧</span> <span class=skolem>b</span> <span class=main>∈</span> circline_set <span class=var>?iH'</span> <span class=main>∧</span> <span class=skolem>c</span> <span class=main>∈</span> circline_set <span class=var>?iH'</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=var>?iH'</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> **
            <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H'</span> <span class=main>=</span> moebius_circline <span class=skolem>M</span> <span class=skolem>H</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> unique_circline_01inf'
      <span class=keyword1><span class=command>unfolding</span></span> Ex1_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"x_axis"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-zero_one_inf_x_axis><span class=command>lemma</span></span> zero_one_inf_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> x_axis"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms unique_circline_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Circline set cardinality›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Diagonal circlines›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_diag_circline_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>is_diag_circline_cmat</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>in</span> <span class=bound>B</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=bound>C</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> is_diag_circline_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>is_diag_circline_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>lift_definition</span></span> circline_diag <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>is_diag_circline_clmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines-circline_diagonalize><span class=command>lemma</span></span> circline_diagonalize<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>M</span> <span class=bound>H'</span><span class=main>.</span> moebius_circline <span class=bound>M</span> <span class=free>H</span> <span class=main>=</span> <span class=bound>H'</span> <span class=main>∧</span> circline_diag <span class=bound>H'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> HH_elems<span class=main>:</span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span> hh
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=skolem><span class=skolem>k1</span></span> <span class=skolem><span class=skolem>k2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"unitary <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"congruence <span class=skolem>M</span> <span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>k2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>k1</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>k2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hermitean_diagonizable<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>H</span></span><span class=main>]</span> hh
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k1</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>k2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹congruence <span class=skolem>M</span> <span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>k2</span><span class=main>)</span>›</span></span> hh congruence_nonzero<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>H</span></span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"mat_inv <span class=skolem>M</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?H'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>k1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>k2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=var>?M'</span> <span class=skolem>H</span><span class=main>)</span> <span class=var>?H'</span> <span class=main>∧</span> is_diag_circline_cmat <span class=var>?H'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?H'</span> <span class=main>∈</span> hermitean_nonzero"</span></span>
    <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=skolem>k1</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>k2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k1</span></span><span class=main>]</span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_det <span class=var>?M'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * mat_det_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>M</span><span class=main>∈</span><span class=main>{</span><span class=bound>M</span><span class=main>.</span> mat_det <span class=bound>M</span> <span class=main>≠</span> <span class=main>0</span><span class=main>}</span><span class=main>.</span>
            <span class=main>∃</span><span class=bound>H'</span><span class=main>∈</span>hermitean_nonzero<span class=main>.</span>
               circline_eq_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=bound>M</span> <span class=skolem>H</span><span class=main>)</span> <span class=bound>H'</span> <span class=main>∧</span> is_diag_circline_cmat <span class=bound>H'</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-wlog_circline_diag><span class=command>lemma</span></span> wlog_circline_diag<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>H</span><span class=main>.</span> circline_diag <span class=bound>H</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>H</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>M</span> <span class=bound>H</span><span class=main>.</span> <span class=free>P</span> <span class=bound>H</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>moebius_circline <span class=bound>M</span> <span class=bound>H</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=skolem><span class=skolem>H'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M</span> <span class=free>H</span> <span class=main>=</span> <span class=skolem>H'</span>"</span></span> <span class=quoted><span class=quoted>"circline_diag <span class=skolem>H'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_diagonalize<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=main>(</span>moebius_circline <span class=skolem>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M</span> <span class=free>H</span>"</span></span> <span class=quoted><span class=quoted>"moebius_inv <span class=skolem>M</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Zero type circline set cardinality›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id=Circlines-circline_type_zero_card_eq1_0><span class=command>lemma</span></span> circline_type_zero_card_eq1_0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=free>H</span> <span class=main>=</span> <span class=main>{</span><span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>unfolding</span></span> circline_set_def
<span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=skolem>z</span>"</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> circline_point_0"</span></span>
    <span class=keyword1><span class=command>using</span></span> unique_circline_type_zero_0'
    <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹on_circline <span class=free>H</span> <span class=skolem>z</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>H</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1 id=Circlines-circline_type_zero_card_eq1><span class=command>lemma</span></span> circline_type_zero_card_eq1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>z</span><span class=main>.</span> circline_set <span class=free>H</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>z</span><span class=main>.</span> on_circline <span class=free>H</span> <span class=bound>z</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
    <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_type_cmat <span class=skolem>H</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>H</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_eq_if_Re_eq hh mat_det_hermitean_real sgn_eq_0_iff<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span><span class=main>*</span><span class=skolem>D</span> <span class=main>=</span> <span class=skolem>B</span><span class=main>*</span><span class=skolem>C</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> HH
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"Bex <span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span> <span class=main>(</span>on_circline_cmat_cvec <span class=skolem>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹<span class=skolem>A</span><span class=main>*</span><span class=skolem>D</span> <span class=main>=</span> <span class=skolem>B</span><span class=main>*</span><span class=skolem>C</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=skolem>B</span><span class=main>,</span> <span class=skolem>A</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main>)</span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=skolem>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_moebius_1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=main>(</span>moebius_circline <span class=skolem>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> on_circline_moebius_circline_I<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹on_circline <span class=free>H</span> <span class=skolem>z</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>moebius_circline <span class=skolem>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=main>{</span><span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_type_zero_card_eq1_0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M</span> <span class=free>H</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹circline_type <span class=free>H</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"circline_set <span class=free>H</span> <span class=main>=</span> <span class=main>{</span><span class=skolem>z</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹moebius_pt <span class=skolem>M</span> <span class=skolem>z</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> bij_moebius_pt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span> bij_image_singleton<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"circline_set <span class=free>H</span>"</span></span> <span class=main>_</span> <span class=quoted><span class=skolem>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Negative type circline set cardinality›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id=Circlines-quad_form_diagonal_iff><span class=command>lemma</span></span> quad_form_diagonal_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>k1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>k2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Re <span class=free>k1</span> <span class=main>*</span> Re <span class=free>k2</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"quad_form <span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span><span class=free>k1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=free>k2</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>φ</span><span class=main>.</span> <span class=free>z1</span> <span class=main>=</span> rcis <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>-</span><span class=free>k2</span> <span class=main>/</span><span class=free>k1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>φ</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>-</span><span class=free>k2</span><span class=main>/</span><span class=free>k1</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>k1</span> <span class=main>*</span> Re <span class=free>k2</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>k1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>k2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>k1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> Re_divide_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>k1</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>k2</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> divide_less_0_iff mult_nonneg_nonneg mult_nonpos_nonpos uminus_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"quad_form <span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span><span class=free>k1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=free>k2</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=main>(</span>cor <span class=main>(</span>cmod <span class=free>z1</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>-</span><span class=free>k2</span> <span class=main>/</span> <span class=free>k1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms add_eq_0_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>k2</span></span> <span class=quoted><span class=quoted>"<span class=free>k1</span><span class=main>*</span><span class=main>(</span>cor <span class=main>(</span>cmod <span class=free>z1</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> eq_divide_imp<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>k1</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cor <span class=main>(</span>cmod <span class=free>z1</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>k2</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span> complex_mult_cnj_cmod<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>⟷</span> <span class=main>(</span>cmod <span class=free>z1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> Re <span class=main>(</span><span class=main>-</span><span class=free>k2</span> <span class=main>/</span><span class=free>k1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> complex_eq_if_Re_eq<span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> Re_complex_of_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=free>z1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span><span class=main>]</span> div_reals
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>⟷</span> cmod <span class=free>z1</span> <span class=main>=</span> sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>-</span><span class=free>k2</span> <span class=main>/</span><span class=free>k1</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> norm_ge_zero real_sqrt_ge_0_iff real_sqrt_pow2 real_sqrt_power<span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>φ</span><span class=main>.</span> <span class=free>z1</span> <span class=main>=</span> rcis <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>-</span><span class=free>k2</span> <span class=main>/</span><span class=free>k1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=bound>φ</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> rcis_cmod_arg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z1</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span> assms abs_of_nonneg<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>-</span><span class=free>k2</span><span class=main>/</span><span class=free>k1</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=main>-</span><span class=free>k2</span><span class=main>/</span><span class=free>k1</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>.</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-circline_type_neg_card_gt3_diag><span class=command>lemma</span></span> circline_type_neg_card_gt3_diag<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"circline_diag <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>A</span> <span class=bound>B</span> <span class=bound>C</span><span class=main>.</span> <span class=bound>A</span> <span class=main>≠</span> <span class=bound>B</span> <span class=main>∧</span> <span class=bound>A</span> <span class=main>≠</span> <span class=bound>C</span> <span class=main>∧</span> <span class=bound>B</span> <span class=main>≠</span> <span class=bound>C</span> <span class=main>∧</span> <span class=main>{</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> HOL.ex_simps<span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> HH_elems<span class=main>:</span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span> hh
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_type_cmat <span class=skolem>H</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"is_diag_circline_cmat <span class=skolem>H</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>*</span> Re <span class=skolem>D</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?x</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>-</span> <span class=skolem>D</span> <span class=main>/</span> <span class=skolem>A</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>rcis <span class=var>?x</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>rcis <span class=var>?x</span> <span class=main>(</span>pi<span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>rcis <span class=var>?x</span> pi<span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>from</span></span> quad_form_diagonal_iff<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹Re <span class=skolem>A</span> <span class=main>*</span> Re <span class=skolem>D</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"quad_form <span class=var>?A</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"quad_form <span class=var>?B</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"quad_form <span class=var>?C</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> rcis_zero_arg<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=skolem>H</span> <span class=var>?A</span> <span class=main>∧</span> on_circline_cmat_cvec <span class=skolem>H</span> <span class=var>?B</span> <span class=main>∧</span> on_circline_cmat_cvec <span class=skolem>H</span> <span class=var>?C</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>                                    
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=skolem>D</span> <span class=main>/</span> <span class=skolem>A</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=skolem>A</span> <span class=main>*</span> Re <span class=skolem>D</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> Re_divide_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>A</span></span> <span class=quoted><span class=skolem>D</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Re_complex_div_lt_0 Re_mult_real div_reals eq_cnj_iff_real is_real_div<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=var>?A</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=var>?B</span> <span class=main>∧</span> <span class=main>¬</span> <span class=var>?A</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=var>?C</span> <span class=main>∧</span> <span class=main>¬</span> <span class=var>?B</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=var>?C</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> rcis_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cis_def complex.corec<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=var>?B</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>≠</span> vec_zero"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>A</span><span class=main>∈</span><span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span><span class=main>.</span> <span class=main>∃</span><span class=bound>B</span><span class=main>∈</span><span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span><span class=main>.</span> <span class=main>∃</span><span class=bound>C</span><span class=main>∈</span><span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span><span class=main>.</span>
            <span class=main>¬</span> <span class=bound>A</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=bound>B</span> <span class=main>∧</span> <span class=main>¬</span> <span class=bound>A</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=bound>C</span> <span class=main>∧</span> <span class=main>¬</span> <span class=bound>B</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=bound>C</span> <span class=main>∧</span>
            on_circline_cmat_cvec <span class=skolem>H</span> <span class=bound>A</span> <span class=main>∧</span> on_circline_cmat_cvec <span class=skolem>H</span> <span class=bound>B</span> <span class=main>∧</span> on_circline_cmat_cvec <span class=skolem>H</span> <span class=bound>C</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-circline_type_neg_card_gt3><span class=command>lemma</span></span> circline_type_neg_card_gt3<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>A</span> <span class=bound>B</span> <span class=bound>C</span><span class=main>.</span> <span class=bound>A</span> <span class=main>≠</span> <span class=bound>B</span> <span class=main>∧</span> <span class=bound>A</span> <span class=main>≠</span> <span class=bound>C</span> <span class=main>∧</span> <span class=bound>B</span> <span class=main>≠</span> <span class=bound>C</span> <span class=main>∧</span> <span class=main>{</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=free>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=skolem><span class=skolem>H'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M</span> <span class=free>H</span> <span class=main>=</span> <span class=skolem>H'</span>"</span></span> <span class=quoted><span class=quoted>"circline_diag <span class=skolem>H'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_diagonalize<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"circline_type <span class=skolem>H'</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms moebius_preserve_circline_type
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>B</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>C</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>≠</span> <span class=skolem>C</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=skolem>H'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_type_neg_card_gt3_diag<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>H'</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?iM</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_inv <span class=skolem>M</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=var>?iM</span> <span class=skolem>H'</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹moebius_circline <span class=skolem>M</span> <span class=free>H</span> <span class=main>=</span> <span class=skolem>H'</span>›</span></span><span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=var>?iM</span> <span class=skolem>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span><span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=var>?iM</span> <span class=skolem>B</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=var>?iM</span> <span class=skolem>C</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=var>?B</span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=var>?C</span> <span class=main>∈</span> circline_set <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹moebius_circline <span class=var>?iM</span> <span class=skolem>H'</span> <span class=main>=</span> <span class=free>H</span>›</span></span><span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=main>{</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=skolem>H'</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>≠</span> <span class=var>?B</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>≠</span> <span class=var>?C</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?B</span> <span class=main>≠</span> <span class=var>?C</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>B</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>C</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>≠</span> <span class=skolem>C</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Positive type circline set cardinality›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id=Circlines-circline_type_pos_card_eq0_diag><span class=command>lemma</span></span> circline_type_pos_card_eq0_diag<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_diag <span class=free>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=free>H</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>unfolding</span></span> circline_set_def
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> HH_elems<span class=main>:</span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span> hh
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"is_diag_circline_cmat <span class=skolem>H</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> circline_type_cmat <span class=skolem>H</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>*</span> Re <span class=skolem>D</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span><span class=main>.</span> <span class=main>¬</span> on_circline_cmat_cvec <span class=skolem>H</span> <span class=bound>x</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span>"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x1</span></span> <span class=skolem><span class=skolem>x2</span></span> <span class=keyword2><span class=keyword>where</span></span> xx<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x1</span><span class=main>,</span> <span class=skolem>x2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>x</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Re <span class=skolem>A</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> Re <span class=skolem>D</span> <span class=main>&gt;</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span>Re <span class=skolem>A</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>∧</span> Re <span class=skolem>D</span> <span class=main>&lt;</span> <span class=main>0</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=skolem>A</span> <span class=main>*</span> Re <span class=skolem>D</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> linorder_neqE_linordered_idom mult_eq_0_iff zero_less_mult_pos zero_less_mult_pos2<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Re <span class=main>(</span><span class=skolem>x1</span> <span class=main>*</span> cnj <span class=skolem>x1</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>∧</span> Re <span class=main>(</span><span class=skolem>x2</span> <span class=main>*</span> cnj <span class=skolem>x2</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span>Re <span class=main>(</span><span class=skolem>x1</span> <span class=main>*</span> cnj <span class=skolem>x1</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> Re <span class=main>(</span><span class=skolem>x2</span> <span class=main>*</span> cnj <span class=skolem>x2</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>x</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>v</span><span class=main>.</span> <span class=bound>v</span> <span class=main>≠</span> vec_zero<span class=main>}</span>›</span></span> xx
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_neq_0 power2_eq_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>*</span> Re <span class=main>(</span><span class=skolem>x1</span> <span class=main>*</span> cnj <span class=skolem>x1</span><span class=main>)</span> <span class=main>+</span> Re <span class=skolem>D</span> <span class=main>*</span> Re <span class=main>(</span><span class=skolem>x2</span> <span class=main>*</span> cnj <span class=skolem>x2</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> mult_neg_pos mult_nonneg_nonneg mult_nonpos_nonneg mult_pos_pos<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>x1</span> <span class=main>*</span> cnj <span class=skolem>x1</span><span class=main>)</span> <span class=main>+</span> <span class=skolem>D</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>x2</span> <span class=main>*</span> cnj <span class=skolem>x2</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Re_mult_real plus_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> zero_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> on_circline_cmat_cvec <span class=skolem>H</span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> <span class=main>0</span>›</span></span> xx
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-circline_type_pos_card_eq0><span class=command>lemma</span></span> circline_type_pos_card_eq0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=free>H</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=skolem><span class=skolem>H'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M</span> <span class=free>H</span> <span class=main>=</span> <span class=skolem>H'</span>"</span></span> <span class=quoted><span class=quoted>"circline_diag <span class=skolem>H'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_diagonalize<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"circline_type <span class=skolem>H'</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms moebius_preserve_circline_type
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"circline_set <span class=skolem>H'</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_type_pos_card_eq0_diag<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>H'</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?iM</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_inv <span class=skolem>M</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=var>?iM</span> <span class=skolem>H'</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹moebius_circline <span class=skolem>M</span> <span class=free>H</span> <span class=main>=</span> <span class=skolem>H'</span>›</span></span><span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹circline_set <span class=skolem>H'</span> <span class=main>=</span> <span class=main>{}</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Cardinality determines type›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id=Circlines-card_eq1_circline_type_zero><span class=command>lemma</span></span> card_eq1_circline_type_zero<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>z</span><span class=main>.</span> circline_set <span class=free>H</span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> circline_type_neg_card_gt3<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> circline_type_pos_card_eq0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span> assms
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=main>(</span>circline_type <span class=free>H</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Circline set is injective›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id=Circlines-inj_circline_set><span class=command>lemma</span></span> inj_circline_set<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_set <span class=free>H</span> <span class=main>=</span> circline_set <span class=free>H'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"circline_set <span class=free>H</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> <span class=free>H'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>B</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>C</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>≠</span> <span class=skolem>C</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_type_neg_card_gt3<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span><span class=bound>H</span><span class=main>.</span> <span class=skolem>A</span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> <span class=skolem>B</span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> <span class=skolem>C</span> <span class=main>∈</span> circline_set <span class=bound>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unique_circline_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>A</span></span> <span class=quoted><span class=skolem>B</span></span> <span class=quoted><span class=skolem>C</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹circline_set <span class=free>H</span> <span class=main>=</span> circline_set <span class=free>H'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>{</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=free>H</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>then</span></span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=skolem>A</span><span class=main>}</span> <span class=main>=</span> circline_set <span class=free>H</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> circline_type_zero_card_eq1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H'</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹circline_set <span class=free>H</span> <span class=main>=</span> circline_set <span class=free>H'</span>›</span></span> card_eq1_circline_type_zero<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H'</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> unique_circline_type_zero<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>A</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹circline_set <span class=free>H</span> <span class=main>=</span> circline_set <span class=free>H'</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=main>(</span>circline_type <span class=free>H</span> <span class=main>&lt;</span> <span class=main>0</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹circline_set <span class=free>H</span> <span class=main>≠</span> <span class=main>{}</span>›</span></span>  circline_type_pos_card_eq0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Circline points - cross ratio real›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id=Circlines-four_points_on_circline_iff_cross_ratio_real><span class=command>lemma</span></span> four_points_on_circline_iff_cross_ratio_real<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>[</span><span class=free>z</span><span class=main>,</span> <span class=free>u</span><span class=main>,</span> <span class=free>v</span><span class=main>,</span> <span class=free>w</span><span class=main>]</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=main>(</span>cross_ratio <span class=free>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>⟷</span> 
         <span class=main>(</span><span class=main>∃</span> <span class=bound>H</span><span class=main>.</span> <span class=main>{</span><span class=free>z</span><span class=main>,</span> <span class=free>u</span><span class=main>,</span> <span class=free>v</span><span class=main>,</span> <span class=free>w</span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=bound>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span> <span class=bound>z</span><span class=main>.</span> distinct <span class=main>[</span><span class=bound>z</span><span class=main>,</span> <span class=free>u</span><span class=main>,</span> <span class=free>v</span><span class=main>,</span> <span class=free>w</span><span class=main>]</span> <span class=main>⟶</span> is_real <span class=main>(</span>to_complex <span class=main>(</span>cross_ratio <span class=bound>z</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span><span class=main>)</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>H</span><span class=main>.</span> <span class=main>{</span><span class=bound>z</span><span class=main>,</span> <span class=free>u</span><span class=main>,</span> <span class=free>v</span><span class=main>,</span> <span class=free>w</span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=bound>H</span><span class=main>)</span>"</span></span>
       <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=free>u</span> <span class=free>v</span> <span class=free>w</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> wlog_moebius_01inf<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=var><span class=quoted><span class=var><span class=quoted><span class=var>?P</span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>u</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>v</span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free>w</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span>
    <span class=keyword3><span class=command>assume</span></span> aa<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=skolem>c</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Ma</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=skolem>a</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Mb</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=skolem>b</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?Mc</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=skolem>c</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=var>?Ma</span> <span class=var>?Mb</span> <span class=var>?Mc</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> allI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule</span> impI<span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
      <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> moebius_pt <span class=skolem>M</span> <span class=skolem>d</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> bij_moebius_pt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>unfolding</span></span> bij_def
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Md</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=skolem>d</span>"</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>[</span><span class=skolem>z</span><span class=main>,</span> moebius_pt <span class=skolem>M</span> <span class=skolem>a</span><span class=main>,</span> moebius_pt <span class=skolem>M</span> <span class=skolem>b</span><span class=main>,</span> moebius_pt <span class=skolem>M</span> <span class=skolem>c</span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>[</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>]</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> *
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>∃</span> <span class=bound>H</span><span class=main>.</span> <span class=main>{</span><span class=skolem>d</span><span class=main>,</span> <span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=bound>H</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>H</span><span class=main>.</span> <span class=main>{</span><span class=skolem>z</span><span class=main>,</span> <span class=var>?Ma</span><span class=main>,</span> <span class=var>?Mb</span><span class=main>,</span> <span class=var>?Mc</span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=bound>H</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> *
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M</span> <span class=improper>H</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> <span class=improper>H</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=main>(</span>cross_ratio <span class=skolem>z</span> <span class=var>?Ma</span> <span class=var>?Mb</span> <span class=var>?Mc</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∃</span><span class=bound>H</span><span class=main>.</span> <span class=main>{</span><span class=skolem>z</span><span class=main>,</span> <span class=var>?Ma</span><span class=main>,</span> <span class=var>?Mb</span><span class=main>,</span> <span class=var>?Mc</span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=bound>H</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> aa<span class=main>[</span><span class=operator>rule_format</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>d</span></span><span class=main>]</span> *
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"distinct <span class=main>[</span><span class=skolem>z</span><span class=main>,</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span><span class=main>,</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span><span class=main>,</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>]</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=main>(</span>cross_ratio <span class=skolem>z</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=skolem>z</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> circline_set x_axis"</span></span>
        <span class=keyword1><span class=command>using</span></span> of_complex_to_complex<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> circline_set_x_axis
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>H</span><span class=main>.</span> <span class=main>{</span><span class=skolem>z</span><span class=main>,</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span><span class=main>,</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span><span class=main>,</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=bound>H</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted>x_axis</span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>H</span>
      <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"distinct <span class=main>[</span><span class=skolem>z</span><span class=main>,</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span><span class=main>,</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span><span class=main>,</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>]</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=skolem>z</span><span class=main>,</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span><span class=main>,</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span><span class=main>,</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span> <span class=main>⊆</span> circline_set <span class=skolem>H</span>"</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> x_axis"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> circline_set x_axis"</span></span>
        <span class=keyword1><span class=command>using</span></span> *
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=skolem>z</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> * circline_set_x_axis
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=main>(</span>cross_ratio <span class=skolem>z</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>≠</span> <span class=free>w</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>w</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Symmetric points wrt. circline›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In the extended complex plane there are no substantial differences between circles and lines,
so we will consider only one kind of relation and call two points \emph{circline symmetric} if they
are mapped to one another using either reflection or inversion over arbitrary line or circle. Points
are symmetric iff the bilinear form of their representation vectors and matrix is zero.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>circline_symmetric_cvec_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_vec <span class=main>⇒</span> complex_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>circline_symmetric_cvec_cmat</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>⟷</span> bilinear_form <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> circline_symmetric_hcoords_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> circline_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_symmetric_cvec_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>lift_definition</span></span> circline_symmetric <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex_homo <span class=main>⇒</span> circline <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_symmetric_hcoords_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> bilinear_form_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> bilinear_form_scale_m bilinear_form_scale_v1 bilinear_form_scale_v2 <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> vec_cnj_sv quad_form_def bilinear_form_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Circlines-symmetry_principle><span class=command>lemma</span></span> symmetry_principle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_symmetric <span class=free>z1</span> <span class=free>z2</span> <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_symmetric <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=free>z1</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=free>z2</span><span class=main>)</span> <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> bilinear_form_def congruence_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Symmetry wrt. <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>"unit_circle"</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>›</span></span>
<span class=keyword1 id=Circlines-circline_symmetric_0inf_disc><span class=command>lemma</span></span> circline_symmetric_0inf_disc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_symmetric <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> unit_circle"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Circlines-circline_symmetric_inv_homo_disc><span class=command>lemma</span></span> circline_symmetric_inv_homo_disc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_symmetric <span class=free>a</span> <span class=main>(</span>inversion <span class=free>a</span><span class=main>)</span> unit_circle"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> inversion_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id="Circlines-circline_symmetric_inv_homo_disc'"><span class=command>lemma</span></span> circline_symmetric_inv_homo_disc'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_symmetric <span class=free>a</span> <span class=free>a'</span> unit_circle"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>a'</span> <span class=main>=</span> inversion <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> inversion_def
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>a'</span>
  <span class=keyword3><span class=command>assume</span></span> vz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a1</span></span> <span class=skolem><span class=skolem>a2</span></span> <span class=keyword2><span class=keyword>where</span></span> aa<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a1</span><span class=main>,</span> <span class=skolem>a2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a1'</span></span> <span class=skolem><span class=skolem>a2'</span></span> <span class=keyword2><span class=keyword>where</span></span> aa'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a1'</span><span class=main>,</span> <span class=skolem>a2'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>a'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"circline_symmetric_cvec_cmat <span class=skolem>a</span> <span class=skolem>a'</span> unit_circle_cmat"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span>conjugate_cvec <span class=main>∘</span> reciprocal_cvec<span class=main>)</span> <span class=skolem>a</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>a1'</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> aa aa' vz *
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>a2</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a1'</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> aa aa' * vz
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span>  vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a1'</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> aa aa' *
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"cnj <span class=skolem>a2</span> <span class=main>/</span> <span class=skolem>a1'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-ex_moebius_circline_x_axis><span class=command>lemma</span></span> ex_moebius_circline_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> moebius_circline <span class=bound>M</span> <span class=free>H</span> <span class=main>=</span> x_axis"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>B</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>C</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>≠</span> <span class=skolem>C</span>"</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=skolem>B</span>"</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=skolem>C</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_type_neg_card_gt3<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=skolem>A</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=skolem>B</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=skolem>C</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_moebius_01inf <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M</span> <span class=free>H</span> <span class=main>=</span> x_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> circline_set_I circline_set_moebius_circline rev_image_eqI unique_circline_01inf'<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-wlog_circline_x_axis><span class=command>lemma</span></span> wlog_circline_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_type <span class=free>H</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>M</span> <span class=bound>H</span><span class=main>.</span> <span class=free>P</span> <span class=bound>H</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>moebius_circline <span class=bound>M</span> <span class=bound>H</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> x_axis"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M</span> <span class=free>H</span> <span class=main>=</span> x_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_moebius_circline_x_axis<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=skolem>M'</span> x_axis <span class=main>=</span> <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> moebius_circline_comp_inv_left<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>2<span class=main>)</span><span class=main>[</span><span class=operator>of</span> <span class=quoted>x_axis</span> <span class=quoted><span class=skolem>M'</span></span><span class=main>]</span> assms<span class=main>(</span>3<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines-circline_intersection_at_most_2_points><span class=command>lemma</span></span> circline_intersection_at_most_2_points<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>H1</span> <span class=main>≠</span> <span class=free>H2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"finite <span class=main>(</span>circline_intersection <span class=free>H1</span> <span class=free>H2</span><span class=main>)</span> <span class=main>∧</span> card <span class=main>(</span>circline_intersection <span class=free>H1</span> <span class=free>H2</span><span class=main>)</span> <span class=main>≤</span> <span class=numeral>2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ccontr<span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=var>?thesis</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>circline_intersection <span class=free>H1</span> <span class=free>H2</span><span class=main>)</span> <span class=main>∨</span> card <span class=main>(</span>circline_intersection <span class=free>H1</span> <span class=free>H2</span><span class=main>)</span> <span class=main>&gt;</span> <span class=numeral>2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>A</span> <span class=bound>B</span> <span class=bound>C</span><span class=main>.</span> <span class=bound>A</span> <span class=main>≠</span> <span class=bound>B</span> <span class=main>∧</span> <span class=bound>B</span> <span class=main>≠</span> <span class=bound>C</span> <span class=main>∧</span> <span class=bound>A</span> <span class=main>≠</span> <span class=bound>C</span> <span class=main>∧</span> <span class=main>{</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>}</span> <span class=main>⊆</span> circline_intersection <span class=free>H1</span> <span class=free>H2</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"card <span class=main>(</span>circline_intersection <span class=free>H1</span> <span class=free>H2</span><span class=main>)</span> <span class=main>&gt;</span> <span class=numeral>2</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> card_geq_3_iff_contains_3_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"circline_intersection <span class=free>H1</span> <span class=free>H2</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"infinite <span class=main>(</span>circline_intersection <span class=free>H1</span> <span class=free>H2</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> infinite_contains_3_elems
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>B</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>≠</span> <span class=skolem>C</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>C</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>{</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>}</span> <span class=main>⊆</span> circline_intersection <span class=free>H1</span> <span class=free>H2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>H2</span> <span class=main>=</span> <span class=free>H1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> circline_intersection_def mem_Collect_eq unique_circline_set <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted>False</span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>
              
<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Oriented_Circlines>
<div class=head>
<h1>Theory Oriented_Circlines</h1>
</div>
<pre class=source><span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Oriented circlines›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>theory</span></span> Oriented_Circlines
<span class=keyword2><span class=keyword>imports</span></span> <a href=#Circlines>Circlines</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Oriented circlines definition›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In this section we describe how the orientation is introduced for the circlines. Similarly as
the set of circline points, the set of disc points is introduced using the quadratic form induced by
the circline matrix --- the set of points of the circline disc is the set of points such that
satisfy that $A\cdot z\cdot \overline{z} + B\cdot \overline{z} + C\cdot z + D &lt; 0$, where
$(A, B, C, D)$ is a circline matrix representative Hermitean matrix. As the
set of disc points must be invariant to the choice of representative, it is clear that oriented
circlines matrices are equivalent only if they are proportional by a positive real factor (recall
that unoriented circline allowed arbitrary non-zero real factors).›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>ocircline_eq_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>ocircline_eq_cmat</span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=free><span class=bound><span class=entity>B</span></span></span> <span class=main>⟷</span><span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>::</span>real<span class=main>.</span> <span class=bound>k</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>B</span></span></span> <span class=main>=</span> cor <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> ocircline_eq_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> circline_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>ocircline_eq_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Oriented_Circlines-ocircline_eq_cmat_id><span class=command>lemma</span></span> ocircline_eq_cmat_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=free>H</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>quotient_type</span></span> ocircline <span class=main>=</span> <span class=quoted>circline_mat</span> <span class=main>/</span> <span class=quoted>ocircline_eq_clmat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> equivpI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"reflp ocircline_eq_clmat"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> reflp_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"symp ocircline_eq_clmat"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> symp_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> ocircline_eq_cmat_def<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=improper>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"transp ocircline_eq_clmat"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> transp_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>only</span><span class=main><span class=main>:</span></span> ocircline_eq_cmat_def<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>k</span><span class=main>*</span><span class=improper>ka</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Points on oriented circlines›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Boundary of the circline.›</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> on_ocircline <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline <span class=main>⇒</span> complex_homo <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>on_circline_clmat_hcoords</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> quad_form_def<span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> quad_form_scale_m quad_form_scale_v <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> quad_form_def<span class=main>)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>ocircline_set</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline <span class=main>⇒</span> complex_homo set"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>ocircline_set</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> on_ocircline <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=bound>z</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=Oriented_Circlines-ocircline_set_I><span class=command>lemma</span></span> ocircline_set_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"on_ocircline <span class=free>H</span> <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> ocircline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> ocircline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Disc and disc complement - in and out points›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Interior and the exterior of an oriented circline.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>in_ocircline_cmat_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_vec <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>in_ocircline_cmat_cvec</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>⟷</span> Re <span class=main>(</span>quad_form <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> in_ocircline_clmat_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>in_ocircline_cmat_cvec</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>lift_definition</span></span> in_ocircline <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline <span class=main>⇒</span> complex_homo <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>in_ocircline_clmat_hcoords</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=skolem>H'</span> <span class=skolem>z</span> <span class=skolem>z'</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H'</span> <span class=main>∧</span> <span class=skolem>H'</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span>
             <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=skolem>H</span> <span class=skolem>H'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z'</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=keyword2><span class=keyword>where</span></span>
    *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H'</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>=</span> <span class=skolem>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span>  <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"quad_form <span class=skolem>z'</span> <span class=skolem>H'</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>k'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> quad_form <span class=skolem>z</span> <span class=skolem>H</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> quad_form_scale_v quad_form_scale_m <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> vec_cnj_sv quad_form_def<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>quad_form <span class=skolem>z'</span> <span class=skolem>H'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>k</span> <span class=main>*</span> <span class=main>(</span>cmod <span class=skolem>k'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> Re <span class=main>(</span>quad_form <span class=skolem>z</span> <span class=skolem>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hh quad_form_hermitean_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>H</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"in_ocircline_cmat_cvec <span class=skolem>H</span> <span class=skolem>z</span> <span class=main>=</span> in_ocircline_cmat_cvec <span class=skolem>H'</span> <span class=skolem>z'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k'</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> mult_less_0_iff
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>disc</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline <span class=main>⇒</span> complex_homo set"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>disc</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> in_ocircline <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=bound>z</span><span class=main>}</span>"</span></span>

<span class=keyword1 id=Oriented_Circlines-disc_I><span class=command>lemma</span></span> disc_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"in_ocircline <span class=free>H</span> <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> disc <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> disc_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>out_ocircline_cmat_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_vec <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>out_ocircline_cmat_cvec</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>⟷</span> Re <span class=main>(</span>quad_form <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> out_ocircline_clmat_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>out_ocircline_cmat_cvec</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>lift_definition</span></span> out_ocircline <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline <span class=main>⇒</span> complex_homo <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>out_ocircline_clmat_hcoords</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=skolem>H'</span> <span class=skolem>z</span> <span class=skolem>z'</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H'</span> <span class=main>∧</span> <span class=skolem>H'</span> <span class=main>≠</span> mat_zero"</span></span>
             <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=skolem>H</span> <span class=skolem>H'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z'</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=keyword2><span class=keyword>where</span></span>
    *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H'</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>=</span> <span class=skolem>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span>  <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"quad_form <span class=skolem>z'</span> <span class=skolem>H'</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=skolem>k'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> quad_form <span class=skolem>z</span> <span class=skolem>H</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> quad_form_scale_v quad_form_scale_m <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> vec_cnj_sv quad_form_def<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>quad_form <span class=skolem>z'</span> <span class=skolem>H'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>k</span> <span class=main>*</span> <span class=main>(</span>cmod <span class=skolem>k'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> Re <span class=main>(</span>quad_form <span class=skolem>z</span> <span class=skolem>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hh quad_form_hermitean_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>H</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"out_ocircline_cmat_cvec <span class=skolem>H</span> <span class=skolem>z</span> <span class=main>=</span> out_ocircline_cmat_cvec <span class=skolem>H'</span> <span class=skolem>z'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k'</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> zero_less_mult_pos
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>disc_compl</span> <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline <span class=main>⇒</span> complex_homo set"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>disc_compl</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> out_ocircline <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=bound>z</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹These three sets are mutually disjoint and they fill up the entire plane.›</span></span>

<span class=keyword1 id=Oriented_Circlines-disc_compl_I><span class=command>lemma</span></span> disc_compl_I <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"out_ocircline <span class=free>H</span> <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> disc_compl <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> disc_compl_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Oriented_Circlines-in_on_out><span class=command>lemma</span></span> in_on_out<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"in_ocircline <span class=free>H</span> <span class=free>z</span> <span class=main>∨</span> on_ocircline <span class=free>H</span> <span class=free>z</span> <span class=main>∨</span> out_ocircline <span class=free>H</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command>using</span></span> quad_form_hermitean_real
  <span class=keyword1><span class=command>using</span></span> complex_eq_if_Re_eq
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Oriented_Circlines-in_on_out_univ><span class=command>lemma</span></span> in_on_out_univ<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"disc <span class=free>H</span> <span class=main>∪</span> disc_compl <span class=free>H</span> <span class=main>∪</span> ocircline_set <span class=free>H</span> <span class=main>=</span> UNIV"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> disc_def disc_compl_def ocircline_set_def
  <span class=keyword1><span class=command>using</span></span> in_on_out<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Oriented_Circlines-disc_inter_disc_compl><span class=command>lemma</span></span> disc_inter_disc_compl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"disc <span class=free>H</span> <span class=main>∩</span> disc_compl <span class=free>H</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> disc_def disc_compl_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-disc_inter_ocircline_set><span class=command>lemma</span></span> disc_inter_ocircline_set <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"disc <span class=free>H</span> <span class=main>∩</span> ocircline_set <span class=free>H</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> disc_def ocircline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-disc_compl_inter_ocircline_set><span class=command>lemma</span></span> disc_compl_inter_ocircline_set <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"disc_compl <span class=free>H</span> <span class=main>∩</span> ocircline_set <span class=free>H</span> <span class=main>=</span> <span class=main>{}</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> disc_compl_def ocircline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Opposite orientation›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Finding opposite circline is idempotent, and opposite circlines share the same set of points,
but exchange disc and its complement.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>opposite_ocircline_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>opposite_ocircline_cmat</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free><span class=bound><span class=entity>H</span></span></span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> opposite_ocircline_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> circline_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>opposite_ocircline_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>lift_definition</span></span> opposite_ocircline <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline <span class=main>⇒</span> ocircline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>opposite_ocircline_clmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>

<span class=keyword1 id=Oriented_Circlines-opposite_ocircline_involution><span class=command>lemma</span></span> opposite_ocircline_involution <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"opposite_ocircline <span class=main>(</span>opposite_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main><span class=main>1</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-on_circline_opposite_ocircline_cmat><span class=command>lemma</span></span> on_circline_opposite_ocircline_cmat <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span> <span class=main>∧</span> <span class=free>H</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline_cmat_cvec <span class=main>(</span>opposite_ocircline_cmat <span class=free>H</span><span class=main>)</span> <span class=free>z</span> <span class=main>=</span> on_circline_cmat_cvec <span class=free>H</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> quad_form_scale_m <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> quad_form_def<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-on_circline_opposite_ocircline><span class=command>lemma</span></span> on_circline_opposite_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_ocircline <span class=main>(</span>opposite_ocircline <span class=free>H</span><span class=main>)</span> <span class=free>z</span> <span class=main>⟷</span> on_ocircline <span class=free>H</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> on_circline_opposite_ocircline_cmat
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-ocircline_set_opposite_ocircline><span class=command>lemma</span></span> ocircline_set_opposite_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ocircline_set <span class=main>(</span>opposite_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> ocircline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ocircline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Oriented_Circlines-disc_compl_opposite_ocircline><span class=command>lemma</span></span> disc_compl_opposite_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"disc_compl <span class=main>(</span>opposite_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> disc <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> disc_def disc_compl_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>auto</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
   <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> quad_form_scale_m <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> quad_form_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span> <span class=main><span class=keyword3>,</span></span><span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> quad_form_scale_m <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> quad_form_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Oriented_Circlines-disc_opposite_ocircline><span class=command>lemma</span></span> disc_opposite_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"disc <span class=main>(</span>opposite_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> disc_compl <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> disc_compl_opposite_ocircline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"opposite_ocircline <span class=free>H</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Positive orientation. Conversion between unoriented and oriented circlines›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Given an oriented circline, one can trivially obtain its unoriented counterpart, and these two
share the same set of points.›</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> of_ocircline <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline <span class=main>⇒</span> circline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"id<span class=main>::</span>circline_mat <span class=main>⇒</span> circline_mat"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> exE<span class=main><span class=keyword3>,</span></span> <span class=operator>force</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-of_ocircline_opposite_ocircline><span class=command>lemma</span></span> of_ocircline_opposite_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_ocircline <span class=main>(</span>opposite_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> of_ocircline <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> exE<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-on_ocircline_of_circline><span class=command>lemma</span></span> on_ocircline_of_circline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_circline <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span> <span class=free>z</span> <span class=main>⟷</span> on_ocircline <span class=free>H</span> <span class=free>z</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-circline_set_of_ocircline><span class=command>lemma</span></span> circline_set_of_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> ocircline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ocircline_set_def circline_set_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Oriented_Circlines-inj_of_ocircline><span class=command>lemma</span></span> inj_of_ocircline<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"of_ocircline <span class=free>H</span> <span class=main>=</span> of_ocircline <span class=free>H'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> <span class=free>H'</span> <span class=main>∨</span> <span class=free>H</span> <span class=main>=</span> opposite_ocircline <span class=free>H'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>metis</span> linorder_neqE_linordered_idom minus_of_real_eq_of_real_iff mult_minus1 mult_sm_distribution neg_0_equal_iff_equal neg_less_0_iff_less<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-inj_ocircline_set><span class=command>lemma</span></span> inj_ocircline_set<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"ocircline_set <span class=free>H</span> <span class=main>=</span> ocircline_set <span class=free>H'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"ocircline_set <span class=free>H</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> <span class=free>H'</span> <span class=main>∨</span> <span class=free>H</span> <span class=main>=</span> opposite_ocircline <span class=free>H'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms 
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> circline_set <span class=main>(</span>of_ocircline <span class=free>H'</span><span class=main>)</span>"</span></span>
       <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>of_ocircline <span class=free>H'</span><span class=main>)</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"of_ocircline <span class=free>H</span> <span class=main>=</span> of_ocircline <span class=free>H'</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> inj_circline_set<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> inj_of_ocircline<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Positive orientation.›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Given a representative Hermitean matrix of a circline, it represents exactly one of the two
possible oriented circlines. The choice of what should be called a positive orientation is
arbitrary. We follow Schwerdtfeger \cite{schwerdtfeger}, use the leading coefficient $A$ as the
first criterion, and say that circline matrices with $A &gt; 0$ are called positively oriented, and
with $A &lt; 0$ negatively oriented. However, Schwerdtfeger did not discuss the possible case of $A =
0$ (the case of lines), so we had to extend his definition to achieve a total characterization.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>pos_oriented_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>pos_oriented_cmat</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>⟷</span>
           <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>H</span></span></span>
              <span class=keyword1>in</span> <span class=main>(</span>Re <span class=bound>A</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∨</span> <span class=main>(</span>Re <span class=bound>A</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=main>(</span><span class=main>(</span><span class=bound>B</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> arg <span class=bound>B</span> <span class=main>&gt;</span> <span class=main>0</span><span class=main>)</span> <span class=main>∨</span> <span class=main>(</span><span class=bound>B</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> Re <span class=bound>D</span> <span class=main>&gt;</span> <span class=main>0</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> pos_oriented_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>pos_oriented_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> pos_oriented <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>pos_oriented_clmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span>
     <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>circline_mat1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>circline_mat2</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> exE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> 
      <span class=operator>metis</span> mult_pos_pos zero_less_mult_pos<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-pos_oriented><span class=command>lemma</span></span> pos_oriented<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=free>H</span> <span class=main>∨</span> pos_oriented <span class=main>(</span>opposite_ocircline <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> Re <span class=skolem>D</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟶</span> <span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hh hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>D</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=main>¬</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=skolem>B</span> <span class=main>⟶</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=main>(</span><span class=main>-</span> <span class=skolem>B</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_plus_pi2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=skolem>B</span>"</span></span><span class=main>]</span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>B</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> arg_uminus<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=skolem>H</span> <span class=main>∨</span> pos_oriented_cmat <span class=main>(</span>opposite_ocircline_cmat <span class=skolem>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-pos_oriented_opposite_ocircline_cmat><span class=command>lemma</span></span> pos_oriented_opposite_ocircline_cmat <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=free>H</span> <span class=main>∧</span> <span class=free>H</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=main>(</span>opposite_ocircline_cmat <span class=free>H</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>¬</span> pos_oriented_cmat <span class=free>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>H</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> Re <span class=skolem>D</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟶</span> <span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>D</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=main>¬</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=skolem>B</span> <span class=main>⟶</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=main>(</span><span class=main>-</span> <span class=skolem>B</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_plus_pi2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=skolem>B</span>"</span></span><span class=main>]</span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>B</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> arg_uminus<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=skolem>B</span> <span class=main>⟶</span> <span class=main>¬</span> <span class=main>0</span> <span class=main>&lt;</span> arg <span class=main>(</span><span class=main>-</span> <span class=skolem>B</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> canon_ang_plus_pi1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"arg <span class=skolem>B</span>"</span></span><span class=main>]</span> arg_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>B</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> arg_uminus<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=main>(</span>opposite_ocircline_cmat <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> pos_oriented_cmat <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>metis</span> not_less_iff_gr_or_eq<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-pos_oriented_opposite_ocircline><span class=command>lemma</span></span> pos_oriented_opposite_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=main>(</span>opposite_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>⟷</span> <span class=main>¬</span> pos_oriented <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> pos_oriented_opposite_ocircline_cmat
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-pos_oriented_circle_inf><span class=command>lemma</span></span> pos_oriented_circle_inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=free>H</span> <span class=main>⟷</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> disc <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> ocircline_set_def disc_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hh hermitean_elems
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> on_circline_cmat_cvec <span class=skolem>H</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=main>¬</span> in_ocircline_cmat_cvec <span class=skolem>H</span>  <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>A</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def Complex_eq<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-pos_oriented_euclidean_circle><span class=command>lemma</span></span> pos_oriented_euclidean_circle<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_circle <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> euclidean_circle <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span>"</span></span>
          <span class=quoted><span class=quoted>"circline_type <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=free>H</span> <span class=main>⟷</span> of_complex <span class=free>a</span> <span class=main>∈</span> disc <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> disc_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=skolem>a</span> <span class=skolem>r</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hh hermitean_elems
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> circline_A0_cmat <span class=main>(</span>id <span class=skolem>H</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>r</span><span class=main>)</span> <span class=main>=</span> euclidean_circle_cmat <span class=main>(</span>id <span class=skolem>H</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"circline_type_cmat <span class=main>(</span>id <span class=skolem>H</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span><span class=main><span class=improper>[</span></span><span class=main><span class=main>!</span></span><span class=main><span class=improper>]</span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=skolem>A</span><span class=main>*</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>B</span><span class=main>*</span><span class=skolem>C</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹circline_type_cmat <span class=main>(</span>id <span class=skolem>H</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> HH
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>*</span> cnj <span class=skolem>A</span><span class=main>)</span> <span class=main>-</span> <span class=skolem>B</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>C</span> <span class=main>*</span> cnj <span class=skolem>A</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> cnj <span class=skolem>A</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>*</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>B</span><span class=main>*</span><span class=skolem>C</span><span class=main>)</span> <span class=main>/</span> <span class=skolem>A</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> Re <span class=skolem>A</span> <span class=main>⟷</span> Re <span class=main>(</span><span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>*</span> cnj <span class=skolem>A</span><span class=main>)</span> <span class=main>-</span> <span class=skolem>B</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>C</span> <span class=main>*</span> cnj <span class=skolem>A</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> cnj <span class=skolem>A</span><span class=main>)</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=skolem>A</span><span class=main>*</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>B</span><span class=main>*</span><span class=skolem>C</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Re_divide_real divide_less_0_iff<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>D</span> <span class=main>-</span> Re <span class=main>(</span>cnj <span class=skolem>B</span> <span class=main>*</span> <span class=skolem>B</span> <span class=main>/</span> cnj <span class=skolem>A</span><span class=main>)</span> <span class=main>&lt;</span> Re <span class=main>(</span><span class=main>(</span><span class=skolem>C</span> <span class=main>-</span> cnj <span class=skolem>B</span> <span class=main>*</span> <span class=skolem>A</span> <span class=main>/</span> cnj <span class=skolem>A</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>B</span> <span class=main>/</span> <span class=skolem>A</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH * <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> that
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>smt</span> <span class=quoted>"**"</span> <span class=quoted>"***"</span> cnj.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> cnj.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> complex_eq diff_divide_distrib left_diff_distrib'
               minus_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> mult.commute nonzero_mult_div_cancel_right<span class=main>)</span><span class=main><span class=keyword3>?</span></span>
  <span class=keyword1><span class=command>moreover</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>if</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>D</span> <span class=main>-</span> Re <span class=main>(</span>cnj <span class=skolem>B</span> <span class=main>*</span> <span class=skolem>B</span> <span class=main>/</span> cnj <span class=skolem>A</span><span class=main>)</span> <span class=main>&lt;</span> Re <span class=main>(</span><span class=main>(</span><span class=skolem>C</span> <span class=main>-</span> cnj <span class=skolem>B</span> <span class=main>*</span> <span class=skolem>A</span> <span class=main>/</span> cnj <span class=skolem>A</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>B</span> <span class=main>/</span> <span class=skolem>A</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH * <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> that
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>smt</span> <span class=quoted>"**"</span> <span class=quoted>"***"</span> cnj.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> cnj.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> complex_eq diff_divide_distrib left_diff_distrib'
               minus_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> mult.commute nonzero_mult_div_cancel_right<span class=main>)</span><span class=main><span class=keyword3>?</span></span>
  <span class=keyword1><span class=command>ultimately</span></span> <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=skolem>H</span> <span class=main>=</span> in_ocircline_cmat_cvec <span class=skolem>H</span> <span class=main>(</span>of_complex_cvec <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹Re <span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> * <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Introduce positive orientation›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>of_circline_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>of_circline_cmat</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> pos_oriented_cmat <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>then</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=keyword1>else</span> opposite_ocircline_cmat <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> of_circline_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> circline_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>of_circline_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id="Oriented_Circlines-of_circline_clmat_def'"><span class=command>lemma</span></span> of_circline_clmat_def'<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_circline_clmat <span class=free>H</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> pos_oriented_clmat <span class=free>H</span> <span class=keyword1>then</span> <span class=free>H</span> <span class=keyword1>else</span> opposite_ocircline_clmat <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>simp</span>

<span class=keyword1 id="Oriented_Circlines-pos_oriented_cmat_mult_positive'"><span class=command>lemma</span></span> pos_oriented_cmat_mult_positive'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    <span class=quoted><span class=quoted>"hermitean <span class=free>H1</span> <span class=main>∧</span> <span class=free>H1</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    <span class=quoted><span class=quoted>"hermitean <span class=free>H2</span> <span class=main>∧</span> <span class=free>H2</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>H2</span> <span class=main>=</span> cor <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=free>H1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=free>H2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A1</span></span> <span class=skolem><span class=skolem>B1</span></span> <span class=skolem><span class=skolem>C1</span></span> <span class=skolem><span class=skolem>D1</span></span> <span class=skolem><span class=skolem>A2</span></span> <span class=skolem><span class=skolem>B2</span></span> <span class=skolem><span class=skolem>C2</span></span> <span class=skolem><span class=skolem>D2</span></span>
    <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>H1</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A1</span><span class=main>,</span> <span class=skolem>B1</span><span class=main>,</span> <span class=skolem>C1</span><span class=main>,</span> <span class=skolem>D1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>H2</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A2</span><span class=main>,</span> <span class=skolem>B2</span><span class=main>,</span> <span class=skolem>C2</span><span class=main>,</span> <span class=skolem>D2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>H1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>H2</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-pos_oriented_cmat_mult_positive><span class=command>lemma</span></span> pos_oriented_cmat_mult_positive<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    <span class=quoted><span class=quoted>"hermitean <span class=free>H1</span> <span class=main>∧</span> <span class=free>H1</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    <span class=quoted><span class=quoted>"hermitean <span class=free>H2</span> <span class=main>∧</span> <span class=free>H2</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>H2</span> <span class=main>=</span> cor <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> 
    <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=free>H1</span> <span class=main>⟷</span> pos_oriented_cmat <span class=free>H2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms<span class=main>(</span>3<span class=main>)</span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>H2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>H1</span> <span class=main>=</span> cor <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms pos_oriented_cmat_mult_positive'
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1 id=Oriented_Circlines-pos_oriented_cmat_mult_negative><span class=command>lemma</span></span> pos_oriented_cmat_mult_negative<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span>
    <span class=quoted><span class=quoted>"hermitean <span class=free>H1</span> <span class=main>∧</span> <span class=free>H1</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    <span class=quoted><span class=quoted>"hermitean <span class=free>H2</span> <span class=main>∧</span> <span class=free>H2</span> <span class=main>≠</span> mat_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>H2</span> <span class=main>=</span> cor <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>H1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>
    <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=free>H1</span> <span class=main>⟷</span> <span class=main>¬</span> pos_oriented_cmat <span class=free>H2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=skolem><span class=skolem>A1</span></span> <span class=skolem><span class=skolem>B1</span></span> <span class=skolem><span class=skolem>C1</span></span> <span class=skolem><span class=skolem>D1</span></span>
    <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>H1</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>H2</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A1</span><span class=main>,</span> <span class=skolem>B1</span><span class=main>,</span> <span class=skolem>C1</span><span class=main>,</span> <span class=skolem>D1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>H1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>H2</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A1</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=skolem>C</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B1</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=skolem>C1</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span> hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A1</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B1</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C1</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D1</span></span></span></span></span></span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> iffI<span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> H1<span class=main>:</span> <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=free>H1</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> pos_oriented_cmat <span class=free>H2</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> assms * ** mult_neg_pos
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> assms * ** H1 <span class=quoted><span class=quoted>‹<span class=main>¬</span> Re <span class=skolem>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> mult_neg_pos
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> arg_uminus_opposite_sign<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>B</span></span><span class=main>]</span> arg_mult_real_negative
          <span class=keyword1><span class=command>using</span></span> assms * ** H1 <span class=quoted><span class=quoted>‹<span class=main>¬</span> Re <span class=skolem>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> mult_neg_pos
          <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> H2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>¬</span> pos_oriented_cmat <span class=free>H2</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=free>H1</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> * ** mult_neg_pos
        <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
        <span class=keyword3><span class=command>case</span></span> True
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> 
          <span class=keyword1><span class=command>using</span></span> assms * ** H2 <span class=quoted><span class=quoted>‹<span class=main>¬</span> Re <span class=skolem>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>smt</span> arg_0_iff arg_complex_of_real_negative arg_complex_of_real_positive arg_mult_eq complex_of_real_Re mult.right_neutral mult_eq_0_iff of_real_0 of_real_1 zero_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>next</span></span>
        <span class=keyword3><span class=command>case</span></span> False
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‹<span class=main>¬</span> Re <span class=skolem>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> H2 * **
          <span class=keyword1><span class=command>using</span></span> arg_uminus_opposite_sign<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>B</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mult_neg_neg<span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>
   
<span class=keyword1><span class=command>lift_definition</span></span> of_circline <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> ocircline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>of_circline_clmat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H1</span> <span class=skolem>H2</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span>
    <span class=quoted><span class=quoted>"hermitean <span class=skolem>H1</span> <span class=main>∧</span> <span class=skolem>H1</span> <span class=main>≠</span> mat_zero"</span></span>
    <span class=quoted><span class=quoted>"hermitean <span class=skolem>H2</span> <span class=main>∧</span> <span class=skolem>H2</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=skolem>H1</span> <span class=skolem>H2</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>H2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=main>(</span>of_circline_cmat <span class=skolem>H1</span><span class=main>)</span> <span class=main>(</span>of_circline_cmat <span class=skolem>H2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=skolem>H1</span> <span class=main>=</span> pos_oriented_cmat <span class=skolem>H2</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * pos_oriented_cmat_mult_positive<span class=main>[</span><span class=operator>OF</span> hh<span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> hh * <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> pos_oriented_cmat_def<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> impI<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=skolem>k</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> impI<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=skolem>k</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=skolem>H1</span> <span class=main>⟷</span> <span class=main>¬</span> <span class=main>(</span>pos_oriented_cmat <span class=skolem>H2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * pos_oriented_cmat_mult_negative<span class=main>[</span><span class=operator>OF</span> hh<span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> hh * <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> pos_oriented_cmat_def<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> conjI<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> impI<span class=main>)</span>
       <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> impI<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-pos_oriented_of_circline><span class=command>lemma</span></span> pos_oriented_of_circline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=main>(</span>of_circline <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> pos_oriented_opposite_ocircline_cmat
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-of_ocircline_of_circline><span class=command>lemma</span></span> of_ocircline_of_circline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_ocircline <span class=main>(</span>of_circline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_circline_clmat_def'<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Oriented_Circlines-of_circline_of_ocircline_pos_oriented><span class=command>lemma</span></span> of_circline_of_ocircline_pos_oriented <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_circline <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-inj_of_circline><span class=command>lemma</span></span> inj_of_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"of_circline <span class=free>H</span> <span class=main>=</span> of_circline <span class=free>H'</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> <span class=free>H'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=skolem>H'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=main>(</span>of_circline_cmat <span class=skolem>H</span><span class=main>)</span> <span class=main>(</span>of_circline_cmat <span class=skolem>H'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"of_circline_cmat <span class=skolem>H'</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> of_circline_cmat <span class=skolem>H</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=skolem>H</span> <span class=skolem>H'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> mult_sm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H'</span>"</span></span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> mult_sm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> <span class=main>(</span>cor <span class=skolem>k</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-of_circline_of_ocircline><span class=command>lemma</span></span> of_circline_of_ocircline<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_circline <span class=main>(</span>of_ocircline <span class=free>H'</span><span class=main>)</span> <span class=main>=</span> <span class=free>H'</span> <span class=main>∨</span> 
         of_circline <span class=main>(</span>of_ocircline <span class=free>H'</span><span class=main>)</span> <span class=main>=</span> opposite_ocircline <span class=free>H'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"pos_oriented <span class=free>H'</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=main>(</span>opposite_ocircline <span class=free>H'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> pos_oriented
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> of_ocircline_opposite_ocircline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H'</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> of_circline_of_ocircline_pos_oriented <span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"opposite_ocircline <span class=free>H'</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Set of points on oriented and unoriented circlines›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1 id=Oriented_Circlines-ocircline_set_of_circline><span class=command>lemma</span></span> ocircline_set_of_circline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ocircline_set <span class=main>(</span>of_circline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> circline_set <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> ocircline_set_def circline_set_def
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"on_ocircline <span class=main>(</span>of_circline <span class=free>H</span><span class=main>)</span> <span class=skolem>z</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> on_circline_cmat_cvec_def opposite_ocircline_cmat_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=skolem>z</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"on_ocircline <span class=main>(</span>of_circline <span class=free>H</span><span class=main>)</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> on_circline_cmat_cvec_def opposite_ocircline_cmat_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Some special oriented circlines and discs›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>lift_definition</span></span> mk_ocircline <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> complex <span class=main>⇒</span> ocircline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>mk_circline_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹oriented unit circle and unit disc›</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> ounit_circle <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>unit_circle_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Oriented_Circlines-pos_oriented_ounit_circle><span class=command>lemma</span></span> pos_oriented_ounit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented ounit_circle"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-of_ocircline_ounit_circle><span class=command>lemma</span></span> of_ocircline_ounit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_ocircline ounit_circle <span class=main>=</span> unit_circle"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-of_circline_unit_circle><span class=command>lemma</span></span> of_circline_unit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_circline <span class=main>(</span>unit_circle<span class=main>)</span> <span class=main>=</span> ounit_circle"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-ocircline_set_ounit_circle><span class=command>lemma</span></span> ocircline_set_ounit_circle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ocircline_set ounit_circle <span class=main>=</span> circline_set unit_circle"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> of_circline_unit_circle<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> ocircline_set_of_circline<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>unit_disc</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo set"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>unit_disc</span> <span class=main>=</span> disc ounit_circle"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>unit_disc_compl</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo set"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>unit_disc_compl</span> <span class=main>=</span> disc_compl ounit_circle"</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>unit_circle_set</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo set"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>unit_circle_set</span> <span class=main>=</span> circline_set unit_circle"</span></span>

<span class=keyword1 id=Oriented_Circlines-zero_in_unit_disc><span class=command>lemma</span></span> zero_in_unit_disc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_def disc_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-one_notin_unit_dic><span class=command>lemma</span></span> one_notin_unit_dic <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> unit_disc"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_def disc_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-inf_notin_unit_disc><span class=command>lemma</span></span> inf_notin_unit_disc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> unit_disc"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_def disc_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-unit_disc_iff_cmod_lt_1><span class=command>lemma</span></span> unit_disc_iff_cmod_lt_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>c</span> <span class=main>∈</span> unit_disc <span class=main>⟷</span> cmod <span class=free>c</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_def disc_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def cmod_def power2_eq_square<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-unit_disc_cmod_square_lt_1><span class=command>lemma</span></span> unit_disc_cmod_square_lt_1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>(</span>to_complex <span class=free>z</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> abs_square_less_1<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-unit_disc_to_complex_inj><span class=command>lemma</span></span> unit_disc_to_complex_inj<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"to_complex <span class=free>u</span> <span class=main>=</span> to_complex <span class=free>v</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>=</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>u</span></span><span class=main>]</span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>v</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Oriented_Circlines-inversion_unit_disc><span class=command>lemma</span></span> inversion_unit_disc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inversion <span class=main>`</span> unit_disc <span class=main>=</span> unit_disc_compl"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_def unit_disc_compl_def disc_def disc_compl_def
<span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"in_ocircline ounit_circle <span class=skolem>x</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"out_ocircline ounit_circle <span class=main>(</span>inversion <span class=skolem>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> inversion_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"out_ocircline ounit_circle <span class=skolem>x</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> inversion <span class=main>`</span> Collect <span class=main>(</span>in_ocircline ounit_circle<span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> image_eqI<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> inversion <span class=main>(</span>inversion <span class=skolem>x</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"inversion <span class=skolem>x</span> <span class=main>∈</span> Collect <span class=main>(</span>in_ocircline ounit_circle<span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>unfolding</span></span> inversion_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-inversion_unit_disc_compl><span class=command>lemma</span></span> inversion_unit_disc_compl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inversion <span class=main>`</span> unit_disc_compl <span class=main>=</span> unit_disc"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inversion <span class=main>`</span> <span class=main>(</span>inversion <span class=main>`</span> unit_disc<span class=main>)</span> <span class=main>=</span> unit_disc"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> inversion_unit_disc <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-inversion_noteq_unit_disc><span class=command>lemma</span></span> inversion_noteq_unit_disc<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inversion <span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inversion <span class=free>u</span> <span class=main>∈</span> unit_disc_compl"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> image_eqI inversion_unit_disc<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> unit_disc_def unit_disc_compl_def
    <span class=keyword1><span class=command>using</span></span> disc_inter_disc_compl
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-in_ocircline_ounit_circle_conjugate><span class=command>lemma</span></span> in_ocircline_ounit_circle_conjugate <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"in_ocircline ounit_circle <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"in_ocircline ounit_circle <span class=main>(</span>conjugate <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-conjugate_unit_disc><span class=command>lemma</span></span> conjugate_unit_disc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>`</span> unit_disc <span class=main>=</span> unit_disc"</span></span>                
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_def disc_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"conjugate <span class=improper>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Oriented_Circlines-conjugate_in_unit_disc><span class=command>lemma</span></span> conjugate_in_unit_disc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=free>z</span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword1><span class=command>using</span></span> conjugate_unit_disc
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1 id=Oriented_Circlines-out_ocircline_ounit_circle_conjugate><span class=command>lemma</span></span> out_ocircline_ounit_circle_conjugate <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"out_ocircline ounit_circle <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"out_ocircline ounit_circle <span class=main>(</span>conjugate <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-conjugate_unit_disc_compl><span class=command>lemma</span></span> conjugate_unit_disc_compl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=main>`</span> unit_disc_compl <span class=main>=</span> unit_disc_compl"</span></span>                
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_compl_def disc_compl_def
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"conjugate <span class=improper>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Oriented_Circlines-conjugate_in_unit_disc_compl><span class=command>lemma</span></span> conjugate_in_unit_disc_compl <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> unit_disc_compl"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"conjugate <span class=free>z</span> <span class=main>∈</span> unit_disc_compl"</span></span>
  <span class=keyword1><span class=command>using</span></span> conjugate_unit_disc_compl
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Oriented x axis and lower half plane›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>lift_definition</span></span> o_x_axis <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>x_axis_clmat</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Oriented_Circlines-o_x_axis_pos_oriented><span class=command>lemma</span></span> o_x_axis_pos_oriented <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented o_x_axis"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-of_ocircline_o_x_axis><span class=command>lemma</span></span> of_ocircline_o_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_ocircline o_x_axis <span class=main>=</span> x_axis"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-of_circline_x_axis><span class=command>lemma</span></span> of_circline_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_circline x_axis <span class=main>=</span> o_x_axis"</span></span>
  <span class=keyword1><span class=command>using</span></span> of_circline_of_ocircline_pos_oriented<span class=main>[</span><span class=operator>of</span> <span class=quoted>o_x_axis</span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> o_x_axis_pos_oriented
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Oriented_Circlines-ocircline_set_circline_set_x_axis><span class=command>lemma</span></span> ocircline_set_circline_set_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ocircline_set o_x_axis <span class=main>=</span> circline_set x_axis"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> of_circline_x_axis<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> ocircline_set_of_circline<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-ii_in_disc_o_x_axis><span class=command>lemma</span></span> ii_in_disc_o_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> disc o_x_axis"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> disc_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-ii_notin_disc_o_x_axis><span class=command>lemma</span></span> ii_notin_disc_o_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> disc_compl o_x_axis"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> disc_compl_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-of_complex_in_o_x_axis_disc><span class=command>lemma</span></span> of_complex_in_o_x_axis_disc <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_complex <span class=free>z</span> <span class=main>∈</span> disc o_x_axis <span class=main>⟷</span> Im <span class=free>z</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> disc_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span><span class=main><span class=keyword3>+</span></span>

<span class=keyword1 id=Oriented_Circlines-inf_notin_disc_o_x_axis><span class=command>lemma</span></span> inf_notin_disc_o_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> disc o_x_axis"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> disc_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-disc_o_x_axis><span class=command>lemma</span></span> disc_o_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"disc o_x_axis <span class=main>=</span> of_complex <span class=main>`</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> Im <span class=bound>z</span> <span class=main>&lt;</span> <span class=main>0</span><span class=main>}</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>{</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> disc o_x_axis"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>x</span><span class=main>.</span> Im <span class=bound>x</span> <span class=main>&lt;</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>z</span> <span class=main>=</span> of_complex <span class=bound>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>}</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Oriented single point circline›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>lift_definition</span></span>  o_circline_point_0 <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>circline_point_0_clmat</span>
<span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Oriented_Circlines-of_ocircline_o_circline_point_0><span class=command>lemma</span></span> of_ocircline_o_circline_point_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"of_ocircline o_circline_point_0 <span class=main>=</span> circline_point_0"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Möbius action on oriented circlines and discs›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius action on an oriented circline is the same as on to an unoriented circline.›</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> moebius_ocircline <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> ocircline <span class=main>⇒</span> ocircline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>moebius_circline_mmat_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>erule</span> conjE<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_inv_mult_sm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>ka</span> <span class=main>/</span> Re <span class=main>(</span><span class=improper>k</span> <span class=main>*</span> cnj <span class=improper>k</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius action on (unoriented) circlines could have been defined using the action on oriented
circlines, but not the other way around.›</span></span>

<span class=keyword1 id=Oriented_Circlines-moebius_circline_ocircline><span class=command>lemma</span></span> moebius_circline_ocircline<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=free>M</span> <span class=free>H</span> <span class=main>=</span> of_ocircline <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=main>(</span>of_circline <span class=free>H</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_circline_clmat_def'<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Oriented_Circlines-moebius_ocircline_circline><span class=command>lemma</span></span> moebius_ocircline_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=free>M</span> <span class=free>H</span> <span class=main>=</span> of_circline <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span><span class=main>)</span> <span class=main>∨</span>
         moebius_ocircline <span class=free>M</span> <span class=free>H</span> <span class=main>=</span> opposite_ocircline <span class=main>(</span>of_circline <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_circline_clmat_def'<span class=main><span class=keyword3>,</span></span> <span class=operator>safe</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius action on oriented circlines have many nice properties as it was the case with
Möbius action on (unoriented) circlines. These transformations are injective and form group under
composition.›</span></span>

<span class=keyword1 id=Oriented_Circlines-inj_moebius_ocircline><span class=command>lemma</span></span> inj_moebius_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inj <span class=main>(</span>moebius_ocircline <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> inj_on_def
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=skolem>H'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=free>M</span> <span class=skolem>H</span> <span class=main>=</span> moebius_ocircline <span class=free>M</span> <span class=skolem>H'</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=skolem>H'</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>H</span> <span class=skolem>H'</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?iM</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"mat_inv <span class=skolem>M</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H</span><span class=main>)</span> <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"congruence <span class=var>?iM</span> <span class=skolem>H'</span> <span class=main>=</span> congruence <span class=var>?iM</span> <span class=main>(</span>cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> congruence_def<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=skolem>H</span> <span class=skolem>H'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> inj_congruence<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?iM</span></span></span> <span class=quoted><span class=skolem>H'</span></span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H</span>"</span></span><span class=main>]</span> mat_det_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-moebius_ocircline_id_moebius><span class=command>lemma</span></span> moebius_ocircline_id_moebius <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_ocircline id_moebius <span class=free>H</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-moebius_ocircline_comp><span class=command>lemma</span></span> moebius_ocircline_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=main>(</span>moebius_comp <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span> <span class=free>H</span> <span class=main>=</span> moebius_ocircline <span class=free>M1</span> <span class=main>(</span>moebius_ocircline <span class=free>M2</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_inv_mult_mm mult_mm_assoc<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-moebius_ocircline_comp_inv_left><span class=command>lemma</span></span> moebius_ocircline_comp_inv_left <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> moebius_ocircline_comp<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Oriented_Circlines-moebius_ocircline_comp_inv_right><span class=command>lemma</span></span> moebius_ocircline_comp_inv_right <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=free>M</span> <span class=main>(</span>moebius_ocircline <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> moebius_ocircline_comp<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Oriented_Circlines-moebius_ocircline_opposite_ocircline><span class=command>lemma</span></span> moebius_ocircline_opposite_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=free>M</span> <span class=main>(</span>opposite_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>=</span> opposite_ocircline <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius action on oriented circlines preserve the set of points of the circline.›</span></span>

<span class=keyword1 id=Oriented_Circlines-ocircline_set_moebius_ocircline><span class=command>lemma</span></span> ocircline_set_moebius_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ocircline_set <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> moebius_pt <span class=free>M</span> <span class=main>`</span> ocircline_set <span class=free>H</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?rhs</span> <span class=main>=</span> circline_set <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_ocircline_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-ocircline_set_fix_iff_ocircline_fix><span class=command>lemma</span></span> ocircline_set_fix_iff_ocircline_fix<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"ocircline_set <span class=free>H'</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"ocircline_set <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> ocircline_set <span class=free>H'</span> <span class=main>⟷</span>
         moebius_ocircline <span class=free>M</span> <span class=free>H</span> <span class=main>=</span> <span class=free>H'</span> <span class=main>∨</span> moebius_ocircline <span class=free>M</span> <span class=free>H</span> <span class=main>=</span> opposite_ocircline <span class=free>H'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> inj_ocircline_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=free>M</span> <span class=free>H</span>"</span></span> <span class=quoted><span class=free>H'</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> ocircline_set_moebius_ocircline<span class=main>)</span>

<span class=keyword1 id=Oriented_Circlines-disc_moebius_ocircline><span class=command>lemma</span></span> disc_moebius_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"disc <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> moebius_pt <span class=free>M</span> <span class=main>`</span> <span class=main>(</span>disc <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> disc <span class=free>H</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=skolem>z</span> <span class=main>∈</span> disc <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> disc_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"in_ocircline <span class=free>H</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"in_ocircline <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"in_ocircline_cmat_cvec <span class=skolem>H</span> <span class=skolem>z</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"in_ocircline_cmat_cvec <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H</span><span class=main>)</span> <span class=main>(</span>moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> quad_form_congruence<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span> <span class=quoted><span class=skolem>z</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> disc <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> moebius_pt <span class=free>M</span> <span class=main>`</span> disc <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> disc_def
  <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"in_ocircline <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> moebius_pt <span class=free>M</span> <span class=main>`</span> Collect <span class=main>(</span>in_ocircline <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> moebius_pt <span class=free>M</span> <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=skolem>z</span> <span class=main>∈</span> Collect <span class=main>(</span>in_ocircline <span class=free>H</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹in_ocircline <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=skolem>z</span>›</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>H</span> <span class=main>::</span> <span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"congruence <span class=main>(</span>mat_inv <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>congruence <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=skolem>H</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>H</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> congruence_def<span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"quad_form <span class=skolem>z</span> <span class=main>(</span>congruence <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=skolem>H</span><span class=main>)</span> <span class=main>=</span> quad_form <span class=main>(</span>mat_inv <span class=skolem>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z</span><span class=main>)</span> <span class=skolem>H</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> quad_form_congruence<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_inv <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span>"</span></span> <span class=quoted><span class=quoted>"congruence <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=skolem>H</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> mat_det_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"in_ocircline_cmat_cvec <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H</span><span class=main>)</span> <span class=skolem>z</span>"</span></span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"in_ocircline_cmat_cvec <span class=skolem>H</span> <span class=main>(</span>moebius_pt_cmat_cvec <span class=main>(</span>moebius_inv_cmat <span class=skolem>M</span><span class=main>)</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-disc_compl_moebius_ocircline><span class=command>lemma</span></span> disc_compl_moebius_ocircline <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"disc_compl <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> moebius_pt <span class=free>M</span> <span class=main>`</span> <span class=main>(</span>disc_compl <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> disc_compl <span class=free>H</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=skolem>z</span> <span class=main>∈</span> disc_compl <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> disc_compl_def
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"out_ocircline <span class=free>H</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"out_ocircline <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"out_ocircline_cmat_cvec <span class=skolem>H</span> <span class=skolem>z</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"out_ocircline_cmat_cvec <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H</span><span class=main>)</span> <span class=main>(</span>moebius_pt_cmat_cvec <span class=skolem>M</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> quad_form_congruence<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span> <span class=quoted><span class=skolem>z</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> disc_compl <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> moebius_pt <span class=free>M</span> <span class=main>`</span> disc_compl <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> disc_compl_def
  <span class=keyword1><span class=command>proof</span></span><span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"out_ocircline <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> moebius_pt <span class=free>M</span> <span class=main>`</span> Collect <span class=main>(</span>out_ocircline <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> moebius_pt <span class=free>M</span> <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span> <span class=skolem>z</span> <span class=main>∈</span> Collect <span class=main>(</span>out_ocircline <span class=free>H</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹out_ocircline <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=skolem>z</span>›</span></span>
      <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
        <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>H</span> <span class=main>::</span> <span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"congruence <span class=main>(</span>mat_inv <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span><span class=main>)</span> <span class=main>(</span>congruence <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=skolem>H</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>H</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> congruence_def<span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"quad_form <span class=skolem>z</span> <span class=main>(</span>congruence <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=skolem>H</span><span class=main>)</span> <span class=main>=</span> quad_form <span class=main>(</span>mat_inv <span class=skolem>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z</span><span class=main>)</span> <span class=skolem>H</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> quad_form_congruence<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_inv <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span>"</span></span> <span class=quoted><span class=quoted>"congruence <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=skolem>H</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> mat_det_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"out_ocircline_cmat_cvec <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H</span><span class=main>)</span> <span class=skolem>z</span>"</span></span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"out_ocircline_cmat_cvec <span class=skolem>H</span> <span class=main>(</span>moebius_pt_cmat_cvec <span class=main>(</span>moebius_inv_cmat <span class=skolem>M</span><span class=main>)</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Orientation after Möbius transformations›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹All Euclidean similarities preserve circline orientation.›</span></span>

<span class=keyword1 id=Oriented_Circlines-moebius_similarity_oriented_lines_to_oriented_lines><span class=command>lemma</span></span> moebius_similarity_oriented_lines_to_oriented_lines<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=free>H</span> <span class=main>⟷</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=main>(</span>moebius_ocircline <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_similarity_lines_to_lines<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=quoted>"of_ocircline <span class=free>H</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id="Oriented_Circlines-moebius_similarity_preserve_orientation'"><span class=command>lemma</span></span> moebius_similarity_preserve_orientation'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=free>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=main>(</span>moebius_ocircline <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_similarity <span class=free>a</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?H</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=var>?M</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=var>?H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=free>H</span>›</span></span> moebius_similarity_oriented_lines_to_oriented_lines<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> disc_compl <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=free>H</span>›</span></span> <span class=quoted><span class=quoted>‹pos_oriented <span class=free>H</span>›</span></span> pos_oriented_circle_inf<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span> in_on_out
    <span class=keyword1><span class=command>unfolding</span></span> disc_def disc_compl_def ocircline_set_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> disc_compl <span class=var>?H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_similarity_inf<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>b</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=var>?H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> pos_oriented_circle_inf<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?H</span></span></span><span class=main>]</span> disc_inter_disc_compl<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?H</span></span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=var>?H</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-moebius_similarity_preserve_orientation><span class=command>lemma</span></span> moebius_similarity_preserve_orientation<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=free>H</span> <span class=main>⟷</span> pos_oriented<span class=main>(</span>moebius_ocircline <span class=main>(</span>moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_similarity <span class=free>a</span> <span class=free>b</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?H</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=var>?M</span> <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=var>?H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=free>H</span>›</span></span> moebius_similarity_oriented_lines_to_oriented_lines<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> moebius_ocircline <span class=main>(</span><span class=main>-</span> moebius_similarity <span class=free>a</span> <span class=free>b</span><span class=main>)</span> <span class=var>?H</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_similarity_preserve_orientation' <span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=free>H</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> moebius_similarity_preserve_orientation'<span class=main>[</span><span class=operator>OF</span> _   <span class=quoted><span class=quoted>‹<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=var>?H</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=free>a</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>b</span><span class=main>/</span><span class=free>a</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> moebius_similarity_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span><span class=main>,</span> <span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main>]</span>  *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-reciprocal_preserve_orientation><span class=command>lemma</span></span> reciprocal_preserve_orientation<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> disc_compl <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=main>(</span>moebius_ocircline moebius_reciprocal <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> disc_compl <span class=main>(</span>moebius_ocircline moebius_reciprocal <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=main>(</span>moebius_ocircline moebius_reciprocal <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> pos_oriented_circle_inf<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_ocircline moebius_reciprocal <span class=free>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> disc_inter_disc_compl<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_ocircline moebius_reciprocal <span class=free>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> disc_compl_inter_ocircline_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_ocircline moebius_reciprocal <span class=free>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1 id=Oriented_Circlines-reciprocal_not_preserve_orientation><span class=command>lemma</span></span> reciprocal_not_preserve_orientation<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> disc <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> pos_oriented <span class=main>(</span>moebius_ocircline moebius_reciprocal <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?H</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_ocircline moebius_reciprocal <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> disc <span class=var>?H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> pos_oriented <span class=var>?H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> pos_oriented_circle_inf<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?H</span></span></span><span class=main>]</span> disc_inter_ocircline_set<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?H</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Orientation of the image of a given oriented circline $H$ under a given Möbius transformation
$M$ depends on whether the pole of $M$ (the point that $M$ maps to $\infty_{hc}$) lies in the disc
or in the disc complement of $H$ (if it is on the set of $H$, then it maps onto a line and we do not
discuss the orientation).›</span></span>

<span class=keyword1 id=Oriented_Circlines-pole_in_disc><span class=command>lemma</span></span> pole_in_disc<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> mk_moebius <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>d</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span><span class=main>*</span><span class=free>d</span> <span class=main>-</span> <span class=free>b</span><span class=main>*</span><span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_pole <span class=free>M</span> <span class=free>z</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> disc <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> pos_oriented <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_translation <span class=main>(</span><span class=free>a</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?rd</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_rotation_dilatation <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>*</span> <span class=free>c</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> <span class=free>d</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=free>c</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?r</span></span></span> <span class=main>=</span>  <span class=quoted><span class=quoted>"moebius_reciprocal"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_translation <span class=main>(</span><span class=free>d</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> moebius_pt <span class=main>(</span>moebius_translation <span class=main>(</span><span class=free>d</span><span class=main>/</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=free>z</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> pole_mk_moebius<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>d</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∉</span> ocircline_set <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>∈</span> disc <span class=free>H</span>›</span></span> disc_inter_ocircline_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>      
                                              
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=main>(</span>moebius_ocircline <span class=var>?t2</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> moebius_pt <span class=var>?t2</span> <span class=free>z</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_pt_neq_I<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span> <span class=main>_</span> <span class=var><span class=quoted><span class=var>?t2</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=main>(</span>moebius_ocircline <span class=main>(</span><span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> moebius_pt <span class=main>(</span>moebius_translation <span class=main>(</span><span class=free>d</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=free>z</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> circline_set_moebius_circline circline_set_moebius_circline_iff circline_set_of_ocircline moebius_pt_comp moebius_reciprocal ocircline_set_moebius_ocircline plus_moebius_def reciprocal_zero<span class=main>)</span>

    
  <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=main>(</span>moebius_ocircline <span class=main>(</span><span class=var>?rd</span> <span class=main>+</span> <span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span><span class=main>*</span><span class=free>d</span> <span class=main>-</span> <span class=free>b</span><span class=main>*</span><span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_dilatation_def
    <span class=keyword1><span class=command>using</span></span> moebius_similarity_oriented_lines_to_oriented_lines<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=main>(</span><span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> divide_eq_0_iff divisors_zero moebius_ocircline_comp plus_moebius_def right_minus_eq<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> pos_oriented <span class=main>(</span>moebius_ocircline <span class=main>(</span><span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> pole_mk_moebius<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>d</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>using</span></span> reciprocal_not_preserve_orientation
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> pos_oriented <span class=main>(</span>moebius_ocircline <span class=main>(</span><span class=var>?rd</span> <span class=main>+</span> <span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span><span class=main>*</span><span class=free>d</span> <span class=main>-</span> <span class=free>b</span><span class=main>*</span><span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_similarity_preserve_orientation<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=main>(</span><span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_dilatation_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>    
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> pos_oriented <span class=main>(</span>moebius_ocircline <span class=main>(</span><span class=var>?t1</span> <span class=main>+</span> <span class=var>?rd</span> <span class=main>+</span> <span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> **
    <span class=keyword1><span class=command>using</span></span> moebius_similarity_preserve_orientation<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=main>(</span><span class=var>?rd</span> <span class=main>+</span> <span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> moebius_translation_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>subst</span> moebius_decomposition<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-pole_in_disc_compl><span class=command>lemma</span></span> pole_in_disc_compl<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> mk_moebius <span class=free>a</span> <span class=free>b</span> <span class=free>c</span> <span class=free>d</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span><span class=main>*</span><span class=free>d</span> <span class=main>-</span> <span class=free>b</span><span class=main>*</span><span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_pole <span class=free>M</span> <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> disc_compl <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_translation <span class=main>(</span><span class=free>a</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?rd</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_rotation_dilatation <span class=main>(</span><span class=main>(</span><span class=free>b</span> <span class=main>*</span> <span class=free>c</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> <span class=free>d</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=free>c</span> <span class=main>*</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?r</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_reciprocal"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?t2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_translation <span class=main>(</span><span class=free>d</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> moebius_pt <span class=main>(</span>moebius_translation <span class=main>(</span><span class=free>d</span><span class=main>/</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=free>z</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> pole_mk_moebius<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>d</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∉</span> ocircline_set <span class=free>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>∈</span> disc_compl <span class=free>H</span>›</span></span> disc_compl_inter_ocircline_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=main>(</span>moebius_ocircline <span class=var>?t2</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> moebius_pt <span class=var>?t2</span> <span class=free>z</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_pt_neq_I<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span> <span class=main>_</span> <span class=var><span class=quoted><span class=var>?t2</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=main>(</span>moebius_ocircline <span class=main>(</span><span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> moebius_pt <span class=main>(</span>moebius_translation <span class=main>(</span><span class=free>d</span> <span class=main>/</span> <span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=free>z</span>›</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> circline_set_moebius_circline circline_set_moebius_circline_iff circline_set_of_ocircline moebius_pt_comp moebius_reciprocal ocircline_set_moebius_ocircline plus_moebius_def reciprocal_zero<span class=main>)</span>

  <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> ocircline_set <span class=main>(</span>moebius_ocircline <span class=main>(</span><span class=var>?rd</span> <span class=main>+</span> <span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span><span class=main>*</span><span class=free>d</span> <span class=main>-</span> <span class=free>b</span><span class=main>*</span><span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_dilatation_def
    <span class=keyword1><span class=command>using</span></span> moebius_similarity_oriented_lines_to_oriented_lines<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=main>(</span><span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> divide_eq_0_iff divisors_zero moebius_ocircline_comp plus_moebius_def right_minus_eq<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=main>(</span>moebius_ocircline <span class=main>(</span><span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> pole_mk_moebius<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>d</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>using</span></span> reciprocal_preserve_orientation
    <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=main>(</span>moebius_ocircline <span class=main>(</span><span class=var>?rd</span> <span class=main>+</span> <span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span><span class=main>*</span><span class=free>d</span> <span class=main>-</span> <span class=free>b</span><span class=main>*</span><span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>c</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_similarity_preserve_orientation<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=main>(</span><span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_dilatation_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"pos_oriented <span class=main>(</span>moebius_ocircline <span class=main>(</span><span class=var>?t1</span> <span class=main>+</span> <span class=var>?rd</span> <span class=main>+</span> <span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> **
    <span class=keyword1><span class=command>using</span></span> moebius_similarity_preserve_orientation<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=main>(</span><span class=var>?rd</span> <span class=main>+</span> <span class=var>?r</span> <span class=main>+</span> <span class=var>?t2</span><span class=main>)</span> <span class=free>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> moebius_translation_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>subst</span> moebius_decomposition<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Oriented circlines uniqueness›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1 id=Oriented_Circlines-ocircline_01inf><span class=command>lemma</span></span> ocircline_01inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=free>H</span> <span class=main>∧</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=free>H</span> <span class=main>∧</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> o_x_axis <span class=main>∨</span> <span class=free>H</span> <span class=main>=</span> opposite_ocircline o_x_axis"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>∧</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span> <span class=main>∧</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=main>(</span>of_ocircline <span class=free>H</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"of_ocircline <span class=free>H</span> <span class=main>=</span> x_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> unique_circline_01inf'
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> o_x_axis <span class=main>∨</span> <span class=free>H</span> <span class=main>=</span> opposite_ocircline o_x_axis"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inj_of_ocircline of_ocircline_o_x_axis<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-unique_ocircline_01inf><span class=command>lemma</span></span> unique_ocircline_01inf<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>H</span><span class=main>.</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=bound>H</span> <span class=main>∧</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=bound>H</span> <span class=main>∧</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=bound>H</span> <span class=main>∧</span> <span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> disc <span class=bound>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set o_x_axis <span class=main>∧</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set o_x_axis <span class=main>∧</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set o_x_axis <span class=main>∧</span> <span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> disc o_x_axis"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=skolem>H</span> <span class=main>∧</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=skolem>H</span> <span class=main>∧</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=skolem>H</span> <span class=main>∧</span> <span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> disc <span class=skolem>H</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=skolem>H</span> <span class=main>∧</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=skolem>H</span> <span class=main>∧</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> ocircline_set <span class=skolem>H</span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> disc <span class=skolem>H</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> o_x_axis <span class=main>∨</span> <span class=skolem>H</span> <span class=main>=</span> opposite_ocircline o_x_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> ocircline_01inf
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> o_x_axis"</span></span>           
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=keyword1>ii<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∉</span> disc <span class=skolem>H</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-unique_ocircline_set><span class=command>lemma</span></span> unique_ocircline_set<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> <span class=free>B</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> <span class=free>C</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>≠</span> <span class=free>C</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>H</span><span class=main>.</span> pos_oriented <span class=bound>H</span> <span class=main>∧</span> <span class=main>(</span><span class=free>A</span> <span class=main>∈</span> ocircline_set <span class=bound>H</span> <span class=main>∧</span> <span class=free>B</span> <span class=main>∈</span> ocircline_set <span class=bound>H</span> <span class=main>∧</span> <span class=free>C</span> <span class=main>∈</span> ocircline_set <span class=bound>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>A</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>  <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>B</span> <span class=main>=</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>C</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_moebius_01inf<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?iM</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?iM</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>A</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=var>?iM</span> <span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>B</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=var>?iM</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=free>C</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> moebius_pt_invert<span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?H</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> o_x_axis"</span></span>
  <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>∈</span> ocircline_set <span class=var>?H</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>∈</span> ocircline_set <span class=var>?H</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>∈</span> ocircline_set <span class=var>?H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> **
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>H'</span><span class=main>.</span> <span class=free>A</span> <span class=main>∈</span> ocircline_set <span class=bound>H'</span> <span class=main>∧</span> <span class=free>B</span> <span class=main>∈</span> ocircline_set <span class=bound>H'</span> <span class=main>∧</span> <span class=free>C</span> <span class=main>∈</span> ocircline_set <span class=bound>H'</span> <span class=main>⟹</span> <span class=bound>H'</span> <span class=main>=</span> <span class=var>?H</span> <span class=main>∨</span> <span class=bound>H'</span> <span class=main>=</span> opposite_ocircline <span class=var>?H</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H'</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?H'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"ocircline_set <span class=skolem>H'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?H''</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"ocircline_set <span class=main>(</span>moebius_ocircline <span class=skolem>M</span> <span class=skolem>H'</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>∈</span> ocircline_set <span class=skolem>H'</span> <span class=main>∧</span> <span class=free>B</span> <span class=main>∈</span> ocircline_set <span class=skolem>H'</span> <span class=main>∧</span> <span class=free>C</span> <span class=main>∈</span> ocircline_set <span class=skolem>H'</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>A</span> <span class=main>∈</span> <span class=var>?H''</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>B</span> <span class=main>∈</span> <span class=var>?H''</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>C</span> <span class=main>∈</span> <span class=var>?H''</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> <span class=var>?H''</span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>1<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> <span class=var>?H''</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> <span class=var>?H''</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=skolem>M</span> <span class=skolem>H'</span> <span class=main>=</span> o_x_axis <span class=main>∨</span> moebius_ocircline <span class=skolem>M</span> <span class=skolem>H'</span> <span class=main>=</span> opposite_ocircline o_x_axis"</span></span>
      <span class=keyword1><span class=command>using</span></span> ocircline_01inf
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"o_x_axis <span class=main>=</span> moebius_ocircline <span class=skolem>M</span> <span class=skolem>H'</span> <span class=main>∨</span>  o_x_axis <span class=main>=</span> opposite_ocircline <span class=main>(</span>moebius_ocircline <span class=skolem>M</span> <span class=skolem>H'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H'</span> <span class=main>=</span> <span class=var>?H</span> <span class=main>∨</span> <span class=skolem>H'</span> <span class=main>=</span> opposite_ocircline <span class=var>?H</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"o_x_axis <span class=main>=</span> moebius_ocircline <span class=skolem>M</span> <span class=skolem>H'</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H'</span> <span class=main>=</span> moebius_ocircline <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> o_x_axis <span class=main>∨</span> <span class=skolem>H'</span> <span class=main>=</span> opposite_ocircline <span class=main>(</span>moebius_ocircline <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> o_x_axis<span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> disjI1<span class=main>)</span> <span class=main>(</span><span class=operator>subst</span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"o_x_axis <span class=main>=</span> opposite_ocircline <span class=main>(</span>moebius_ocircline <span class=skolem>M</span> <span class=skolem>H'</span><span class=main>)</span>"</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H'</span> <span class=main>=</span> moebius_ocircline <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> o_x_axis <span class=main>∨</span> <span class=skolem>H'</span> <span class=main>=</span> opposite_ocircline <span class=main>(</span>moebius_ocircline <span class=main>(</span>moebius_inv <span class=skolem>M</span><span class=main>)</span> o_x_axis<span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> disjI2<span class=main>)</span> <span class=main>(</span><span class=operator>subst</span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span> <span class=bound>x</span><span class=main>.</span> <span class=var>?P</span> <span class=bound>x</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"pos_oriented <span class=var>?H</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=var>?H</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> 1 True
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>H</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=var>?H</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> 1 2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>H</span></span><span class=main>]</span> True
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?OH</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"opposite_ocircline <span class=var>?H</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=var>?OH</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> 1 False
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>H</span>"</span></span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=var>?OH</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> False 2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>H</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Oriented_Circlines-ocircline_set_0h><span class=command>lemma</span></span> ocircline_set_0h<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"ocircline_set <span class=free>H</span> <span class=main>=</span> <span class=main>{</span><span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span><span class=main>}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>H</span> <span class=main>=</span> o_circline_point_0 <span class=main>∨</span> <span class=free>H</span> <span class=main>=</span> opposite_ocircline <span class=main>(</span>o_circline_point_0<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"of_ocircline <span class=free>H</span> <span class=main>=</span> circline_point_0"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> unique_circline_type_zero_0' card_eq1_circline_type_zero<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"of_ocircline <span class=free>H</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inj_of_ocircline of_ocircline_o_circline_point_0<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Circlines_Angle>
<div class=head>
<h1>Theory Circlines_Angle</h1>
</div>
<pre class=source><span class=keyword1><span class=command>theory</span></span> Circlines_Angle
  <span class=keyword2><span class=keyword>imports</span></span> <a href=#Oriented_Circlines>Oriented_Circlines</a> <a href=#Elementary_Complex_Geometry>Elementary_Complex_Geometry</a>
<span class=keyword2><span class=keyword>begin</span></span>


<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Angle between circlines›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Angle between circlines can be defined in purely algebraic terms (following Schwerdtfeger
\cite{schwerdtfeger}) and using this definitions many properties can be easily proved.›</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mat_det_12</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat <span class=main>⇒</span> complex"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>mat_det_12</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>A1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>B1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>C1</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>D1</span></span></span><span class=main>)</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>A2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>B2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>C2</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>D2</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>A1</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>D2</span></span></span> <span class=main>+</span> <span class=free><span class=bound><span class=entity>A2</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>D1</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>B1</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>C2</span></span></span> <span class=main>-</span> <span class=free><span class=bound><span class=entity>B2</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>C1</span></span></span>"</span></span>

<span class=keyword1 id=Circlines_Angle-mat_det_12_mm_l><span class=command>lemma</span></span> mat_det_12_mm_l <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det_12 <span class=main>(</span><span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=main>(</span><span class=free>M</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> mat_det <span class=free>M</span> <span class=main>*</span> mat_det_12 <span class=free>A</span> <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Circlines_Angle-mat_det_12_mm_r><span class=command>lemma</span></span> mat_det_12_mm_r <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det_12 <span class=main>(</span><span class=free>A</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span> <span class=main>(</span><span class=free>B</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>M</span><span class=main>)</span> <span class=main>=</span> mat_det <span class=free>M</span> <span class=main>*</span> mat_det_12 <span class=free>A</span> <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Circlines_Angle-mat_det_12_sm_l><span class=command>lemma</span></span> mat_det_12_sm_l <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det_12 <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>A</span><span class=main>)</span> <span class=free>B</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> mat_det_12 <span class=free>A</span> <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Circlines_Angle-mat_det_12_sm_r><span class=command>lemma</span></span> mat_det_12_sm_r <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det_12 <span class=free>A</span> <span class=main>(</span><span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> mat_det_12 <span class=free>A</span> <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>B</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Circlines_Angle-mat_det_12_congruence><span class=command>lemma</span></span> mat_det_12_congruence <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mat_det_12 <span class=main>(</span>congruence <span class=free>M</span> <span class=free>A</span><span class=main>)</span> <span class=main>(</span>congruence <span class=free>M</span> <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cor <span class=main>(</span><span class=main>(</span>cmod <span class=main>(</span>mat_det <span class=free>M</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> mat_det_12 <span class=free>A</span> <span class=free>B</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> congruence_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=main>(</span><span class=operator>subst</span> mult_mm_assoc<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mat_det_12_mm_l<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mat_det_12_mm_r<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mat_det_adj<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> complex_mult_cnj_cmod<span class=main>)</span>


<span class=keyword1><span class=command>definition</span></span> <span class=entity>cos_angle_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> complex_mat <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>cos_angle_cmat</span> <span class=free><span class=bound><span class=entity>H1</span></span></span> <span class=free><span class=bound><span class=entity>H2</span></span></span> <span class=main>=</span> <span class=main>-</span> Re <span class=main>(</span>mat_det_12 <span class=free><span class=bound><span class=entity>H1</span></span></span> <span class=free><span class=bound><span class=entity>H2</span></span></span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=free><span class=bound><span class=entity>H1</span></span></span> <span class=main>*</span> mat_det <span class=free><span class=bound><span class=entity>H2</span></span></span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> cos_angle_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> circline_mat <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>cos_angle_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Circlines_Angle-cos_angle_den_scale><span class=command>lemma</span></span> cos_angle_den_scale <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>k1</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>k2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> mat_det <span class=free>H1</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> mat_det <span class=free>H2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
         <span class=free>k1</span> <span class=main>*</span> <span class=free>k2</span> <span class=main>*</span> sqrt <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=free>H1</span> <span class=main>*</span> mat_det <span class=free>H2</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> mat_det <span class=free>H1</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> mat_det <span class=free>H2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"mat_det <span class=free>H1</span> <span class=main>*</span> mat_det <span class=free>H2</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=main>(</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>*</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=var>?lhs</span> <span class=main>=</span> <span class=main>(</span><span class=free>k1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>*</span><span class=free>k2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> Re <span class=var>?rhs</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> real_sqrt_mult<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> cos_angle <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline <span class=main>⇒</span> ocircline <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>cos_angle_clmat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H1</span> <span class=skolem>H2</span> <span class=skolem>H1'</span> <span class=skolem>H2'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=skolem>H1</span> <span class=skolem>H1'</span>"</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=skolem>H2</span> <span class=skolem>H2'</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k1</span></span> <span class=skolem><span class=skolem>k2</span></span> <span class=main>::</span> <span class=quoted>real</span> <span class=keyword2><span class=keyword>where</span></span>
  *<span class=main>:</span>  <span class=quoted><span class=quoted>"<span class=skolem>k1</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H1'</span> <span class=main>=</span> cor <span class=skolem>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H1</span>"</span></span>
      <span class=quoted><span class=quoted>"<span class=skolem>k2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>H2'</span> <span class=main>=</span> cor <span class=skolem>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>H2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"cos_angle_cmat <span class=skolem>H1</span> <span class=skolem>H2</span> <span class=main>=</span> cos_angle_cmat <span class=skolem>H1'</span> <span class=skolem>H2'</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> cos_angle_cmat_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mat_det_12_sm_l<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> mat_det_12_sm_r<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mat_det_mult_sm<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> power2_eq_square<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> cos_angle_den_scale<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius transformations are conformal, meaning that they preserve oriented angle between
oriented circlines.›</span></span>

<span class=keyword1 id=Circlines_Angle-cos_angle_opposite1><span class=command>lemma</span></span> cos_angle_opposite1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos_angle <span class=main>(</span>opposite_ocircline <span class=free>H</span><span class=main>)</span> <span class=free>H'</span> <span class=main>=</span> <span class=main>-</span> cos_angle <span class=free>H</span> <span class=free>H'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Circlines_Angle-cos_angle_opposite2><span class=command>lemma</span></span> cos_angle_opposite2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos_angle <span class=free>H</span> <span class=main>(</span>opposite_ocircline <span class=free>H'</span><span class=main>)</span> <span class=main>=</span> <span class=main>-</span> cos_angle <span class=free>H</span> <span class=free>H'</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Connection with the elementary angle definition between circles›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span><span class=quoted><span class=plain_text>‹We want to connect algebraic definition of an angle with a traditional one and 
to prove equivalency between these two definitions. For the traditional definition of 
an angle we follow the approach suggested by Needham \cite{needham}.›</span></span>

<span class=keyword1 id=Circlines_Angle-Re_sgn><span class=command>lemma</span></span> Re_sgn<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>sgn <span class=free>A</span><span class=main>)</span> <span class=main>=</span> sgn_bool <span class=main>(</span>Re <span class=free>A</span> <span class=main>&gt;</span> <span class=main>0</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>using</span></span> More_Complex.Re_sgn complex_eq_if_Re_eq
<span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Circlines_Angle-Re_mult_real3><span class=command>lemma</span></span> Re_mult_real3<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>z3</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>z1</span> <span class=main>*</span> <span class=free>z2</span> <span class=main>*</span> <span class=free>z3</span><span class=main>)</span> <span class=main>=</span> Re <span class=free>z1</span> <span class=main>*</span> Re <span class=free>z2</span> <span class=main>*</span> Re <span class=free>z3</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Re_mult_real mult_reals<span class=main>)</span>

<span class=keyword1 id=Circlines_Angle-sgn_sqrt><span class=command>lemma</span></span> sgn_sqrt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>sqrt <span class=free>x</span><span class=main>)</span> <span class=main>=</span> sgn <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_root sqrt_def<span class=main>)</span>

<span class=keyword1 id=Circlines_Angle-real_circle_sgn_r><span class=command>lemma</span></span> real_circle_sgn_r<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_circle <span class=free>H</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>,</span> <span class=free>r</span><span class=main>)</span> <span class=main>=</span> euclidean_circle <span class=free>H</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sgn <span class=free>r</span> <span class=main>=</span> <span class=main>-</span> circline_type <span class=free>H</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span> <span class=main>::</span> <span class=quoted>complex_mat</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>a</span> <span class=skolem>r</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hermitean_elems hh
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> circline_A0_cmat <span class=skolem>H</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>r</span><span class=main>)</span> <span class=main>=</span> euclidean_circle_cmat <span class=skolem>H</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> circline_A0_cmat <span class=skolem>H</span>›</span></span> HH
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>*</span> Re <span class=skolem>A</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_eq_if_Re_eq not_real_square_gt_zero
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"sgn <span class=skolem>r</span> <span class=main>=</span> <span class=main>-</span> circline_type_cmat <span class=skolem>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> HH <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>r</span><span class=main>)</span> <span class=main>=</span> euclidean_circle_cmat <span class=skolem>H</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Re_divide_real sgn_minus<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The definition of an angle using algebraic terms is not intuitive, and we want to connect it to
the more common definition given earlier that defines an
angle between circlines as the angle between tangent vectors in the point of the intersection of the
circlines.›</span></span>

<span class=keyword1 id=Circlines_Angle-cos_angle_eq_cos_ang_circ><span class=command>lemma</span></span> cos_angle_eq_cos_ang_circ<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span>
  <span class=quoted><span class=quoted>"is_circle <span class=main>(</span>of_ocircline <span class=free>H1</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_circle <span class=main>(</span>of_ocircline <span class=free>H2</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  <span class=quoted><span class=quoted>"circline_type <span class=main>(</span>of_ocircline <span class=free>H1</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"circline_type <span class=main>(</span>of_ocircline <span class=free>H2</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a1</span><span class=main>,</span> <span class=free>r1</span><span class=main>)</span> <span class=main>=</span> euclidean_circle <span class=main>(</span>of_ocircline <span class=free>H1</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a2</span><span class=main>,</span> <span class=free>r2</span><span class=main>)</span> <span class=main>=</span> euclidean_circle <span class=main>(</span>of_ocircline <span class=free>H2</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  <span class=quoted><span class=quoted>"of_complex <span class=free>E</span> <span class=main>∈</span> ocircline_set <span class=free>H1</span> <span class=main>∩</span> ocircline_set <span class=free>H2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos_angle <span class=free>H1</span> <span class=free>H2</span> <span class=main>=</span> cos <span class=main>(</span>ang_circ <span class=free>E</span> <span class=free>a1</span> <span class=free>a2</span> <span class=main>(</span>pos_oriented <span class=free>H1</span><span class=main>)</span> <span class=main>(</span>pos_oriented <span class=free>H2</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?p1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"pos_oriented <span class=free>H1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?p2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"pos_oriented <span class=free>H2</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>∈</span> circle <span class=free>a1</span> <span class=free>r1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>∈</span> circle <span class=free>a2</span> <span class=free>r2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> classic_circle<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"of_ocircline <span class=free>H1</span>"</span></span> <span class=quoted><span class=free>a1</span></span> <span class=quoted><span class=free>r1</span></span><span class=main>]</span>  classic_circle<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"of_ocircline <span class=free>H2</span>"</span></span> <span class=quoted><span class=free>a2</span></span> <span class=quoted><span class=free>r2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> assms of_complex_inj
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"cdist <span class=free>E</span> <span class=free>a1</span> <span class=main>=</span> <span class=free>r1</span>"</span></span> <span class=quoted><span class=quoted>"cdist <span class=free>E</span> <span class=free>a2</span> <span class=main>=</span> <span class=free>r2</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> circle_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> norm_minus_commute<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>r1</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>r2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms<span class=main>(</span>1-6<span class=main>)</span> real_circle_sgn_r<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"of_ocircline <span class=free>H1</span>"</span></span> <span class=quoted><span class=free>a1</span></span> <span class=quoted><span class=free>r1</span></span><span class=main>]</span>  real_circle_sgn_r<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"of_ocircline <span class=free>H2</span>"</span></span> <span class=quoted><span class=free>a2</span></span> <span class=quoted><span class=free>r2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> sgn_greater 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>a1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>E</span> <span class=main>≠</span> <span class=free>a2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cdist <span class=free>E</span> <span class=free>a1</span> <span class=main>=</span> <span class=free>r1</span>›</span></span> <span class=quoted><span class=quoted>‹cdist <span class=free>E</span> <span class=free>a2</span> <span class=main>=</span> <span class=free>r2</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?k</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sgn_bool <span class=main>(</span><span class=var>?p1</span> <span class=main>=</span> <span class=var>?p2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?xx</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?k</span> <span class=main>*</span> <span class=main>(</span><span class=free>r1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>r2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cdist <span class=free>a2</span> <span class=free>a1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>r1</span> <span class=main>*</span> <span class=free>r2</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cos <span class=main>(</span>ang_circ <span class=free>E</span> <span class=free>a1</span> <span class=free>a2</span> <span class=var>?p1</span> <span class=var>?p2</span><span class=main>)</span> <span class=main>=</span> <span class=var>?xx</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> law_of_cosines<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a2</span></span> <span class=quoted><span class=free>a1</span></span> <span class=quoted><span class=free>E</span></span><span class=main>]</span> * <span class=quoted><span class=quoted>‹<span class=free>r1</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>r2</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> cos_ang_circ_simp<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>E</span> <span class=main>≠</span> <span class=free>a1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>E</span> <span class=main>≠</span> <span class=free>a2</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> ang_vec_opposite_opposite'<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=free>E</span> <span class=main>≠</span> <span class=free>a1</span>›</span></span><span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> <span class=quoted><span class=quoted>‹<span class=free>E</span> <span class=main>≠</span> <span class=free>a2</span>›</span></span><span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=main>,</span></span> <span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cos_angle <span class=free>H1</span> <span class=free>H2</span> <span class=main>=</span> <span class=var>?xx</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>r1</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>r2</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>a1</span><span class=main>,</span> <span class=free>r1</span><span class=main>)</span> <span class=main>=</span> euclidean_circle <span class=main>(</span>of_ocircline <span class=free>H1</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=free>a2</span><span class=main>,</span> <span class=free>r2</span><span class=main>)</span> <span class=main>=</span> euclidean_circle <span class=main>(</span>of_ocircline <span class=free>H2</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_circle <span class=main>(</span>of_ocircline <span class=free>H1</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹is_circle <span class=main>(</span>of_ocircline <span class=free>H2</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹circline_type <span class=main>(</span>of_ocircline <span class=free>H1</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹circline_type <span class=main>(</span>of_ocircline <span class=free>H2</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a1</span> <span class=skolem>r1</span> <span class=skolem>H1</span> <span class=skolem>H2</span> <span class=skolem>a2</span> <span class=skolem>r2</span>
    <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H1</span> <span class=main>∧</span> <span class=skolem>H1</span> <span class=main>≠</span> mat_zero"</span></span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H2</span> <span class=main>∧</span> <span class=skolem>H2</span> <span class=main>≠</span> mat_zero"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A1</span></span> <span class=skolem><span class=skolem>B1</span></span> <span class=skolem><span class=skolem>C1</span></span> <span class=skolem><span class=skolem>D1</span></span> <span class=keyword2><span class=keyword>where</span></span> HH1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H1</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A1</span><span class=main>,</span> <span class=skolem>B1</span><span class=main>,</span> <span class=skolem>C1</span><span class=main>,</span> <span class=skolem>D1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H1</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A2</span></span> <span class=skolem><span class=skolem>B2</span></span> <span class=skolem><span class=skolem>C2</span></span> <span class=skolem><span class=skolem>D2</span></span> <span class=keyword2><span class=keyword>where</span></span> HH2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H2</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A2</span><span class=main>,</span> <span class=skolem>B2</span><span class=main>,</span> <span class=skolem>C2</span><span class=main>,</span> <span class=skolem>D2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H2</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A1</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A2</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D1</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D2</span>"</span></span> <span class=quoted><span class=quoted>"cnj <span class=skolem>B1</span> <span class=main>=</span> <span class=skolem>C1</span>"</span></span> <span class=quoted><span class=quoted>"cnj <span class=skolem>B2</span> <span class=main>=</span> <span class=skolem>C2</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A1</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B1</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C1</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D1</span></span></span></span></span></span></span></span><span class=main>]</span> hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A2</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B2</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C2</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D2</span></span></span></span></span></span></span></span><span class=main>]</span> HH1 HH2
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cnj <span class=skolem>A1</span> <span class=main>=</span> <span class=skolem>A1</span>"</span></span> <span class=quoted><span class=quoted>"cnj <span class=skolem>A2</span> <span class=main>=</span> <span class=skolem>A2</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A2</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>case_tac</span><span class=main><span class=improper>[</span></span><span class=main><span class=main>!</span></span><span class=main><span class=improper>]</span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem>A1</span></span></span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span><span class=main><span class=improper>[</span></span><span class=main><span class=main>!</span></span><span class=main><span class=improper>]</span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem>A2</span></span></span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_eq<span class=main>)</span>

    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> circline_A0_cmat <span class=main>(</span>id <span class=skolem>H1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> circline_A0_cmat <span class=main>(</span>id <span class=skolem>H2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> HH1 HH2
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A2</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> complex.expand
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_type_cmat <span class=main>(</span>id <span class=skolem>H1</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"circline_type_cmat <span class=main>(</span>id <span class=skolem>H2</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a1</span><span class=main>,</span> <span class=skolem>r1</span><span class=main>)</span> <span class=main>=</span> euclidean_circle_cmat <span class=main>(</span>id <span class=skolem>H1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>a2</span><span class=main>,</span> <span class=skolem>r2</span><span class=main>)</span> <span class=main>=</span> euclidean_circle_cmat <span class=main>(</span>id <span class=skolem>H2</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r1</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>

    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?D12</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"mat_det_12 <span class=skolem>H1</span> <span class=skolem>H2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>H1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>H2</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?x1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>cdist <span class=skolem>a2</span> <span class=skolem>a1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=skolem>r1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=skolem>r2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?x2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span><span class=skolem>r1</span><span class=main>*</span><span class=skolem>r2</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?x</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=var>?x1</span> <span class=main>/</span> <span class=var>?x2</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span>  <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=var>?D12</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=var>?D1</span> <span class=main>*</span> <span class=var>?D2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Re <span class=main>(</span>sgn <span class=skolem>A1</span><span class=main>)</span> <span class=main>*</span> Re <span class=main>(</span>sgn <span class=skolem>A2</span><span class=main>)</span> <span class=main>*</span> <span class=var>?x</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A1</span><span class=main>,</span> <span class=skolem>B1</span><span class=main>,</span> <span class=skolem>C1</span><span class=main>,</span> <span class=skolem>D1</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?M2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A2</span><span class=main>,</span> <span class=skolem>B2</span><span class=main>,</span> <span class=skolem>C2</span><span class=main>,</span> <span class=skolem>D2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?d1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>B1</span> <span class=main>*</span> <span class=skolem>C1</span> <span class=main>-</span> <span class=skolem>A1</span> <span class=main>*</span> <span class=skolem>D1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?d2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=skolem>B2</span> <span class=main>*</span> <span class=skolem>C2</span> <span class=main>-</span> <span class=skolem>A2</span> <span class=main>*</span> <span class=skolem>D2</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=var>?d1</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=var>?d2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> HH1 HH2 <span class=quoted><span class=quoted>‹circline_type_cmat <span class=main>(</span>id <span class=skolem>H1</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>  <span class=quoted><span class=quoted>‹circline_type_cmat <span class=main>(</span>id <span class=skolem>H2</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=var>?d1</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A1</span> <span class=main>*</span> <span class=skolem>A1</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=var>?d2</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A2</span> <span class=main>*</span> <span class=skolem>A2</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_neq_0 power2_eq_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command>have</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span><span class=var>?d1</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A1</span> <span class=main>*</span> <span class=skolem>A1</span><span class=main>)</span><span class=main>)</span> <span class=main>∧</span> is_real <span class=main>(</span><span class=var>?d2</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A2</span> <span class=main>*</span> <span class=skolem>A2</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A1</span>›</span></span>  <span class=quoted><span class=quoted>‹is_real <span class=skolem>A2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹cnj <span class=skolem>B1</span> <span class=main>=</span> <span class=skolem>C1</span>›</span></span><span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=quoted><span class=quoted>‹cnj <span class=skolem>B2</span> <span class=main>=</span> <span class=skolem>C2</span>›</span></span><span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D2</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> div_reals<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cor <span class=var>?x</span> <span class=main>=</span> mat_det_12 <span class=var>?M1</span> <span class=var>?M2</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> sgn <span class=skolem>A1</span> <span class=main>*</span> sgn <span class=skolem>A2</span> <span class=main>*</span> cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=var>?d1</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span>Re <span class=var>?d2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A1</span><span class=main>*</span><span class=skolem>A2</span><span class=main>*</span>cor <span class=var>?x1</span> <span class=main>=</span> mat_det_12 <span class=var>?M1</span> <span class=var>?M2</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
          <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>A1</span><span class=main>*</span><span class=skolem>A2</span><span class=main>*</span><span class=main>(</span>cor <span class=main>(</span><span class=main>(</span>cdist <span class=skolem>a2</span> <span class=skolem>a1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=skolem>B2</span><span class=main>*</span><span class=skolem>A1</span> <span class=main>-</span> <span class=skolem>A2</span><span class=main>*</span><span class=skolem>B1</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=skolem>C2</span><span class=main>*</span><span class=skolem>A1</span> <span class=main>-</span> <span class=skolem>C1</span><span class=main>*</span><span class=skolem>A2</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A1</span><span class=main>*</span><span class=skolem>A2</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>a1</span><span class=main>,</span> <span class=skolem>r1</span><span class=main>)</span> <span class=main>=</span> euclidean_circle_cmat <span class=main>(</span>id <span class=skolem>H1</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>a2</span><span class=main>,</span> <span class=skolem>r2</span><span class=main>)</span> <span class=main>=</span> euclidean_circle_cmat <span class=main>(</span>id <span class=skolem>H2</span><span class=main>)</span>›</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> cdist_def cmod_square
            <span class=keyword1><span class=command>using</span></span> HH1 HH2 * <span class=quoted><span class=quoted>‹<span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹cnj <span class=skolem>A1</span> <span class=main>=</span> <span class=skolem>A1</span>›</span></span> <span class=quoted><span class=quoted>‹cnj <span class=skolem>A2</span> <span class=main>=</span> <span class=skolem>A2</span>›</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> Let_def
            <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> complex_of_real_Re<span class=main>)</span>
            <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
            <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod power2_eq_square<span class=main>)</span>
            <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
            <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
          <span class=keyword1><span class=command>have</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>A1</span><span class=main>*</span><span class=skolem>A2</span><span class=main>*</span>cor <span class=main>(</span><span class=main>-</span><span class=skolem>r1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=skolem>A2</span><span class=main>*</span><span class=skolem>D1</span> <span class=main>-</span> <span class=skolem>B1</span><span class=main>*</span><span class=skolem>C1</span><span class=main>*</span><span class=skolem>A2</span><span class=main>/</span><span class=skolem>A1</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>a1</span><span class=main>,</span> <span class=skolem>r1</span><span class=main>)</span> <span class=main>=</span> euclidean_circle_cmat <span class=main>(</span>id <span class=skolem>H1</span><span class=main>)</span>›</span></span>
            <span class=keyword1><span class=command>using</span></span> HH1 ** * *** <span class=quoted><span class=quoted>‹<span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
          <span class=keyword1><span class=command>have</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>A1</span><span class=main>*</span><span class=skolem>A2</span><span class=main>*</span>cor <span class=main>(</span><span class=main>-</span><span class=skolem>r2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=skolem>A1</span><span class=main>*</span><span class=skolem>D2</span> <span class=main>-</span> <span class=skolem>B2</span><span class=main>*</span><span class=skolem>C2</span><span class=main>*</span><span class=skolem>A1</span><span class=main>/</span><span class=skolem>A2</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>a2</span><span class=main>,</span> <span class=skolem>r2</span><span class=main>)</span> <span class=main>=</span> euclidean_circle_cmat <span class=main>(</span>id <span class=skolem>H2</span><span class=main>)</span>›</span></span>
            <span class=keyword1><span class=command>using</span></span> HH2 ** * *** <span class=quoted><span class=quoted>‹<span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A1</span><span class=main>*</span><span class=skolem>A2</span><span class=main>*</span>cor<span class=main>(</span><span class=main>(</span>cdist <span class=skolem>a2</span> <span class=skolem>a1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>+</span> <span class=skolem>A1</span><span class=main>*</span><span class=skolem>A2</span><span class=main>*</span>cor<span class=main>(</span><span class=main>-</span><span class=skolem>r1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>+</span> <span class=skolem>A1</span><span class=main>*</span><span class=skolem>A2</span><span class=main>*</span>cor<span class=main>(</span><span class=main>-</span><span class=skolem>r2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> mat_det_12 <span class=var>?M1</span> <span class=var>?M2</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> 1<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> 2<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> 3<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
          <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>qed</span></span>

        <span class=keyword1><span class=command>moreover</span></span>

        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A1</span> <span class=main>*</span> <span class=skolem>A2</span> <span class=main>*</span> cor <span class=main>(</span><span class=var>?x2</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> sgn <span class=skolem>A1</span> <span class=main>*</span> sgn <span class=skolem>A2</span> <span class=main>*</span> cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=var>?d1</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span>Re <span class=var>?d2</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
          <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span>Re <span class=main>(</span><span class=var>?d1</span><span class=main>/</span> <span class=main>(</span><span class=skolem>A1</span> <span class=main>*</span> <span class=skolem>A1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> sqrt <span class=main>(</span>Re <span class=var>?d1</span><span class=main>)</span> <span class=main>/</span> <span class=main>¦</span>Re <span class=skolem>A1</span><span class=main>¦</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A1</span>›</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> real_sqrt_divide<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

          <span class=keyword1><span class=command>have</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span>Re <span class=main>(</span><span class=var>?d2</span><span class=main>/</span> <span class=main>(</span><span class=skolem>A2</span> <span class=main>*</span> <span class=skolem>A2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> sqrt <span class=main>(</span>Re <span class=var>?d2</span><span class=main>)</span> <span class=main>/</span> <span class=main>¦</span>Re <span class=skolem>A2</span><span class=main>¦</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A2</span>›</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> real_sqrt_divide<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sgn <span class=skolem>A1</span> <span class=main>=</span> <span class=skolem>A1</span> <span class=main>/</span> cor <span class=main>¦</span>Re <span class=skolem>A1</span><span class=main>¦</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A1</span>›</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> sgn_eq
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_eq_Re<span class=main>)</span>
          <span class=keyword1><span class=command>moreover</span></span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sgn <span class=skolem>A2</span> <span class=main>=</span> <span class=skolem>A2</span> <span class=main>/</span> cor <span class=main>¦</span>Re <span class=skolem>A2</span><span class=main>¦</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A2</span>›</span></span>
            <span class=keyword1><span class=command>unfolding</span></span> sgn_eq
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_eq_Re<span class=main>)</span>
          <span class=keyword1><span class=command>ultimately</span></span>
          <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>a1</span><span class=main>,</span> <span class=skolem>r1</span><span class=main>)</span> <span class=main>=</span> euclidean_circle_cmat <span class=main>(</span>id <span class=skolem>H1</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=skolem>a2</span><span class=main>,</span> <span class=skolem>r2</span><span class=main>)</span> <span class=main>=</span> euclidean_circle_cmat <span class=main>(</span>id <span class=skolem>H2</span><span class=main>)</span>›</span></span>  HH1 HH2
            <span class=keyword1><span class=command>using</span></span> *** <span class=quoted><span class=quoted>‹is_real <span class=skolem>A1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A2</span>›</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>subst</span> 1<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> 2<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
        <span class=keyword1><span class=command>qed</span></span>

        <span class=keyword1><span class=command>ultimately</span></span>

        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A1</span> <span class=main>*</span> <span class=skolem>A2</span> <span class=main>*</span> cor <span class=var>?x1</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A1</span> <span class=main>*</span> <span class=skolem>A2</span> <span class=main>*</span> <span class=main>(</span>cor <span class=var>?x2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span>
               mat_det_12 <span class=var>?M1</span> <span class=var>?M2</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> sgn <span class=skolem>A1</span> <span class=main>*</span> sgn <span class=skolem>A2</span> <span class=main>*</span> cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=var>?d1</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span>Re <span class=var>?d2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cor <span class=var>?x</span> <span class=main>*</span> sgn <span class=skolem>A1</span> <span class=main>*</span> sgn <span class=skolem>A2</span> <span class=main>=</span> mat_det_12 <span class=var>?M1</span> <span class=var>?M2</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=var>?d1</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span>Re <span class=var>?d2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_zero_iff<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>cor <span class=var>?x</span> <span class=main>*</span> sgn <span class=skolem>A1</span> <span class=main>*</span> sgn <span class=skolem>A2</span><span class=main>)</span> <span class=main>=</span> Re <span class=main>(</span>sgn <span class=skolem>A1</span><span class=main>)</span> <span class=main>*</span> Re <span class=main>(</span>sgn <span class=skolem>A2</span><span class=main>)</span> <span class=main>*</span> <span class=var>?x</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>cor <span class=var>?x</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>sgn <span class=skolem>A1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>sgn <span class=skolem>A2</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A2</span>›</span></span> Im_complex_of_real<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?x</span></span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> Re_complex_of_real<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?x</span></span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> Re_mult_real3<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span>Re <span class=var>?D1</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span>Re <span class=var>?D2</span><span class=main>)</span> <span class=main>=</span> sqrt <span class=main>(</span>Re <span class=var>?d1</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span>Re <span class=var>?d2</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> HH1 HH2
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> real_sqrt_mult<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=var>?D1</span> <span class=main>*</span> <span class=var>?D2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=var>?d1</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>  <span class=quoted><span class=quoted>‹Re <span class=var>?d2</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> HH1 HH2 <span class=quoted><span class=quoted>‹is_real <span class=skolem>A1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A2</span>›</span></span>  <span class=quoted><span class=quoted>‹is_real <span class=skolem>D1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D2</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> hh mat_det_hermitean_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>H1</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> Re_mult_real<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=var>?D12</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=var>?D1</span> <span class=main>*</span> <span class=var>?D2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Re <span class=main>(</span><span class=var>?D12</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=var>?D1</span> <span class=main>*</span> <span class=var>?D2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=var>?d1</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>  <span class=quoted><span class=quoted>‹Re <span class=var>?d2</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> HH1 HH2 <span class=quoted><span class=quoted>‹is_real <span class=skolem>A1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A2</span>›</span></span>  <span class=quoted><span class=quoted>‹is_real <span class=skolem>D1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D2</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main>)</span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>mat_det_12 <span class=var>?M1</span> <span class=var>?M2</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=var>?d1</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span>Re <span class=var>?d2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Re <span class=main>(</span><span class=var>?D12</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=var>?D1</span> <span class=main>*</span> <span class=var>?D2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> HH1 HH2 hh mat_det_hermitean_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>H1</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> **<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Re_mult_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> real_sqrt_mult<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> *<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=skolem>H1</span> <span class=main>⟷</span> Re <span class=skolem>A1</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"pos_oriented_cmat <span class=skolem>H2</span> <span class=main>⟷</span> Re <span class=skolem>A2</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> HH1  <span class=quoted><span class=quoted>‹Re <span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> HH2
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"cos_angle_cmat <span class=skolem>H1</span> <span class=skolem>H2</span> <span class=main>=</span> sgn_bool <span class=main>(</span>pos_oriented_cmat <span class=skolem>H1</span> <span class=main>=</span> pos_oriented_cmat <span class=skolem>H2</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>r1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=skolem>r2</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cdist <span class=skolem>a2</span> <span class=skolem>a1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>/</span>  <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=skolem>r1</span> <span class=main>*</span> <span class=skolem>r2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> Let_def
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>r1</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>r2</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> cos_angle_cmat_def
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> divide_minus_left<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_sgn<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Re_sgn<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A2</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> **<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> **<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Perpendicularity›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Two circlines are perpendicular if the intersect at right angle i.e., the angle with the cosine
0.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>perpendicular</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>perpendicular</span> <span class=free><span class=bound><span class=entity>H1</span></span></span> <span class=free><span class=bound><span class=entity>H2</span></span></span> <span class=main>⟷</span> cos_angle <span class=main>(</span>of_circline <span class=free><span class=bound><span class=entity>H1</span></span></span><span class=main>)</span> <span class=main>(</span>of_circline <span class=free><span class=bound><span class=entity>H2</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>

<span class=keyword1 id=Circlines_Angle-perpendicular_sym><span class=command>lemma</span></span> perpendicular_sym<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"perpendicular <span class=free>H1</span> <span class=free>H2</span> <span class=main>⟷</span> perpendicular <span class=free>H2</span> <span class=free>H1</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> perpendicular_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Möbius transforms preserve angles and perpendicularity›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius transformations are \emph{conformal} i.e., they preserve angles between circlines.›</span></span>

<span class=keyword1 id=Circlines_Angle-moebius_preserve_circline_angle><span class=command>lemma</span></span> moebius_preserve_circline_angle <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cos_angle <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H1</span><span class=main>)</span> <span class=main>(</span>moebius_ocircline <span class=free>M</span> <span class=free>H2</span><span class=main>)</span> <span class=main>=</span>
         cos_angle <span class=free>H1</span> <span class=free>H2</span> "</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H1</span> <span class=skolem>H2</span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"cos_angle_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H1</span><span class=main>)</span> <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> <span class=skolem>H2</span><span class=main>)</span> <span class=main>=</span> cos_angle_cmat <span class=skolem>H1</span> <span class=skolem>H2</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> cos_angle_cmat_def moebius_circline_cmat_cmat_def
    <span class=keyword1><span class=command>unfolding</span></span> Let_def mat_det_12_congruence mat_det_congruence
    <span class=keyword1><span class=command>using</span></span> hh mat_det_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> cor_squared<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> cos_angle_den_scale<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square real_sqrt_mult <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Circlines_Angle-perpendicular_moebius><span class=command>lemma</span></span> perpendicular_moebius <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"perpendicular <span class=free>H1</span> <span class=free>H2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"perpendicular <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H1</span><span class=main>)</span> <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> perpendicular_def
  <span class=keyword1><span class=command>using</span></span> moebius_preserve_circline_angle<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=quoted>"of_circline <span class=free>H1</span>"</span></span> <span class=quoted><span class=quoted>"of_circline <span class=free>H2</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> moebius_ocircline_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=quoted>"of_circline <span class=free>H1</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> moebius_ocircline_circline<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span> <span class=quoted><span class=quoted>"of_circline <span class=free>H2</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> moebius_preserve_circline_angle<span class=main>)</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Unit_Circle_Preserving_Moebius>
<div class=head>
<h1>Theory Unit_Circle_Preserving_Moebius</h1>
</div>
<pre class=source><span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Unit circle preserving Möbius transformations›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹In this section we shall examine Möbius transformations that map the unit circle onto itself.
We shall say that they fix or preserve the unit circle (although, they do not need to fix each of
its points).›</span></span>

<span class=keyword1><span class=command>theory</span></span> Unit_Circle_Preserving_Moebius
<span class=keyword2><span class=keyword>imports</span></span> <a href=#Unitary11_Matrices>Unitary11_Matrices</a> <a href=#Moebius>Moebius</a> <a href=#Oriented_Circlines>Oriented_Circlines</a>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Möbius transformations that fix the unit circle›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹We define Möbius transformations that preserve unit circle as transformations represented by
generalized unitary matrices with the $1-1$ signature (elements of the gruop $GU_{1,1}(2,
\mathbb{C})$, defined earlier in the theory Unitary11Matrices).›</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> unit_circle_fix_mmat <span class=main>::</span> <span class=quoted><span class=quoted>"moebius_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>unitary11_gen</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> unit_circle_fix <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>unit_circle_fix_mmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> mult_sm.simps<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> mult_sm.simps <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary11_gen_mult_sm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> mult_sm.simps <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary11_gen_div_sm<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Our algebraic characterisation (by matrices) is geometrically correct.›</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_circle_fix_iff><span class=command>lemma</span></span> unit_circle_fix_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=free>M</span> <span class=main>⟷</span> 
         moebius_circline <span class=free>M</span> unit_circle <span class=main>=</span> unit_circle"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?rhs</span> <span class=main>=</span> <span class=var>?lhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> unit_circle_cmat<span class=main>)</span> unit_circle_cmat"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> congruence <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>/</span>cor <span class=skolem>k</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>/</span>cor <span class=skolem>k</span><span class=main>)</span> <span class=main>=</span> congruence <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> mult_sm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"congruence <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span> <span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"congruence <span class=skolem>M</span> <span class=main>(</span><span class=main>1</span><span class=main>/</span>cor <span class=skolem>k</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>/</span>cor <span class=skolem>k</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> mat_det_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> congruence_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_inv <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>/</span>cor <span class=skolem>k</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>/</span>cor <span class=skolem>k</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"congruence <span class=skolem>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> congruence_scale_m<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span>cor <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> mult_sm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span> cor <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"congruence <span class=skolem>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=skolem>M</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> unitary11_gen_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=skolem>M</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> unitary11_gen_mat_inv
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>" circline_eq_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> unit_circle_cmat<span class=main>)</span> unit_circle_cmat"</span></span>
      <span class=keyword1><span class=command>unfolding</span></span> unitary11_gen_real
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=improper>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-circline_set_fix_iff_circline_fix><span class=command>lemma</span></span> circline_set_fix_iff_circline_fix<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"circline_set <span class=free>H'</span> <span class=main>≠</span> <span class=main>{}</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"circline_set <span class=main>(</span>moebius_circline <span class=free>M</span> <span class=free>H</span><span class=main>)</span> <span class=main>=</span> circline_set <span class=free>H'</span> <span class=main>⟷</span> 
         moebius_circline <span class=free>M</span> <span class=free>H</span> <span class=main>=</span> <span class=free>H'</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>rule</span> inj_circline_set<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_circle_fix_iff_unit_circle_set><span class=command>lemma</span></span> unit_circle_fix_iff_unit_circle_set<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=free>M</span> <span class=main>⟷</span> moebius_pt <span class=free>M</span> <span class=main>`</span> unit_circle_set <span class=main>=</span> unit_circle_set"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"circline_set unit_circle <span class=main>≠</span> <span class=main>{}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> one_in_unit_circle_set
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> unit_circle_fix_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span> circline_set_fix_iff_circline_fix<span class=main>[</span><span class=operator>of</span> <span class=quoted>unit_circle</span> <span class=quoted><span class=free>M</span></span> <span class=quoted>unit_circle</span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unit_circle_set_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Unit circle preserving Möbius transformations form a group. ›</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_circle_fix_id_moebius><span class=command>lemma</span></span> unit_circle_fix_id_moebius <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_circle_fix id_moebius"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary11_gen_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_circle_fix_moebius_add><span class=command>lemma</span></span> unit_circle_fix_moebius_add <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=free>M1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=free>M2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=main>(</span><span class=free>M1</span> <span class=main>+</span> <span class=free>M2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> unit_circle_fix_iff
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_circle_fix_moebius_comp><span class=command>lemma</span></span> unit_circle_fix_moebius_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=free>M1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=free>M2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=main>(</span>moebius_comp <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> unit_circle_fix_moebius_add<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_circle_fix_moebius_uminus><span class=command>lemma</span></span> unit_circle_fix_moebius_uminus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=main>(</span><span class=main>-</span><span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> unit_circle_fix_iff
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> moebius_circline_comp_inv_left uminus_moebius_def<span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_circle_fix_moebius_inv><span class=command>lemma</span></span> unit_circle_fix_moebius_inv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> unit_circle_fix_moebius_uminus<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Unit circle fixing transforms preserve inverse points.›</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_circle_fix_moebius_pt_inversion><span class=command>lemma</span></span> unit_circle_fix_moebius_pt_inversion <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=main>(</span>inversion <span class=free>z</span><span class=main>)</span> <span class=main>=</span> inversion <span class=main>(</span>moebius_pt <span class=free>M</span> <span class=free>z</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> symmetry_principle<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span> <span class=quoted><span class=quoted>"inversion <span class=free>z</span>"</span></span> <span class=quoted>unit_circle</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> unit_circle_fix_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> circline_symmetric_inv_homo_disc<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> circline_symmetric_inv_homo_disc'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>z</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=main>(</span>inversion <span class=free>z</span><span class=main>)</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Möbius transformations that fix the imaginary unit circle›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Only for completeness we show that Möbius transformations that preserve the imaginary unit
circle are exactly those characterised by generalized unitary matrices (with the (2, 0) signature).›</span></span>
<span class=keyword1 id=Unit_Circle_Preserving_Moebius-imag_unit_circle_fixed_iff_unitary_gen><span class=command>lemma</span></span> imag_unit_circle_fixed_iff_unitary_gen<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>mk_moebius <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span><span class=main>)</span> imag_unit_circle <span class=main>=</span> imag_unit_circle <span class=main>⟷</span>
         unitary_gen <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>A</span> <span class=skolem>B</span> <span class=skolem>C</span> <span class=skolem>D</span> <span class=main>::</span> <span class=quoted>complex</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?E</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=main>(</span>mk_moebius_cmat <span class=skolem>A</span> <span class=skolem>B</span> <span class=skolem>C</span> <span class=skolem>D</span><span class=main>)</span> imag_unit_circle_cmat<span class=main>)</span> imag_unit_circle_cmat"</span></span>
           <span class=quoted><span class=quoted>"mat_det <span class=var>?M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?E</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> congruence <span class=main>(</span>mat_inv <span class=var>?M</span><span class=main>)</span> <span class=var>?E</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=main>(</span>mat_inv <span class=var>?M</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> mult_sm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"congruence <span class=main>(</span>mat_inv <span class=var>?M</span><span class=main>)</span> <span class=var>?E</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?E</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> unitary_gen_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> congruence_def divide_eq_0_iff eye_def mat_eye_r of_real_eq_0_iff one_neq_zero<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=var>?M</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> unitary_gen_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_inv <span class=var>?M</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹mat_det <span class=var>?M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> mat_inv.simps<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>A</span> <span class=skolem>B</span> <span class=skolem>C</span> <span class=skolem>D</span> <span class=main>::</span> <span class=quoted>complex</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?E</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=var>?M</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=var>?M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"unitary_gen <span class=main>(</span>mat_inv <span class=var>?M</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> unitary_gen_inv<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?M</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_adj <span class=main>(</span>mat_inv <span class=var>?M</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_inv <span class=var>?M</span><span class=main>)</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye"</span></span>
      <span class=keyword1><span class=command>using</span></span> unitary_gen_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_inv <span class=var>?M</span>"</span></span><span class=main>]</span> mat_det_inv<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?M</span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?E</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> cor <span class=skolem>k</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_adj <span class=main>(</span>mat_inv <span class=var>?M</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_inv <span class=var>?M</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> mult_sm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span>"</span></span> <span class=quoted>eye</span> <span class=quoted><span class=quoted>"mat_adj <span class=main>(</span>mat_inv <span class=var>?M</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_inv <span class=var>?M</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span>
            <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> cor <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>mat_adj <span class=main>(</span>mat_inv <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_inv <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=var>?M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=quoted>"*"</span> Im_complex_of_real Re_complex_of_real <span class=quoted><span class=quoted>‹mat_adj <span class=main>(</span>mat_inv <span class=var>?M</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> mat_inv <span class=var>?M</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> eye›</span></span> complex_of_real_Re eye_def mat_eye_l mult_mm_assoc mult_mm_sm mult_sm_eye_mm of_real_1 of_real_divide of_real_eq_1_iff zero_eq_1_divide_iff<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=main>(</span>mk_moebius_cmat <span class=skolem>A</span> <span class=skolem>B</span> <span class=skolem>C</span> <span class=skolem>D</span><span class=main>)</span> imag_unit_circle_cmat<span class=main>)</span> imag_unit_circle_cmat"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹mat_det <span class=var>?M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> mat_inv.simps<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Möbius transformations that fix the oriented unit circle and the unit disc›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Möbius transformations that fix the unit circle either map the unit disc onto itself or
exchange it with its exterior. The transformations that fix the unit disc can be recognized from
their matrices -- they have the form as before, but additionally it must hold that $|a|^2 &gt; |b|^2$.›</span></span>
  
<span class=keyword1><span class=command>definition</span></span> <span class=entity>unit_disc_fix_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>unit_disc_fix_cmat</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>⟷</span>
          <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>M</span></span></span>
            <span class=keyword1>in</span> unitary11_gen <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>∧</span> <span class=main>(</span><span class=bound>B</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> Re <span class=main>(</span><span class=main>(</span><span class=bound>A</span><span class=main>*</span><span class=bound>D</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=bound>B</span><span class=main>*</span><span class=bound>C</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> unit_disc_fix_mmat <span class=main>::</span> <span class=quoted><span class=quoted>"moebius_mat <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>unit_disc_fix_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> unit_disc_fix <span class=main>::</span> <span class=quoted><span class=quoted>"moebius <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>unit_disc_fix_mmat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>M'</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
  <span class=keyword3><span class=command>assume</span></span> det<span class=main>:</span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"moebius_cmat_eq <span class=skolem>M</span> <span class=skolem>M'</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M'</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=skolem>M</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"unitary11_gen <span class=skolem>M</span> <span class=main>⟷</span> unitary11_gen <span class=skolem>M'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_mult_sm<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span> unitary11_gen_div_sm<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> MM<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>M</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>M</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A'</span></span> <span class=skolem><span class=skolem>B'</span></span> <span class=skolem><span class=skolem>C'</span></span> <span class=skolem><span class=skolem>D'</span></span> <span class=keyword2><span class=keyword>where</span></span> MM'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A'</span><span class=main>,</span> <span class=skolem>B'</span><span class=main>,</span> <span class=skolem>C'</span><span class=main>,</span> <span class=skolem>D'</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>M'</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>M'</span></span><span class=main>)</span> <span class=operator>auto</span>

  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_cmat <span class=skolem>M</span> <span class=main>=</span> unit_disc_fix_cmat <span class=skolem>M'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * ** MM MM'
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Transformations that fix the unit disc also fix the unit circle.›</span></span>
<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_unit_circle_fix><span class=command>lemma</span></span> unit_disc_fix_unit_circle_fix <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Transformations that preserve the unit disc preserve the orientation of the unit circle.›</span></span>
<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_iff_ounit_circle><span class=command>lemma</span></span> unit_disc_fix_iff_ounit_circle<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span> <span class=main>⟷</span> 
         moebius_ocircline <span class=free>M</span> ounit_circle <span class=main>=</span> ounit_circle"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?rhs</span> <span class=main>⟷</span> <span class=var>?lhs</span>"</span></span><span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=free>M</span> unit_circle <span class=main>=</span> unit_circle"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> moebius_circline_ocircline<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free>M</span></span></span></span> <span class=quoted><span class=quoted>unit_circle</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> of_circline_unit_circle<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=free>M</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unit_circle_fix_iff<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>using</span></span> *
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?H</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> MM<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>M</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>M</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> unit_circle_cmat<span class=main>)</span> unit_circle_cmat"</span></span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?H</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> congruence <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=var>?H</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"congruence <span class=skolem>M</span> <span class=var>?H</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?H</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> congruence_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_inv <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?H</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>/</span>cor <span class=skolem>k</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=var>?H</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> mult_sm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cor <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"congruence <span class=main>(</span>mat_inv <span class=skolem>M</span><span class=main>)</span> <span class=var>?H</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?H</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> mult_sm_inv_l<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span>cor <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"congruence <span class=skolem>M</span> <span class=var>?H</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> congruence_scale_m<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span>cor <span class=skolem>k</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?H</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>⋀</span><span class=bound>B</span><span class=main>.</span> <span class=main>⟦</span><span class=main>1</span> <span class=main>/</span> cor <span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span><span class=main>;</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> cor <span class=skolem>k</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> congruence <span class=skolem>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=bound>B</span><span class=main>⟧</span> <span class=main>⟹</span> congruence <span class=skolem>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>/</span> cor <span class=skolem>k</span><span class=main>)</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=bound>B</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_det_inv<span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>=</span> <span class=skolem>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> unitary11_sgn_det_orientation'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span> <span class=quoted><span class=skolem>k</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹sgn <span class=main>(</span>Re <span class=main>(</span>mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> sgn_0 zero_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_cmat <span class=skolem>M</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> unitary11_sgn_det<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k'</span></span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>b</span></span> <span class=quoted><span class=skolem>M</span></span> <span class=quoted><span class=skolem>A</span></span> <span class=quoted><span class=skolem>B</span></span> <span class=quoted><span class=skolem>C</span></span> <span class=quoted><span class=skolem>D</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> MM<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹unitary11_gen <span class=skolem>M</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_1_pos <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>

    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> MM<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>M</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>M</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_cmat <span class=skolem>M</span>"</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"unitary11_gen <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=main>1</span> <span class=main>&lt;</span> Re <span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> <span class=skolem>D</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>B</span> <span class=main>*</span> <span class=skolem>C</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> MM<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span><span class=keyword1>if</span> <span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span> <span class=main>1</span> <span class=keyword1>else</span> sgn <span class=main>(</span>Re <span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> <span class=skolem>D</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>B</span> <span class=main>*</span> <span class=skolem>C</span><span class=main>)</span><span class=main>)</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=main>1</span> <span class=main>&lt;</span> Re <span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> <span class=skolem>D</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>B</span> <span class=main>*</span> <span class=skolem>C</span><span class=main>)</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"congruence <span class=skolem>M</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span> <span class=main>=</span> cor <span class=skolem>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> unitary11_orientation<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹unitary11_gen <span class=skolem>M</span>›</span></span> MM<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sgn_1_pos<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=main>(</span>moebius_circline_cmat_cmat <span class=skolem>M</span> unit_circle_cmat<span class=main>)</span> unit_circle_cmat"</span></span>
      <span class=keyword1><span class=command>using</span></span> congruence_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"cor <span class=skolem>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> congruence_scale_m<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mat_inv <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"cor <span class=skolem>k'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span><span class=main>1</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Our algebraic characterisation (by matrices) is geometrically correct.›</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_iff><span class=command>lemma</span></span> unit_disc_fix_iff <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=main>`</span> unit_disc <span class=main>=</span> unit_disc"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> unit_disc_fix_iff_ounit_circle<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> disc_moebius_ocircline<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_discI><span class=command>lemma</span></span> unit_disc_fix_discI <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M</span> <span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword1><span class=command>using</span></span> unit_disc_fix_iff assms
  <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Unit disc preserving transformations form a group.›</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_id_moebius><span class=command>lemma</span></span> unit_disc_fix_id_moebius <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix id_moebius"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary11_gen_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_moebius_add><span class=command>lemma</span></span> unit_disc_fix_moebius_add <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=main>(</span><span class=free>M1</span> <span class=main>+</span> <span class=free>M2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_fix_iff_ounit_circle
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_moebius_comp><span class=command>lemma</span></span> unit_disc_fix_moebius_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=main>(</span>moebius_comp <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> unit_disc_fix_moebius_add<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_moebius_uminus><span class=command>lemma</span></span> unit_disc_fix_moebius_uminus <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=main>(</span><span class=main>-</span><span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_fix_iff_ounit_circle
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> moebius_ocircline_comp_inv_left uminus_moebius_def<span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_moebius_inv><span class=command>lemma</span></span> unit_disc_fix_moebius_inv <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=main>(</span>moebius_inv <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> unit_disc_fix_moebius_uminus<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Rotations are unit disc preserving transformations›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_rotation><span class=command>lemma</span></span> unit_disc_fix_rotation <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=main>(</span>moebius_rotation <span class=free>φ</span><span class=main>)</span>"</span></span>      
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def moebius_similarity_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary11_gen_def mat_adj_def mat_cnj_def cis_mult<span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-moebius_rotation_unit_circle_fix><span class=command>lemma</span></span> moebius_rotation_unit_circle_fix <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=free>φ</span><span class=main>)</span> <span class=free>u</span> <span class=main>∈</span> unit_circle_set <span class=main>⟷</span> <span class=free>u</span> <span class=main>∈</span> unit_circle_set"</span></span>
  <span class=keyword1><span class=command>using</span></span> moebius_pt_moebius_inv_in_set unit_circle_fix_iff_unit_circle_set
  <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-ex_rotation_mapping_u_to_positive_x_axis><span class=command>lemma</span></span> ex_rotation_mapping_u_to_positive_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>φ</span><span class=main>.</span> moebius_pt <span class=main>(</span>moebius_rotation <span class=bound>φ</span><span class=main>)</span> <span class=free>u</span> <span class=main>∈</span> positive_x_axis"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>=</span> of_complex <span class=skolem>c</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>cis <span class=main>(</span><span class=main>-</span> arg <span class=skolem>c</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>cis <span class=main>(</span><span class=main>-</span>arg <span class=skolem>c</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted>"*"</span> assms is_real_rot_to_x_axis positive_rot_to_x_axis of_complex_zero_iff
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span>arg <span class=skolem>c</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> positive_x_axis_def circline_set_x_axis<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-ex_rotation_mapping_u_to_positive_y_axis><span class=command>lemma</span></span> ex_rotation_mapping_u_to_positive_y_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>φ</span><span class=main>.</span> moebius_pt <span class=main>(</span>moebius_rotation <span class=bound>φ</span><span class=main>)</span> <span class=free>u</span> <span class=main>∈</span> positive_y_axis"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>=</span> of_complex <span class=skolem>c</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_imag <span class=main>(</span>cis <span class=main>(</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=main>-</span> arg <span class=skolem>c</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"Im <span class=main>(</span>cis <span class=main>(</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=main>-</span> arg <span class=skolem>c</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>c</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted>"*"</span> assms is_real_rot_to_x_axis positive_rot_to_x_axis of_complex_zero_iff
    <span class=keyword1><span class=command>by</span></span> <span class=operator>-</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"pi<span class=main>/</span><span class=numeral>2</span><span class=main>-</span>arg <span class=skolem>c</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> positive_y_axis_def circline_set_y_axis<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-wlog_rotation_to_positive_x_axis><span class=command>lemma</span></span> wlog_rotation_to_positive_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> in_disc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=keyword2><span class=keyword>and</span></span> not_zero<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> preserving<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>φ</span> <span class=bound>u</span><span class=main>.</span> <span class=main>⟦</span><span class=bound>u</span> <span class=main>∈</span> unit_disc<span class=main>;</span> <span class=bound>u</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_rotation <span class=bound>φ</span><span class=main>)</span> <span class=bound>u</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>u</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> x_axis<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>⟦</span>is_real <span class=bound>x</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> Re <span class=bound>x</span><span class=main>;</span> Re <span class=bound>x</span> <span class=main>&lt;</span> <span class=main>1</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>of_complex <span class=bound>x</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>u</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> in_disc <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>φ</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span>
    <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=skolem>φ</span><span class=main>)</span> <span class=free>u</span> <span class=main>∈</span> positive_x_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_rotation_mapping_u_to_positive_x_axis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>u</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> inf_notin_unit_disc not_zero
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Mu</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=skolem>φ</span><span class=main>)</span> <span class=free>u</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=var>?Mu</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?x</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"to_complex <span class=var>?Mu</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?Mu</span> <span class=main>∈</span> unit_disc"</span></span> <span class=quoted><span class=quoted>"<span class=var>?Mu</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?Mu</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>u</span> <span class=main>∈</span> unit_disc›</span></span> <span class=quoted><span class=quoted>‹<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=var>?Mu</span><span class=main>)</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> Re <span class=var>?x</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=var>?x</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>unfolding</span></span> positive_x_axis_def circline_set_x_axis
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_eq_Re<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> x_axis<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?x</span></span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=var>?Mu</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> preserving<span class=main>[</span><span class=operator>OF</span> in_disc<span class=main>]</span> not_zero
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Unit_Circle_Preserving_Moebius-wlog_rotation_to_positive_x_axis'"><span class=command>lemma</span></span> wlog_rotation_to_positive_x_axis'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> not_zero<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> not_inf<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> preserving<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>φ</span> <span class=bound>u</span><span class=main>.</span> <span class=main>⟦</span><span class=bound>u</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span><span class=main>;</span> <span class=bound>u</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_rotation <span class=bound>φ</span><span class=main>)</span> <span class=bound>u</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>u</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> x_axis<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>⟦</span>is_real <span class=bound>x</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> Re <span class=bound>x</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>of_complex <span class=bound>x</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>u</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> not_zero <span class=keyword2><span class=keyword>and</span></span> not_inf <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>φ</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span>
    <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=skolem>φ</span><span class=main>)</span> <span class=free>u</span> <span class=main>∈</span> positive_x_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_rotation_mapping_u_to_positive_x_axis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>u</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> inf_notin_unit_disc
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Mu</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=skolem>φ</span><span class=main>)</span> <span class=free>u</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=var>?Mu</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?x</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"to_complex <span class=var>?Mu</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?Mu</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?Mu</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=var>?Mu</span><span class=main>)</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> Re <span class=var>?x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>unfolding</span></span> positive_x_axis_def circline_set_x_axis
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_eq_Re<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> x_axis<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?x</span></span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=var>?Mu</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> preserving<span class=main>[</span><span class=operator>OF</span> not_zero not_inf<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-wlog_rotation_to_positive_y_axis><span class=command>lemma</span></span> wlog_rotation_to_positive_y_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> in_disc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=keyword2><span class=keyword>and</span></span> not_zero<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> preserving<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>φ</span> <span class=bound>u</span><span class=main>.</span> <span class=main>⟦</span><span class=bound>u</span> <span class=main>∈</span> unit_disc<span class=main>;</span> <span class=bound>u</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span>moebius_pt <span class=main>(</span>moebius_rotation <span class=bound>φ</span><span class=main>)</span> <span class=bound>u</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>u</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> y_axis<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>x</span><span class=main>.</span> <span class=main>⟦</span>is_imag <span class=bound>x</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> Im <span class=bound>x</span><span class=main>;</span> Im <span class=bound>x</span> <span class=main>&lt;</span> <span class=main>1</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>of_complex <span class=bound>x</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>u</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> in_disc <span class=keyword2><span class=keyword>and</span></span> not_zero <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>φ</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span>
    <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=skolem>φ</span><span class=main>)</span> <span class=free>u</span> <span class=main>∈</span> positive_y_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_rotation_mapping_u_to_positive_y_axis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>u</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> inf_notin_unit_disc
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Mu</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>moebius_rotation <span class=skolem>φ</span><span class=main>)</span> <span class=free>u</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=var>?Mu</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?y</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"to_complex <span class=var>?Mu</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?Mu</span> <span class=main>∈</span> unit_disc"</span></span> <span class=quoted><span class=quoted>"<span class=var>?Mu</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?Mu</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>u</span> <span class=main>∈</span> unit_disc›</span></span> <span class=quoted><span class=quoted>‹<span class=free>u</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_imag <span class=main>(</span>to_complex <span class=var>?Mu</span><span class=main>)</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> Im <span class=var>?y</span>"</span></span> <span class=quoted><span class=quoted>"Im <span class=var>?y</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>unfolding</span></span> positive_y_axis_def circline_set_y_axis
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_eq_Im<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> y_axis<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?y</span></span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=var>?Mu</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> preserving<span class=main>[</span><span class=operator>OF</span> in_disc not_zero<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Blaschke factors are unit disc preserving transformations›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹For a given point $a$, Blaschke factor transformations are of the form $k \cdot
\left(\begin{array}{cc}1 &amp; -a\\ -\overline{a} &amp; 1\end{array}\right)$. It is a disc preserving
Möbius transformation that maps the point $a$ to zero (by the symmetry principle, it must map the
inverse point of $a$ to infinity).›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>blaschke_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>blaschke_cmat</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> cmod <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≠</span> <span class=main>1</span> <span class=keyword1>then</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>-</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>-</span>cnj <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>else</span> eye<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> blaschke_mmat <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> moebius_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>blaschke_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lift_definition</span></span> blaschke <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> moebius"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>blaschke_mmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-blaschke_0_id><span class=command>lemma</span></span> blaschke_0_id <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"blaschke <span class=main>0</span> <span class=main>=</span> id_moebius"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-blaschke_a_to_zero><span class=command>lemma</span></span> blaschke_a_to_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> <span class=main>(</span>of_complex <span class=free>a</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-blaschke_inv_a_inf><span class=command>lemma</span></span> blaschke_inv_a_inf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> <span class=main>(</span>inversion <span class=main>(</span>of_complex <span class=free>a</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> inversion_def
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=improper>a</span><span class=main>*</span>cnj <span class=improper>a</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-blaschke_inf><span class=command>lemma</span></span> blaschke_inf <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> of_complex <span class=main>(</span><span class=main>-</span> <span class=main>1</span> <span class=main>/</span> cnj <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mod_sqrt_Re_mult_cnj<span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-blaschke_0_minus_a><span class=command>lemma</span></span> blaschke_0_minus_a <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>~<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
                                                
<span class=keyword1 id=Unit_Circle_Preserving_Moebius-blaschke_unit_circle_fix><span class=command>lemma</span></span> blaschke_unit_circle_fix <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_circle_fix <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary11_gen_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-blaschke_unit_disc_fix><span class=command>lemma</span></span> blaschke_unit_disc_fix <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"cmod <span class=skolem>a</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_cmat <span class=main>(</span>blaschke_cmat <span class=skolem>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary11_gen_def mat_adj_def mat_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex_mod_sqrt_Re_mult_cnj real_sqrt_lt_1_iff<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>/</span> Re <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> False
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> complex_div_gt_0 less_divide_eq_1_pos one_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> right_inverse_eq<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>1</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_is_Real_iff<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unitary11_gen_def mat_adj_def mat_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Unit_Circle_Preserving_Moebius-blaschke_unit_circle_fix'"><span class=command>lemma</span></span> blaschke_unit_circle_fix'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> unit_circle <span class=main>=</span> unit_circle"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> blaschke_unit_circle_fix unit_circle_fix_iff
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id="Unit_Circle_Preserving_Moebius-blaschke_ounit_circle_fix'"><span class=command>lemma</span></span> blaschke_ounit_circle_fix'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_ocircline <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> ounit_circle <span class=main>=</span> ounit_circle"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>a</span> <span class=main>*</span> cnj <span class=free>a</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex_mod_sqrt_Re_mult_cnj real_sqrt_lt_1_iff<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> blaschke_unit_disc_fix unit_disc_fix_iff_ounit_circle
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-moebius_pt_blaschke><span class=command>lemma</span></span> moebius_pt_blaschke <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>≠</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=main>1</span> <span class=main>/</span> cnj <span class=free>a</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> <span class=main>(</span>of_complex <span class=free>z</span><span class=main>)</span> <span class=main>=</span> of_complex <span class=main>(</span><span class=main>(</span><span class=free>z</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> cnj <span class=free>a</span> <span class=main>*</span> <span class=free>z</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mod_sqrt_Re_mult_cnj<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> cnj <span class=improper>a</span> <span class=main>*</span> <span class=improper>z</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Blaschke factors for a real point $a$›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹If the point $a$ is real, the Blaschke factor preserve x-axis and the upper and the lower
halfplane.›</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-blaschke_real_preserve_x_axis><span class=command>lemma</span></span> blaschke_real_preserve_x_axis <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> <span class=free>z</span> <span class=main>∈</span> circline_set x_axis <span class=main>⟷</span> <span class=free>z</span> <span class=main>∈</span> circline_set x_axis"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>linarith</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?a</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"of_complex <span class=free>a</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?i</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"inversion <span class=var>?a</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=var>?a</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=var>?i</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?M</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> of_complex <span class=main>(</span><span class=main>-</span><span class=free>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cmod <span class=free>a</span> <span class=main>≠</span> <span class=main>1</span>›</span></span> blaschke_a_to_zero<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span> blaschke_inv_a_inf<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span> blaschke_0_minus_a<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?Mx</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> x_axis"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?a</span> <span class=main>∈</span> circline_set x_axis"</span></span> <span class=quoted><span class=quoted>"<span class=var>?i</span> <span class=main>∈</span> circline_set x_axis"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set x_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>a</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=var>?Mx</span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=var>?Mx</span>"</span></span> <span class=quoted><span class=quoted>"of_complex <span class=main>(</span><span class=main>-</span><span class=free>a</span><span class=main>)</span> <span class=main>∈</span> circline_set <span class=var>?Mx</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>-</span>                          
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>force</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> image_iff<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> bexI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>   
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set x_axis"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set x_axis"</span></span> <span class=quoted><span class=quoted>"of_complex <span class=main>(</span><span class=main>-</span><span class=free>a</span><span class=main>)</span> <span class=main>∈</span> circline_set x_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>a</span>›</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"of_complex <span class=main>(</span><span class=main>-</span><span class=free>a</span><span class=main>)</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>≠</span> of_complex <span class=main>(</span><span class=main>-</span><span class=free>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>∃!</span><span class=bound>H</span><span class=main>.</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∈</span> circline_set <span class=bound>H</span> <span class=main>∧</span> of_complex <span class=main>(</span><span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=main>∈</span> circline_set <span class=bound>H</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unique_circline_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"of_complex <span class=main>(</span><span class=main>-</span><span class=free>a</span><span class=main>)</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"moebius_circline <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> x_axis <span class=main>=</span> x_axis"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> circline_set_moebius_circline_iff<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-blaschke_real_preserve_sgn_Im><span class=command>lemma</span></span> blaschke_real_preserve_sgn_Im <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> inversion <span class=main>(</span>of_complex <span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>Im <span class=main>(</span>to_complex <span class=main>(</span>moebius_pt <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> <span class=free>z</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>Im <span class=main>(</span>to_complex <span class=free>z</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z'</span></span> <span class=keyword2><span class=keyword>where</span></span> z'<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z'</span> <span class=main>≠</span> <span class=main>1</span> <span class=main>/</span> cnj <span class=free>a</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms z' <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> of_complex_inj<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>*</span> cnj <span class=free>a</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cmod <span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mod_sqrt_Re_mult_cnj<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>Im <span class=main>(</span><span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>Im <span class=skolem>z'</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>a</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z'</span> <span class=main>≠</span> <span class=main>1</span> <span class=main>/</span> cnj <span class=free>a</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>                             
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>a</span>›</span></span> <span class=quoted><span class=quoted>‹cmod <span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> Re_power2 minus_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> norm_complex_def one_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> power2_less_0 real_sqrt_lt_1_iff<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Im <span class=main>(</span><span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Re <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> Im <span class=skolem>z'</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>cmod <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span><span class=main>*</span><span class=skolem>z'</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> cnj <span class=skolem>z'</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z'</span> <span class=main>≠</span> <span class=main>1</span> <span class=main>/</span> cnj <span class=free>a</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> Im_complex_div_eq_0  complex_cnj_zero_iff diff_eq_diff_eq diff_numeral_special<span class=main><span class=main>(</span></span>9<span class=main><span class=main>)</span></span> eq_divide_imp is_real_div mult_not_zero one_complex.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> zero_neq_one<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Im <span class=main>(</span><span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> Im <span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=free>a</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> cnj <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> <span class=skolem>z'</span><span class=main>)</span> <span class=main>*</span> cnj <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>a</span>›</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> Im <span class=main>(</span><span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=free>a</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>*</span> cnj <span class=skolem>z'</span> <span class=main>+</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> cnj <span class=skolem>z'</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>cmod <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span><span class=main>*</span><span class=skolem>z'</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> complex_mult_cnj_cmod
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>finally</span></span> <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>a</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span> 
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=main>(</span>Re <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> Im <span class=skolem>z'</span> <span class=main>/</span> <span class=main>(</span>cmod <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span> <span class=main>*</span> <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>⟹</span> Im <span class=skolem>z'</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>a</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&lt;</span> Re <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>›</span></span> 
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> Re_power_real divide_le_0_iff minus_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> not_sum_power2_lt_zero one_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> zero_less_mult_pos<span class=main>)</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>unfolding</span></span> sgn_real_def
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cmod <span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>≠</span> <span class=main>1</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>a</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cmod_eq_Re<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms z' moebius_pt_blaschke<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=skolem>z'</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹is_real <span class=free>a</span>›</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>                  
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-blaschke_real_preserve_sgn_arg><span class=command>lemma</span></span> blaschke_real_preserve_sgn_arg <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>a</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∉</span> circline_set x_axis"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sgn <span class=main>(</span>arg <span class=main>(</span>to_complex <span class=main>(</span>moebius_pt <span class=main>(</span>blaschke <span class=free>a</span><span class=main>)</span> <span class=free>z</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> sgn <span class=main>(</span>arg <span class=main>(</span>to_complex <span class=free>z</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> special_points_on_x_axis''<span class=main>(</span>3<span class=main>)</span> <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> inversion <span class=main>(</span>of_complex <span class=free>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> calculation circline_equation_x_axis circline_set_x_axis_I conjugate_of_complex inversion_of_complex inversion_sym is_real_inversion o_apply of_complex_zero reciprocal_zero to_complex_of_complex<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> blaschke_real_preserve_sgn_Im<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> assms<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> arg_Im_sgn assms<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> circline_set_x_axis_I norm_sgn of_complex_to_complex<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Inverse Blaschke transform›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>inv_blaschke_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>inv_blaschke_cmat</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>if</span> cmod <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=main>≠</span> <span class=main>1</span> <span class=keyword1>then</span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> cnj <span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>else</span> eye<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> inv_blaschke_mmat <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> moebius_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>inv_blaschke_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>lift_definition</span></span> inv_blaschke <span class=main>::</span> <span class=quoted><span class=quoted>"complex <span class=main>⇒</span> moebius"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>inv_blaschke_mmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-inv_blaschke_neg><span class=command>lemma</span></span> inv_blaschke_neg <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"inv_blaschke <span class=free>a</span> <span class=main>=</span> blaschke <span class=main>(</span><span class=main>-</span><span class=free>a</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-inv_blaschke><span class=command>lemma</span></span> inv_blaschke<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"cmod <span class=free>a</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"blaschke <span class=free>a</span> <span class=main>+</span> inv_blaschke <span class=free>a</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=improper>a</span><span class=main>*</span>cnj <span class=improper>a</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-ex_unit_disc_fix_mapping_u_to_zero><span class=command>lemma</span></span> ex_unit_disc_fix_mapping_u_to_zero<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> moebius_pt <span class=bound>M</span> <span class=free>u</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>=</span> of_complex <span class=skolem>c</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inf_notin_unit_disc inf_or_of_complex<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cmod <span class=skolem>c</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms unit_disc_iff_cmod_lt_1
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"blaschke <span class=skolem>c</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
       <span class=main>(</span><span class=operator>smt</span> blaschke_a_to_zero blaschke_ounit_circle_fix' unit_disc_fix_iff_ounit_circle<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-wlog_zero><span class=command>lemma</span></span> wlog_zero<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> in_disc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> preserving<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>a</span> <span class=bound>u</span><span class=main>.</span> <span class=main>⟦</span><span class=bound>u</span> <span class=main>∈</span> unit_disc<span class=main>;</span> cmod <span class=bound>a</span> <span class=main>&lt;</span> <span class=main>1</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span>moebius_pt <span class=main>(</span>blaschke <span class=bound>a</span><span class=main>)</span> <span class=bound>u</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>u</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> zero<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>u</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>blaschke <span class=main>(</span>to_complex <span class=free>u</span><span class=main>)</span><span class=main>)</span> <span class=free>u</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> blaschke_a_to_zero in_disc inf_notin_unit_disc of_complex_to_complex unit_disc_iff_cmod_lt_1<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> preserving<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>u</span></span> <span class=quoted><span class=quoted>"to_complex <span class=free>u</span>"</span></span><span class=main>]</span> in_disc zero
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>u</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-wlog_real_zero><span class=command>lemma</span></span> wlog_real_zero<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> in_disc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=keyword2><span class=keyword>and</span></span> real<span class=main>:</span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span>to_complex <span class=free>u</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> preserving<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>a</span> <span class=bound>u</span><span class=main>.</span> <span class=main>⟦</span><span class=bound>u</span> <span class=main>∈</span> unit_disc<span class=main>;</span> is_real <span class=bound>a</span><span class=main>;</span> cmod <span class=bound>a</span> <span class=main>&lt;</span> <span class=main>1</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span>moebius_pt <span class=main>(</span>blaschke <span class=bound>a</span><span class=main>)</span> <span class=bound>u</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>u</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> zero<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>u</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=main>(</span>blaschke <span class=main>(</span>to_complex <span class=free>u</span><span class=main>)</span><span class=main>)</span> <span class=free>u</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> blaschke_a_to_zero in_disc inf_notin_unit_disc of_complex_to_complex unit_disc_iff_cmod_lt_1<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> preserving<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>u</span></span> <span class=quoted><span class=quoted>"to_complex <span class=free>u</span>"</span></span><span class=main>]</span> in_disc zero real
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>u</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_transitive><span class=command>lemma</span></span> unit_disc_fix_transitive<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> in_disc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u'</span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> moebius_pt <span class=bound>M</span> <span class=free>u</span> <span class=main>=</span> <span class=free>u'</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span> <span class=bound>u</span> <span class=main>∈</span> unit_disc<span class=main>.</span> <span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> moebius_pt <span class=bound>M</span> <span class=bound>u</span> <span class=main>=</span> <span class=free>u'</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=free>u'</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> wlog_zero<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>u'</span> <span class=main>∈</span> unit_disc"</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>fact</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> ex_unit_disc_fix_mapping_u_to_zero<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>u</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"cmod <span class=skolem>a</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=main>(</span>moebius_pt <span class=main>(</span>blaschke <span class=skolem>a</span><span class=main>)</span> <span class=skolem>u</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?P</span> <span class=skolem>u</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>u'</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u'</span> <span class=main>∈</span> unit_disc"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M'</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M'</span> <span class=skolem>u'</span> <span class=main>=</span> moebius_pt <span class=main>(</span>blaschke <span class=skolem>a</span><span class=main>)</span> <span class=skolem>u</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> *
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> moebius_pt <span class=bound>M</span> <span class=skolem>u'</span> <span class=main>=</span> <span class=skolem>u</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹cmod <span class=skolem>a</span> <span class=main>&lt;</span> <span class=main>1</span>›</span></span> blaschke_unit_disc_fix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>a</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> unit_disc_fix_moebius_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span> blaschke <span class=skolem>a</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M'</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> unit_disc_fix_moebius_inv<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"blaschke <span class=skolem>a</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> <span class=main>(</span>blaschke <span class=skolem>a</span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=skolem>M'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Decomposition of unit disc preserving Möbius transforms›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Each transformation preserving unit disc can be decomposed to a rotation around the origin and
a Blaschke factors that maps a point within the unit disc to zero.›</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_decompose_blaschke_rotation><span class=command>lemma</span></span> unit_disc_fix_decompose_blaschke_rotation<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span> <span class=bound>φ</span><span class=main>.</span> cmod <span class=bound>k</span> <span class=main>&lt;</span> <span class=main>1</span> <span class=main>∧</span> <span class=free>M</span> <span class=main>=</span> moebius_rotation <span class=bound>φ</span> <span class=main>+</span> blaschke <span class=bound>k</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> moebius_rotation_def moebius_similarity_def
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"mat_det <span class=skolem>M</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_cmat <span class=skolem>M</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=main>::</span> <span class=quoted>complex</span> <span class=keyword2><span class=keyword>where</span></span>
    **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"mat_det <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>=</span> <span class=skolem>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>b</span><span class=main>,</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> unitary11_gen_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * **
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a'</span></span> <span class=skolem><span class=skolem>k'</span></span> <span class=skolem><span class=skolem>φ</span></span>
    <span class=keyword2><span class=keyword>where</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k'</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=skolem>a'</span> <span class=main>*</span> cnj <span class=skolem>a'</span> <span class=main>≠</span> <span class=main>1</span> <span class=main>∧</span> <span class=skolem>M</span> <span class=main>=</span> <span class=skolem>k'</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span>cis <span class=skolem>φ</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>m</sub><span class=hidden>⇩</span><sub>m</sub></span> <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>-</span> <span class=skolem>a'</span><span class=main>,</span> <span class=main>-</span> cnj <span class=skolem>a'</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ** unitary11_gen_cis_blaschke<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>k</span></span> <span class=quoted><span class=skolem>M</span></span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>b</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a'</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∨</span> <span class=main>1</span> <span class=main>&lt;</span> <span class=main>1</span> <span class=main>/</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * *** complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>a'</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cmod <span class=skolem>a'</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> less_divide_eq_1_pos norm_zero one_less_power one_power2 pos2<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>k</span><span class=main>.</span> cmod <span class=bound>k</span> <span class=main>&lt;</span> <span class=main>1</span> <span class=main>∧</span>
            <span class=main>(</span><span class=main>∃</span><span class=bound>φ</span><span class=main>.</span> moebius_cmat_eq <span class=skolem>M</span> <span class=main>(</span>moebius_comp_cmat <span class=main>(</span>mk_moebius_cmat <span class=main>(</span>cis <span class=bound>φ</span><span class=main>)</span> <span class=main>0</span> <span class=main>0</span> <span class=main>1</span><span class=main>)</span> <span class=main>(</span>blaschke_cmat <span class=bound>k</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ***
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=skolem>a'</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=skolem>φ</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=skolem>k'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-wlog_unit_disc_fix><span class=command>lemma</span></span> wlog_unit_disc_fix<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> b<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>k</span><span class=main>.</span> cmod <span class=bound>k</span> <span class=main>&lt;</span> <span class=main>1</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span>blaschke <span class=bound>k</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> r<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>φ</span><span class=main>.</span> <span class=free>P</span> <span class=main>(</span>moebius_rotation <span class=bound>φ</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> comp<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>M1</span> <span class=bound>M2</span><span class=main>.</span> <span class=main>⟦</span>unit_disc_fix <span class=bound>M1</span><span class=main>;</span> <span class=free>P</span> <span class=bound>M1</span><span class=main>;</span> unit_disc_fix <span class=bound>M2</span><span class=main>;</span> <span class=free>P</span> <span class=bound>M2</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=main>(</span><span class=bound>M1</span> <span class=main>+</span> <span class=bound>M2</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>M</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> unit_disc_fix_decompose_blaschke_rotation<span class=main>[</span><span class=operator>OF</span> assms<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> blaschke_unit_disc_fix
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-ex_unit_disc_fix_to_zero_positive_x_axis><span class=command>lemma</span></span> ex_unit_disc_fix_to_zero_positive_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> unit_disc"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span>
              moebius_pt <span class=bound>M</span> <span class=free>u</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>∧</span> moebius_pt <span class=bound>M</span> <span class=free>v</span> <span class=main>∈</span> positive_x_axis"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=keyword2><span class=keyword>where</span></span>
    *<span class=main>:</span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>B</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>B</span> <span class=free>u</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_unit_disc_fix_mapping_u_to_zero
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?v</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>B</span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>∈</span> unit_disc"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>v</span> <span class=main>∈</span> unit_disc›</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inf_notin_unit_disc <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?v</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>›</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> moebius_pt_invert<span class=main>)</span>

  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>R</span></span> <span class=keyword2><span class=keyword>where</span></span>
    <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>R</span>"</span></span>
    <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>R</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>R</span> <span class=var>?v</span> <span class=main>∈</span> positive_x_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_rotation_mapping_u_to_positive_x_axis<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?v</span></span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=var>?v</span> <span class=main>≠</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=var>?v</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_pt_rotation_inf_iff moebius_pt_moebius_rotation_zero unit_disc_fix_rotation
    <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> * moebius_comp<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>R</span></span> <span class=quoted><span class=skolem>B</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> unit_disc_fix_moebius_comp
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>R</span> <span class=main>+</span> <span class=skolem>B</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> comp_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-wlog_x_axis><span class=command>lemma</span></span> wlog_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> in_disc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> unit_disc"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> preserved<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>M</span> <span class=bound>u</span> <span class=bound>v</span><span class=main>.</span> <span class=main>⟦</span>unit_disc_fix <span class=bound>M</span><span class=main>;</span> <span class=bound>u</span> <span class=main>∈</span> unit_disc<span class=main>;</span> <span class=bound>v</span> <span class=main>∈</span> unit_disc<span class=main>;</span> <span class=free>P</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=bound>u</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=bound>v</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>u</span> <span class=bound>v</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> axis<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>x</span><span class=main>.</span> <span class=main>⟦</span>is_real <span class=bound>x</span><span class=main>;</span> <span class=main>0</span> <span class=main>≤</span> Re <span class=bound>x</span><span class=main>;</span>  Re <span class=bound>x</span> <span class=main>&lt;</span> <span class=main>1</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=bound>x</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>u</span> <span class=free>v</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>=</span> <span class=free>v</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>u</span> <span class=free>u</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?Q</span> <span class=free>u</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> wlog_zero<span class=main><span class=main>[</span></span><span class=keyword2><span class=keyword><span class=operator>where</span></span></span> P<span class=main><span class=main><span class=main>=</span></span></span><span class=quoted><span class=quoted><span class=quoted>"<span class=var><span class=var>?Q</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fact</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=var>?Q</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> axis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>u</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=quoted><span class=quoted>"cmod <span class=skolem>a</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?Q</span> <span class=main>(</span>moebius_pt <span class=main>(</span>blaschke <span class=skolem>a</span><span class=main>)</span> <span class=skolem>u</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?Q</span> <span class=skolem>u</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> preserved<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"blaschke <span class=skolem>a</span>"</span></span> <span class=quoted><span class=skolem>u</span></span> <span class=quoted><span class=skolem>u</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> blaschke_unit_disc_fix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>a</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> True
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>from</span></span> in_disc <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>M</span></span> <span class=keyword2><span class=keyword>where</span></span>
    *<span class=main>:</span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>u</span> <span class=main>=</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>v</span> <span class=main>∈</span> positive_x_axis"</span></span>
    <span class=keyword1><span class=command>using</span></span> ex_unit_disc_fix_to_zero_positive_x_axis False
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=keyword2><span class=keyword>where</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"moebius_pt <span class=skolem>M</span> <span class=free>v</span> <span class=main>=</span> of_complex <span class=skolem>x</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>x</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> positive_x_axis_def circline_set_x_axis
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"of_complex <span class=skolem>x</span> <span class=main>∈</span> unit_disc"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹unit_disc_fix <span class=skolem>M</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>v</span> <span class=main>∈</span> unit_disc›</span></span> **
    <span class=keyword1><span class=command>using</span></span> unit_disc_fix_discI
    <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>&lt;</span> Re <span class=skolem>x</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>x</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹moebius_pt <span class=skolem>M</span> <span class=free>v</span> <span class=main>∈</span> positive_x_axis›</span></span> **
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> positive_x_axis_def cmod_eq_Re<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=skolem>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>x</span>›</span></span> axis
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> preserved<span class=main>[</span><span class=operator>OF</span> *<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> assms<span class=main><span class=main>(</span></span>1-2<span class=main><span class=main>)</span></span><span class=main>]</span> *<span class=main>(</span>2<span class=main>)</span> **<span class=main>(</span>1<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-wlog_positive_x_axis><span class=command>lemma</span></span> wlog_positive_x_axis<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> in_disc<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> unit_disc"</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> preserved<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>M</span> <span class=bound>u</span> <span class=bound>v</span><span class=main>.</span> <span class=main>⟦</span>unit_disc_fix <span class=bound>M</span><span class=main>;</span> <span class=bound>u</span> <span class=main>∈</span> unit_disc<span class=main>;</span> <span class=bound>v</span> <span class=main>∈</span> unit_disc<span class=main>;</span> <span class=bound>u</span> <span class=main>≠</span> <span class=bound>v</span><span class=main>;</span> <span class=free>P</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=bound>u</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=bound>M</span> <span class=bound>v</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=bound>u</span> <span class=bound>v</span>"</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> axis<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>x</span><span class=main>.</span> <span class=main>⟦</span>is_real <span class=bound>x</span><span class=main>;</span> <span class=main>0</span> <span class=main>&lt;</span> Re <span class=bound>x</span><span class=main>;</span>  Re <span class=bound>x</span> <span class=main>&lt;</span> <span class=main>1</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=free>P</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=bound>x</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>P</span> <span class=free>u</span> <span class=free>v</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span> <span class=main>⟶</span> <span class=free>P</span> <span class=free>u</span> <span class=free>v</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?Q</span> <span class=free>u</span> <span class=free>v</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> wlog_x_axis<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=free>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=quoted><span class=quoted>"<span class=free>v</span> <span class=main>∈</span> unit_disc"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fact</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>u</span> <span class=skolem>v</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>u</span> <span class=main>∈</span> unit_disc"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>∈</span> unit_disc"</span></span>
           <span class=quoted><span class=quoted>"<span class=var>?Q</span> <span class=main>(</span>moebius_pt <span class=skolem>M</span> <span class=skolem>u</span><span class=main>)</span> <span class=main>(</span>moebius_pt <span class=skolem>M</span> <span class=skolem>v</span><span class=main>)</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?Q</span> <span class=skolem>u</span> <span class=skolem>v</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> preserved<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>M</span></span> <span class=quoted><span class=skolem>u</span></span> <span class=quoted><span class=skolem>v</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> moebius_pt_invert
      <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>x</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> Re <span class=skolem>x</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>x</span> <span class=main>&lt;</span> <span class=main>1</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=var>?Q</span> <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=skolem>x</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> axis<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span> of_complex_zero_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span> complex.expand<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=main>0</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>u</span> <span class=main>≠</span> <span class=free>v</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹All functions that fix the unit disc›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹It can be proved that continuous functions that fix the unit disc are either actions of
Möbius transformations that fix the unit disc (homographies), or are compositions of actions of
Möbius transformations that fix the unit disc and the conjugation (antihomographies). We postulate
this as a definition, but it this characterisation could also be formally shown (we do not need this
for our further applications).›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>unit_disc_fix_f</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>unit_disc_fix_f</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>⟷</span> 
   <span class=main>(</span><span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> moebius_pt <span class=bound>M</span> <span class=main>∨</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> moebius_pt <span class=bound>M</span> <span class=main>∘</span> conjugate<span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Unit disc fixing functions really fix unit disc.›</span></span>
<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_f_unit_disc><span class=command>lemma</span></span> unit_disc_fix_f_unit_disc<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>`</span> unit_disc <span class=main>=</span> unit_disc"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_fix_f_def
  <span class=keyword1><span class=command>using</span></span> image_comp
  <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Actions of unit disc fixing Möbius transformations (unit disc fixing homographies) are unit
disc fixing functions.›</span></span>
<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_f_moebius_pt><span class=command>lemma</span></span> unit_disc_fix_f_moebius_pt <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=main>(</span>moebius_pt <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>unfolding</span></span> unit_disc_fix_f_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Compositions of unit disc fixing Möbius transformations and conjugation (unit disc fixing
antihomographies) are unit disc fixing functions.›</span></span>
<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_conjugate_moebius><span class=command>lemma</span></span> unit_disc_fix_conjugate_moebius <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=main>(</span>conjugate_moebius <span class=free>M</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span><span class=bound>a</span> <span class=bound>aa</span> <span class=bound>ab</span> <span class=bound>b</span><span class=main>.</span> <span class=main>⟦</span><span class=main>1</span> <span class=main>&lt;</span> Re <span class=main>(</span><span class=bound>a</span> <span class=main>*</span> <span class=bound>b</span> <span class=main>/</span> <span class=main>(</span><span class=bound>aa</span> <span class=main>*</span> <span class=bound>ab</span><span class=main>)</span><span class=main>)</span><span class=main>;</span> <span class=main>¬</span> <span class=main>1</span> <span class=main>&lt;</span> Re <span class=main>(</span>cnj <span class=bound>a</span> <span class=main>*</span> cnj <span class=bound>b</span> <span class=main>/</span> <span class=main>(</span>cnj <span class=bound>aa</span> <span class=main>*</span> cnj <span class=bound>ab</span><span class=main>)</span><span class=main>)</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>aa</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> cnj.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> complex_cnj_divide complex_cnj_mult<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
       <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_cnj_def unitary11_gen_def mat_adj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_conjugate_comp_moebius><span class=command>lemma</span></span> unit_disc_fix_conjugate_comp_moebius <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=main>(</span>conjugate <span class=main>∘</span> moebius_pt <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> conjugate_moebius<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unit_disc_fix_f_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"conjugate_moebius <span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Uniti disc fixing functions form a group under function composition.›</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_f_comp><span class=command>lemma</span></span> unit_disc_fix_f_comp <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=free>f1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=free>f2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=main>(</span><span class=free>f1</span> <span class=main>∘</span> <span class=free>f2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> unit_disc_fix_f_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> unit_disc_fix_f_def<span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>M'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M'</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=main>(</span>moebius_pt <span class=skolem>M</span> <span class=main>∘</span> moebius_pt <span class=skolem>M'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unit_disc_fix_f_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>+</span> <span class=skolem>M'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>M'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M'</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=main>(</span>moebius_pt <span class=skolem>M</span> <span class=main>∘</span> <span class=main>(</span>moebius_pt <span class=skolem>M'</span> <span class=main>∘</span> conjugate<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unit_disc_fix_f_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> comp_assoc<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
       <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>+</span> <span class=skolem>M'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>M'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M'</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=main>(</span><span class=main>(</span>moebius_pt <span class=skolem>M</span> <span class=main>∘</span> conjugate<span class=main>)</span> <span class=main>∘</span> moebius_pt <span class=skolem>M'</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unit_disc_fix_f_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> comp_assoc<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> conjugate_moebius<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> comp_assoc<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
       <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>+</span> conjugate_moebius <span class=skolem>M'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=skolem>M'</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M</span>"</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M'</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=main>(</span><span class=main>(</span>moebius_pt <span class=skolem>M</span> <span class=main>∘</span> conjugate<span class=main>)</span> <span class=main>∘</span> <span class=main>(</span>moebius_pt <span class=skolem>M'</span> <span class=main>∘</span> conjugate<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> comp_assoc<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> comp_assoc<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> conjugate_moebius<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> comp_assoc<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> comp_assoc<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> unit_disc_fix_f_def<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>+</span> conjugate_moebius <span class=skolem>M'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_f_inv><span class=command>lemma</span></span> unit_disc_fix_f_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=main>(</span>inv <span class=free>M</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> unit_disc_fix_f_def<span class=main>)</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>safe</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inv <span class=main>(</span>moebius_pt <span class=skolem>M</span><span class=main>)</span> <span class=main>=</span> moebius_pt <span class=main>(</span><span class=main>-</span><span class=skolem>M</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> moebius_inv<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=main>(</span>inv <span class=main>(</span>moebius_pt <span class=skolem>M</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹unit_disc_fix <span class=skolem>M</span>›</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unit_disc_fix_f_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=skolem>M</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=skolem>M</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inv <span class=main>(</span>moebius_pt <span class=skolem>M</span> <span class=main>∘</span> conjugate<span class=main>)</span> <span class=main>=</span> conjugate <span class=main>∘</span> inv <span class=main>(</span>moebius_pt <span class=skolem>M</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> o_inv_distrib<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> conjugate <span class=main>∘</span> <span class=main>(</span>moebius_pt <span class=main>(</span><span class=main>-</span><span class=skolem>M</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> moebius_inv
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> moebius_pt <span class=main>(</span>conjugate_moebius <span class=main>(</span><span class=main>-</span><span class=skolem>M</span><span class=main>)</span><span class=main>)</span> <span class=main>∘</span> conjugate"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> conjugate_moebius<span class=main>)</span>
  <span class=keyword1><span class=command>finally</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f <span class=main>(</span>inv <span class=main>(</span>moebius_pt <span class=skolem>M</span> <span class=main>∘</span> conjugate<span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹unit_disc_fix <span class=skolem>M</span>›</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> unit_disc_fix_f_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"conjugate_moebius <span class=main>(</span><span class=main>-</span><span class=skolem>M</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Action of unit disc fixing functions on circlines›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>unit_disc_fix_f_circline</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>unit_disc_fix_f_circline</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span> 
      <span class=main>(</span><span class=keyword1>if</span> <span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> moebius_pt <span class=bound>M</span> <span class=keyword1>then</span>
          moebius_circline <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> moebius_pt <span class=bound>M</span><span class=main>)</span> <span class=free><span class=bound><span class=entity>H</span></span></span>
       <span class=keyword1>else</span> <span class=keyword1>if</span> <span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> moebius_pt <span class=bound>M</span> <span class=main>∘</span> conjugate <span class=keyword1>then</span>
          <span class=main>(</span>moebius_circline <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>=</span> moebius_pt <span class=bound>M</span> <span class=main>∘</span> conjugate<span class=main>)</span> <span class=main>∘</span> conjugate_circline<span class=main>)</span> <span class=free><span class=bound><span class=entity>H</span></span></span>
       <span class=keyword1>else</span>
          <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>)</span>"</span></span>


<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unique_moebius_pt_conjugate><span class=command>lemma</span></span> unique_moebius_pt_conjugate<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M1</span> <span class=main>∘</span> conjugate <span class=main>=</span> moebius_pt <span class=free>M2</span> <span class=main>∘</span> conjugate"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>M1</span> <span class=main>=</span> <span class=free>M2</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>               
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"moebius_pt <span class=free>M1</span> <span class=main>=</span> moebius_pt <span class=free>M2</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> conjugate_conjugate_comp rewriteL_comp_comp2 <span class=keyword1><span class=command>by</span></span> <span class=operator>fastforce</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> unique_moebius_pt
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_f_circline_direct><span class=command>lemma</span></span> unit_disc_fix_f_circline_direct<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> moebius_pt <span class=free>M</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f_circline <span class=free>f</span> <span class=free>H</span> <span class=main>=</span> moebius_circline <span class=free>M</span> <span class=free>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>=</span> moebius_pt <span class=bound>M</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> theI_unique<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>=</span> moebius_pt <span class=bound>M</span>"</span></span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> unique_moebius_pt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> unit_disc_fix_f_circline_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Unit_Circle_Preserving_Moebius-unit_disc_fix_f_circline_indirect><span class=command>lemma</span></span> unit_disc_fix_f_circline_indirect<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"unit_disc_fix <span class=free>M</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>f</span> <span class=main>=</span> moebius_pt <span class=free>M</span> <span class=main>∘</span> conjugate"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"unit_disc_fix_f_circline <span class=free>f</span> <span class=free>H</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span>moebius_circline <span class=free>M</span><span class=main>)</span> <span class=main>∘</span> conjugate_circline<span class=main>)</span> <span class=free>H</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>=</span> moebius_pt <span class=bound>M</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms homography_antihomography_exclusive<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>f</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> is_homography_def is_antihomography_def is_moebius_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>M</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>THE</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>=</span> moebius_pt <span class=bound>M</span> <span class=main>∘</span> conjugate<span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> theI_unique<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>λ</span> <span class=bound>M</span><span class=main>.</span> unit_disc_fix <span class=bound>M</span> <span class=main>∧</span> <span class=free>f</span> <span class=main>=</span> moebius_pt <span class=bound>M</span> <span class=main>∘</span> conjugate"</span></span> <span class=quoted><span class=free>M</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> unique_moebius_pt_conjugate<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M</span></span><span class=main>]</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>unfolding</span></span> unit_disc_fix_f_circline_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Disc automorphisms - it would be nice to show that there are no disc automorphisms other than
unit disc fixing homographies and antihomographies, but this part of the theory is not yet
developed.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>is_disc_aut</span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>is_disc_aut</span> <span class=free><span class=bound><span class=entity>f</span></span></span> <span class=main>⟷</span> bij_betw <span class=free><span class=bound><span class=entity>f</span></span></span> unit_disc unit_disc"</span></span>

<span class=keyword2><span class=keyword>end</span></span></pre>
</div><div id=Riemann_Sphere>
<div class=head>
<h1>Theory Riemann_Sphere</h1>
</div>
<pre class=source><span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>section</span></span> <span class=quoted><span class=plain_text>‹Riemann sphere›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The extended complex plane $\mathbb{C}P^1$ can be identified with a Riemann (unit) sphere
$\Sigma$ by means of stereographic projection. The sphere is projected from its north pole $N$ to
the $xOy$ plane (identified with $\mathbb{C}$). This projection establishes a bijective map $sp$
between $\Sigma \setminus \{N\}$ and the finite complex plane $\mathbb{C}$. The infinite point is
defined as the image of $N$.›</span></span>

<span class=keyword1><span class=command>theory</span></span> Riemann_Sphere
<span class=keyword2><span class=keyword>imports</span></span> <a href=#Homogeneous_Coordinates>Homogeneous_Coordinates</a> <a href=#Circlines>Circlines</a> <span class=quoted>"<a href=https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Analysis/Product_Vector.html>HOL-Analysis.Product_Vector</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Coordinates in $\mathbb{R}^3$›</span></span>
<span class=keyword1><span class=command>type_synonym</span></span> R3 <span class=main>=</span> <span class=quoted><span class=quoted>"real <span class=main>×</span> real <span class=main>×</span> real"</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Type of points of $\Sigma$›</span></span>
<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>unit_sphere</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>unit_sphere</span> <span class=main>≡</span> <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>::</span>real<span class=main>,</span> <span class=bound>y</span><span class=main>::</span>real<span class=main>,</span> <span class=bound>z</span><span class=main>::</span>real<span class=main>)</span><span class=main>.</span> <span class=bound>x</span><span class=main>*</span><span class=bound>x</span> <span class=main>+</span> <span class=bound>y</span><span class=main>*</span><span class=bound>y</span> <span class=main>+</span> <span class=bound>z</span><span class=main>*</span><span class=bound>z</span> <span class=main>=</span> <span class=main>1</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>typedef</span></span> riemann_sphere <span class=main>=</span> <span class=quoted><span class=quoted>"unit_sphere"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>setup_lifting</span></span> type_definition_riemann_sphere

<span class=keyword1 id="Riemann_Sphere-sphere_bounds'"><span class=command>lemma</span></span> sphere_bounds'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>z</span><span class=main>*</span><span class=free>z</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>real<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>∧</span> <span class=free>x</span> <span class=main>≤</span> <span class=main>1</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main>*</span><span class=free>x</span> <span class=main>≤</span> <span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> real_minus_mult_self_le<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≤</span> <span class=main>1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> <span class=free>x</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≤</span> <span class=main>1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>∧</span> <span class=free>x</span> <span class=main>≤</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≥</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≤</span> <span class=main>1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> power2_le_imp_le<span class=main>)</span>      
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>-</span><span class=free>x</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≤</span> <span class=main>1</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> power2_le_imp_le<span class=main>)</span>      
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Riemann_Sphere-sphere_bounds><span class=command>lemma</span></span> sphere_bounds<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>z</span><span class=main>*</span><span class=free>z</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>::</span>real<span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span> <span class=main>≤</span> <span class=free>x</span> <span class=main>∧</span> <span class=free>x</span> <span class=main>≤</span> <span class=main>1</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span> <span class=main>≤</span> <span class=free>y</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>≤</span> <span class=main>1</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>1</span> <span class=main>≤</span> <span class=free>z</span> <span class=main>∧</span> <span class=free>z</span> <span class=main>≤</span> <span class=main>1</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>using</span></span> sphere_bounds'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>y</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> sphere_bounds'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> sphere_bounds'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Parametrization of the unit sphere in polar coordinates›</span></span>
<span class=comment1>(* ---------------------------------------------------------------------------- *)</span>

<span class=keyword1 id=Riemann_Sphere-sphere_params_on_sphere><span class=command>lemma</span></span> sphere_params_on_sphere<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>α</span> <span class=free>β</span> <span class=main>::</span> <span class=quoted>real</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> cos <span class=free>α</span> <span class=main>*</span> cos <span class=free>β</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>=</span> cos <span class=free>α</span> <span class=main>*</span> sin <span class=free>β</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> sin <span class=free>α</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>z</span><span class=main>*</span><span class=free>z</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>*</span><span class=free>y</span> <span class=main>=</span> <span class=main>(</span>cos <span class=free>α</span> <span class=main>*</span> cos <span class=free>α</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>cos <span class=free>β</span> <span class=main>*</span> cos <span class=free>β</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span>cos <span class=free>α</span> <span class=main>*</span> cos <span class=free>α</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>sin <span class=free>β</span> <span class=main>*</span> sin <span class=free>β</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>*</span><span class=free>y</span> <span class=main>=</span> cos <span class=free>α</span> <span class=main>*</span> cos <span class=free>α</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> sin_cos_squared_add3<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>β</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> distrib_left<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>using</span></span> sin_cos_squared_add3<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>α</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Riemann_Sphere-sphere_params><span class=command>lemma</span></span> sphere_params<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=free>z</span> <span class=main>::</span> <span class=quoted>real</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>z</span><span class=main>*</span><span class=free>z</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> cos <span class=main>(</span>arcsin <span class=free>z</span><span class=main>)</span> <span class=main>*</span> cos <span class=main>(</span>atan2 <span class=free>y</span> <span class=free>x</span><span class=main>)</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>=</span> cos <span class=main>(</span>arcsin <span class=free>z</span><span class=main>)</span> <span class=main>*</span> sin <span class=main>(</span>atan2 <span class=free>y</span> <span class=free>x</span><span class=main>)</span> <span class=main>∧</span> <span class=free>z</span> <span class=main>=</span> sin <span class=main>(</span>arcsin <span class=free>z</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span><span class=main>=</span><span class=main>1</span> <span class=main>∨</span> <span class=free>z</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>=</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> <span class=main>1</span> <span class=main>∨</span> <span class=free>z</span> <span class=main>=</span> <span class=main>-</span><span class=main>1</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cos_arcsin<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=free>y</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> square_eq_1_iff<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> real_sqrt_unique<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>y</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>-</span> <span class=free>z</span><span class=main>*</span><span class=free>z</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> real_sqrt_unique<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=free>y</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>-</span> <span class=free>z</span><span class=main>*</span><span class=free>z</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> sphere_bounds<span class=main>[</span><span class=operator>OF</span> assms<span class=main>]</span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cos_arcsin cos_arctan sin_arctan power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span> real_sqrt_divide atan2_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Riemann_Sphere-ex_sphere_params><span class=command>lemma</span></span> ex_sphere_params<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main>*</span><span class=free>x</span> <span class=main>+</span> <span class=free>y</span><span class=main>*</span><span class=free>y</span> <span class=main>+</span> <span class=free>z</span><span class=main>*</span><span class=free>z</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>α</span> <span class=bound>β</span><span class=main>.</span> <span class=free>x</span> <span class=main>=</span> cos <span class=bound>α</span> <span class=main>*</span> cos <span class=bound>β</span> <span class=main>∧</span> <span class=free>y</span> <span class=main>=</span> cos <span class=bound>α</span> <span class=main>*</span> sin <span class=bound>β</span> <span class=main>∧</span> <span class=free>z</span> <span class=main>=</span> sin <span class=bound>α</span> <span class=main>∧</span> <span class=main>-</span>pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>≤</span> <span class=bound>α</span> <span class=main>∧</span> <span class=bound>α</span> <span class=main>≤</span> pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>∧</span> <span class=main>-</span>pi <span class=main>≤</span> <span class=bound>β</span> <span class=main>∧</span> <span class=bound>β</span> <span class=main>&lt;</span> pi"</span></span>
<span class=keyword1><span class=command>using</span></span> assms arcsin_bounded<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> sphere_bounds<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>x</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>y</span></span></span></span></span></span> <span class=quoted><span class=free><span class=quoted><span class=free><span class=quoted><span class=free>z</span></span></span></span></span></span><span class=main>]</span>
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"arcsin <span class=free>z</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"atan2 <span class=free>y</span> <span class=free>x</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> sphere_params arcsin_bounded atan2_bounded<span class=main>)</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Stereographic and inverse stereographic projection›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Stereographic projection›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>stereographic_r3_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"R3 <span class=main>⇒</span> complex_vec"</span></span> <span class=keyword2><span class=keyword>where</span></span>
<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>stereographic_r3_cvec</span> <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>,</span> <span class=bound>z</span><span class=main>)</span> <span class=main>=</span>  <span class=free><span class=bound><span class=entity>M</span></span></span> <span class=keyword1>in</span>
     <span class=main>(</span><span class=keyword1>if</span> <span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>,</span> <span class=bound>z</span><span class=main>)</span> <span class=main>≠</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=keyword1>then</span>
           <span class=main>(</span><span class=bound>x</span> <span class=main>+</span> <span class=keyword1>𝗂</span> <span class=main>*</span> <span class=bound>y</span><span class=main>,</span> cor <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=bound>z</span><span class=main>)</span><span class=main>)</span>
      <span class=keyword1>else</span>
           <span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>0</span><span class=main>)</span>
     <span class=main>)</span><span class=main>)</span>"</span></span>


<span class=keyword1><span class=command>lift_definition</span></span> stereographic_r3_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"R3 <span class=main>⇒</span> complex_homo_coords"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>stereographic_r3_cvec</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cor_eq_0<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> stereographic <span class=main>::</span> <span class=quoted><span class=quoted>"riemann_sphere <span class=main>⇒</span> complex_homo"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>stereographic_r3_hcoords</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Inverse stereographic projection›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>inv_stereographic_cvec_r3</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> R3"</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>inv_stereographic_cvec_r3</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> <span class=main>(</span>
     <span class=keyword1>let</span> <span class=main>(</span><span class=bound>z1</span><span class=main>,</span> <span class=bound>z2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>z</span></span></span>
       <span class=keyword1>in</span> <span class=keyword1>if</span> <span class=bound>z2</span> <span class=main>=</span> <span class=main>0</span> <span class=keyword1>then</span>
              <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>
          <span class=keyword1>else</span>
             <span class=keyword1>let</span> <span class=bound>z</span> <span class=main>=</span> <span class=bound>z1</span><span class=main>/</span><span class=bound>z2</span><span class=main>;</span>
                 <span class=bound>X</span> <span class=main>=</span> Re <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=bound>z</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=bound>z</span><span class=main>*</span>cnj <span class=bound>z</span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
                 <span class=bound>Y</span> <span class=main>=</span> Im <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=bound>z</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=bound>z</span><span class=main>*</span>cnj <span class=bound>z</span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
                 <span class=bound>Z</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span>cmod <span class=bound>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=bound>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>
               <span class=keyword1>in</span> <span class=main>(</span><span class=bound>X</span><span class=main>,</span> <span class=bound>Y</span><span class=main>,</span> <span class=bound>Z</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Riemann_Sphere-Re_stereographic><span class=command>lemma</span></span> Re_stereographic<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>z</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>z</span> <span class=main>*</span> cnj <span class=free>z</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> Re <span class=free>z</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> one_plus_square_neq_zero
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_mult_cnj_cmod<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Re_divide_real<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>

<span class=keyword1 id=Riemann_Sphere-Im_stereographic><span class=command>lemma</span></span> Im_stereographic<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Im <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>z</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>z</span> <span class=main>*</span> cnj <span class=free>z</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> Im <span class=free>z</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> one_plus_square_neq_zero
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_mult_cnj_cmod<span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> Im_divide_real<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>

<span class=keyword1 id=Riemann_Sphere-inv_stereographic_on_sphere><span class=command>lemma</span></span> inv_stereographic_on_sphere<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>X</span> <span class=main>=</span> Re <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=free>z</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>z</span><span class=main>*</span>cnj <span class=free>z</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>Y</span> <span class=main>=</span> Im <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=free>z</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>z</span><span class=main>*</span>cnj <span class=free>z</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>Z</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>X</span><span class=main>*</span><span class=free>X</span> <span class=main>+</span> <span class=free>Y</span><span class=main>*</span><span class=free>Y</span> <span class=main>+</span> <span class=free>Z</span><span class=main>*</span><span class=free>Z</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> power2_less_0<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Re_stereographic Im_stereographic<span class=main>)</span>
       <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square real_sqrt_mult<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span> add_divide_distrib<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_norm power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> inv_stereographic_hcoords_r3 <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> R3"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>inv_stereographic_cvec_r3</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> inv_stereographic <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> riemann_sphere"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>inv_stereographic_hcoords_r3</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>v</span> <span class=skolem>v'</span>
  <span class=keyword3><span class=command>assume</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v'</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>v'</span>"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>v1</span></span> <span class=skolem><span class=skolem>v2</span></span> <span class=skolem><span class=skolem>v'1</span></span> <span class=skolem><span class=skolem>v'2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v1</span><span class=main>,</span> <span class=skolem>v2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>v'1</span><span class=main>,</span> <span class=skolem>v'2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>v</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>v'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=skolem><span class=skolem>z</span></span> <span class=keyword2><span class=keyword>where</span></span>
    **<span class=main>:</span> <span class=quoted><span class=quoted>"inv_stereographic_cvec_r3 <span class=skolem>v</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>,</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"inv_stereographic_cvec_r3 <span class=skolem>v</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inv_stereographic_cvec_r3 <span class=skolem>v</span> <span class=main>∈</span> unit_sphere"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>v2</span> <span class=main>=</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> * ** inv_stereographic_on_sphere<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=quoted>"<span class=skolem>v1</span> <span class=main>/</span> <span class=skolem>v2</span>"</span></span> <span class=quoted><span class=skolem>y</span></span> <span class=quoted><span class=skolem>z</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> norm_divide<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"inv_stereographic_cvec_r3 <span class=skolem>v</span> <span class=main>=</span> inv_stereographic_cvec_r3 <span class=skolem>v'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> 1 * **
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split if_split_asm<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"inv_stereographic_cvec_r3 <span class=skolem>v</span> <span class=main>∈</span> unit_sphere <span class=main>∧</span>
        inv_stereographic_cvec_r3 <span class=skolem>v</span> <span class=main>=</span> inv_stereographic_cvec_r3 <span class=skolem>v'</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹North pole›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>North_R3</span> <span class=main>::</span> <span class=quoted>R3</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>North_R3</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>lift_definition</span></span> North <span class=main>::</span> <span class=quoted><span class=quoted>"riemann_sphere"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>North_R3</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Riemann_Sphere-stereographic_North><span class=command>lemma</span></span> stereographic_North<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>x</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>⟷</span> <span class=free>x</span> <span class=main>=</span> North"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Stereographic and inverse stereographic projection are mutually inverse.›</span></span>

<span class=keyword1 id="Riemann_Sphere-stereographic_inv_stereographic'"><span class=command>lemma</span></span> stereographic_inv_stereographic'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span>
  z<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=free>z1</span><span class=main>/</span><span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  X<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>X</span> <span class=main>=</span> Re <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=free>z</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>z</span><span class=main>*</span>cnj <span class=free>z</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> Y<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Y</span> <span class=main>=</span> Im <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=free>z</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>z</span><span class=main>*</span>cnj <span class=free>z</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> Z<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>Z</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=main>(</span><span class=free>X</span> <span class=main>+</span> <span class=keyword1>𝗂</span><span class=main>*</span><span class=free>Y</span><span class=main>,</span> complex_of_real <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>Z</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=free>z1</span><span class=main>,</span> <span class=free>z2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> one_power2 sum_power2_eq_zero_iff zero_neq_one<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>Z</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Z
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=free>Z</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>/</span> cor <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>X</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> Re<span class=main>(</span><span class=free>z</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> X
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Re_stereographic<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>Y</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> Im<span class=main>(</span><span class=free>z</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> Y
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Im_stereographic<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>X</span> <span class=main>+</span> <span class=keyword1>𝗂</span><span class=main>*</span><span class=free>Y</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>z</span> <span class=main>/</span> cor <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> Complex_eq<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>X</span></span> <span class=quoted><span class=free>Y</span></span><span class=main>,</span> <span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=quoted><span class=quoted>‹<span class=free>X</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span>Re<span class=main>(</span><span class=free>z</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>›</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> <span class=quoted><span class=quoted>‹<span class=free>Y</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span>Im<span class=main>(</span><span class=free>z</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>›</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Complex_scale4 Complex_scale1<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cor <span class=main>(</span>cmod <span class=main>(</span><span class=free>z1</span> <span class=main>/</span> <span class=free>z2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> one_plus_square_neq_zero<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>z</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> z<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
       <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cor <span class=main>(</span>cmod <span class=main>(</span><span class=free>z1</span> <span class=main>/</span> <span class=free>z2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=free>z2</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Riemann_Sphere-stereographic_inv_stereographic><span class=command>lemma</span></span> stereographic_inv_stereographic <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"stereographic <span class=main>(</span>inv_stereographic <span class=free>w</span><span class=main>)</span> <span class=main>=</span> <span class=free>w</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>=</span> stereographic <span class=main>(</span>inv_stereographic <span class=free>w</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>w</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=skolem><span class=skolem>z</span></span> <span class=keyword2><span class=keyword>where</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"inv_stereographic_cvec_r3 <span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>,</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"inv_stereographic_cvec_r3 <span class=skolem>w</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>blast</span><span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> stereographic_r3_cvec <span class=main>(</span>inv_stereographic_cvec_r3 <span class=skolem>w</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>w</span> <span class=main>≠</span> vec_zero›</span></span> stereographic_inv_stereographic'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>w1</span><span class=main>/</span><span class=skolem>w2</span>"</span></span> <span class=quoted><span class=skolem>w1</span></span> <span class=quoted><span class=skolem>w2</span></span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>y</span></span> <span class=quoted><span class=skolem>z</span></span><span class=main>]</span> * **
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> split_def Let_def <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Stereographic projection is bijective function›</span></span>

<span class=keyword1 id=Riemann_Sphere-bij_stereographic><span class=command>lemma</span></span> bij_stereographic<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bij stereographic"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> bij_def inj_on_def surj_def
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>safe</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>b</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"stereographic <span class=skolem>a</span> <span class=main>=</span> stereographic <span class=skolem>b</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>b</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=main>::</span> <span class=quoted>R3</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>xa</span></span> <span class=skolem><span class=skolem>ya</span></span> <span class=skolem><span class=skolem>za</span></span> <span class=skolem><span class=skolem>xb</span></span> <span class=skolem><span class=skolem>yb</span></span> <span class=skolem><span class=skolem>zb</span></span> <span class=keyword2><span class=keyword>where</span></span>
      *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>xa</span><span class=main>,</span> <span class=skolem>ya</span><span class=main>,</span> <span class=skolem>za</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>xb</span><span class=main>,</span> <span class=skolem>yb</span><span class=main>,</span> <span class=skolem>zb</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>b</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>∈</span> unit_sphere"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>∈</span> unit_sphere"</span></span> <span class=quoted><span class=quoted>"stereographic_r3_cvec <span class=skolem>a</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> stereographic_r3_cvec <span class=skolem>b</span>"</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=skolem>b</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span> <span class=main>∨</span> <span class=skolem>b</span> <span class=main>=</span> <span class=main>(</span><span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> * **
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> ++<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"cor <span class=skolem>xb</span> <span class=main>+</span> <span class=keyword1>𝗂</span> <span class=main>*</span> cor <span class=skolem>yb</span> <span class=main>=</span> <span class=skolem>k</span> <span class=main>*</span> <span class=main>(</span>cor <span class=skolem>xa</span> <span class=main>+</span> <span class=keyword1>𝗂</span> <span class=main>*</span> cor <span class=skolem>ya</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>-</span> cor <span class=skolem>zb</span> <span class=main>=</span> <span class=skolem>k</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> cor <span class=skolem>za</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> * **
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span>

      <span class=keyword1><span class=command>{</span></span>
          <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>xb</span> <span class=main>+</span> <span class=skolem>xa</span><span class=main>*</span><span class=skolem>zb</span> <span class=main>=</span> <span class=skolem>xa</span> <span class=main>+</span> <span class=skolem>xb</span><span class=main>*</span><span class=skolem>za</span>"</span></span>
                 <span class=quoted><span class=quoted>"<span class=skolem>yb</span> <span class=main>+</span> <span class=skolem>ya</span><span class=main>*</span><span class=skolem>zb</span> <span class=main>=</span> <span class=skolem>ya</span> <span class=main>+</span> <span class=skolem>yb</span><span class=main>*</span><span class=skolem>za</span>"</span></span>
                 <span class=quoted><span class=quoted>"<span class=skolem>xa</span><span class=main>*</span><span class=skolem>xa</span> <span class=main>+</span> <span class=skolem>ya</span><span class=main>*</span><span class=skolem>ya</span> <span class=main>+</span> <span class=skolem>za</span><span class=main>*</span><span class=skolem>za</span> <span class=main>=</span> <span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>xb</span><span class=main>*</span><span class=skolem>xb</span> <span class=main>+</span> <span class=skolem>yb</span><span class=main>*</span><span class=skolem>yb</span> <span class=main>+</span> <span class=skolem>zb</span><span class=main>*</span><span class=skolem>zb</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
                 <span class=quoted><span class=quoted>"<span class=skolem>za</span> <span class=main>≠</span> <span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>zb</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
          <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>xa</span> <span class=main>=</span> <span class=skolem>xb</span> <span class=main>∧</span> <span class=skolem>ya</span> <span class=main>=</span> <span class=skolem>yb</span> <span class=main>∧</span> <span class=skolem>za</span> <span class=main>=</span> <span class=skolem>zb</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>algebra</span>
      <span class=keyword1><span class=command>}</span></span> <span class=keyword1><span class=command>note</span></span> *** <span class=main>=</span> this

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>za</span> <span class=main>≠</span> <span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>zb</span> <span class=main>≠</span> <span class=main>1</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> False * **
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> cor <span class=skolem>zb</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> cor <span class=skolem>za</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>-</span> cor <span class=skolem>zb</span> <span class=main>=</span> <span class=skolem>k</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> cor <span class=skolem>za</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>za</span> <span class=main>≠</span> <span class=main>1</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>-</span> cor <span class=skolem>za</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>cor <span class=skolem>xb</span> <span class=main>+</span> <span class=keyword1>𝗂</span> <span class=main>*</span> cor <span class=skolem>yb</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> cor <span class=skolem>zb</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>cor <span class=skolem>xa</span> <span class=main>+</span> <span class=keyword1>𝗂</span> <span class=main>*</span> cor <span class=skolem>ya</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>za</span> <span class=main>≠</span> <span class=main>1</span>›</span></span> ++<span class=main>(</span>2<span class=main>)</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>xb</span> <span class=main>+</span> <span class=skolem>xa</span><span class=main>*</span><span class=skolem>zb</span> <span class=main>=</span> <span class=skolem>xa</span> <span class=main>+</span> <span class=skolem>xb</span><span class=main>*</span><span class=skolem>za</span>"</span></span>
            <span class=quoted><span class=quoted>"<span class=skolem>yb</span> <span class=main>+</span> <span class=skolem>ya</span><span class=main>*</span><span class=skolem>zb</span> <span class=main>=</span> <span class=skolem>ya</span> <span class=main>+</span> <span class=skolem>yb</span><span class=main>*</span><span class=skolem>za</span>"</span></span>
            <span class=quoted><span class=quoted>"<span class=skolem>xa</span><span class=main>*</span><span class=skolem>xa</span> <span class=main>+</span> <span class=skolem>ya</span><span class=main>*</span><span class=skolem>ya</span> <span class=main>+</span> <span class=skolem>za</span><span class=main>*</span><span class=skolem>za</span> <span class=main>=</span> <span class=main>1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>xb</span><span class=main>*</span><span class=skolem>xb</span> <span class=main>+</span> <span class=skolem>yb</span><span class=main>*</span><span class=skolem>yb</span> <span class=main>+</span> <span class=skolem>zb</span><span class=main>*</span><span class=skolem>zb</span> <span class=main>=</span> <span class=main>1</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> * ** <span class=quoted><span class=quoted>‹<span class=skolem>za</span> <span class=main>≠</span> <span class=main>1</span>›</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>unfolding</span></span> complex_of_real_def imaginary_unit.ctr
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> legacy_Complex_simps<span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> * ** *** <span class=quoted><span class=quoted>‹<span class=skolem>za</span> <span class=main>≠</span> <span class=main>1</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>zb</span> <span class=main>≠</span> <span class=main>1</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>y</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>x</span><span class=main>.</span> <span class=skolem>y</span> <span class=main>=</span> stereographic <span class=bound>x</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"inv_stereographic <span class=skolem>y</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1 id=Riemann_Sphere-inv_stereographic_stereographic><span class=command>lemma</span></span> inv_stereographic_stereographic <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inv_stereographic <span class=main>(</span>stereographic <span class=free>x</span><span class=main>)</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> stereographic_inv_stereographic<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"stereographic <span class=free>x</span>"</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> bij_stereographic
  <span class=keyword1><span class=command>unfolding</span></span> bij_def inj_on_def
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Riemann_Sphere-inv_stereographic_is_inv><span class=command>lemma</span></span> inv_stereographic_is_inv<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"inv_stereographic <span class=main>=</span> inv stereographic"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule</span> inv_equality<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>

<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Circles on the sphere›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Circlines in the plane correspond to circles on the Riemann sphere, and we formally establish
this connection. Every circle in three--dimensional space can be obtained as the intersection of a
sphere and a plane. We establish a one-to-one correspondence between circles on the Riemann sphere
and planes in space. Note that the plane need not intersect the sphere, but we will still say that
it defines a single imaginary circle. However, for one special circline (the one with the identity
representative matrix), there does not exist a plane in $\mathbb{R}^3$ that would correspond to it
--- in order to have this, instead of considering planes in $\mathbb{R}^3$, we must consider three
dimensional projective space and consider the infinite (hyper)plane.›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Planes in $R^3$ are given by equations $ax+by+cz=d$. Two four-tuples of coefficients $(a, b, c,
d)$ give the same plane iff they are proportional.›</span></span>

<span class=keyword1><span class=command>type_synonym</span></span> R4 <span class=main>=</span> <span class=quoted><span class=quoted>"real <span class=main>×</span> real <span class=main>×</span> real <span class=main>×</span> real"</span></span>

<span class=keyword1><span class=command>fun</span></span> <span class=entity>mult_sv</span> <span class=main>::</span> <span class=quoted><span class=quoted>"real <span class=main>⇒</span> R4 <span class=main>⇒</span> R4"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>infixl</span></span> <span class=quoted>"<span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>4</sub></span>"</span> 100<span class=main>)</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free><span class=bound><span class=entity>k</span></span></span> <span class=keyword1><span class=free>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>4</sub></span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>a</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>b</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>c</span></span></span><span class=main>,</span> <span class=free><span class=bound><span class=entity>k</span></span></span><span class=main>*</span><span class=free><span class=bound><span class=entity>d</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>abbreviation</span></span> <span class=entity>plane_vectors</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>plane_vectors</span> <span class=main>≡</span> <span class=main>{</span><span class=main>(</span><span class=bound>a</span><span class=main>::</span>real<span class=main>,</span> <span class=bound>b</span><span class=main>::</span>real<span class=main>,</span> <span class=bound>c</span><span class=main>::</span>real<span class=main>,</span> <span class=bound>d</span><span class=main>::</span>real<span class=main>)</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=bound>b</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=bound>c</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=bound>d</span> <span class=main>≠</span> <span class=main>0</span><span class=main>}</span>"</span></span>

<span class=keyword1><span class=command>typedef</span></span> plane_vec <span class=main>=</span> <span class=quoted><span class=quoted>"plane_vectors"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>1</span><span class=main>,</span> <span class=main>1</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>setup_lifting</span></span> type_definition_plane_vec

<span class=keyword1><span class=command>definition</span></span> <span class=entity>plane_vec_eq_r4</span> <span class=main>::</span> <span class=quoted><span class=quoted>"R4 <span class=main>⇒</span> R4 <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>plane_vec_eq_r4</span> <span class=free><span class=bound><span class=entity>v1</span></span></span> <span class=free><span class=bound><span class=entity>v2</span></span></span> <span class=main>⟷</span> <span class=main>(</span><span class=main>∃</span> <span class=bound>k</span><span class=main>.</span> <span class=bound>k</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∧</span> <span class=free><span class=bound><span class=entity>v2</span></span></span> <span class=main>=</span> <span class=bound>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>4</sub></span> <span class=free><span class=bound><span class=entity>v1</span></span></span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> plane_vec_eq <span class=main>::</span> <span class=quoted><span class=quoted>"plane_vec <span class=main>⇒</span> plane_vec <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>plane_vec_eq_r4</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Riemann_Sphere-mult_sv_one><span class=command>lemma</span></span> mult_sv_one <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>4</sub></span> <span class=free>x</span> <span class=main>=</span> <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>x</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1 id=Riemann_Sphere-mult_sv_distb><span class=command>lemma</span></span> mult_sv_distb <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>4</sub></span> <span class=main>(</span><span class=free>y</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>4</sub></span> <span class=free>v</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>x</span><span class=main>*</span><span class=free>y</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>4</sub></span> <span class=free>v</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>v</span></span><span class=main>)</span> <span class=operator>simp</span>

<span class=keyword1><span class=command>quotient_type</span></span> plane <span class=main>=</span> <span class=quoted>plane_vec</span> <span class=main>/</span> <span class=quoted>plane_vec_eq</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> equivpI<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"reflp plane_vec_eq"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> reflp_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> plane_vec_eq_def<span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"symp plane_vec_eq"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> symp_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> plane_vec_eq_def<span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span><span class=improper>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"transp plane_vec_eq"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> transp_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> plane_vec_eq_def<span class=main>)</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>ka</span><span class=main>*</span><span class=improper>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Plane coefficients give a linear equation and the point on the Riemann sphere lies on the
circle determined by the plane iff its representation satisfies that linear equation.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>on_sphere_circle_r4_r3</span> <span class=main>::</span> <span class=quoted><span class=quoted>"R4 <span class=main>⇒</span> R3 <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>on_sphere_circle_r4_r3</span> <span class=free><span class=bound><span class=entity>α</span></span></span> <span class=free><span class=bound><span class=entity>A</span></span></span> <span class=main>⟷</span>
      <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>X</span><span class=main>,</span> <span class=bound>Y</span><span class=main>,</span> <span class=bound>Z</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>A</span></span></span><span class=main>;</span>
           <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> <span class=bound>c</span><span class=main>,</span> <span class=bound>d</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>α</span></span></span>
        <span class=keyword1>in</span> <span class=bound>a</span><span class=main>*</span><span class=bound>X</span> <span class=main>+</span> <span class=bound>b</span><span class=main>*</span><span class=bound>Y</span> <span class=main>+</span> <span class=bound>c</span><span class=main>*</span><span class=bound>Z</span> <span class=main>+</span> <span class=bound>d</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> on_sphere_circle_vec <span class=main>::</span> <span class=quoted><span class=quoted>"plane_vec <span class=main>⇒</span> R3 <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>on_sphere_circle_r4_r3</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> on_sphere_circle <span class=main>::</span> <span class=quoted><span class=quoted>"plane <span class=main>⇒</span> riemann_sphere <span class=main>⇒</span> bool"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>on_sphere_circle_vec</span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>pv1</span> <span class=skolem>pv2</span> <span class=main>::</span> <span class=quoted>R4</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>w</span> <span class=main>::</span> <span class=quoted>R3</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a1</span></span> <span class=skolem><span class=skolem>b1</span></span> <span class=skolem><span class=skolem>c1</span></span> <span class=skolem><span class=skolem>d1</span></span> <span class=skolem><span class=skolem>a2</span></span> <span class=skolem><span class=skolem>b2</span></span> <span class=skolem><span class=skolem>c2</span></span> <span class=skolem><span class=skolem>d2</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=skolem><span class=skolem>z</span></span> <span class=keyword2><span class=keyword>where</span></span>
    *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>pv1</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a1</span><span class=main>,</span> <span class=skolem>b1</span><span class=main>,</span> <span class=skolem>c1</span><span class=main>,</span> <span class=skolem>d1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>pv2</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a2</span><span class=main>,</span> <span class=skolem>b2</span><span class=main>,</span> <span class=skolem>c2</span><span class=main>,</span> <span class=skolem>d2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>,</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>pv1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>pv2</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>w</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>pv1</span> <span class=main>∈</span> plane_vectors"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>pv2</span> <span class=main>∈</span> plane_vectors"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>∈</span> unit_sphere"</span></span> <span class=quoted><span class=quoted>"plane_vec_eq_r4 <span class=skolem>pv1</span> <span class=skolem>pv2</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a2</span> <span class=main>=</span> <span class=skolem>k</span><span class=main>*</span><span class=skolem>a1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>b2</span> <span class=main>=</span> <span class=skolem>k</span><span class=main>*</span><span class=skolem>b1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>c2</span> <span class=main>=</span> <span class=skolem>k</span><span class=main>*</span><span class=skolem>c1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>d2</span> <span class=main>=</span> <span class=skolem>k</span><span class=main>*</span><span class=skolem>d1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>*</span> <span class=skolem>a1</span> <span class=main>*</span> <span class=skolem>x</span> <span class=main>+</span> <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>b1</span> <span class=main>*</span> <span class=skolem>y</span> <span class=main>+</span> <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>c1</span> <span class=main>*</span> <span class=skolem>z</span> <span class=main>+</span> <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>d1</span> <span class=main>=</span> <span class=skolem>k</span><span class=main>*</span><span class=main>(</span><span class=skolem>a1</span><span class=main>*</span><span class=skolem>x</span> <span class=main>+</span> <span class=skolem>b1</span><span class=main>*</span><span class=skolem>y</span> <span class=main>+</span> <span class=skolem>c1</span><span class=main>*</span><span class=skolem>z</span> <span class=main>+</span> <span class=skolem>d1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"on_sphere_circle_r4_r3 <span class=skolem>pv1</span> <span class=skolem>w</span> <span class=main>=</span> on_sphere_circle_r4_r3 <span class=skolem>pv2</span> <span class=skolem>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * **
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>sphere_circle_set</span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=quoted><span class=quoted>"<span class=free>sphere_circle_set</span> <span class=free><span class=bound><span class=entity>α</span></span></span> <span class=main>=</span> <span class=main>{</span><span class=bound>A</span><span class=main>.</span> on_sphere_circle <span class=free><span class=bound><span class=entity>α</span></span></span> <span class=bound>A</span><span class=main>}</span>"</span></span>


<span class=comment1>(* ----------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Connections of circlines in the plane and circles on the Riemann sphere›</span></span>
<span class=comment1>(* ----------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹We introduce stereographic and inverse stereographic projection between circles on the Riemann
sphere and circlines in the extended complex plane.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>inv_stereographic_circline_cmat_r4</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> R4"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>inv_stereographic_circline_cmat_r4</span> <span class=free><span class=bound><span class=entity>H</span></span></span>  <span class=main>=</span>
            <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>H</span></span></span>
              <span class=keyword1>in</span> <span class=main>(</span>Re <span class=main>(</span><span class=bound>B</span><span class=main>+</span><span class=bound>C</span><span class=main>)</span><span class=main>,</span> Re<span class=main>(</span><span class=keyword1>𝗂</span><span class=main>*</span><span class=main>(</span><span class=bound>C</span><span class=main>-</span><span class=bound>B</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> Re<span class=main>(</span><span class=bound>A</span><span class=main>-</span><span class=bound>D</span><span class=main>)</span><span class=main>,</span> Re<span class=main>(</span><span class=bound>D</span><span class=main>+</span><span class=bound>A</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> inv_stereographic_circline_clmat_pv <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> plane_vec"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>inv_stereographic_circline_cmat_r4</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def real_imag_0 eq_cnj_iff_real<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> inv_stereographic_circline <span class=main>::</span> <span class=quoted><span class=quoted>"circline <span class=main>⇒</span> plane"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>inv_stereographic_circline_clmat_pv</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule</span> exE<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=improper>k</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>circline_mat1</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=quoted>"<span class=improper>circline_mat2</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>stereographic_circline_r4_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"R4 <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
<span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>stereographic_circline_r4_cmat</span> <span class=free><span class=bound><span class=entity>α</span></span></span> <span class=main>=</span>
         <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>a</span><span class=main>,</span> <span class=bound>b</span><span class=main>,</span> <span class=bound>c</span><span class=main>,</span> <span class=bound>d</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>α</span></span></span>
           <span class=keyword1>in</span> <span class=main>(</span>cor <span class=main>(</span><span class=main>(</span><span class=bound>c</span><span class=main>+</span><span class=bound>d</span><span class=main>)</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span> <span class=main>,</span> <span class=main>(</span><span class=main>(</span>cor <span class=bound>a</span> <span class=main>+</span> <span class=keyword1>𝗂</span> <span class=main>*</span> cor <span class=bound>b</span><span class=main>)</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=main>(</span>cor <span class=bound>a</span> <span class=main>-</span> <span class=keyword1>𝗂</span> <span class=main>*</span> cor <span class=bound>b</span><span class=main>)</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>,</span> cor <span class=main>(</span><span class=main>(</span><span class=bound>d</span><span class=main>-</span><span class=bound>c</span><span class=main>)</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> stereographic_circline_pv_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"plane_vec <span class=main>⇒</span> circline_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>stereographic_circline_r4_cmat</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> stereographic_circline <span class=main>::</span> <span class=quoted><span class=quoted>"plane <span class=main>⇒</span> circline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>stereographic_circline_pv_clmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>case_tac</span> <span class=quoted><span class=improper>plane_vec1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>case_tac</span> <span class=quoted><span class=improper>plane_vec2</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>erule</span> exE<span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=improper>k</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Stereographic and inverse stereographic projection of circlines are mutually inverse.›</span></span>

<span class=keyword1 id=Riemann_Sphere-stereographic_circline_inv_stereographic_circline><span class=command>lemma</span></span> stereographic_circline_inv_stereographic_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"stereographic_circline <span class=main>∘</span> inv_stereographic_circline <span class=main>=</span> id"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"stereographic_circline <span class=main>(</span>inv_stereographic_circline <span class=skolem>H</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>H</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H</span>
    <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> HH hh hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=main>(</span>stereographic_circline_r4_cmat <span class=main>(</span>inv_stereographic_circline_cmat_r4 <span class=skolem>H</span><span class=main>)</span><span class=main>)</span> <span class=skolem>H</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> HH
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>B</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> add_uminus_conv_diff complex_cnj_add complex_cnj_complex_of_real complex_cnj_i complex_cnj_mult complex_cnj_one complex_eq distrib_left_numeral mult.commute mult.left_commute mult.left_neutral mult_cancel_right2 mult_minus_left of_real_1 one_add_one<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Stereographic and inverse stereographic projection of circlines are mutually inverse.›</span></span>
<span class=keyword1 id=Riemann_Sphere-inv_stereographic_circline_stereographic_circline><span class=command>lemma</span></span> inv_stereographic_circline_stereographic_circline<span class=main>:</span>
  <span class=quoted><span class=quoted>"inv_stereographic_circline <span class=main>∘</span> stereographic_circline <span class=main>=</span> id"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>rule</span> ext<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>α</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"inv_stereographic_circline <span class=main>(</span>stereographic_circline <span class=skolem>α</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>α</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>α</span>
    <span class=keyword3><span class=command>assume</span></span> aa<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>α</span> <span class=main>∈</span> plane_vectors"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=skolem><span class=skolem>d</span></span> <span class=keyword2><span class=keyword>where</span></span> AA<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>α</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a</span><span class=main>,</span> <span class=skolem>b</span><span class=main>,</span> <span class=skolem>c</span><span class=main>,</span> <span class=skolem>d</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>α</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"plane_vec_eq_r4 <span class=main>(</span>inv_stereographic_circline_cmat_r4 <span class=main>(</span>stereographic_circline_r4_cmat <span class=skolem>α</span><span class=main>)</span><span class=main>)</span> <span class=skolem>α</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> AA
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> complex_of_real_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Riemann_Sphere-stereographic_sphere_circle_set''"><span class=command>lemma</span></span> stereographic_sphere_circle_set''<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"on_sphere_circle <span class=main>(</span>inv_stereographic_circline <span class=free>H</span><span class=main>)</span> <span class=free>z</span> <span class=main>⟷</span>
         on_circline <span class=free>H</span> <span class=main>(</span>stereographic <span class=free>z</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>R3</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>H</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
  <span class=keyword3><span class=command>assume</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"hermitean <span class=skolem>H</span> <span class=main>∧</span> <span class=skolem>H</span> <span class=main>≠</span> mat_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>∈</span> unit_sphere"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A</span></span> <span class=skolem><span class=skolem>B</span></span> <span class=skolem><span class=skolem>C</span></span> <span class=skolem><span class=skolem>D</span></span> <span class=keyword2><span class=keyword>where</span></span> HH<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>H</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hh HH hermitean_elems<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>A</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>B</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>C</span></span></span></span></span></span></span></span> <span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem><span class=quoted><span class=skolem>D</span></span></span></span></span></span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=skolem><span class=skolem>z</span></span> <span class=keyword2><span class=keyword>where</span></span> MM<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>,</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"on_sphere_circle_r4_r3 <span class=main>(</span>inv_stereographic_circline_cmat_r4 <span class=skolem>H</span><span class=main>)</span> <span class=skolem>M</span> <span class=main>⟷</span>
        on_circline_cmat_cvec <span class=skolem>H</span> <span class=main>(</span>stereographic_r3_cvec <span class=skolem>M</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>=</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span><span class=main>=</span><span class=main>1</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> MM hh
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=var>?lhs</span>›</span></span> HH MM <span class=quoted><span class=quoted>‹<span class=skolem>z</span><span class=main>=</span><span class=main>1</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>A</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def Complex_eq Let_def<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=skolem>B</span><span class=main>*</span><span class=skolem>x</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Im <span class=skolem>B</span><span class=main>*</span><span class=skolem>y</span> <span class=main>+</span> Re <span class=skolem>D</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=var>?lhs</span>›</span></span> HH MM
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Re <span class=skolem>A</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=skolem>B</span><span class=main>*</span><span class=skolem>x</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Im <span class=skolem>B</span><span class=main>*</span><span class=skolem>y</span> <span class=main>+</span> Re <span class=skolem>D</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=skolem>z</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=skolem>B</span><span class=main>*</span><span class=skolem>x</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Im <span class=skolem>B</span><span class=main>*</span><span class=skolem>y</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> Re <span class=skolem>D</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span><span class=main>*</span><span class=skolem>x</span><span class=main>+</span><span class=skolem>y</span><span class=main>*</span><span class=skolem>y</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=skolem>z</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> MM hh
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span><span class=main>*</span><span class=main>(</span><span class=skolem>x</span><span class=main>*</span><span class=skolem>x</span><span class=main>+</span><span class=skolem>y</span><span class=main>*</span><span class=skolem>y</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=skolem>B</span><span class=main>*</span><span class=skolem>x</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Im <span class=skolem>B</span><span class=main>*</span><span class=skolem>y</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> Re <span class=skolem>D</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x</span> <span class=main>*</span> Re <span class=skolem>A</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=skolem>z</span><span class=main>)</span> <span class=main>*</span> Re <span class=skolem>B</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>x</span> <span class=main>-</span> <span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=skolem>y</span> <span class=main>*</span> Re <span class=skolem>A</span><span class=main>)</span> <span class=main>+</span> <span class=main>-</span> <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=skolem>z</span><span class=main>)</span> <span class=main>*</span> Im <span class=skolem>B</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>y</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>*</span> Re <span class=skolem>B</span> <span class=main>+</span> <span class=skolem>y</span> <span class=main>*</span> Im <span class=skolem>B</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=skolem>z</span><span class=main>)</span> <span class=main>*</span> Re <span class=skolem>D</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>≠</span> <span class=main>1</span>›</span></span> HH MM * <span class=quoted><span class=quoted>‹Re <span class=skolem>A</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=skolem>B</span><span class=main>*</span><span class=skolem>x</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Im <span class=skolem>B</span><span class=main>*</span><span class=skolem>y</span> <span class=main>+</span> Re <span class=skolem>D</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> complex_eq_iff<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>assume</span></span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span><span class=main>=</span><span class=main>1</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> MM hh
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> HH MM <span class=quoted><span class=quoted>‹<span class=var>?rhs</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>=</span> <span class=main>1</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x</span> <span class=main>*</span> Re <span class=skolem>A</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=skolem>z</span><span class=main>)</span> <span class=main>*</span> Re <span class=skolem>B</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>x</span> <span class=main>-</span> <span class=main>(</span><span class=main>-</span> <span class=main>(</span><span class=skolem>y</span> <span class=main>*</span> Re <span class=skolem>A</span><span class=main>)</span> <span class=main>+</span> <span class=main>-</span> <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=skolem>z</span><span class=main>)</span> <span class=main>*</span> Im <span class=skolem>B</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>y</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>*</span> Re <span class=skolem>B</span> <span class=main>+</span> <span class=skolem>y</span> <span class=main>*</span> Im <span class=skolem>B</span> <span class=main>+</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=skolem>z</span><span class=main>)</span> <span class=main>*</span> Re <span class=skolem>D</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> HH MM * <span class=quoted><span class=quoted>‹<span class=var>?rhs</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def vec_cnj_def complex_eq_iff<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span><span class=main>*</span><span class=main>(</span><span class=skolem>x</span><span class=main>*</span><span class=skolem>x</span><span class=main>+</span><span class=skolem>y</span><span class=main>*</span><span class=skolem>y</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=skolem>B</span><span class=main>*</span><span class=skolem>x</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Im <span class=skolem>B</span><span class=main>*</span><span class=skolem>y</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> Re <span class=skolem>D</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span><span class=main>*</span><span class=skolem>x</span> <span class=main>+</span> <span class=skolem>y</span><span class=main>*</span><span class=skolem>y</span> <span class=main>=</span> <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=skolem>z</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> MM hh
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=skolem>z</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=skolem>B</span><span class=main>*</span><span class=skolem>x</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Im <span class=skolem>B</span><span class=main>*</span><span class=skolem>y</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> Re <span class=skolem>D</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Re <span class=skolem>A</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=skolem>B</span><span class=main>*</span><span class=skolem>x</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Im <span class=skolem>B</span><span class=main>*</span><span class=skolem>y</span> <span class=main>+</span> Re <span class=skolem>D</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=skolem>z</span><span class=main>)</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=skolem>B</span><span class=main>*</span><span class=skolem>x</span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Im <span class=skolem>B</span><span class=main>*</span><span class=skolem>y</span> <span class=main>+</span> Re <span class=skolem>D</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>-</span><span class=skolem>z</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>≠</span> <span class=main>1</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> MM HH *
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Riemann_Sphere-stereographic_sphere_circle_set'"><span class=command>lemma</span></span> stereographic_sphere_circle_set' <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"stereographic <span class=main>`</span> sphere_circle_set <span class=main>(</span>inv_stereographic_circline <span class=free>H</span><span class=main>)</span> <span class=main>=</span>
         circline_set <span class=free>H</span>"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> sphere_circle_set_def circline_set_def
<span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>safe</span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"on_sphere_circle <span class=main>(</span>inv_stereographic_circline <span class=free>H</span><span class=main>)</span> <span class=skolem>x</span>"</span></span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=main>(</span>stereographic <span class=skolem>x</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> stereographic_sphere_circle_set''
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"on_circline <span class=free>H</span> <span class=skolem>x</span>"</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> stereographic <span class=main>`</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> on_sphere_circle <span class=main>(</span>inv_stereographic_circline <span class=free>H</span><span class=main>)</span> <span class=bound>z</span><span class=main>}</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> stereographic <span class=main>(</span>inv_stereographic <span class=skolem>x</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"inv_stereographic <span class=skolem>x</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>z</span><span class=main>.</span> on_sphere_circle <span class=main>(</span>inv_stereographic_circline <span class=free>H</span><span class=main>)</span> <span class=bound>z</span><span class=main>}</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> stereographic_sphere_circle_set''<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>H</span></span> <span class=quoted><span class=quoted>"inv_stereographic <span class=skolem>x</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹on_circline <span class=free>H</span> <span class=skolem>x</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The projection of the set of points on a circle on the Riemann sphere is exactly the set of
points on the circline obtained by the just introduced circle stereographic projection.›</span></span>
<span class=keyword1 id=Riemann_Sphere-stereographic_sphere_circle_set><span class=command>lemma</span></span> stereographic_sphere_circle_set<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"stereographic <span class=main>`</span> sphere_circle_set <span class=free>H</span> <span class=main>=</span> circline_set <span class=main>(</span>stereographic_circline <span class=free>H</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> stereographic_sphere_circle_set'<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"stereographic_circline <span class=free>H</span>"</span></span><span class=main>]</span>
<span class=keyword1><span class=command>using</span></span> inv_stereographic_circline_stereographic_circline
<span class=keyword1><span class=command>unfolding</span></span> comp_def
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> id_apply<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Stereographic projection of circlines is bijective.›</span></span>
<span class=keyword1 id=Riemann_Sphere-bij_stereographic_circline><span class=command>lemma</span></span> bij_stereographic_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bij stereographic_circline"</span></span>
  <span class=keyword1><span class=command>using</span></span> stereographic_circline_inv_stereographic_circline inv_stereographic_circline_stereographic_circline
  <span class=keyword1><span class=command>using</span></span> o_bij <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Inverse stereographic projection is bijective.›</span></span>
<span class=keyword1 id=Riemann_Sphere-bij_inv_stereographic_circline><span class=command>lemma</span></span> bij_inv_stereographic_circline<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"bij inv_stereographic_circline"</span></span>
  <span class=keyword1><span class=command>using</span></span> stereographic_circline_inv_stereographic_circline inv_stereographic_circline_stereographic_circline
  <span class=keyword1><span class=command>using</span></span> o_bij <span class=keyword1><span class=command>by</span></span> <span class=operator>blast</span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div><div id=Chordal_Metric>
<div class=head>
<h1>Theory Chordal_Metric</h1>
</div>
<pre class=source><span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsection</span></span> <span class=quoted><span class=plain_text>‹Chordal Metric›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Riemann sphere can be made a metric space. We are going to introduce distance on Riemann sphere
and to prove that it is a metric space. The distance between two points on the sphere is defined as
the length of the chord that connects them. This metric can be used in formalization of elliptic
geometry.›</span></span>

<span class=keyword1><span class=command>theory</span></span> Chordal_Metric
  <span class=keyword2><span class=keyword>imports</span></span> <a href=#Homogeneous_Coordinates>Homogeneous_Coordinates</a> <a href=#Riemann_Sphere>Riemann_Sphere</a> <a href=#Oriented_Circlines>Oriented_Circlines</a> <span class=quoted>"<a href=https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Analysis/Inner_Product.html>HOL-Analysis.Inner_Product</a>"</span> <span class=quoted>"<a href=https://www.cl.cam.ac.uk/research/hvg/Isabelle/dist/library/HOL/HOL-Analysis/Euclidean_Space.html>HOL-Analysis.Euclidean_Space</a>"</span>
<span class=keyword2><span class=keyword>begin</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Inner product and norm›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>inprod_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_vec <span class=main>⇒</span> complex"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>inprod_cvec</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=free><span class=bound><span class=entity>w</span></span></span> <span class=main>=</span>
             <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>z1</span><span class=main>,</span> <span class=bound>z2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>;</span>
                  <span class=main>(</span><span class=bound>w1</span><span class=main>,</span> <span class=bound>w2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>w</span></span></span>
               <span class=keyword1>in</span> vec_cnj <span class=main>(</span><span class=bound>z1</span><span class=main>,</span> <span class=bound>z2</span><span class=main>)</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>v</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=main>(</span><span class=bound>w1</span><span class=main>,</span> <span class=bound>w2</span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>syntax</span></span>
  <span class=quoted>"_inprod_cvec"</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_vec <span class=main>⇒</span> complex"</span></span>  <span class=main>(</span><span class=quoted>"<span class=keyword1>⟨</span>_<span class=keyword1>,</span>_<span class=keyword1>⟩</span>"</span><span class=main>)</span>
<span class=keyword1><span class=command>translations</span></span>
  <span class=quoted>"<span class=main>⟨</span><span class=free>z</span><span class=main>,</span><span class=free>w</span><span class=main>⟩</span>"</span> <span class=main>==</span> <span class=quoted>"<span class=keyword1>CONST</span> inprod_cvec <span class=free>z</span> <span class=free>w</span>"</span>

<span class=keyword1 id=Chordal_Metric-real_inprod_cvec><span class=command>lemma</span></span> real_inprod_cvec <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>⟨</span><span class=free>z</span><span class=main>,</span><span class=free>z</span><span class=main>⟩</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Chordal_Metric-inprod_cvec_ge_zero><span class=command>lemma</span></span> inprod_cvec_ge_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=main>⟨</span><span class=free>z</span><span class=main>,</span><span class=free>z</span><span class=main>⟩</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

<span class=keyword1 id=Chordal_Metric-inprod_cvec_bilinear1><span class=command>lemma</span></span> inprod_cvec_bilinear1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z'</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span>  <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>z'</span><span class=main>,</span><span class=free>w</span><span class=main>⟩</span> <span class=main>=</span> cnj <span class=free>k</span> <span class=main>*</span> <span class=main>⟨</span><span class=free>z</span><span class=main>,</span><span class=free>w</span><span class=main>⟩</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>z'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Chordal_Metric-inprod_cvec_bilinear2><span class=command>lemma</span></span> inprod_cvec_bilinear2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z'</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>w</span><span class=main>,</span> <span class=free>z'</span><span class=main>⟩</span> <span class=main>=</span> <span class=free>k</span> <span class=main>*</span> <span class=main>⟨</span><span class=free>w</span><span class=main>,</span> <span class=free>z</span><span class=main>⟩</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>z'</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>w</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1 id=Chordal_Metric-inprod_cvec_g_zero><span class=command>lemma</span></span> inprod_cvec_g_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=main>⟨</span><span class=free>z</span><span class=main>,</span> <span class=free>z</span><span class=main>⟩</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>∀</span> <span class=bound>a</span> <span class=bound>b</span><span class=main>.</span> <span class=bound>a</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=bound>b</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>⟶</span> <span class=main>0</span> <span class=main>&lt;</span> <span class=main>(</span>Re <span class=bound>a</span> <span class=main>*</span> Re <span class=bound>a</span> <span class=main>+</span> Im <span class=bound>a</span> <span class=main>*</span> Im <span class=bound>a</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span>Re <span class=bound>b</span> <span class=main>*</span> Re <span class=bound>b</span> <span class=main>+</span> Im <span class=bound>b</span> <span class=main>*</span> Im <span class=bound>b</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> complex_eq_0 not_sum_squares_lt_zero power2_eq_square<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>z</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>norm_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>where</span></span>
  <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>norm_cvec</span> <span class=free><span class=bound><span class=entity>z</span></span></span> <span class=main>=</span> sqrt <span class=main>(</span>Re <span class=main>⟨</span><span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>,</span><span class=free><span class=bound><span class=entity>z</span></span></span><span class=main>⟩</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>syntax</span></span>
  <span class=quoted>"_norm_cvec"</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex"</span></span>  <span class=main>(</span><span class=quoted>"<span class=keyword1>⟨</span>_<span class=keyword1>⟩</span>"</span><span class=main>)</span>
<span class=keyword1><span class=command>translations</span></span>
  <span class=quoted>"<span class=main>⟨</span><span class=free>z</span><span class=main>⟩</span>"</span> <span class=main>==</span> <span class=quoted>"<span class=keyword1>CONST</span> norm_cvec <span class=free>z</span>"</span>

<span class=keyword1 id=Chordal_Metric-norm_cvec_square><span class=command>lemma</span></span> norm_cvec_square<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>z</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> Re <span class=main>(</span><span class=main>⟨</span><span class=free>z</span><span class=main>,</span><span class=free>z</span><span class=main>⟩</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> inprod_cvec_def<span class=main>)</span>

<span class=keyword1 id=Chordal_Metric-norm_cvec_gt_0><span class=command>lemma</span></span> norm_cvec_gt_0<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>z</span><span class=main>⟩</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> inprod_cvec_def<span class=main>)</span>

<span class=keyword1 id=Chordal_Metric-norm_cvec_scale><span class=command>lemma</span></span> norm_cvec_scale<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z'</span> <span class=main>=</span> <span class=free>k</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=free>z</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>z'</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> Re <span class=main>(</span>cnj <span class=free>k</span> <span class=main>*</span> <span class=free>k</span><span class=main>)</span> <span class=main>*</span> <span class=main>⟨</span><span class=free>z</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> norm_cvec_square
  <span class=keyword1><span class=command>using</span></span> inprod_cvec_bilinear1<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>z'</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>using</span></span> inprod_cvec_bilinear2<span class=main>[</span><span class=operator>OF</span> assms<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> inprod_cvec_def <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> inprod_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> complex"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>inprod_cvec</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> norm_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>norm_cvec</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Distance in $\mathbb{C}P^1$ - defined by Fubini-Study metric.›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Formula for the chordal distance between the two points can be given directly based
on the homogenous coordinates of their stereographic projections in the plane. This is
called the Fubini-Study metric.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>dist_fs_cvec</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> complex_vec <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>dist_fs_cvec</span> <span class=free><span class=bound><span class=entity>z1</span></span></span> <span class=free><span class=bound><span class=entity>z2</span></span></span> <span class=main>=</span>
     <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>z1x</span><span class=main>,</span> <span class=bound>z1y</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>z1</span></span></span><span class=main>;</span>
          <span class=main>(</span><span class=bound>z2x</span><span class=main>,</span> <span class=bound>z2y</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>z2</span></span></span><span class=main>;</span>
          <span class=bound>num</span> <span class=main>=</span> <span class=main>(</span><span class=bound>z1x</span><span class=main>*</span><span class=bound>z2y</span> <span class=main>-</span> <span class=bound>z2x</span><span class=main>*</span><span class=bound>z1y</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>cnj <span class=bound>z1x</span><span class=main>*</span>cnj <span class=bound>z2y</span> <span class=main>-</span> cnj <span class=bound>z2x</span><span class=main>*</span>cnj <span class=bound>z1y</span><span class=main>)</span><span class=main>;</span>
          <span class=bound>den</span> <span class=main>=</span> <span class=main>(</span><span class=bound>z1x</span><span class=main>*</span>cnj <span class=bound>z1x</span> <span class=main>+</span> <span class=bound>z1y</span><span class=main>*</span>cnj <span class=bound>z1y</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=bound>z2x</span><span class=main>*</span>cnj <span class=bound>z2x</span> <span class=main>+</span> <span class=bound>z2y</span><span class=main>*</span>cnj <span class=bound>z2y</span><span class=main>)</span>
       <span class=keyword1>in</span> <span class=numeral>2</span><span class=main>*</span>sqrt<span class=main>(</span>Re <span class=bound>num</span> <span class=main>/</span> Re <span class=bound>den</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Chordal_Metric-dist_fs_cvec_iff><span class=command>lemma</span></span> dist_fs_cvec_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_fs_cvec <span class=free>z</span> <span class=free>w</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span>sqrt<span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=main>(</span>cmod <span class=main>⟨</span><span class=free>z</span><span class=main>,</span><span class=free>w</span><span class=main>⟩</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=main>(</span><span class=main>⟨</span><span class=free>z</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>⟨</span><span class=free>w</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>w</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span>sqrt<span class=main>(</span><span class=main>1</span> <span class=main>-</span> <span class=main>(</span>cmod <span class=main>⟨</span><span class=free>z</span><span class=main>,</span><span class=free>w</span><span class=main>⟩</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=main>(</span><span class=main>⟨</span><span class=free>z</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>⟨</span><span class=free>w</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span><span class=main>*</span>sqrt<span class=main>(</span><span class=main>(</span><span class=main>⟨</span><span class=free>z</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>⟨</span><span class=free>w</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cmod <span class=main>⟨</span><span class=free>z</span><span class=main>,</span><span class=free>w</span><span class=main>⟩</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>⟨</span><span class=free>z</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>⟨</span><span class=free>w</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> norm_cvec_gt_0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> norm_cvec_gt_0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span><span class=main>]</span> assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> 2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>z</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>⟨</span><span class=free>w</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> Re <span class=main>(</span><span class=main>(</span><span class=skolem>z1</span><span class=main>*</span>cnj <span class=skolem>z1</span> <span class=main>+</span> <span class=skolem>z2</span><span class=main>*</span>cnj <span class=skolem>z2</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>*</span>cnj <span class=skolem>w1</span> <span class=main>+</span> <span class=skolem>w2</span><span class=main>*</span>cnj <span class=skolem>w2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> assms *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> 3<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⟨</span><span class=free>z</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>⟨</span><span class=free>w</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=main>(</span>cmod <span class=main>⟨</span><span class=free>z</span><span class=main>,</span><span class=free>w</span><span class=main>⟩</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> Re <span class=main>(</span><span class=main>(</span><span class=skolem>z1</span><span class=main>*</span><span class=skolem>w2</span> <span class=main>-</span> <span class=skolem>w1</span><span class=main>*</span><span class=skolem>z2</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>cnj <span class=skolem>z1</span><span class=main>*</span>cnj <span class=skolem>w2</span> <span class=main>-</span> cnj <span class=skolem>w1</span><span class=main>*</span>cnj <span class=skolem>z2</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>subst</span> norm_cvec_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> 1 2 3
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>unfolding</span></span> dist_fs_cvec_def Let_def
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> dist_fs_hcoords <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> complex_homo_coords <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>dist_fs_cvec</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> dist_fs <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> complex_homo <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>dist_fs_hcoords</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z1</span> <span class=skolem>z2</span> <span class=skolem>z1'</span> <span class=skolem>z2'</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1x</span></span> <span class=skolem><span class=skolem>z1y</span></span> <span class=skolem><span class=skolem>z2x</span></span> <span class=skolem><span class=skolem>z2y</span></span> <span class=skolem><span class=skolem>z1'x</span></span> <span class=skolem><span class=skolem>z1'y</span></span> <span class=skolem><span class=skolem>z2'x</span></span> <span class=skolem><span class=skolem>z2'y</span></span> <span class=keyword2><span class=keyword>where</span></span>
    zz<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1x</span><span class=main>,</span> <span class=skolem>z1y</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z2x</span><span class=main>,</span> <span class=skolem>z2y</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z1'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1'x</span><span class=main>,</span> <span class=skolem>z1'y</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2'</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z2'x</span><span class=main>,</span> <span class=skolem>z2'y</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z1'</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z2'</span>"</span></span><span class=main>)</span> <span class=operator>blast</span>

  <span class=keyword3><span class=command>assume</span></span> 1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z1'</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2'</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z1'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z2'</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k1</span></span> <span class=skolem><span class=skolem>k2</span></span> <span class=keyword2><span class=keyword>where</span></span>
    *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k1</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z1'</span> <span class=main>=</span> <span class=skolem>k1</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z1</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
    **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k2</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z2'</span> <span class=main>=</span> <span class=skolem>k2</span> <span class=keyword1>*<span class=hidden>⇩</span><sub>s</sub><span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>z2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>⟨</span><span class=skolem>z1</span><span class=main>,</span><span class=skolem>z2</span><span class=main>⟩</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=main>(</span><span class=main>⟨</span><span class=skolem>z1</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>⟨</span><span class=skolem>z2</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>cmod <span class=main>⟨</span><span class=skolem>z1'</span><span class=main>,</span><span class=skolem>z2'</span><span class=main>⟩</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=main>(</span><span class=main>⟨</span><span class=skolem>z1'</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>⟨</span><span class=skolem>z2'</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k1</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k2</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> cmod_square<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>k1</span></span><span class=main>]</span> cmod_square<span class=main>[</span><span class=operator>symmetric</span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=skolem>k2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> norm_cvec_scale<span class=main><span class=main>[</span></span><span class=operator>OF</span> *<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> norm_cvec_scale<span class=main><span class=main>[</span></span><span class=operator>OF</span> **<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> inprod_cvec_bilinear1<span class=main><span class=main>[</span></span><span class=operator>OF</span> *<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> inprod_cvec_bilinear2<span class=main><span class=main>[</span></span><span class=operator>OF</span> **<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square norm_mult<span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"dist_fs_cvec <span class=skolem>z1</span> <span class=skolem>z2</span> <span class=main>=</span> dist_fs_cvec <span class=skolem>z1'</span> <span class=skolem>z2'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> 1 dist_fs_cvec_iff
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Chordal_Metric-dist_fs_finite><span class=command>lemma</span></span> dist_fs_finite<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_fs <span class=main>(</span>of_complex <span class=free>z1</span><span class=main>)</span> <span class=main>(</span>of_complex <span class=free>z2</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> cmod<span class=main>(</span><span class=free>z1</span> <span class=main>-</span> <span class=free>z2</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>z1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>z2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> real_sqrt_divide cmod_def power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> real_sqrt_mult<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Chordal_Metric-dist_fs_infinite1><span class=command>lemma</span></span> dist_fs_infinite1<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_fs <span class=main>(</span>of_complex <span class=free>z1</span><span class=main>)</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>z1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> real_sqrt_divide<span class=main>)</span>

<span class=keyword1 id=Chordal_Metric-dist_fs_infinite2><span class=command>lemma</span></span> dist_fs_infinite2<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_fs <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=main>(</span>of_complex <span class=free>z1</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>z1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> real_sqrt_divide<span class=main>)</span>

<span class=keyword1 id=Chordal_Metric-dist_fs_cvec_zero><span class=command>lemma</span></span> dist_fs_cvec_zero<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>w</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"dist_fs_cvec <span class=free>z</span> <span class=free>w</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> <span class=main>(</span>cmod <span class=main>⟨</span><span class=free>z</span><span class=main>,</span><span class=free>w</span><span class=main>⟩</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>(</span><span class=main>⟨</span><span class=free>z</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>⟨</span><span class=free>w</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms norm_cvec_gt_0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>  norm_cvec_gt_0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>w</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> dist_fs_cvec_iff<span class=main>)</span> <span class=operator>auto</span>

<span class=keyword1 id=Chordal_Metric-dist_fs_zero1><span class=command>lemma</span></span> dist_fs_zero1 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_fs <span class=free>z</span> <span class=free>z</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
     <span class=main>(</span><span class=operator>subst</span> dist_fs_cvec_zero<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>subst</span> norm_cvec_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> cmod_square<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> inprod_cvec_def<span class=main>)</span>

<span class=keyword1 id=Chordal_Metric-dist_fs_zero2><span class=command>lemma</span></span> dist_fs_zero2 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"dist_fs <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z1</span> <span class=main>=</span> <span class=free>z2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>z</span> <span class=skolem>w</span> <span class=main>::</span> <span class=quoted>complex_vec</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=skolem><span class=skolem>w1</span></span> <span class=skolem><span class=skolem>w2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>z1</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>w1</span><span class=main>,</span> <span class=skolem>w2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>w</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?x</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>z1</span><span class=main>*</span><span class=skolem>w2</span> <span class=main>-</span> <span class=skolem>w1</span><span class=main>*</span><span class=skolem>z2</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>cnj <span class=skolem>z1</span><span class=main>*</span>cnj <span class=skolem>w2</span> <span class=main>-</span> cnj <span class=skolem>w1</span><span class=main>*</span>cnj <span class=skolem>z2</span><span class=main>)</span>"</span></span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>w</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"dist_fs_cvec <span class=skolem>z</span> <span class=skolem>w</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cmod <span class=main>⟨</span><span class=skolem>z</span><span class=main>,</span><span class=skolem>w</span><span class=main>⟩</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>⟨</span><span class=skolem>z</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>⟨</span><span class=skolem>w</span><span class=main>⟩</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> dist_fs_cvec_zero<span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=var>?x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> cmod_square<span class=main>)</span> <span class=main>(</span><span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> norm_cvec_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?x</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span><span class=main>*</span><span class=skolem>w2</span> <span class=main>-</span> <span class=skolem>w1</span><span class=main>*</span><span class=skolem>z2</span>"</span></span><span class=main>]</span> zero_complex.simps
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_eq_if_Re_eq<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=var><span class=quoted><span class=var><span class=quoted><span class=var><span class=quoted><span class=var>?x</span></span></span></span></span></span></span> <span class=quoted><span class=main><span class=quoted><span class=main><span class=quoted><span class=main>0</span></span></span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>linarith</span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z1</span> <span class=main>*</span> <span class=skolem>w2</span> <span class=main>-</span> <span class=skolem>w1</span> <span class=main>*</span> <span class=skolem>z2</span> <span class=main>=</span> <span class=main>0</span> <span class=main>⟷</span> cnj <span class=skolem>z1</span> <span class=main>*</span> cnj <span class=skolem>w2</span> <span class=main>-</span> cnj <span class=skolem>w1</span> <span class=main>*</span> cnj <span class=skolem>z2</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex_cnj_diff complex_cnj_mult complex_cnj_zero_iff<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>w</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=skolem>z</span> <span class=main>≠</span> vec_zero›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>w</span> <span class=main>≠</span> vec_zero›</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_cvec_eq_mix<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z1</span></span> <span class=quoted><span class=skolem>z2</span></span> <span class=quoted><span class=skolem>w1</span></span> <span class=quoted><span class=skolem>w2</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Chordal_Metric-dist_fs_sym><span class=command>lemma</span></span> dist_fs_sym<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_fs <span class=free>z1</span> <span class=free>z2</span> <span class=main>=</span> dist_fs <span class=free>z2</span> <span class=free>z1</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> split_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Triangle inequality for Fubini-Study metric›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1 id=Chordal_Metric-dist_fs_triangle_finite><span class=command>lemma</span></span> dist_fs_triangle_finite<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cmod<span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> cmod <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> cmod <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?cc</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?bb</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?aa</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?cc</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?aa</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?bb</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> real_sqrt_gt_zero zero_compare_simps<span class=main><span class=main>(</span></span>12<span class=main><span class=main>)</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span>cnj <span class=free>c</span><span class=main>*</span><span class=free>c</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=free>a</span><span class=main>-</span><span class=free>c</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span>cnj <span class=free>c</span><span class=main>*</span><span class=free>b</span><span class=main>)</span> <span class=main>+</span> <span class=main>(</span><span class=free>c</span><span class=main>-</span><span class=free>b</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> cnj <span class=free>c</span><span class=main>*</span><span class=free>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>+</span> cnj <span class=free>c</span> <span class=main>*</span> <span class=free>c</span> <span class=main>=</span> <span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_norm_square
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span>cnj <span class=free>c</span><span class=main>*</span><span class=free>c</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> cmod<span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> norm_mult norm_of_real zero_compare_simps<span class=main><span class=main>(</span></span>12<span class=main><span class=main>)</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cmod<span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≤</span> cmod <span class=main>(</span><span class=free>a</span><span class=main>-</span><span class=free>c</span><span class=main>)</span> <span class=main>*</span> cmod <span class=main>(</span><span class=main>1</span><span class=main>+</span>cnj <span class=free>c</span><span class=main>*</span><span class=free>b</span><span class=main>)</span> <span class=main>+</span> cmod <span class=main>(</span><span class=free>c</span><span class=main>-</span><span class=free>b</span><span class=main>)</span> <span class=main>*</span> cmod<span class=main>(</span><span class=main>1</span> <span class=main>+</span> cnj <span class=free>c</span><span class=main>*</span><span class=free>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_mod_triangle_ineq2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>a</span><span class=main>-</span><span class=free>c</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span><span class=main>+</span>cnj <span class=free>c</span><span class=main>*</span><span class=free>b</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>c</span><span class=main>-</span><span class=free>b</span><span class=main>)</span><span class=main>*</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> cnj <span class=free>c</span><span class=main>*</span><span class=free>a</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> norm_mult<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>a</span> <span class=bound>b</span> <span class=bound>c</span> <span class=bound>d</span> <span class=bound>b'</span> <span class=bound>d'</span><span class=main>.</span> <span class=main>⟦</span><span class=bound>b</span> <span class=main>≤</span> <span class=bound>b'</span><span class=main>;</span> <span class=bound>d</span> <span class=main>≤</span> <span class=bound>d'</span><span class=main>;</span> <span class=bound>a</span> <span class=main>≥</span> <span class=main>(</span><span class=main>0</span><span class=main>::</span>real<span class=main>)</span><span class=main>;</span> <span class=bound>c</span> <span class=main>≥</span> <span class=main>0</span><span class=main>⟧</span> <span class=main>⟹</span> <span class=bound>a</span><span class=main>*</span><span class=bound>b</span> <span class=main>+</span> <span class=bound>c</span><span class=main>*</span><span class=bound>d</span> <span class=main>≤</span> <span class=bound>a</span><span class=main>*</span><span class=bound>b'</span> <span class=main>+</span> <span class=bound>c</span><span class=main>*</span><span class=bound>d'</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add_mono_thms_linordered_semiring<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> mult_left_mono<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>a</span><span class=main>-</span><span class=free>c</span><span class=main>)</span> <span class=main>*</span> cmod <span class=main>(</span><span class=main>1</span><span class=main>+</span>cnj <span class=free>c</span><span class=main>*</span><span class=free>b</span><span class=main>)</span> <span class=main>+</span> cmod <span class=main>(</span><span class=free>c</span><span class=main>-</span><span class=free>b</span><span class=main>)</span> <span class=main>*</span> cmod<span class=main>(</span><span class=main>1</span> <span class=main>+</span> cnj <span class=free>c</span><span class=main>*</span><span class=free>a</span><span class=main>)</span> <span class=main>≤</span> cmod <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> cmod <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *<span class=main>[</span><span class=operator>OF</span> cmod_1_plus_mult_le<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"cnj <span class=free>c</span>"</span></span> <span class=quoted><span class=free>b</span></span><span class=main><span class=main>]</span></span> cmod_1_plus_mult_le<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted>"cnj <span class=free>c</span>"</span></span> <span class=quoted><span class=free>a</span></span><span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>a</span><span class=main>-</span><span class=free>c</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>c</span><span class=main>-</span><span class=free>b</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> real_sqrt_mult<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cmod<span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> <span class=var>?cc</span> <span class=main>≤</span> cmod <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?bb</span> <span class=main>+</span> cmod <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?aa</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command><span class=improper>hence</span></span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> <span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?aa</span> <span class=main>*</span> sqrt <span class=var>?bb</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> mult_right_mono<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?aa</span>"</span></span>  <span class=quoted><span class=quoted>"sqrt <span class=var>?bb</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> mult_right_mono<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=main>0</span></span> <span class=quoted><span class=quoted>"<span class=var>?cc</span>"</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?aa</span> <span class=main>*</span> sqrt <span class=var>?bb</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?cc</span> <span class=main>/</span> <span class=var>?cc</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> sqrt <span class=var>?cc</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹sqrt <span class=var>?cc</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?cc</span> <span class=main>/</span> <span class=main>(</span><span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?aa</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=var>?aa</span> <span class=main>*</span> sqrt <span class=var>?cc</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> times_divide_eq_right<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span>sqrt <span class=var>?aa</span>"</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?cc</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?cc</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹sqrt <span class=var>?aa</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=var>?cc</span> <span class=main>/</span> <span class=main>(</span><span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?aa</span><span class=main>)</span> <span class=main>=</span> cmod <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=var>?aa</span> <span class=main>*</span> sqrt <span class=var>?cc</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> times_divide_eq_right<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?cc</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?aa</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?cc</span> <span class=main>/</span> <span class=var>?cc</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> sqrt <span class=var>?cc</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹sqrt <span class=var>?cc</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?cc</span> <span class=main>/</span> <span class=main>(</span><span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?bb</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=var>?bb</span> <span class=main>*</span> sqrt <span class=var>?cc</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> times_divide_eq_right<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>1</span><span class=main>/</span>sqrt <span class=var>?bb</span>"</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?cc</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?cc</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹sqrt <span class=var>?bb</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=var>?cc</span> <span class=main>/</span> <span class=main>(</span><span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?bb</span><span class=main>)</span> <span class=main>=</span> cmod <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=var>?bb</span> <span class=main>*</span> sqrt <span class=var>?cc</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> times_divide_eq_right<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"sqrt <span class=var>?cc</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?bb</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> divide_right_mono<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> <span class=var>?cc</span>"</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?bb</span> <span class=main>+</span> cmod <span class=main>(</span><span class=free>c</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>*</span> sqrt <span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?aa</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?cc</span> <span class=main>*</span> sqrt <span class=var>?aa</span> <span class=main>*</span> sqrt <span class=var>?bb</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹sqrt <span class=var>?aa</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹sqrt <span class=var>?bb</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹sqrt <span class=var>?cc</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add_divide_distrib<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Chordal_Metric-dist_fs_triangle_infinite1><span class=command>lemma</span></span> dist_fs_triangle_infinite1<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>/</span> sqrt<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≤</span> <span class=main>1</span> <span class=main>/</span> sqrt<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>+</span> cmod <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?bb</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?cc</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?bb</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?cc</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_strict_increasing real_sqrt_gt_0_iff zero_le_power2 zero_less_one<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?bb</span> <span class=main>*</span> <span class=var>?cc</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?cc</span> <span class=main>-</span> <span class=var>?bb</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=var>?bb</span> <span class=main>*</span> <span class=var>?cc</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> <span class=var>?bb</span> <span class=main>-</span> <span class=main>1</span> <span class=main>/</span> <span class=var>?cc</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>  <span class=quoted><span class=quoted>‹sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>/</span> <span class=var>?bb</span> <span class=main>≤</span> <span class=main>1</span> <span class=main>/</span> <span class=var>?cc</span> <span class=main>+</span> cmod <span class=main>(</span><span class=free>b</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=var>?bb</span> <span class=main>*</span> <span class=var>?cc</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> divide_right_mono<span class=main>[</span><span class=operator>OF</span> cmod_diff_ge<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>c</span></span> <span class=quoted><span class=free>b</span></span><span class=main><span class=main>]</span></span> *<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> **<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> norm_minus_commute<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Chordal_Metric-dist_fs_triangle_infinite2><span class=command>lemma</span></span> dist_fs_triangle_infinite2<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>/</span> sqrt<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≤</span> cmod <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>c</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span> <span class=main>/</span> sqrt<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>c</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> dist_fs_triangle_infinite1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>c</span></span><span class=main>]</span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

<span class=keyword1 id=Chordal_Metric-dist_fs_triangle_infinite3><span class=command>lemma</span></span> dist_fs_triangle_infinite3<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"cmod<span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span><span class=main>+</span><span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>1</span> <span class=main>/</span> sqrt<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>+</span> <span class=main>1</span> <span class=main>/</span> sqrt<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?aa</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>a</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?bb</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>b</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?aa</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?bb</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> add_strict_increasing real_sqrt_gt_0_iff zero_le_power2 zero_less_one<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=var>?aa</span> <span class=main>*</span> <span class=var>?bb</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?aa</span> <span class=main>+</span> <span class=var>?bb</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=var>?aa</span> <span class=main>*</span> <span class=var>?bb</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> <span class=var>?aa</span> <span class=main>+</span> <span class=main>1</span> <span class=main>/</span> <span class=var>?bb</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=var>?aa</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=var>?bb</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"cmod <span class=main>(</span><span class=free>a</span> <span class=main>-</span> <span class=free>b</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=var>?aa</span> <span class=main>*</span> <span class=var>?bb</span><span class=main>)</span> <span class=main>≤</span> <span class=main>1</span> <span class=main>/</span> <span class=var>?aa</span> <span class=main>+</span> <span class=main>1</span> <span class=main>/</span> <span class=var>?bb</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> divide_right_mono<span class=main>[</span><span class=operator>OF</span> cmod_diff_le<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span> <span class=quoted><span class=free>b</span></span><span class=main><span class=main>]</span></span> *<span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> **<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> norm_minus_commute<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Chordal_Metric-dist_fs_triangle><span class=command>lemma</span></span> dist_fs_triangle<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_fs <span class=free>A</span> <span class=free>B</span> <span class=main>≤</span> dist_fs <span class=free>A</span> <span class=free>C</span> <span class=main>+</span> dist_fs <span class=free>C</span> <span class=free>B</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>C</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> of_complex <span class=skolem>c</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>C</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>C</span> <span class=main>=</span> of_complex <span class=skolem>c</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_fs_infinite2 dist_fs_sym<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>=</span> of_complex <span class=skolem>b</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>B</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>C</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>=</span> of_complex <span class=skolem>b</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> of_complex <span class=skolem>c</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>C</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>=</span> of_complex <span class=skolem>b</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>C</span> <span class=main>=</span> of_complex <span class=skolem>c</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> mult_left_mono<span class=main>[</span><span class=operator>OF</span> dist_fs_triangle_infinite1<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>b</span></span> <span class=quoted><span class=skolem>c</span></span><span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=numeral>2</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_fs_finite dist_fs_infinite1 dist_fs_infinite2 dist_fs_sym<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> of_complex <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>A</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>C</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>=</span> of_complex <span class=skolem>a</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_fs_infinite2<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> of_complex <span class=skolem>c</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>C</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>C</span> <span class=main>=</span> of_complex <span class=skolem>c</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>=</span> of_complex <span class=skolem>a</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> mult_left_mono<span class=main>[</span><span class=operator>OF</span> dist_fs_triangle_infinite2<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>c</span></span><span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=numeral>2</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_fs_finite dist_fs_infinite1 dist_fs_infinite2<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>b</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>=</span> of_complex <span class=skolem>b</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>B</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>C</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>=</span> of_complex <span class=skolem>b</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>=</span> of_complex <span class=skolem>a</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> mult_left_mono<span class=main>[</span><span class=operator>OF</span> dist_fs_triangle_infinite3<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>b</span></span><span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=numeral>2</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_fs_finite dist_fs_infinite1 dist_fs_infinite2<span class=main>)</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>c</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> of_complex <span class=skolem>c</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>C</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>=</span> of_complex <span class=skolem>a</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>=</span> of_complex <span class=skolem>b</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>C</span> <span class=main>=</span> of_complex <span class=skolem>c</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> mult_left_mono<span class=main>[</span><span class=operator>OF</span> dist_fs_triangle_finite<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=skolem>b</span></span> <span class=quoted><span class=skolem>c</span></span><span class=main><span class=main>]</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=numeral>2</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_fs_finite norm_minus_commute dist_fs_sym<span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹$\mathbb{C}P^1$ with Fubini-Study metric is a metric space›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Using the (already available) fact that $\mathbb{R}^3$ is a metric space (under the distance
function $\lambda\ x\ y.\ <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>norm</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span>(x - y)$), it was not difficult to show that the type <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span>
<span class=quoted><span class=free><span class=quoted><span class=free>complex_homo</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> equipped with <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>dist_fs</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> is a metric space, i.e., an instantiation of the <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span>
<span class=quoted><span class=free><span class=quoted><span class=free>metric_space</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> locale.›</span></span>

<span class=keyword1><span class=command>instantiation</span></span> complex_homo <span class=main>::</span> <span class=quoted>metric_space</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=class_parameter>dist_complex_homo</span></span> <span class=main>=</span> dist_fs"</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=class_parameter>uniformity_complex_homo</span></span> <span class=main>::</span> <span class=main>(</span>complex_homo <span class=main>×</span> complex_homo<span class=main>)</span> filter<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>INF</span> <span class=bound>e</span><span class=main>∈</span><span class=main>{</span><span class=main>0</span><span class=main>&lt;..}</span><span class=main>.</span> principal <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> dist_class.dist <span class=bound>x</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=bound>e</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=class_parameter>open_complex_homo</span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>U</span></span></span> <span class=main>::</span> complex_homo set<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>U</span></span></span><span class=main>.</span> eventually <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>x'</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=bound>x'</span> <span class=main>=</span> <span class=bound>x</span> <span class=main>⟶</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>U</span></span></span><span class=main>)</span> uniformity<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>instance</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>::</span> <span class=quoted>complex_homo</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_class.dist <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>=</span> <span class=skolem>y</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> dist_complex_homo_def
    <span class=keyword1><span class=command>using</span></span> dist_fs_zero1<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span><span class=main>]</span> dist_fs_zero2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>y</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>complex_homo</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"dist_class.dist <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>≤</span> dist_class.dist <span class=skolem>x</span> <span class=skolem>z</span> <span class=main>+</span> dist_class.dist <span class=skolem>y</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> dist_complex_homo_def
    <span class=keyword1><span class=command>using</span></span> dist_fs_triangle<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>y</span></span> <span class=quoted><span class=skolem>z</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_fs_sym<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> open_complex_homo_def uniformity_complex_homo_def<span class=main>)</span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Chordal distance on the Riemann sphere›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Distance of the two points is given by the length of the chord. We show that it corresponds to
the Fubini-Study metric in the plane.›</span></span>

<span class=keyword1><span class=command>definition</span></span> <span class=entity>dist_riemann_sphere_r3</span> <span class=main>::</span> <span class=quoted><span class=quoted>"R3 <span class=main>⇒</span> R3 <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=quoted><span class=quoted>"<span class=free>dist_riemann_sphere_r3</span> <span class=free><span class=bound><span class=entity>M1</span></span></span> <span class=free><span class=bound><span class=entity>M2</span></span></span> <span class=main>=</span>
     <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>x1</span><span class=main>,</span> <span class=bound>y1</span><span class=main>,</span> <span class=bound>z1</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>M1</span></span></span><span class=main>;</span>
          <span class=main>(</span><span class=bound>x2</span><span class=main>,</span> <span class=bound>y2</span><span class=main>,</span> <span class=bound>z2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>M2</span></span></span>
       <span class=keyword1>in</span> norm <span class=main>(</span><span class=bound>x1</span> <span class=main>-</span> <span class=bound>x2</span><span class=main>,</span> <span class=bound>y1</span> <span class=main>-</span> <span class=bound>y2</span><span class=main>,</span> <span class=bound>z1</span> <span class=main>-</span> <span class=bound>z2</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Chordal_Metric-dist_riemann_sphere_r3_inner><span class=command>lemma</span></span> dist_riemann_sphere_r3_inner<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>M1</span> <span class=main>∈</span> unit_sphere"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>M2</span> <span class=main>∈</span> unit_sphere"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span>dist_riemann_sphere_r3 <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> inner <span class=free>M1</span> <span class=free>M2</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>M1</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=free>M2</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> norm_prod_def<span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>


<span class=keyword1><span class=command>lift_definition</span></span> dist_riemann_sphere' <span class=main>::</span> <span class=quoted><span class=quoted>"riemann_sphere <span class=main>⇒</span> riemann_sphere <span class=main>⇒</span> real"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>dist_riemann_sphere_r3</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1 id=Chordal_Metric-dist_riemann_sphere_ge_0><span class=command>lemma</span></span> dist_riemann_sphere_ge_0 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command>using</span></span> norm_ge_zero
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> split_def Let_def<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Using stereographic projection we prove the connection between chordal metric on the spehere
and Fubini-Study metric in the plane.›</span></span>

<span class=keyword1 id=Chordal_Metric-dist_stereographic_finite><span class=command>lemma</span></span> dist_stereographic_finite<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M1</span> <span class=main>=</span> of_complex <span class=free>m1</span>"</span></span>  <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M2</span> <span class=main>=</span> of_complex <span class=free>m2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> cmod <span class=main>(</span><span class=free>m1</span> <span class=main>-</span> <span class=free>m2</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>M1</span> <span class=main>=</span> inv_stereographic <span class=main>(</span>of_complex <span class=free>m1</span><span class=main>)</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=free>M2</span> <span class=main>=</span> inv_stereographic <span class=main>(</span>of_complex <span class=free>m2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inv_stereographic_is_inv assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inv_stereographic_stereographic<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> power2_less_0<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> realpow_square_minus_le<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> norm_mult_less norm_zero power2_eq_square zero_power2<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> ++<span class=main>:</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> cmod <span class=free>m1</span> <span class=main>*</span> cmod <span class=free>m1</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> cmod <span class=free>m2</span> <span class=main>*</span> cmod <span class=free>m2</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> real_sqrt_gt_0_iff
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> cmod <span class=main>(</span><span class=free>m1</span> <span class=main>-</span> <span class=free>m2</span><span class=main>)</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> cmod <span class=free>m1</span> <span class=main>*</span> cmod <span class=free>m1</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> cmod <span class=free>m2</span> <span class=main>*</span> cmod <span class=free>m2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>⟷</span> cmod <span class=main>(</span><span class=free>m1</span> <span class=main>-</span> <span class=free>m2</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> diff_self divide_nonneg_pos mult_2 norm_ge_zero norm_triangle_ineq4 norm_zero<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>cmod <span class=main>(</span><span class=free>m1</span> <span class=main>-</span> <span class=free>m2</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>m1</span> <span class=skolem>m2</span> <span class=skolem>M1</span> <span class=skolem>M2</span>
    <span class=keyword3><span class=command>assume</span></span> us<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>M1</span> <span class=main>∈</span> unit_sphere"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M2</span> <span class=main>∈</span> unit_sphere"</span></span> <span class=keyword2><span class=keyword>and</span></span>
        *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>M1</span> <span class=main>=</span> inv_stereographic_cvec_r3 <span class=main>(</span>of_complex_cvec <span class=skolem>m1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M2</span> <span class=main>=</span> inv_stereographic_cvec_r3 <span class=main>(</span>of_complex_cvec <span class=skolem>m2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>  <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> power2_less_0<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_riemann_sphere_r3 <span class=skolem>M1</span> <span class=skolem>M2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span>
          <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>cmod <span class=main>(</span><span class=skolem>m1</span> <span class=main>-</span> <span class=skolem>m2</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> dist_riemann_sphere_r3_inner<span class=main><span class=main>[</span></span><span class=operator>OF</span> us<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_riemann_sphere_r3_inner<span class=main><span class=main>[</span></span><span class=operator>OF</span> us<span class=main><span class=main>]</span></span> complex_mult_cnj_cmod<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> left_diff_distrib<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=numeral><span class=quoted><span class=numeral>2</span></span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> left_diff_distrib<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=quoted><span class=quoted>"<span class=numeral><span class=numeral>2</span></span><span class=main><span class=main>*</span></span><span class=main><span class=main>(</span></span><span class=main><span class=main>1</span></span><span class=main><span class=main>+</span></span><span class=main><span class=main>(</span></span>cmod <span class=skolem><span class=skolem>m1</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main><span class=hidden>⇧</span><sup>2</sup></span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> distrib_right<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=main><span class=main>1</span></span> <span class=main><span class=main>+</span></span> <span class=main><span class=main>(</span></span>cmod <span class=skolem><span class=skolem>m1</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main><span class=hidden>⇧</span><sup>2</sup></span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> distrib_right<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=main><span class=main>1</span></span> <span class=main><span class=main>+</span></span> <span class=main><span class=main>(</span></span>cmod <span class=skolem><span class=skolem>m1</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main><span class=hidden>⇧</span><sup>2</sup></span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> distrib_right<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=main><span class=main>1</span></span> <span class=main><span class=main>+</span></span> <span class=main><span class=main>(</span></span>cmod <span class=skolem><span class=skolem>m2</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main><span class=hidden>⇧</span><sup>2</sup></span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> distrib_right<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=main><span class=main>1</span></span> <span class=main><span class=main>+</span></span> <span class=main><span class=main>(</span></span>cmod <span class=skolem><span class=skolem>m2</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main><span class=hidden>⇧</span><sup>2</sup></span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> distrib_right<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=main><span class=main>_</span></span> <span class=main><span class=main>_</span></span> <span class=quoted><span class=quoted><span class=quoted>"<span class=main><span class=main>(</span></span><span class=main><span class=main>1</span></span> <span class=main><span class=main>+</span></span> <span class=main><span class=main>(</span></span>cmod <span class=skolem><span class=skolem>m2</span></span><span class=main><span class=main>)</span></span><span class=main><span class=main><span class=hidden>⇧</span><sup>2</sup></span></span><span class=main><span class=main>)</span></span>"</span></span></span><span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> cmod_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>cmod <span class=main>(</span><span class=free>m1</span> <span class=main>-</span> <span class=free>m2</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>  <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> eq_divide_imp<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>cmod <span class=main>(</span><span class=free>m1</span> <span class=main>-</span> <span class=free>m2</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>*</span> cmod <span class=main>(</span><span class=free>m1</span> <span class=main>-</span> <span class=free>m2</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> power2_eq_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span>cmod <span class=main>(</span><span class=free>m1</span> <span class=main>-</span> <span class=free>m2</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>  <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square real_sqrt_mult<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> dist_riemann_sphere_ge_0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M1</span></span> <span class=quoted><span class=free>M2</span></span><span class=main>]</span> **
    <span class=keyword1><span class=command>using</span></span> ++ divide_le_0_iff <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1 id=Chordal_Metric-dist_stereographic_infinite><span class=command>lemma</span></span> dist_stereographic_infinite<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M1</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M2</span> <span class=main>=</span> of_complex <span class=free>m2</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>M1</span> <span class=main>=</span> inv_stereographic <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>  <span class=quoted><span class=quoted>"<span class=free>M2</span> <span class=main>=</span> inv_stereographic <span class=main>(</span>of_complex <span class=free>m2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inv_stereographic_is_inv assms
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> inv_stereographic_stereographic<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> power2_less_0<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> realpow_square_minus_le<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> cmod <span class=free>m2</span> <span class=main>*</span> cmod <span class=free>m2</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> real_sqrt_gt_0_iff
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> cmod <span class=free>m2</span> <span class=main>*</span> cmod <span class=free>m2</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=numeral>4</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>transfer</span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M1</span> <span class=skolem>M2</span> <span class=skolem>m2</span>
    <span class=keyword3><span class=command>assume</span></span> us<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>M1</span> <span class=main>∈</span> unit_sphere"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M2</span> <span class=main>∈</span> unit_sphere"</span></span> <span class=keyword2><span class=keyword>and</span></span>
           *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>M1</span> <span class=main>=</span> inv_stereographic_cvec_r3 <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M2</span> <span class=main>=</span> inv_stereographic_cvec_r3 <span class=main>(</span>of_complex_cvec <span class=skolem>m2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> power2_less_0<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_riemann_sphere_r3 <span class=skolem>M1</span> <span class=skolem>M2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=numeral>4</span>"</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> dist_riemann_sphere_r3_inner<span class=main><span class=main>[</span></span><span class=operator>OF</span> us<span class=main><span class=main>]</span></span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod<span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> left_diff_distrib<span class=main><span class=main>[</span></span><span class=operator>of</span> <span class=quoted><span class=numeral><span class=quoted><span class=numeral>2</span></span></span></span><span class=main><span class=main>]</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=numeral>4</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> power2_eq_iff<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span>"</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=free>m2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square real_sqrt_mult<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>using</span></span> dist_riemann_sphere_ge_0<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M1</span></span> <span class=quoted><span class=free>M2</span></span><span class=main>]</span> **
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Chordal_Metric-dist_rieman_sphere_zero><span class=command>lemma</span></span> dist_rieman_sphere_zero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere' <span class=free>M</span> <span class=free>M</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=operator>transfer</span> <span class=operator>auto</span>

<span class=keyword1 id=Chordal_Metric-dist_riemann_sphere_sym><span class=command>lemma</span></span> dist_riemann_sphere_sym<span class=main>:</span> 
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span> <span class=main>=</span> dist_riemann_sphere' <span class=free>M2</span> <span class=free>M1</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M1</span> <span class=skolem>M2</span> <span class=main>::</span> <span class=quoted>R3</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x1</span></span> <span class=skolem><span class=skolem>y1</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>x2</span></span> <span class=skolem><span class=skolem>y2</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=keyword2><span class=keyword>where</span></span> MM<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x1</span><span class=main>,</span> <span class=skolem>y1</span><span class=main>,</span> <span class=skolem>z1</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>M1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x2</span><span class=main>,</span> <span class=skolem>y2</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>M2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>M1</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>M2</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere_r3 <span class=skolem>M1</span> <span class=skolem>M2</span> <span class=main>=</span> dist_riemann_sphere_r3 <span class=skolem>M2</span> <span class=skolem>M1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> norm_minus_cancel<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x1</span> <span class=main>-</span> <span class=skolem>x2</span><span class=main>,</span> <span class=skolem>y1</span> <span class=main>-</span> <span class=skolem>y2</span><span class=main>,</span> <span class=skolem>z1</span> <span class=main>-</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span><span class=main>]</span> MM<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Central theorem that connects the two metrics.›</span></span>
<span class=keyword1 id=Chordal_Metric-dist_stereographic><span class=command>lemma</span></span> dist_stereographic<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere' <span class=free>M1</span> <span class=free>M2</span> <span class=main>=</span> dist_fs <span class=main>(</span>stereographic <span class=free>M1</span><span class=main>)</span> <span class=main>(</span>stereographic <span class=free>M2</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>M1</span> <span class=main>=</span> North"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M1</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> stereographic_North<span class=main>)</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>M2</span> <span class=main>=</span> North"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>M1</span> <span class=main>=</span> North›</span></span> <span class=quoted><span class=quoted>‹<span class=free>M2</span> <span class=main>=</span> North›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M2</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> stereographic_North<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>M2</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M2</span> <span class=main>=</span> of_complex <span class=skolem>m2</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"stereographic <span class=free>M2</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹stereographic <span class=free>M2</span> <span class=main>=</span> of_complex <span class=skolem>m2</span>›</span></span> <span class=quoted><span class=quoted>‹stereographic <span class=free>M1</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> dist_fs_infinite1 dist_stereographic_infinite
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_fs_sym<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M1</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> stereographic_North<span class=main>)</span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m1</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M1</span> <span class=main>=</span> of_complex <span class=skolem>m1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"stereographic <span class=free>M1</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>M2</span> <span class=main>=</span> North"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M2</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> stereographic_North<span class=main>)</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹stereographic <span class=free>M1</span> <span class=main>=</span> of_complex <span class=skolem>m1</span>›</span></span> <span class=quoted><span class=quoted>‹stereographic <span class=free>M2</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> dist_fs_infinite2 dist_stereographic_infinite
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> dist_riemann_sphere_sym<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_fs_sym<span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M2</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> stereographic_North<span class=main>)</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>m2</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"stereographic <span class=free>M2</span> <span class=main>=</span> of_complex <span class=skolem>m2</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"stereographic <span class=free>M2</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹stereographic <span class=free>M1</span> <span class=main>=</span> of_complex <span class=skolem>m1</span>›</span></span> <span class=quoted><span class=quoted>‹stereographic <span class=free>M2</span> <span class=main>=</span> of_complex <span class=skolem>m2</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> dist_fs_finite dist_stereographic_finite
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Other direction›</span></span>
<span class=keyword1 id="Chordal_Metric-dist_stereographic'"><span class=command>lemma</span></span> dist_stereographic'<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_fs <span class=free>A</span> <span class=free>B</span> <span class=main>=</span> dist_riemann_sphere' <span class=main>(</span>inv_stereographic <span class=free>A</span><span class=main>)</span> <span class=main>(</span>inv_stereographic <span class=free>B</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> dist_stereographic<span class=main>)</span> <span class=main>(</span><span class=operator>metis</span> stereographic_inv_stereographic<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>riemann_sphere</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> equipped with <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=quoted>dist_riemann_sphere'</span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> is a metric space, i.e.,
an instantiation of the <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>metric_space</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> locale.›</span></span>

<span class=keyword1><span class=command>instantiation</span></span> riemann_sphere <span class=main>::</span> <span class=quoted>metric_space</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=class_parameter>dist_riemann_sphere</span></span> <span class=main>=</span> dist_riemann_sphere'"</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free><span class=class_parameter>uniformity_riemann_sphere</span></span> <span class=main>::</span> <span class=main>(</span>riemann_sphere <span class=main>×</span> riemann_sphere<span class=main>)</span> filter<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=keyword1>INF</span> <span class=bound>e</span><span class=main>∈</span><span class=main>{</span><span class=main>0</span><span class=main>&lt;..}</span><span class=main>.</span> principal <span class=main>{</span><span class=main>(</span><span class=bound>x</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> dist_class.dist <span class=bound>x</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=bound>e</span><span class=main>}</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=quoted><span class=quoted>"<span class=free><span class=class_parameter>open_riemann_sphere</span></span> <span class=main>(</span><span class=free><span class=bound><span class=entity>U</span></span></span> <span class=main>::</span> riemann_sphere set<span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=main>∀</span> <span class=bound>x</span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>U</span></span></span><span class=main>.</span> eventually <span class=main>(</span><span class=main>λ</span><span class=main>(</span><span class=bound>x'</span><span class=main>,</span> <span class=bound>y</span><span class=main>)</span><span class=main>.</span> <span class=bound>x'</span> <span class=main>=</span> <span class=bound>x</span> <span class=main>⟶</span> <span class=bound>y</span> <span class=main>∈</span> <span class=free><span class=bound><span class=entity>U</span></span></span><span class=main>)</span> uniformity<span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>instance</span></span>
<span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>::</span> <span class=quoted>riemann_sphere</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_class.dist <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>=</span> <span class=skolem>y</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> dist_riemann_sphere_def
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>::</span> <span class=quoted>R3</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x1</span></span> <span class=skolem><span class=skolem>y1</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>x2</span></span> <span class=skolem><span class=skolem>y2</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x1</span><span class=main>,</span> <span class=skolem>y1</span><span class=main>,</span> <span class=skolem>z1</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>x</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x2</span><span class=main>,</span> <span class=skolem>y2</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>y</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>x</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=skolem>y</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> unit_sphere"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>∈</span> unit_sphere"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_riemann_sphere_r3 <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>=</span> <span class=main>0</span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span> <span class=main>=</span> <span class=skolem>y</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> norm_eq_zero<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x1</span> <span class=main>-</span> <span class=skolem>y2</span><span class=main>,</span> <span class=skolem>y1</span> <span class=main>-</span> <span class=skolem>y2</span><span class=main>,</span> <span class=skolem>z1</span> <span class=main>-</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span><span class=main>]</span> <span class=keyword1><span class=command>using</span></span> *<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> zero_prod_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>riemann_sphere</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"dist_class.dist <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>≤</span> dist_class.dist <span class=skolem>x</span> <span class=skolem>z</span> <span class=main>+</span> dist_class.dist <span class=skolem>y</span> <span class=skolem>z</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> dist_riemann_sphere_def
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span> <span class=skolem>y</span> <span class=skolem>z</span> <span class=main>::</span> <span class=quoted>R3</span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x1</span></span> <span class=skolem><span class=skolem>y1</span></span> <span class=skolem><span class=skolem>z1</span></span> <span class=skolem><span class=skolem>x2</span></span> <span class=skolem><span class=skolem>y2</span></span> <span class=skolem><span class=skolem>z2</span></span> <span class=skolem><span class=skolem>x3</span></span> <span class=skolem><span class=skolem>y3</span></span> <span class=skolem><span class=skolem>z3</span></span> <span class=keyword2><span class=keyword>where</span></span> MM<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x1</span><span class=main>,</span> <span class=skolem>y1</span><span class=main>,</span> <span class=skolem>z1</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>x</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x2</span><span class=main>,</span> <span class=skolem>y2</span><span class=main>,</span> <span class=skolem>z2</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>y</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x3</span><span class=main>,</span> <span class=skolem>y3</span><span class=main>,</span> <span class=skolem>z3</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>z</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>y</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>z</span>"</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>∈</span> unit_sphere"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>∈</span> unit_sphere"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>∈</span> unit_sphere"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere_r3 <span class=skolem>x</span> <span class=skolem>y</span> <span class=main>≤</span> dist_riemann_sphere_r3 <span class=skolem>x</span> <span class=skolem>z</span> <span class=main>+</span> dist_riemann_sphere_r3 <span class=skolem>y</span> <span class=skolem>z</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> MM<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> norm_minus_cancel<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x3</span> <span class=main>-</span> <span class=skolem>x2</span><span class=main>,</span> <span class=skolem>y3</span> <span class=main>-</span> <span class=skolem>y2</span><span class=main>,</span> <span class=skolem>z3</span> <span class=main>-</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span><span class=main>]</span> norm_triangle_ineq<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x1</span> <span class=main>-</span> <span class=skolem>x3</span><span class=main>,</span> <span class=skolem>y1</span> <span class=main>-</span> <span class=skolem>y3</span><span class=main>,</span> <span class=skolem>z1</span> <span class=main>-</span> <span class=skolem>z3</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>x3</span> <span class=main>-</span> <span class=skolem>x2</span><span class=main>,</span> <span class=skolem>y3</span> <span class=main>-</span> <span class=skolem>y2</span><span class=main>,</span> <span class=skolem>z3</span> <span class=main>-</span> <span class=skolem>z2</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span> <span class=main>(</span><span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> uniformity_riemann_sphere_def open_riemann_sphere_def<span class=main>)</span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>riemann_sphere</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> metric space is perfect, i.e., it does not have isolated points.›</span></span>
<span class=keyword1><span class=command>instantiation</span></span> riemann_sphere <span class=main>::</span> <span class=quoted>perfect_space</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span> <span class=main>::</span> <span class=quoted>riemann_sphere</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> open <span class=main>{</span><span class=skolem>M</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> open_dist dist_riemann_sphere_def
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> dist_riemann_sphere_sym<span class=main>)</span>
  <span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>M</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>∈</span> unit_sphere"</span></span>
    <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>x</span></span> <span class=skolem><span class=skolem>y</span></span> <span class=skolem><span class=skolem>z</span></span> <span class=keyword2><span class=keyword>where</span></span> MM<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>x</span><span class=main>,</span> <span class=skolem>y</span><span class=main>,</span> <span class=skolem>z</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=skolem>M</span>"</span></span><span class=main>)</span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>α</span></span> <span class=skolem><span class=skolem>β</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>x</span> <span class=main>=</span> cos <span class=skolem>α</span> <span class=main>*</span> cos <span class=skolem>β</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>y</span> <span class=main>=</span> cos <span class=skolem>α</span> <span class=main>*</span> sin <span class=skolem>β</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>z</span> <span class=main>=</span> sin <span class=skolem>α</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>≤</span> <span class=skolem>α</span> <span class=main>∧</span> <span class=skolem>α</span> <span class=main>≤</span> pi <span class=main>/</span> <span class=numeral>2</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>M</span> <span class=main>∈</span> unit_sphere›</span></span>
      <span class=keyword1><span class=command>using</span></span> ex_sphere_params<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>x</span></span> <span class=quoted><span class=skolem>y</span></span> <span class=quoted><span class=skolem>z</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>⋀</span> <span class=bound>e</span><span class=main>.</span> <span class=bound>e</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span><span class=main>∃</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>∈</span> unit_sphere <span class=main>∧</span> dist_riemann_sphere_r3 <span class=skolem>M</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=bound>e</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>≠</span> <span class=skolem>M</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
      <span class=keyword3><span class=command>fix</span></span> <span class=skolem>e</span> <span class=main>::</span> <span class=quoted>real</span>
      <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>e</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>α'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>-</span> <span class=main>(</span><span class=skolem>e</span><span class=main>*</span><span class=skolem>e</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span> <span class=main>&lt;</span> cos <span class=main>(</span><span class=skolem>α</span> <span class=main>-</span> <span class=skolem>α'</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>α</span> <span class=main>≠</span> <span class=skolem>α'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span>pi<span class=main>/</span><span class=numeral>2</span> <span class=main>≤</span> <span class=skolem>α'</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>α'</span> <span class=main>≤</span> pi<span class=main>/</span><span class=numeral>2</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> ex_cos_gt<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>α</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>-</span> <span class=main>(</span><span class=skolem>e</span><span class=main>*</span><span class=skolem>e</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=main>-</span> pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>≤</span> <span class=skolem>α</span> <span class=main>∧</span> <span class=skolem>α</span> <span class=main>≤</span> pi <span class=main>/</span> <span class=numeral>2</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"sin <span class=skolem>α</span> <span class=main>≠</span> sin <span class=skolem>α'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>-</span>pi <span class=main>/</span> <span class=numeral>2</span> <span class=main>≤</span> <span class=skolem>α</span> <span class=main>∧</span> <span class=skolem>α</span> <span class=main>≤</span> pi <span class=main>/</span> <span class=numeral>2</span>›</span></span> sin_inj<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>α</span></span> <span class=quoted><span class=skolem>α'</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> cos <span class=main>(</span><span class=skolem>α</span> <span class=main>-</span> <span class=skolem>α'</span><span class=main>)</span> <span class=main>&lt;</span> <span class=skolem>e</span><span class=main>*</span><span class=skolem>e</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> mult_strict_right_mono<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>-</span> <span class=main>(</span><span class=skolem>e</span><span class=main>*</span><span class=skolem>e</span><span class=main>/</span><span class=numeral>2</span><span class=main>)</span> <span class=main>&lt;</span> cos <span class=main>(</span><span class=skolem>α</span> <span class=main>-</span> <span class=skolem>α'</span><span class=main>)</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=numeral>2</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> cos <span class=main>(</span><span class=skolem>α</span> <span class=main>-</span> <span class=skolem>α'</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> cos_le_one<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>α</span> <span class=main>-</span> <span class=skolem>α'</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>algebra_split_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?M'</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span>cos <span class=skolem>α'</span> <span class=main>*</span> cos <span class=skolem>β</span><span class=main>,</span>  cos <span class=skolem>α'</span> <span class=main>*</span> sin <span class=skolem>β</span><span class=main>,</span> sin <span class=skolem>α'</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere_r3 <span class=skolem>M</span> <span class=var>?M'</span> <span class=main>=</span> sqrt <span class=main>(</span><span class=main>(</span>cos <span class=skolem>α</span> <span class=main>-</span> cos <span class=skolem>α'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span>sin <span class=skolem>α</span> <span class=main>-</span> sin <span class=skolem>α'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> MM * sphere_params_on_sphere<span class=main>[</span><span class=operator>of</span> <span class=main>_</span> <span class=quoted><span class=skolem>α'</span></span> <span class=quoted><span class=skolem>β</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>using</span></span> sin_cos_squared_add<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>β</span></span><span class=main>]</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_riemann_sphere'_def Abs_riemann_sphere_inverse norm_prod_def<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> left_diff_distrib<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> power_mult_distrib<span class=main>)</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> distrib_left<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
      <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>...</span> <span class=main>=</span> sqrt <span class=main>(</span><span class=numeral>2</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span>cos <span class=main>(</span><span class=skolem>α</span> <span class=main>-</span> <span class=skolem>α'</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span> cos_diff<span class=main>)</span>
      <span class=keyword1><span class=command>finally</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_riemann_sphere_r3 <span class=skolem>M</span> <span class=var>?M'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=numeral>2</span> <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span>cos <span class=main>(</span><span class=skolem>α</span> <span class=main>-</span> <span class=skolem>α'</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> cos <span class=main>(</span><span class=skolem>α</span> <span class=main>-</span> <span class=skolem>α'</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>dist_riemann_sphere_r3 <span class=skolem>M</span> <span class=var>?M'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>&lt;</span> <span class=skolem>e</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>2</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> cos <span class=main>(</span><span class=skolem>α</span> <span class=main>-</span> <span class=skolem>α'</span><span class=main>)</span> <span class=main>&lt;</span> <span class=skolem>e</span><span class=main>*</span><span class=skolem>e</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"dist_riemann_sphere_r3 <span class=skolem>M</span> <span class=var>?M'</span> <span class=main>&lt;</span> <span class=skolem>e</span>"</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule</span> power2_less_imp_less<span class=main>)</span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>e</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>M</span> <span class=main>≠</span> <span class=var>?M'</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> MM  <span class=quoted><span class=quoted>‹sin <span class=skolem>α</span> <span class=main>≠</span> sin <span class=skolem>α'</span>›</span></span> *
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?M'</span> <span class=main>∈</span> unit_sphere"</span></span>
        <span class=keyword1><span class=command>using</span></span> sphere_params_on_sphere <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span><span class=bound>y</span><span class=main>.</span> <span class=bound>y</span> <span class=main>∈</span> unit_sphere <span class=main>∧</span> dist_riemann_sphere_r3 <span class=skolem>M</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=skolem>e</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>≠</span> <span class=skolem>M</span>"</span></span>
        <span class=keyword1><span class=command>unfolding</span></span> dist_riemann_sphere_def
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"<span class=var>?M'</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=main>{</span><span class=skolem>M</span><span class=main>}</span><span class=main>.</span> <span class=main>∃</span><span class=bound><span class=bound>e</span></span><span class=main>&gt;</span><span class=main>0</span><span class=main>.</span> <span class=main>∀</span><span class=bound>y</span><span class=main>∈</span><span class=main>{</span><span class=bound>x</span><span class=main>.</span> <span class=bound>x</span> <span class=main>∈</span> unit_sphere<span class=main>}</span><span class=main>.</span> dist_riemann_sphere_r3 <span class=bound>x</span> <span class=bound>y</span> <span class=main>&lt;</span> <span class=bound>e</span> <span class=main>⟶</span> <span class=bound>y</span> <span class=main>∈</span> <span class=main>{</span><span class=skolem>M</span><span class=main>}</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>
<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The <span class=antiquoted><span class=antiquoted><span class=antiquote><span class=antiquote>@{</span></span><span class=operator><span class=operator>term</span></span> <span class=quoted><span class=free><span class=quoted><span class=free>complex_homo</span></span></span></span><span class=antiquote><span class=antiquote>}</span></span></span></span> metric space is perfect, i.e., it does not have isolated points.›</span></span>
<span class=keyword1><span class=command>instantiation</span></span> complex_homo <span class=main>::</span> <span class=quoted>perfect_space</span>
<span class=keyword2><span class=keyword>begin</span></span>
<span class=keyword1><span class=command>instance</span></span> <span class=keyword1><span class=command>proof</span></span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>x</span><span class=main>::</span><span class=quoted>complex_homo</span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"<span class=main>¬</span> open <span class=main>{</span><span class=skolem>x</span><span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>unfolding</span></span> open_dist
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>auto</span><span class=main>)</span>
    <span class=keyword3><span class=command>fix</span></span> <span class=skolem>e</span><span class=main>::</span><span class=quoted>real</span>
    <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>e</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword3><span class=command>thus</span></span> <span class=quoted><span class=quoted>"<span class=main>∃</span> <span class=bound>y</span><span class=main>.</span> dist_class.dist <span class=bound>y</span> <span class=skolem>x</span> <span class=main>&lt;</span> <span class=skolem>e</span> <span class=main>∧</span> <span class=bound>y</span> <span class=main>≠</span> <span class=skolem>x</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> not_open_singleton<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"inv_stereographic <span class=skolem>x</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>unfolding</span></span> open_dist
      <span class=keyword1><span class=command>unfolding</span></span> dist_complex_homo_def dist_riemann_sphere_def
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> dist_stereographic'<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>erule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=skolem>e</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> allE<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"stereographic <span class=improper>y</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>

<span class=keyword1 id=Chordal_Metric-Lim_within><span class=command>lemma</span></span> Lim_within<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>f</span> <span class=main>⤏</span> <span class=free>l</span><span class=main>)</span> <span class=main>(</span><span class=keyword1>at</span> <span class=free>a</span> <span class=keyword1>within</span> <span class=free>S</span><span class=main>)</span> <span class=main>⟷</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound><span class=bound>e</span></span> <span class=main>&gt;</span><span class=main>0</span><span class=main>.</span> <span class=main>∃</span><span class=bound><span class=bound>d</span></span><span class=main>&gt;</span><span class=main>0</span><span class=main>.</span> <span class=main>∀</span><span class=bound>x</span> <span class=main>∈</span> <span class=free>S</span><span class=main>.</span> <span class=main>0</span> <span class=main>&lt;</span> dist_class.dist <span class=bound>x</span> <span class=free>a</span> <span class=main>∧</span> dist_class.dist <span class=bound>x</span> <span class=free>a</span>  <span class=main>&lt;</span> <span class=bound>d</span> <span class=main>⟶</span> dist_class.dist <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span> <span class=free>l</span> <span class=main>&lt;</span> <span class=bound>e</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span><span class=main><span class=main>:</span></span> tendsto_iff eventually_at<span class=main>)</span>

<span class=keyword1 id=Chordal_Metric-continuous_on_iff><span class=command>lemma</span></span> continuous_on_iff<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"continuous_on <span class=free>s</span> <span class=free>f</span> <span class=main>⟷</span>
    <span class=main>(</span><span class=main>∀</span><span class=bound>x</span><span class=main>∈</span><span class=free>s</span><span class=main>.</span> <span class=main>∀</span><span class=bound><span class=bound>e</span></span><span class=main>&gt;</span><span class=main>0</span><span class=main>.</span> <span class=main>∃</span><span class=bound><span class=bound>d</span></span><span class=main>&gt;</span><span class=main>0</span><span class=main>.</span> <span class=main>∀</span><span class=bound>x'</span><span class=main>∈</span><span class=free>s</span><span class=main>.</span> dist_class.dist <span class=bound>x'</span> <span class=bound>x</span> <span class=main>&lt;</span> <span class=bound>d</span> <span class=main>⟶</span> dist_class.dist <span class=main>(</span><span class=free>f</span> <span class=bound>x'</span><span class=main>)</span> <span class=main>(</span><span class=free>f</span> <span class=bound>x</span><span class=main>)</span> <span class=main>&lt;</span> <span class=bound>e</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>unfolding</span></span> continuous_on_def Lim_within
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> dist_pos_lt dist_self<span class=main>)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Using the chordal metric in the extended plane, and the Euclidean metric on the sphere in
$\mathbb{R}^3$, the stereographic and inverse stereographic projections are proved to be
continuous.›</span></span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"continuous_on UNIV stereographic"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> continuous_on_iff
<span class=keyword1><span class=command>unfolding</span></span> dist_complex_homo_def dist_riemann_sphere_def
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> dist_stereographic'<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span> <span class=quoted><span class=quoted>"continuous_on UNIV inv_stereographic"</span></span>
<span class=keyword1><span class=command>unfolding</span></span> continuous_on_iff
<span class=keyword1><span class=command>unfolding</span></span> dist_complex_homo_def dist_riemann_sphere_def
<span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> dist_stereographic<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>

<span class=comment1>(* -------------------------------------------------------------------------- *)</span>
<span class=keyword1><span class=command>subsubsection</span></span> <span class=quoted><span class=plain_text>‹Chordal circles›</span></span>
<span class=comment1>(* -------------------------------------------------------------------------- *)</span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Real circlines are sets of points that are equidistant from some given point in the chordal
metric. There are exactly two such points (two chordal centers). On the Riemann sphere, these two
points are obtained as intersections of the sphere and a line that goes trough center of the circle,
and its orthogonal to its plane.›</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹The circline for the given chordal center and radius.›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>chordal_circle_cvec_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_vec <span class=main>⇒</span> real <span class=main>⇒</span> complex_mat"</span></span> <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>chordal_circle_cvec_cmat</span> <span class=free><span class=bound><span class=entity>a</span></span></span> <span class=free><span class=bound><span class=entity>r</span></span></span> <span class=main>=</span>
           <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>a1</span><span class=main>,</span> <span class=bound>a2</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>a</span></span></span>
             <span class=keyword1>in</span> <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=bound>a2</span><span class=main>*</span>cnj <span class=bound>a2</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>*</span><span class=main>(</span><span class=bound>a1</span><span class=main>*</span>cnj <span class=bound>a1</span> <span class=main>+</span> <span class=bound>a2</span><span class=main>*</span>cnj <span class=bound>a2</span><span class=main>)</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=main>-</span><span class=numeral>4</span><span class=main>*</span><span class=bound>a1</span><span class=main>*</span>cnj <span class=bound>a2</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=main>-</span><span class=numeral>4</span><span class=main>*</span>cnj <span class=bound>a1</span><span class=main>*</span><span class=bound>a2</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=bound>a1</span><span class=main>*</span>cnj <span class=bound>a1</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free><span class=bound><span class=entity>r</span></span></span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>*</span><span class=main>(</span><span class=bound>a1</span><span class=main>*</span>cnj <span class=bound>a1</span> <span class=main>+</span> <span class=bound>a2</span><span class=main>*</span>cnj <span class=bound>a2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1 id=Chordal_Metric-chordal_circle_cmat_hermitean_nonzero><span class=command>lemma</span></span> chordal_circle_cmat_hermitean_nonzero <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"chordal_circle_cvec_cmat <span class=free>a</span> <span class=free>r</span> <span class=main>∈</span> hermitean_nonzero"</span></span>
  <span class=keyword1><span class=command>using</span></span> assms
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=free>a</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def Let_def<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> chordal_circle_hcoords_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo_coords <span class=main>⇒</span> real <span class=main>⇒</span> circline_mat"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>chordal_circle_cvec_cmat</span>
  <span class=keyword1><span class=command>using</span></span> chordal_circle_cmat_hermitean_nonzero
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> chordal_circle_cvec_cmat_def<span class=main>)</span>

<span class=keyword1><span class=command>lift_definition</span></span> chordal_circle <span class=main>::</span> <span class=quoted><span class=quoted>"complex_homo <span class=main>⇒</span> real <span class=main>⇒</span> circline"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>chordal_circle_hcoords_clmat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>a</span> <span class=skolem>b</span> <span class=main>::</span> <span class=quoted>complex_vec</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>r</span> <span class=main>::</span> <span class=quoted>real</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> vec_zero"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>≠</span> vec_zero"</span></span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a1</span></span> <span class=skolem><span class=skolem>a2</span></span> <span class=keyword2><span class=keyword>where</span></span> aa<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>a1</span><span class=main>,</span> <span class=skolem>a2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>a</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>b1</span></span> <span class=skolem><span class=skolem>b2</span></span> <span class=keyword2><span class=keyword>where</span></span> bb<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>b1</span><span class=main>,</span> <span class=skolem>b2</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>b</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=keyword1>≈<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>b</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=skolem>b</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> <span class=skolem>a1</span><span class=main>,</span> <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>a2</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> aa bb
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span>Re <span class=main>(</span><span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>k</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>k</span> <span class=main>*</span> cnj <span class=skolem>k</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex_In_mult_cnj_zero complex_of_real_Re<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=main>(</span>chordal_circle_cvec_cmat <span class=skolem>a</span> <span class=skolem>r</span><span class=main>)</span> <span class=main>(</span>chordal_circle_cvec_cmat <span class=skolem>b</span> <span class=skolem>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * aa bb
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=skolem>k</span><span class=main>*</span>cnj <span class=skolem>k</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Chordal_Metric-sqrt_1_plus_square><span class=command>lemma</span></span> sqrt_1_plus_square<span class=main>:</span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> real_sqrt_less_mono real_sqrt_zero realpow_square_minus_le<span class=main>)</span>

<span class=keyword1><span class=command>lemma</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"dist_fs <span class=free>z</span> <span class=free>a</span> <span class=main>=</span> <span class=free>r</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>chordal_circle <span class=free>a</span> <span class=free>r</span><span class=main>)</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a'</span></span> <span class=keyword2><span class=keyword>where</span></span>  <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> of_complex <span class=skolem>a'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>a'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span><span class=main>=</span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>4</span><span class=main>*</span>cnj <span class=skolem>a'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>4</span><span class=main>*</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span> <span class=main>-</span>  <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?A</span><span class=main>,</span> <span class=var>?B</span><span class=main>,</span> <span class=var>?C</span><span class=main>,</span> <span class=var>?D</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>H</span><span class=main>.</span> hermitean <span class=bound>H</span> <span class=main>∧</span> <span class=bound>H</span> <span class=main>≠</span> mat_zero<span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"chordal_circle <span class=main>(</span>of_complex <span class=skolem>a'</span><span class=main>)</span> <span class=free>r</span> <span class=main>=</span> mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>*</span> cmod <span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> dist_fs_finite<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z'</span></span> <span class=quoted><span class=skolem>a'</span></span><span class=main>]</span> assms <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> of_complex <span class=skolem>a'</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>cmod <span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> "</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sqrt_1_plus_square
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>cmod <span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>  <span class=main>=</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> Re <span class=main>(</span><span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=skolem>a'</span><span class=main>)</span><span class=main>*</span>cnj <span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=skolem>z'</span><span class=main>*</span>cnj <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>Re<span class=main>(</span><span class=skolem>z'</span><span class=main>*</span>cnj <span class=skolem>z'</span><span class=main>)</span> <span class=main>-</span> Re<span class=main>(</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>z'</span><span class=main>)</span> <span class=main>-</span> Re<span class=main>(</span>cnj <span class=skolem>a'</span><span class=main>*</span><span class=skolem>z'</span><span class=main>)</span> <span class=main>+</span> Re<span class=main>(</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=skolem>z'</span><span class=main>*</span>cnj <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=var>?A</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>*</span> cnj <span class=skolem>z'</span> <span class=main>+</span> <span class=var>?B</span> <span class=main>*</span> cnj <span class=skolem>z'</span> <span class=main>+</span> <span class=var>?C</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>+</span> <span class=var>?D</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>*</span> cnj <span class=skolem>z'</span> <span class=main>+</span> <span class=var>?B</span> <span class=main>*</span> cnj <span class=skolem>z'</span> <span class=main>+</span> <span class=var>?C</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>+</span> <span class=var>?D</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_eq_if_Re_eq<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cnj <span class=skolem>z'</span> <span class=main>*</span> <span class=var>?A</span> <span class=main>+</span> <span class=var>?C</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>+</span> <span class=main>(</span>cnj <span class=skolem>z'</span> <span class=main>*</span> <span class=var>?B</span> <span class=main>+</span> <span class=var>?D</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>algebra</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>›</span></span> hh
      <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> of_complex <span class=skolem>a'</span>›</span></span><span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> of_complex <span class=skolem>a'</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> dist_fs_infinite2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>a'</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sqrt_1_plus_square
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>=</span> <span class=free>r</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>=</span> <span class=main>(</span><span class=free>r</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>=</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_mult_distrib<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>a'</span> <span class=main>*</span> cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> cmod_square<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_eq_if_Re_eq<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"circline_A0 <span class=main>(</span>mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_in_circline_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=free>z</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> of_complex <span class=skolem>a'</span>›</span></span><span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span><span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?A</span><span class=main>,</span> <span class=var>?B</span><span class=main>,</span> <span class=var>?C</span><span class=main>,</span> <span class=var>?D</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>H</span><span class=main>.</span> hermitean <span class=bound>H</span> <span class=main>∧</span> <span class=bound>H</span> <span class=main>≠</span> mat_zero<span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"chordal_circle <span class=free>a</span> <span class=free>r</span> <span class=main>=</span> mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=free>a</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=free>a</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> * hh
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>subst</span> inf_in_circline_set<span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>›</span></span><span class=quoted><span class=quoted>‹<span class=main>¬</span> <span class=free>a</span> <span class=main>≠</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> dist_fs_infinite2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z'</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_fs_sym<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sqrt_1_plus_square
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>=</span> <span class=free>r</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>=</span> <span class=main>(</span><span class=free>r</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>=</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power_mult_distrib<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>z'</span> <span class=main>*</span> cnj <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> cmod_square<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=skolem>z'</span><span class=main>*</span>cnj <span class=skolem>z'</span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_eq_if_Re_eq<span class=main>)</span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh
      <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>›</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>lemma</span></span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>chordal_circle <span class=free>a</span> <span class=free>r</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"dist_fs <span class=free>z</span> <span class=free>a</span> <span class=main>=</span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>a'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>a</span> <span class=main>=</span> of_complex <span class=skolem>a'</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> inf_or_of_complex
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>a'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span><span class=main>=</span><span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>4</span><span class=main>*</span>cnj <span class=skolem>a'</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>4</span><span class=main>*</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span> <span class=main>-</span>  <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?A</span><span class=main>,</span> <span class=var>?B</span><span class=main>,</span> <span class=var>?C</span><span class=main>,</span> <span class=var>?D</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>H</span><span class=main>.</span> hermitean <span class=bound>H</span> <span class=main>∧</span> <span class=bound>H</span> <span class=main>≠</span> mat_zero<span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"chordal_circle <span class=main>(</span>of_complex <span class=skolem>a'</span><span class=main>)</span> <span class=free>r</span> <span class=main>=</span> mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>z</span></span><span class=main>]</span> inf_or_of_complex<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>a</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> of_complex <span class=skolem>a'</span>›</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cnj <span class=skolem>z'</span> <span class=main>*</span> <span class=var>?A</span> <span class=main>+</span> <span class=var>?C</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>+</span> <span class=main>(</span>cnj <span class=skolem>z'</span> <span class=main>*</span> <span class=var>?B</span> <span class=main>+</span> <span class=var>?D</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh
      <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>›</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?A</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>*</span> cnj <span class=skolem>z'</span> <span class=main>+</span> <span class=var>?B</span> <span class=main>*</span> cnj <span class=skolem>z'</span> <span class=main>+</span> <span class=var>?C</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>+</span> <span class=var>?D</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>algebra</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=var>?A</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>*</span> cnj <span class=skolem>z'</span> <span class=main>+</span> <span class=var>?B</span> <span class=main>*</span> cnj <span class=skolem>z'</span> <span class=main>+</span><span class=var>?C</span> <span class=main>*</span> <span class=skolem>z'</span> <span class=main>+</span><span class=var>?D</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> Re <span class=main>(</span><span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=skolem>a'</span><span class=main>)</span><span class=main>*</span>cnj <span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=skolem>z'</span><span class=main>*</span>cnj <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>cmod <span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>  <span class=main>=</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main>)</span><span class=main><span class=keyword3>+</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sqrt_1_plus_square
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>+</span></span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>cmod <span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=main>(</span><span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> "</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>*</span> cmod <span class=main>(</span><span class=skolem>z'</span> <span class=main>-</span> <span class=skolem>a'</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span>sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> real_sqrt_eq_iff<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> real_sqrt_mult real_sqrt_divide<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> of_complex <span class=skolem>a'</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> dist_fs_finite<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z'</span></span> <span class=quoted><span class=skolem>a'</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> of_complex <span class=skolem>a'</span>›</span></span> *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"circline_A0 <span class=main>(</span>mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_in_circline_set<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>a'</span><span class=main>*</span>cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>a'</span> <span class=main>*</span> cnj <span class=skolem>a'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>=</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>=</span> <span class=free>r</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> real_sqrt_eq_iff<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> real_sqrt_mult<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sqrt_1_plus_square
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>a'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> of_complex <span class=skolem>a'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> dist_fs_infinite2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>a'</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?A</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?B</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?C</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?D</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span><span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
  <span class=keyword1><span class=command>have</span></span> hh<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=var>?A</span><span class=main>,</span> <span class=var>?B</span><span class=main>,</span> <span class=var>?C</span><span class=main>,</span> <span class=var>?D</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>H</span><span class=main>.</span> hermitean <span class=bound>H</span> <span class=main>∧</span> <span class=bound>H</span> <span class=main>≠</span> mat_zero<span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"chordal_circle <span class=free>a</span> <span class=free>r</span> <span class=main>=</span> mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=main>1</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span> assms * hh
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> inf_in_circline_set<span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>z'</span></span> <span class=keyword2><span class=keyword>where</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> inf_or_of_complex
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>z</span> <span class=main>∈</span> circline_set <span class=main>(</span>mk_circline <span class=var>?A</span> <span class=var>?B</span> <span class=var>?C</span> <span class=var>?D</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> assms *
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=skolem>z'</span><span class=main>*</span>cnj <span class=skolem>z'</span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> hh
      <span class=keyword1><span class=command>unfolding</span></span> circline_set_def
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>›</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> vec_cnj_def<span class=main><span class=keyword3>,</span></span> <span class=operator>algebra</span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>z'</span><span class=main>*</span>cnj <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=free>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span><span class=skolem>z'</span> <span class=main>*</span> cnj <span class=skolem>z'</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>=</span> <span class=free>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> cmod_square<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>=</span> <span class=free>r</span> <span class=main>*</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>r</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> real_sqrt_eq_iff<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> real_sqrt_mult<span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> sqrt_1_plus_square
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span> <span class=main>/</span> sqrt <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=main>(</span>cmod <span class=skolem>z'</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=free>r</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>z</span> <span class=main>=</span> of_complex <span class=skolem>z'</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a</span> <span class=main>=</span> <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> dist_fs_infinite2<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>z'</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> dist_fs_sym<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1><span class=command>text</span></span> <span class=quoted><span class=plain_text>‹Two chordal centers and radii for the given circline›</span></span>
<span class=keyword1><span class=command>definition</span></span> <span class=entity>chordal_circles_cmat</span> <span class=main>::</span> <span class=quoted><span class=quoted>"complex_mat <span class=main>⇒</span> <span class=main>(</span>complex <span class=main>×</span> real<span class=main>)</span> <span class=main>×</span> <span class=main>(</span>complex <span class=main>×</span> real<span class=main>)</span>"</span></span>  <span class=keyword2><span class=keyword>where</span></span>
 <span class=main>[</span><span class=operator>simp</span><span class=main>]</span><span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>chordal_circles_cmat</span> <span class=free><span class=bound><span class=entity>H</span></span></span> <span class=main>=</span>
     <span class=main>(</span><span class=keyword1>let</span> <span class=main>(</span><span class=bound>A</span><span class=main>,</span> <span class=bound>B</span><span class=main>,</span> <span class=bound>C</span><span class=main>,</span> <span class=bound>D</span><span class=main>)</span> <span class=main>=</span> <span class=free><span class=bound><span class=entity>H</span></span></span><span class=main>;</span>
          <span class=bound>dsc</span> <span class=main>=</span> sqrt<span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=bound>D</span><span class=main>-</span><span class=bound>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=bound>B</span><span class=main>*</span>cnj <span class=bound>B</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
          <span class=bound>a1</span> <span class=main>=</span> <span class=main>(</span><span class=bound>A</span> <span class=main>-</span> <span class=bound>D</span> <span class=main>+</span> cor <span class=bound>dsc</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=bound>C</span><span class=main>)</span><span class=main>;</span>
          <span class=bound>r1</span> <span class=main>=</span> sqrt<span class=main>(</span><span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=bound>a1</span><span class=main>/</span><span class=bound>B</span><span class=main>)</span> <span class=main>*</span> <span class=bound>A</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=bound>a1</span><span class=main>*</span>cnj <span class=bound>a1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>;</span>
          <span class=bound>a2</span> <span class=main>=</span> <span class=main>(</span><span class=bound>A</span> <span class=main>-</span> <span class=bound>D</span> <span class=main>-</span> cor <span class=bound>dsc</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=bound>C</span><span class=main>)</span><span class=main>;</span>
          <span class=bound>r2</span> <span class=main>=</span> sqrt<span class=main>(</span><span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=bound>a2</span><span class=main>/</span><span class=bound>B</span><span class=main>)</span> <span class=main>*</span> <span class=bound>A</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=bound>a2</span><span class=main>*</span>cnj <span class=bound>a2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
       <span class=keyword1>in</span> <span class=main>(</span><span class=main>(</span><span class=bound>a1</span><span class=main>,</span> <span class=bound>r1</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=bound>a2</span><span class=main>,</span> <span class=bound>r2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

<span class=keyword1><span class=command>lift_definition</span></span> chordal_circles_clmat <span class=main>::</span> <span class=quoted><span class=quoted>"circline_mat <span class=main>⇒</span> <span class=main>(</span>complex <span class=main>×</span> real<span class=main>)</span> <span class=main>×</span> <span class=main>(</span>complex <span class=main>×</span> real<span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>chordal_circles_cmat</span>
  <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>

<span class=keyword1><span class=command>lift_definition</span></span> chordal_circles <span class=main>::</span> <span class=quoted><span class=quoted>"ocircline <span class=main>⇒</span> <span class=main>(</span>complex <span class=main>×</span> real<span class=main>)</span> <span class=main>×</span> <span class=main>(</span>complex <span class=main>×</span> real<span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>is</span></span> <span class=quoted>chordal_circles_clmat</span>
<span class=keyword1><span class=command>proof</span></span> <span class=operator>transfer</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>H1</span> <span class=skolem>H2</span> <span class=main>::</span> <span class=quoted>complex_mat</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A1</span></span> <span class=skolem><span class=skolem>B1</span></span> <span class=skolem><span class=skolem>C1</span></span> <span class=skolem><span class=skolem>D1</span></span> <span class=keyword2><span class=keyword>where</span></span> hh1<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A1</span><span class=main>,</span> <span class=skolem>B1</span><span class=main>,</span> <span class=skolem>C1</span><span class=main>,</span> <span class=skolem>D1</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>H1</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H1</span></span><span class=main>)</span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>A2</span></span> <span class=skolem><span class=skolem>B2</span></span> <span class=skolem><span class=skolem>C2</span></span> <span class=skolem><span class=skolem>D2</span></span> <span class=keyword2><span class=keyword>where</span></span> hh2<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A2</span><span class=main>,</span> <span class=skolem>B2</span><span class=main>,</span> <span class=skolem>C2</span><span class=main>,</span> <span class=skolem>D2</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>H2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=skolem>H2</span></span><span class=main>)</span> <span class=operator>auto</span>

  <span class=keyword3><span class=command>assume</span></span> <span class=quoted><span class=quoted>"ocircline_eq_cmat <span class=skolem>H1</span> <span class=skolem>H2</span>"</span></span>
  <span class=keyword1><span class=command>then</span></span> <span class=keyword3><span class=command>obtain</span></span> <span class=skolem><span class=skolem>k</span></span> <span class=keyword2><span class=keyword>where</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>A1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>B1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>C1</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>D2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=skolem>D1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hh1<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span> hh2<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?dsc1</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=skolem>D1</span> <span class=main>-</span> <span class=skolem>A1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>B1</span> <span class=main>*</span> cnj <span class=skolem>B1</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?dsc2</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=skolem>D2</span> <span class=main>-</span> <span class=skolem>A2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>B2</span> <span class=main>*</span> cnj <span class=skolem>B2</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?a11</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A1</span> <span class=main>-</span> <span class=skolem>D1</span> <span class=main>+</span> cor <span class=var>?dsc1</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=skolem>C1</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?a12</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A2</span> <span class=main>-</span> <span class=skolem>D2</span> <span class=main>+</span> cor <span class=var>?dsc2</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=skolem>C2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?a21</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A1</span> <span class=main>-</span> <span class=skolem>D1</span> <span class=main>-</span> cor <span class=var>?dsc1</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=skolem>C1</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=var><span class=quoted><span class=var>?a22</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A2</span> <span class=main>-</span> <span class=skolem>D2</span> <span class=main>-</span> cor <span class=var>?dsc2</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=skolem>C2</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?r11</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt<span class=main>(</span><span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a11</span><span class=main>/</span><span class=skolem>B1</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A1</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=var>?a11</span><span class=main>*</span>cnj <span class=var>?a11</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?r12</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt<span class=main>(</span><span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a12</span><span class=main>/</span><span class=skolem>B2</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A2</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=var>?a12</span><span class=main>*</span>cnj <span class=var>?a12</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?r21</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt<span class=main>(</span><span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a21</span><span class=main>/</span><span class=skolem>B1</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A1</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=var>?a21</span><span class=main>*</span>cnj <span class=var>?a21</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?r22</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"sqrt<span class=main>(</span><span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a22</span><span class=main>/</span><span class=skolem>B2</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A2</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=var>?a22</span><span class=main>*</span>cnj <span class=var>?a22</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=skolem>D2</span> <span class=main>-</span> <span class=skolem>A2</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>B2</span> <span class=main>*</span> cnj <span class=skolem>B2</span><span class=main>)</span><span class=main>)</span> <span class=main>=</span> <span class=skolem>k</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> Re <span class=main>(</span><span class=main>(</span><span class=skolem>D1</span> <span class=main>-</span> <span class=skolem>A1</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>B1</span> <span class=main>*</span> cnj <span class=skolem>B1</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?dsc2</span> <span class=main>=</span> <span class=skolem>k</span> <span class=main>*</span> <span class=var>?dsc1</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> real_sqrt_mult<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A2</span> <span class=main>-</span> <span class=skolem>D2</span> <span class=main>+</span> cor <span class=var>?dsc2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>A1</span> <span class=main>-</span> <span class=skolem>D1</span> <span class=main>+</span> cor <span class=var>?dsc1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A2</span> <span class=main>-</span> <span class=skolem>D2</span> <span class=main>-</span> cor <span class=var>?dsc2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>A1</span> <span class=main>-</span> <span class=skolem>D1</span> <span class=main>-</span> cor <span class=var>?dsc1</span><span class=main>)</span>"</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span><span class=skolem>C2</span> <span class=main>=</span> cor <span class=skolem>k</span> <span class=main>*</span> <span class=main>(</span><span class=numeral>2</span><span class=main>*</span><span class=skolem>C1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?a12</span> <span class=main>=</span> <span class=var>?a11</span>"</span></span> <span class=quoted><span class=quoted>"<span class=var>?a22</span> <span class=main>=</span> <span class=var>?a21</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>k</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a12</span><span class=main>/</span><span class=skolem>B2</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A2</span><span class=main>)</span> <span class=main>=</span> Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a11</span><span class=main>/</span><span class=skolem>B1</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=quoted><span class=quoted>‹<span class=var>?a12</span> <span class=main>=</span> <span class=var>?a11</span>›</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?r12</span> <span class=main>=</span> <span class=var>?r11</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=quoted><span class=quoted>‹Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a12</span><span class=main>/</span><span class=skolem>B2</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A2</span><span class=main>)</span> <span class=main>=</span> Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a11</span><span class=main>/</span><span class=skolem>B1</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A1</span><span class=main>)</span>›</span></span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=quoted><span class=quoted>‹<span class=var>?a12</span> <span class=main>=</span> <span class=var>?a11</span>›</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a22</span><span class=main>/</span><span class=skolem>B2</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A2</span><span class=main>)</span> <span class=main>=</span> Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a21</span><span class=main>/</span><span class=skolem>B1</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=quoted><span class=quoted>‹<span class=var>?a22</span> <span class=main>=</span> <span class=var>?a21</span>›</span></span><span class=main>)</span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?r22</span> <span class=main>=</span> <span class=var>?r21</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=quoted><span class=quoted>‹Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a22</span><span class=main>/</span><span class=skolem>B2</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A2</span><span class=main>)</span> <span class=main>=</span> Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=var>?a21</span><span class=main>/</span><span class=skolem>B1</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A1</span><span class=main>)</span>›</span></span><span class=main><span class=keyword3>,</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=quoted><span class=quoted>‹<span class=var>?a22</span> <span class=main>=</span> <span class=var>?a21</span>›</span></span><span class=main>)</span><span class=main><span class=keyword3>+</span></span><span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"chordal_circles_cmat <span class=skolem>H1</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=var>?a11</span><span class=main>,</span> <span class=var>?r11</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=var>?a21</span><span class=main>,</span> <span class=var>?r21</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hh1<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> chordal_circles_cmat_def Let_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> times_complex.sel<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"chordal_circles_cmat <span class=skolem>H2</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=var>?a12</span><span class=main>,</span> <span class=var>?r12</span><span class=main>)</span><span class=main>,</span> <span class=main>(</span><span class=var>?a22</span><span class=main>,</span> <span class=var>?r22</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hh2<span class=main>[</span><span class=operator>symmetric</span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> chordal_circles_cmat_def Let_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>del</span><span class=main><span class=main>:</span></span> times_complex.sel<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"chordal_circles_cmat <span class=skolem>H1</span> <span class=main>=</span> chordal_circles_cmat <span class=skolem>H2</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>metis</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Chordal_Metric-chordal_circle_radius_positive><span class=command>lemma</span></span> chordal_circle_radius_positive<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"hermitean <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>mat_det <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  <span class=quoted><span class=quoted>"<span class=free>dsc</span> <span class=main>=</span> sqrt<span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=free>D</span><span class=main>-</span><span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> 
  <span class=quoted><span class=quoted>"<span class=free>a1</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>+</span> cor <span class=free>dsc</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>C</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>a2</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>-</span> cor <span class=free>dsc</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>C</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>a1</span><span class=main>/</span><span class=free>B</span><span class=main>)</span> <span class=main>≥</span> <span class=main>-</span><span class=main>1</span> <span class=main>∧</span> Re <span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>a2</span><span class=main>/</span><span class=free>B</span><span class=main>)</span> <span class=main>≥</span> <span class=main>-</span><span class=main>1</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
  <span class=keyword1><span class=command>from</span></span> assms <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>D</span>"</span></span> <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>=</span> cnj <span class=free>B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> hermitean_elems
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span><span class=main>*</span><span class=free>a1</span><span class=main>/</span><span class=free>B</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>+</span> cor <span class=free>dsc</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>C</span> <span class=main>=</span> cnj <span class=free>B</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a1</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>+</span> cor <span class=free>dsc</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>C</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span> <span class=operator>algebra</span>
  <span class=keyword1><span class=command>have</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>A</span><span class=main>*</span><span class=free>a2</span><span class=main>/</span><span class=free>B</span> <span class=main>=</span> <span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>-</span> cor <span class=free>dsc</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>C</span> <span class=main>=</span> cnj <span class=free>B</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>a2</span> <span class=main>=</span> <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>-</span> cor <span class=free>dsc</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>C</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span> <span class=operator>algebra</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>dsc</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>0</span> <span class=main>≤</span> Re <span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> Re <span class=main>(</span><span class=main>(</span>cor <span class=main>(</span>cmod <span class=free>B</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span> <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>dsc</span> <span class=main>=</span> sqrt<span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=free>D</span><span class=main>-</span><span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span><span class=main>*</span><span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> complex_mult_cnj_cmod<span class=main>)</span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>-</span> cor <span class=free>dsc</span><span class=main>)</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>+</span> cor <span class=free>dsc</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_mult_cnj_cmod<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword1><span class=command>have</span></span> xxx<span class=main>:</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>+</span> cor <span class=free>dsc</span><span class=main>)</span> <span class=main>/</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>-</span> cor <span class=free>dsc</span><span class=main>)</span> <span class=main>/</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=main>(</span><span class=keyword2><span class=keyword>is</span></span> <span class=quoted><span class=quoted>"<span class=var>?lhs</span> <span class=main>≥</span> <span class=var>?rhs</span>"</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> divide_right_mono less_eq_real_def<span class=main>)</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=free>A</span> <span class=main>*</span> Re <span class=free>D</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span>mat_det <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>C</span> <span class=main>=</span> cnj <span class=free>B</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>


  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span><span class=main>)</span> <span class=main>/</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> Re <span class=free>A</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> divide_divide_eq_left<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> mult.assoc<span class=main>)</span>
    <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> nonzero_divide_mult_cancel_right<span class=main>)</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp_all</span>

  <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
  <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"Re <span class=free>A</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>case</span></span> True
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>a1</span><span class=main>/</span><span class=free>B</span><span class=main>)</span> <span class=main>≥</span> Re <span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>a2</span><span class=main>/</span><span class=free>B</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> * ** <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span> xxx
      <span class=keyword1><span class=command>using</span></span> mult_right_mono<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span> <span class=quoted><span class=quoted>"Re <span class=free>A</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_mult_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
      <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>a2</span><span class=main>/</span><span class=free>B</span><span class=main>)</span> <span class=main>≥</span> <span class=main>-</span><span class=main>1</span>"</span></span>
    <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
      <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>*</span> Re <span class=free>D</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>›</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>+</span> Re <span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span><span class=main>*</span><span class=free>A</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>/</span> Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>+</span> Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> divide_right_mono<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>+</span> Re <span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span><span class=main>*</span><span class=free>A</span><span class=main>)</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square add_divide_distrib<span class=main>)</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> Re<span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>  <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>*</span> Re<span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> mult_right_mono<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>/</span> Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>+</span> Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> distrib_right<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> Re <span class=main>(</span><span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> Re_divide_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span>Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>*</span> Re<span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>=</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span> <span class=main>/</span> <span class=free>A</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> Re_divide_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>A</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>4</span> <span class=main>*</span> <span class=free>A</span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>D</span><span class=main>)</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> Re<span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>  <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span> <span class=main>/</span> <span class=free>A</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> Re<span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span> <span class=main>+</span>  <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> power2_sum<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>dsc</span> <span class=main>≤</span> sqrt <span class=main>(</span>Re<span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span> <span class=main>+</span>  <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>dsc</span> <span class=main>=</span> sqrt<span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=free>D</span><span class=main>-</span><span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span><span class=main>*</span><span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re<span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span> <span class=main>+</span>  <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>Re<span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span><span class=main>)</span> <span class=main>+</span>  <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span> div_reals
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>dsc</span> <span class=main>≤</span> <span class=main>¦</span>Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span><span class=main>¦</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
        <span class=keyword1><span class=command>have</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
        <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>-</span> <span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span> <span class=main>≥</span> Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>*</span> Re <span class=free>D</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>finally</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>-</span> <span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> divide_right_mono<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>-</span> <span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=free>A</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add_divide_distrib diff_divide_distrib<span class=main>)</span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>dsc</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>+</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span> <span class=main>≤</span> Re <span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>-</span> cor <span class=free>dsc</span><span class=main>)</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
      <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span><span class=main>)</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>-</span> cor <span class=free>dsc</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
      <span class=keyword1><span class=command>from</span></span> divide_right_mono<span class=main>[</span><span class=operator>OF</span> this<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>1</span> <span class=main>/</span> Re <span class=free>A</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>-</span> cor <span class=free>dsc</span><span class=main>)</span> <span class=main>/</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&lt;</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span>Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span><span class=main>)</span> <span class=main>/</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> Re <span class=free>A</span>›</span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
      <span class=keyword1><span class=command>from</span></span> mult_right_mono<span class=main>[</span><span class=operator>OF</span> this<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=free>A</span>"</span></span><span class=main>]</span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> **<span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_mult_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
    <span class=keyword1><span class=command>qed</span></span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>next</span></span>
    <span class=keyword3><span class=command>case</span></span> False
    <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"Re <span class=free>A</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
      <span class=keyword3><span class=command>case</span></span> True
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>a1</span><span class=main>/</span><span class=free>B</span><span class=main>)</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>a2</span><span class=main>/</span><span class=free>B</span><span class=main>)</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> * ** <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span> xxx
        <span class=keyword1><span class=command>using</span></span> mult_right_mono_neg<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?rhs</span></span></span> <span class=var><span class=quoted><span class=var>?lhs</span></span></span> <span class=quoted><span class=quoted>"Re <span class=free>A</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_mult_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span><span class=main><span class=keyword3>+</span></span>
        <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
      <span class=keyword1><span class=command>moreover</span></span>
      <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main>*</span><span class=free>a1</span><span class=main>/</span><span class=free>B</span><span class=main>)</span> <span class=main>≥</span> <span class=main>-</span><span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
        <span class=keyword1><span class=command>from</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>*</span> Re <span class=free>D</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>›</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>-</span> Re <span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span><span class=main>*</span><span class=free>A</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>/</span> Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>-</span> Re <span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span>
          <span class=keyword1><span class=command>using</span></span> divide_right_mono<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>-</span> Re <span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span><span class=main>*</span><span class=free>A</span><span class=main>)</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square diff_divide_distrib<span class=main>)</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> Re<span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>  <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span>Re <span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>*</span> Re<span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> mult_right_mono<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>/</span> Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>-</span> Re <span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> left_diff_distrib<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> Re <span class=main>(</span><span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> Re_divide_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>2</span><span class=main>*</span>Re <span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>*</span> Re<span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>=</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span> <span class=main>/</span> <span class=free>A</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>using</span></span> Re_divide_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=free>A</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>4</span> <span class=main>*</span> <span class=free>D</span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>A</span><span class=main>)</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span>"</span></span><span class=main>]</span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> Re<span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>/</span> <span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>  <span class=main>-</span> <span class=numeral>2</span><span class=main>*</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span> <span class=main>/</span> <span class=free>A</span> <span class=main>*</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span> power2_eq_square<span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>≤</span> Re<span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span> <span class=main>-</span>  <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> power2_diff<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>dsc</span> <span class=main>≤</span> sqrt <span class=main>(</span>Re<span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span> <span class=main>-</span>  <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>dsc</span> <span class=main>=</span> sqrt<span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=free>D</span><span class=main>-</span><span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span><span class=main>*</span><span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re<span class=main>(</span><span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span> <span class=main>-</span>  <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>=</span> <span class=main>(</span>Re<span class=main>(</span><span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span> <span class=main>-</span>  <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span> div_reals
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>dsc</span> <span class=main>≤</span> <span class=main>¦</span>Re <span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span><span class=main>¦</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>moreover</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
          <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
          <span class=keyword1><span class=command>also</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>-</span> <span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span> <span class=main>≥</span> Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>"</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>*</span> Re <span class=free>D</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span><span class=main>)</span>›</span></span>
            <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword1><span class=command>finally</span></span> <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>-</span> <span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
          <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
            <span class=keyword1><span class=command>using</span></span> divide_right_mono_neg<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=free>A</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>2</span><span class=main>*</span><span class=free>B</span><span class=main>*</span>cnj <span class=free>B</span> <span class=main>-</span> <span class=free>A</span><span class=main>*</span><span class=free>D</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>›</span></span><span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=free>A</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
            <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> add_divide_distrib diff_divide_distrib<span class=main>)</span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>qed</span></span>
        <span class=keyword1><span class=command>ultimately</span></span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>dsc</span> <span class=main>≤</span> Re <span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span> <span class=main>-</span> <span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span> <span class=main>/</span> <span class=free>A</span><span class=main>)</span> <span class=main>≥</span> Re <span class=main>(</span><span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>+</span> cor <span class=free>dsc</span><span class=main>)</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
        <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span><span class=main>)</span> <span class=main>≥</span> Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>+</span> cor <span class=free>dsc</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
        <span class=keyword1><span class=command>from</span></span> divide_right_mono<span class=main>[</span><span class=operator>OF</span> this<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span>"</span></span><span class=main>]</span>
        <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>1</span> <span class=main>/</span> Re <span class=free>A</span> <span class=main>≥</span> Re <span class=main>(</span><span class=free>A</span> <span class=main>-</span> <span class=free>D</span> <span class=main>+</span> cor <span class=free>dsc</span><span class=main>)</span> <span class=main>/</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span>"</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>0</span> <span class=main>&lt;</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span>›</span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>(</span>Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=main>(</span><span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> Re <span class=free>A</span><span class=main>)</span> <span class=main>/</span> Re <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=free>B</span> <span class=main>*</span> cnj <span class=free>B</span><span class=main>)</span> <span class=main>=</span> <span class=main>1</span> <span class=main>/</span> Re <span class=free>A</span>›</span></span>
          <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
        <span class=keyword1><span class=command>from</span></span> mult_right_mono_neg<span class=main>[</span><span class=operator>OF</span> this<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=free>A</span>"</span></span><span class=main>]</span>
        <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
          <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹Re <span class=free>A</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>A</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
          <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> *<span class=main>)</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_mult_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>apply</span></span></span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
          <span class=keyword1><span class=command><span class=improper><span class=command>done</span></span></span></span>
      <span class=keyword1><span class=command>qed</span></span>
      <span class=keyword1><span class=command>ultimately</span></span>
      <span class=keyword3><span class=command>show</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>next</span></span>
      <span class=keyword3><span class=command>case</span></span> False
      <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>A</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
        <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>¬</span> Re <span class=free>A</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=free>A</span>›</span></span>
        <span class=keyword1><span class=command>using</span></span> complex_eq_if_Re_eq <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
      <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
        <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>qed</span></span>
<span class=keyword1><span class=command>qed</span></span>


<span class=keyword1 id=Chordal_Metric-chordal_circle_det_positive><span class=command>lemma</span></span> chordal_circle_det_positive<span class=main>:</span>
  <span class=keyword2><span class=keyword>fixes</span></span> <span class=free>x</span> <span class=free>y</span> <span class=main>::</span> <span class=quoted>real</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>*</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>/</span> <span class=main>(</span><span class=free>x</span> <span class=main>-</span> <span class=free>y</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span><span class=main>)</span>
  <span class=keyword3><span class=command>case</span></span> True
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>*</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>smt</span> mult_nonneg_nonneg<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>-</span> <span class=free>y</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>&gt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> zero_less_divide_iff<span class=main>)</span>
<span class=keyword1><span class=command>next</span></span>
  <span class=keyword3><span class=command>case</span></span> False
  <span class=keyword1><span class=command>hence</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>y</span> <span class=main>&gt;</span> <span class=main>0</span> <span class=main>∧</span> <span class=free>x</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=free>x</span> <span class=main>*</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> mult_nonpos_nonpos<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=free>x</span></span> <span class=quoted><span class=free>y</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>cases</span> <span class=quoted><span class=quoted>"<span class=free>x</span><span class=main>=</span><span class=main>0</span>"</span></span><span class=main>)</span> <span class=operator>force</span><span class=main><span class=keyword3>+</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>-</span> <span class=free>y</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> zero_less_divide_iff<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Chordal_Metric-cor_sqrt_squared><span class=command>lemma</span></span> cor_sqrt_squared<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=free>x</span> <span class=main>≥</span> <span class=main>0</span> <span class=main>⟹</span> <span class=main>(</span>cor <span class=main>(</span>sqrt <span class=free>x</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> cor <span class=free>x</span>"</span></span>
  <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>

<span class=keyword1 id=Chordal_Metric-chordal_circle1><span class=command>lemma</span></span> chordal_circle1<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>D</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span> <span class=main>*</span> <span class=free>D</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>=</span> sqrt<span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=free>A</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>A</span><span class=main>-</span><span class=free>D</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mk_circline <span class=free>A</span> <span class=main>0</span> <span class=main>0</span> <span class=free>D</span> <span class=main>=</span> chordal_circle <span class=keyword1>∞<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>A</span> <span class=skolem>D</span> <span class=skolem>r</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>=</span> sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>A</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=skolem>A</span><span class=main>-</span><span class=skolem>D</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>D</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>∈</span> hermitean_nonzero"</span></span>
    <span class=keyword1><span class=command>using</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>A</span></span><span class=main>]</span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>D</span></span><span class=main>]</span> *
    <span class=keyword1><span class=command>unfolding</span></span> hermitean_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span> <span class=main>(</span>cor <span class=skolem>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=skolem>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>∈</span> hermitean_nonzero"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>D</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>A</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=skolem>A</span><span class=main>-</span><span class=skolem>D</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span> <span class=main>/</span> Re <span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> chordal_circle_det_positive<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>D</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>D</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=numeral>4</span> <span class=main>*</span> <span class=skolem>A</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> cor <span class=main>(</span>Re <span class=main>(</span><span class=numeral>4</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>A</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=skolem>A</span><span class=main>-</span><span class=skolem>D</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cor_sqrt_squared <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=skolem>A</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>4</span> <span class=main>*</span> <span class=skolem>D</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span><span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>D</span>›</span></span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>divide_simps</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> minus_mult_right<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=numeral>4</span> <span class=main>*</span> <span class=skolem>A</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> cor <span class=main>(</span>Re <span class=main>(</span><span class=numeral>4</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>D</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>A</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=skolem>A</span><span class=main>-</span><span class=skolem>D</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>D</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cor_sqrt_squared <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=main>(</span>mk_circline_cmat <span class=skolem>A</span> <span class=main>0</span> <span class=main>0</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>(</span>chordal_circle_cvec_cmat <span class=keyword1>∞<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>r</span> <span class=main>=</span> sqrt<span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>A</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=skolem>A</span><span class=main>-</span><span class=skolem>D</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re<span class=main>(</span><span class=numeral>4</span><span class=main>/</span><span class=main>(</span><span class=skolem>D</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> **<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id=Chordal_Metric-chordal_circle2><span class=command>lemma</span></span> chordal_circle2<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>A</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"is_real <span class=free>D</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=free>A</span> <span class=main>*</span> <span class=free>D</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>=</span> sqrt<span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=free>D</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=free>D</span><span class=main>-</span><span class=free>A</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mk_circline <span class=free>A</span> <span class=main>0</span> <span class=main>0</span> <span class=free>D</span> <span class=main>=</span> chordal_circle <span class=keyword1>0<span class=hidden>⇩</span><sub>h</sub></span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>A</span> <span class=skolem>D</span> <span class=skolem>r</span>
  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>=</span> sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>D</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=skolem>D</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>D</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>H</span><span class=main>.</span> hermitean <span class=bound>H</span> <span class=main>∧</span> <span class=bound>H</span> <span class=main>≠</span> mat_zero<span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>A</span></span><span class=main>]</span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>D</span></span><span class=main>]</span> *
    <span class=keyword1><span class=command>unfolding</span></span> hermitean_def
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> mat_adj_def mat_cnj_def<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=skolem>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>0</span><span class=main>,</span> <span class=main>-</span> <span class=main>(</span>cor <span class=skolem>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>H</span><span class=main>.</span> hermitean <span class=bound>H</span> <span class=main>∧</span> <span class=bound>H</span> <span class=main>≠</span> mat_zero<span class=main>}</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> hermitean_def mat_adj_def mat_cnj_def power2_eq_square<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>D</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re<span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>D</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=skolem>D</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>D</span> <span class=main>/</span> Re <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=skolem>A</span> <span class=main>*</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>&lt;</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span>
      <span class=keyword1><span class=command>using</span></span> chordal_circle_det_positive<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"Re <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"Re <span class=skolem>A</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>D</span>›</span></span> Re_divide_real <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>have</span></span>  <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=skolem>D</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>4</span> <span class=main>*</span> <span class=skolem>A</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>divide_simps</span></span> <span class=quasi_keyword>split</span><span class=main><span class=main>:</span></span> if_split_asm<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>D</span>›</span></span> minus_mult_right<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>D</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=skolem>D</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> cor <span class=main>(</span>Re <span class=main>(</span><span class=numeral>4</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=numeral>4</span> <span class=main>*</span> <span class=skolem>D</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cor_sqrt_squared <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span> <span class=main>(</span>cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>D</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=skolem>D</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> cor <span class=main>(</span>Re <span class=main>(</span><span class=numeral>4</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span><span class=main>)</span><span class=main>)</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>D</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹Re <span class=main>(</span><span class=numeral>4</span> <span class=main>*</span> <span class=skolem>D</span> <span class=main>/</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cor_sqrt_squared <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=main>(</span>mk_circline_cmat <span class=skolem>A</span> <span class=main>0</span> <span class=main>0</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>(</span>chordal_circle_cvec_cmat <span class=keyword1>0<span class=hidden>⇩</span><sub>v</sub></span> <span class=skolem>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>A</span> <span class=main>≠</span> <span class=main>0</span> <span class=main>∨</span> <span class=skolem>D</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>r</span> <span class=main>=</span> sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>D</span><span class=main>)</span><span class=main>/</span><span class=main>(</span><span class=skolem>D</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> *
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=numeral>4</span><span class=main>/</span><span class=main>(</span><span class=skolem>A</span><span class=main>-</span><span class=skolem>D</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp_all</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> **<span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword1 id="Chordal_Metric-chordal_circle'"><span class=command>lemma</span></span> chordal_circle'<span class=main>:</span>
  <span class=keyword2><span class=keyword>assumes</span></span> <span class=quoted><span class=quoted>"<span class=free>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span> <span class=main>∈</span> hermitean_nonzero"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>mat_det <span class=main>(</span><span class=free>A</span><span class=main>,</span> <span class=free>B</span><span class=main>,</span> <span class=free>C</span><span class=main>,</span> <span class=free>D</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span>
  <span class=quoted><span class=quoted>"<span class=free>C</span> <span class=main>*</span> <span class=free>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span>  <span class=main>+</span> <span class=main>(</span><span class=free>D</span> <span class=main>-</span> <span class=free>A</span><span class=main>)</span> <span class=main>*</span> <span class=free>a</span> <span class=main>-</span> <span class=free>B</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> <span class=quoted><span class=quoted>"<span class=free>r</span> <span class=main>=</span> sqrt<span class=main>(</span><span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> Re<span class=main>(</span><span class=main>(</span><span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> <span class=free>a</span><span class=main>/</span><span class=free>B</span><span class=main>)</span> <span class=main>*</span> <span class=free>A</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=free>a</span><span class=main>*</span>cnj <span class=free>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword2><span class=keyword>shows</span></span> <span class=quoted><span class=quoted>"mk_circline <span class=free>A</span> <span class=free>B</span> <span class=free>C</span> <span class=free>D</span> <span class=main>=</span> chordal_circle <span class=main>(</span>of_complex <span class=free>a</span><span class=main>)</span> <span class=free>r</span>"</span></span>
<span class=keyword1><span class=command>using</span></span> assms
<span class=keyword1><span class=command>proof</span></span> <span class=main>(</span><span class=operator>transfer</span><span class=main><span class=keyword3>,</span></span> <span class=operator>transfer</span><span class=main>)</span>
  <span class=keyword3><span class=command>fix</span></span> <span class=skolem>A</span> <span class=skolem>B</span> <span class=skolem>C</span> <span class=skolem>D</span> <span class=skolem>a</span> <span class=main>::</span> <span class=quoted>complex</span> <span class=keyword2><span class=keyword>and</span></span> <span class=skolem>r</span> <span class=main>::</span> <span class=quoted>real</span>

  <span class=keyword1><span class=command>let</span></span> <span class=var><span class=quoted><span class=var>?k</span></span></span> <span class=main>=</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=numeral>4</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>a</span> <span class=main>/</span> <span class=skolem>B</span>"</span></span>

  <span class=keyword3><span class=command>assume</span></span> *<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>∈</span> <span class=main>{</span><span class=bound>H</span><span class=main>.</span> hermitean <span class=bound>H</span> <span class=main>∧</span> <span class=bound>H</span> <span class=main>≠</span> mat_zero<span class=main>}</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> **<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>*</span> <span class=skolem>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>a</span> <span class=main>-</span> <span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> rr<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>r</span> <span class=main>=</span> sqrt <span class=main>(</span><span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> Re <span class=main>(</span><span class=var>?k</span> <span class=main>*</span> <span class=skolem>A</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword>and</span></span> det<span class=main>:</span> <span class=quoted><span class=quoted>"Re <span class=main>(</span>mat_det <span class=main>(</span><span class=skolem>A</span><span class=main>,</span> <span class=skolem>B</span><span class=main>,</span> <span class=skolem>C</span><span class=main>,</span> <span class=skolem>D</span><span class=main>)</span><span class=main>)</span> <span class=main>≤</span> <span class=main>0</span>"</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"is_real <span class=skolem>D</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * hermitean_elems
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>

  <span class=keyword1><span class=command>from</span></span> ** <span class=keyword1><span class=command>have</span></span> a12<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=keyword1>let</span> <span class=bound>dsc</span> <span class=main>=</span> sqrt<span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=skolem>D</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>B</span><span class=main>*</span>cnj <span class=skolem>B</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>
                      <span class=keyword1>in</span> <span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span> <span class=main>+</span> cor <span class=bound>dsc</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=skolem>C</span><span class=main>)</span> <span class=main>∨</span> <span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span><span class=skolem>A</span> <span class=main>-</span> <span class=skolem>D</span> <span class=main>-</span> cor <span class=bound>dsc</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=numeral>2</span> <span class=main>*</span> <span class=skolem>C</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>(</span><span class=skolem>D</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>B</span><span class=main>*</span>cnj <span class=skolem>B</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> complex_mult_cnj_cmod<span class=main>)</span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main>)</span>
    <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"ccsqrt <span class=main>(</span><span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> <span class=skolem>C</span> <span class=main>*</span> <span class=main>-</span> <span class=skolem>B</span><span class=main>)</span> <span class=main>=</span> cor <span class=main>(</span>sqrt <span class=main>(</span>Re <span class=main>(</span><span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>B</span> <span class=main>*</span> cnj <span class=skolem>B</span><span class=main>)</span><span class=main>)</span><span class=main>)</span><span class=main>)</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> csqrt_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>B</span> <span class=main>*</span> cnj <span class=skolem>B</span><span class=main>)</span><span class=main>)</span>"</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> complex_quadratic_equation_two_roots<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>C</span></span> <span class=quoted><span class=skolem>a</span></span> <span class=quoted><span class=quoted>"<span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span>"</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=skolem>B</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>using</span></span>  <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>*</span> <span class=skolem>a</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>+</span> <span class=main>(</span><span class=skolem>D</span> <span class=main>-</span> <span class=skolem>A</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>a</span> <span class=main>-</span> <span class=skolem>B</span> <span class=main>=</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def<span class=main>)</span>
  <span class=keyword1><span class=command>qed</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=var>?k</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> a12 <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>D</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> **
    <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"Re <span class=var>?k</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=main>(</span><span class=main>-</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>a</span> <span class=main>/</span> <span class=skolem>B</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> complex.expand divide_eq_0_iff divisors_zero zero_complex.simps<span class=main><span class=main>(</span></span>1<span class=main><span class=main>)</span></span> zero_complex.simps<span class=main><span class=main>(</span></span>2<span class=main><span class=main>)</span></span> zero_neq_neg_numeral<span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=main>-</span><span class=numeral>4</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>a</span> <span class=main>=</span> cor <span class=main>(</span>Re <span class=var>?k</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>B</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_of_real_Re<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹is_real <span class=main>(</span><span class=main>-</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>a</span><span class=main>/</span><span class=skolem>B</span><span class=main>)</span>›</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span><span class=skolem>a</span><span class=main>/</span><span class=skolem>B</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=var>?k</span>›</span></span> is_real_mult_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>4</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>/</span> <span class=skolem>B</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"is_real <span class=main>(</span><span class=skolem>B</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> <span class=main><span class=main>(</span></span>no_types<span class=main><span class=main>,</span></span> lifting<span class=main><span class=main>)</span></span> Im_complex_div_eq_0 complex_cnj_divide eq_cnj_iff_real hermitean_elems<span class=main><span class=main>(</span></span>3<span class=main><span class=main>)</span></span> mem_Collect_eq mult.commute<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>=</span> cnj <span class=skolem>B</span> <span class=main>*</span> <span class=skolem>a</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=skolem>B</span> <span class=main>*</span> cnj <span class=skolem>a</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>4</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>=</span> cor <span class=main>(</span>Re <span class=var>?k</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>C</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_of_real_Re<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹is_real <span class=var>?k</span>›</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>+</span> <span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> complex_mult_cnj_cmod<span class=main>)</span>
  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> Re <span class=main>(</span><span class=var>?k</span> <span class=main>*</span> <span class=skolem>A</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span><span class=main>)</span>"</span></span>
  <span class=keyword1><span class=command>proof</span></span><span class=operator>-</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=skolem>a</span> <span class=main>/</span> <span class=skolem>B</span> <span class=main>*</span> <span class=skolem>A</span><span class=main>)</span> <span class=main>≥</span> <span class=main>-</span><span class=main>1</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> a12 chordal_circle_radius_positive<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=skolem>A</span></span> <span class=quoted><span class=skolem>B</span></span> <span class=quoted><span class=skolem>C</span></span> <span class=quoted><span class=skolem>D</span></span><span class=main>]</span> * <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> det
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>auto</span> <span class=quasi_keyword>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> Let_def <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>from</span></span> mult_right_mono_neg<span class=main>[</span><span class=operator>OF</span> this<span class=main>,</span> <span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>4</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span> Re <span class=main>(</span><span class=var>?k</span> <span class=main>*</span> <span class=skolem>A</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> Re_mult_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>4</span>"</span></span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>/</span> <span class=skolem>B</span> <span class=main>*</span> <span class=skolem>A</span>"</span></span><span class=main>]</span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
    <span class=keyword1><span class=command>moreover</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span> <span class=main>&gt;</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span> complex_mult_cnj complex_neq_0
      <span class=keyword1><span class=command>by</span></span> <span class=operator>auto</span>
    <span class=keyword1><span class=command>ultimately</span></span>
    <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> Re <span class=main>(</span><span class=var>?k</span> <span class=main>*</span> <span class=skolem>A</span><span class=main>)</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> Re <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span><span class=main>)</span> <span class=main>≥</span> <span class=main>0</span>"</span></span>
      <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>metis</span> divide_nonneg_pos<span class=main>)</span>
    <span class=keyword3><span class=command>thus</span></span> <span class=var><span class=quoted><span class=var>?thesis</span></span></span>
      <span class=keyword1><span class=command>using</span></span> rr
      <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>qed</span></span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=skolem>r</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> Re <span class=main>(</span><span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> <span class=var>?k</span> <span class=main>*</span> <span class=skolem>A</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=var>?k</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>+</span> <span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> Re_divide_real<span class=main><span class=keyword3>,</span></span> <span class=operator>auto</span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=main>(</span>cor <span class=skolem>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span>  <span class=main>(</span><span class=numeral>4</span> <span class=main>-</span> <span class=var>?k</span> <span class=main>*</span> <span class=skolem>A</span><span class=main>)</span> <span class=main>/</span> <span class=main>(</span><span class=main>1</span> <span class=main>+</span> <span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=var>?k</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=skolem>A</span>›</span></span> mult_reals<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?k</span></span></span> <span class=quoted><span class=skolem>A</span></span><span class=main>]</span> 
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> cor_squared<span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=skolem>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> cor <span class=main>(</span>Re <span class=var>?k</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_of_real_Re<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹is_real <span class=main>(</span><span class=main>-</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>a</span><span class=main>/</span><span class=skolem>B</span><span class=main>)</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=main>1</span> <span class=main>+</span> <span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main>)</span>
  <span class=keyword1><span class=command>moreover</span></span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?k</span> <span class=main>=</span> cnj <span class=var>?k</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹is_real <span class=var>?k</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> eq_cnj_iff_real<span class=main>[</span><span class=operator>of</span> <span class=quoted><span class=quoted>"<span class=main>-</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>a</span><span class=main>/</span><span class=skolem>B</span>"</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"<span class=var>?k</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> cor <span class=main>(</span><span class=main>(</span>cmod <span class=var>?k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span>  cor_cmod_real<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹is_real <span class=var>?k</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>unfolding</span></span> power2_eq_square <span class=keyword1><span class=command>by</span></span> <span class=operator>force</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?k</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>=</span> <span class=var>?k</span> <span class=main>*</span> cnj <span class=var>?k</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_mult_cnj_cmod<span class=main>[</span><span class=operator>of</span> <span class=var><span class=quoted><span class=var>?k</span></span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>hence</span></span> ***<span class=main>:</span> <span class=quoted><span class=quoted>"<span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>=</span> <span class=main>(</span>cor <span class=main>(</span><span class=main>(</span>Re <span class=var>?k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=skolem>B</span> <span class=main>*</span> <span class=skolem>C</span><span class=main>)</span> <span class=main>/</span> <span class=numeral>16</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_of_real_Re<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹is_real <span class=main>(</span><span class=main>-</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>a</span><span class=main>/</span><span class=skolem>B</span><span class=main>)</span>›</span></span><span class=main>]</span> <span class=quoted><span class=quoted>‹<span class=skolem>C</span> <span class=main>=</span> cnj <span class=skolem>B</span>›</span></span> <span class=quoted><span class=quoted>‹is_real <span class=main>(</span><span class=main>-</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>a</span><span class=main>/</span><span class=skolem>B</span><span class=main>)</span>›</span></span> <span class=quoted><span class=quoted>‹<span class=skolem>B</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span>
  <span class=keyword1><span class=command>from</span></span> ** <span class=keyword1><span class=command>have</span></span> <span class=quoted><span class=quoted>"cor <span class=main>(</span><span class=main>(</span>Re <span class=var>?k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=skolem>B</span> <span class=main>*</span> <span class=skolem>C</span> <span class=main>-</span> <span class=numeral>4</span> <span class=main>*</span> cor <span class=main>(</span>Re <span class=var>?k</span><span class=main>)</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>D</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span> <span class=main>-</span> <span class=numeral>16</span> <span class=main>=</span> <span class=main>0</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_of_real_Re<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹is_real <span class=var>?k</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> power2_eq_square<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span> <span class=quasi_keyword>add</span><span class=main><span class=main>:</span></span> <span class=dynamic><span class=dynamic>field_simps</span></span><span class=main><span class=keyword3>,</span></span> <span class=operator>algebra</span><span class=main>)</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?k</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>D</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span>cor <span class=main>(</span><span class=main>(</span>Re <span class=var>?k</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span><span class=main>)</span> <span class=main>*</span> <span class=skolem>B</span> <span class=main>*</span> <span class=skolem>C</span> <span class=main>/</span> <span class=numeral>16</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span> complex_of_real_Re<span class=main><span class=main>[</span></span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹is_real <span class=var>?k</span>›</span></span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>algebra</span>
  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=var>?k</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>D</span><span class=main>-</span><span class=skolem>A</span><span class=main>)</span> <span class=main>=</span> <span class=numeral>4</span> <span class=main>*</span> <span class=main>(</span><span class=skolem>a</span><span class=main>*</span>cnj <span class=skolem>a</span> <span class=main>-</span> <span class=main>1</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>subst</span> <span class=main><span class=main>(</span></span><span class=quasi_keyword>asm</span><span class=main><span class=main>)</span></span>  ***<span class=main><span class=main>[</span></span><span class=operator>symmetric</span><span class=main><span class=main>]</span></span><span class=main>)</span> <span class=operator>simp</span>

  <span class=keyword1><span class=command>hence</span></span> <span class=quoted><span class=quoted>"<span class=numeral>4</span> <span class=main>*</span> <span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>-</span> <span class=main>(</span>cor <span class=skolem>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> cor <span class=main>(</span>Re <span class=var>?k</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>D</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> <span class=quoted><span class=quoted>‹<span class=numeral>4</span> <span class=main>-</span> <span class=main>(</span>cor <span class=skolem>r</span><span class=main>)</span><span class=main><span class=hidden>⇧</span><sup>2</sup></span> <span class=main>*</span> <span class=main>(</span><span class=skolem>a</span> <span class=main>*</span> cnj <span class=skolem>a</span> <span class=main>+</span> <span class=main>1</span><span class=main>)</span> <span class=main>=</span> cor <span class=main>(</span>Re <span class=var>?k</span><span class=main>)</span> <span class=main>*</span> <span class=skolem>A</span>›</span></span>
    <span class=keyword1><span class=command>using</span></span> complex_of_real_Re<span class=main>[</span><span class=operator>OF</span> <span class=quoted><span class=quoted>‹is_real <span class=main>(</span><span class=main>-</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>a</span><span class=main>/</span><span class=skolem>B</span><span class=main>)</span>›</span></span><span class=main>]</span>
    <span class=keyword1><span class=command>by</span></span> <span class=operator>simp</span> <span class=operator>algebra</span>
  <span class=keyword1><span class=command>ultimately</span></span>
  <span class=keyword3><span class=command>show</span></span> <span class=quoted><span class=quoted>"circline_eq_cmat <span class=main>(</span>mk_circline_cmat <span class=skolem>A</span> <span class=skolem>B</span> <span class=skolem>C</span> <span class=skolem>D</span><span class=main>)</span> <span class=main>(</span>chordal_circle_cvec_cmat <span class=main>(</span>of_complex_cvec <span class=skolem>a</span><span class=main>)</span> <span class=skolem>r</span><span class=main>)</span>"</span></span>
    <span class=keyword1><span class=command>using</span></span> * <span class=quoted><span class=quoted>‹<span class=skolem>a</span> <span class=main>≠</span> <span class=main>0</span>›</span></span>
    <span class=keyword1><span class=command>by</span></span> <span class=main>(</span><span class=operator>simp</span><span class=main><span class=keyword3>,</span></span> <span class=operator>rule_tac</span> x<span class=main><span class=main>=</span></span><span class=quoted><span class=quoted>"Re <span class=main>(</span><span class=main>-</span><span class=numeral>4</span><span class=main>*</span><span class=skolem>a</span> <span class=main>/</span> <span class=skolem>B</span><span class=main>)</span>"</span></span> <span class=keyword2><span class=keyword><span class=quasi_keyword>in</span></span></span> exI<span class=main><span class=keyword3>,</span></span> <span class=operator>simp</span><span class=main>)</span>
<span class=keyword1><span class=command>qed</span></span>

<span class=keyword2><span class=keyword>end</span></span>
</pre>
</div>
</main>
</div>
</div>
</body>
</html>