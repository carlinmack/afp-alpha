<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><title>Session Constructor_Funs - Archive of Formal Proofs</title><meta property="og:title" content="Session Constructor_Funs" />
<meta property="og:description" content="" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/entries/constructor_funs/theories/" />
<meta property="og:image" content="/images/afp.png"/>
<meta property="og:site_name" content="Archive of Formal Proofs" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="/images/afp.png"/>

<meta name="twitter:title" content="Session Constructor_Funs"/>
<meta name="twitter:description" content=""/>

  
  
  <link rel="stylesheet" type="text/css" href="/css/front.min.css" integrity="sha256-QUoTd2RQ4/P7SQKKOG301QYvQ7o2&#43;3qwXOJptpPXM0E="><link rel="stylesheet" type="text/css" href="/css/isabelle.css">
  
  <link rel="icon" href="/images/favicon.ico" type="image/icon">
  <script src="/js/flexsearch.min.js"></script><script src="/js/header-search.js"></script></head>

<body class="mathjax_ignore">
  <aside>
    <div>
  <div>
    <a href="/">
      <img src="/images/afp.png" alt='Logo of the Archive of Formal Proofs'
        class="logo">
    </a>
    <ul>
      <a href="/entries/constructor_funs"><li>Return to entry</li></a>
    </ul>
    <hr>
    <ul>
      <a href="#Constructor_Funs"><li>Constructor_Funs</li></a>
      <a href="#Test_Constructor_Funs"><li>Test_Constructor_Funs</li></a>
    </ul>
  </div>
  <ul>
    <a href="https://www.isa-afp.org/browser_info/current/AFP/Constructor_Funs/outline.pdf"><li>Proof
      outline</li></a>
    <a href="https://www.isa-afp.org/browser_info/current/AFP/Constructor_Funs/document.pdf"><li>Proof
      document</li></a>
    <a href="https://www.isa-afp.org/browser_info/current/AFP/Constructor_Funs/session_graph.pdf"><li>Theory dependencies</li></a>
  </ul>
</div>
  </aside>

  <div class='content theories'><header>
  <form action="/%20search">
  <div class='form-container'>
    <input id="searchInput" type="search" size="31" maxlength="255" value=""><button
      id="searchButton" type="button"><img src="/images/search.svg" alt="Search" /></button>
    <div id="searchInputautocomplete-list" style="display: none">
      <div></div>
    </div>
  </div>
  </form>
  
  <h1 ><span class='first'>S</span>ession <span class='first'>C</span>onstructor_<span class='first'>F</span>uns
  </h1>
  <div>
  
  
  </div>
</header><div><main>
  
  <div id="Constructor_Funs">
<div class="head"><h1>Theory Constructor_Funs</h1>
<span class="command">theory</span> <span class="name">Constructor_Funs</span><br/>
<span class="keyword">imports</span> <a href="../../HOL/HOL/Main.html"><span class="name">Main</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Introduction›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Constructor_Funs</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>Main</span><span>
</span><span>  </span><span class="keyword2"><span class="keyword">keywords</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"constructor_funs"</span></span></span><span> </span><span class="delimiter">::</span><span> </span><span>thy_decl</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  Importing this theory adds a preprocessing step to the code generator: All datatype constructors
  are replaced by functions, and all constructor calls are replaced by function calls. For example,
  for the @{const Suc} constructor of @{const nat}, a new constant with the same type and the
  definition @{term ‹suc' n = Suc n›} is created. Then, all instances of @{const Suc} (except for
  in the constructor functions themselves) are replaced. Note that the constructor functions are
  defined in eta-long form.

  Note that this does not affect constructors declared by @{command code_datatype}, only
  @{command datatype} (and @{command free_constructors}).

  The motivation for doing this is to avoid target-specific lambda-insertion by the code generator.
  In some target languages, constructors cannot be used as functions. As a consequence, terms like
  @{term ‹map Suc xs›} have to be printed as ‹map (fn x =&gt; Suc x) xs)›. This entails generation of
  fresh names outside of the proof kernel. The transformation provided by this theory ensures that
  all constructor calls are fully saturated. This makes supporting target languages that forbid
  partially-applied constructor calls much easier.

  The obvious downside is that this construction will usually degrade performance of generated code.
  To some extent, an optimising compiler that performs inlining can alleviate that.
›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Setup›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">ML_file</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹constructor_funs.ML›</span></span></span><span>
</span><span class="keyword1"><span class="command">setup</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Constructor_Funs.setup›</span></span></span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>
</div>
</div><div id="Test_Constructor_Funs">
<div class="head"><h1>Theory Test_Constructor_Funs</h1>
<span class="command">theory</span> <span class="name">Test_Constructor_Funs</span><br/>
<span class="keyword">imports</span> <a href="Constructor_Funs.html"><span class="name">Constructor_Funs</span></a><br/>
</div>
<div class="source">
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Usage›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">theory</span></span><span> </span><span>Test_Constructor_Funs</span><span>
</span><span class="keyword2"><span class="keyword">imports</span></span><span> </span><span>Constructor_Funs</span><span>
</span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  This entry provides a @{command datatype} plugin and a separate command.
  The plugin runs by default on all defined datatypes, but it can be disabled individually:
›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">datatype</span></span><span> </span><span class="delimiter">(</span><span>plugins</span><span> </span><span>del</span><span class="delimiter">:</span><span> </span><span class="string"><span class="delete"><span class="delete">"constructor_funs"</span></span></span><span class="delimiter">)</span><span> </span><span class="tfree">'a</span><span> </span><span>tree</span><span> </span><span class="delimiter">=</span><span> </span><span>Node</span><span> </span><span class="delimiter">|</span><span> </span><span>Fork</span><span> </span><span class="tfree">'a</span><span> </span><span class="string"><span class="delete"><span class="delete">"'a tree list"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">context</span></span><span> </span><span class="keyword2"><span class="keyword">begin</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  The @{command constructor_funs} command can be used to add constructor functions if the plugin has
  been disabled during datatype definition.
›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">constructor_funs</span></span><span> </span><span>tree</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Records are supported.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">record</span></span><span> </span><span class="tfree">'a</span><span> </span><span>meep</span><span> </span><span class="delimiter">=</span><span>
</span><span>  </span><span>field1</span><span> </span><span class="delimiter">::</span><span> </span><span class="tfree">'a</span><span>
</span><span>  </span><span>field2</span><span> </span><span class="delimiter">::</span><span> </span><span>nat</span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Nested and mutual recursion are supported.›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">datatype</span></span><span>
</span><span>  </span><span class="tfree">'a</span><span> </span><span>mlist1</span><span> </span><span class="delimiter">=</span><span> </span><span>MNil1</span><span> </span><span class="delimiter">|</span><span> </span><span>MCons1</span><span> </span><span class="tfree">'a</span><span> </span><span class="string"><span class="delete"><span class="delete">"'a mlist2"</span></span></span><span> </span><span class="keyword2"><span class="keyword">and</span></span><span>
</span><span>  </span><span class="tfree">'a</span><span> </span><span>mlist2</span><span> </span><span class="delimiter">=</span><span> </span><span>MNil2</span><span> </span><span class="delimiter">|</span><span> </span><span>MCons2</span><span> </span><span class="tfree">'a</span><span> </span><span class="string"><span class="delete"><span class="delete">"'a mlist1"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">section</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹Examples›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">datatype</span></span><span> </span><span class="tfree">'a</span><span> </span><span>seq</span><span> </span><span class="delimiter">=</span><span> </span><span>Nil</span><span> </span><span class="delimiter">|</span><span> </span><span>Cons</span><span> </span><span class="tfree">'a</span><span> </span><span class="string"><span class="delete"><span class="delete">"'a seq"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>app</span><span> </span><span class="delimiter">::</span><span> </span><span class="string"><span class="delete"><span class="delete">"'a seq ⇒ 'a seq ⇒ 'a seq"</span></span></span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="string"><span class="delete"><span class="delete">"app Nil ys = ys"</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span class="string"><span class="delete"><span class="delete">"app (Cons x xs) ys = Cons x (app xs ys)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">fun</span></span><span> </span><span>map</span><span> </span><span class="keyword2"><span class="keyword">where</span></span><span>
</span><span class="string"><span class="delete"><span class="delete">"map _ Nil = Nil"</span></span></span><span> </span><span class="delimiter">|</span><span>
</span><span class="string"><span class="delete"><span class="delete">"map f (Cons x xs) = Cons (f x) (map f xs)"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">definition</span></span><span> </span><span class="string"><span class="delete"><span class="delete">"bla = map (Cons True) Nil"</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">text</span></span><span> </span><span class="cartouche"><span class="delete"><span class="delete">‹
  The generated code never calls constructors directly, but only through regular functions. These
  functions are defined in eta-long form.
›</span></span></span><span>
</span><span>
</span><span class="keyword1"><span class="command">declare</span></span><span> </span><span class="delimiter">[</span><span class="delimiter">[</span><span class="string"><span class="delete"><span class="delete">"constructor_funs"</span></span></span><span class="delimiter">]</span><span class="delimiter">]</span><span>
</span><span>
</span><span class="keyword1"><span class="command">export_code</span></span><span> </span><span>app</span><span> </span><span>bla</span><span> </span><span>plus_nat_inst.plus_nat</span><span> </span><span class="keyword2"><span class="keyword">in</span></span><span> </span><span>SML</span><span>
</span><span>
</span><span class="keyword1"><span class="command">export_code</span></span><span> </span><span>app</span><span> </span><span>bla</span><span> </span><span>plus_nat_inst.plus_nat</span><span> </span><span class="keyword2"><span class="keyword">checking</span></span><span> </span><span>SML</span><span> </span><span>Scala</span><span>
</span><span>
</span><span class="keyword2"><span class="keyword">end</span></span><span>
</span></pre>
</div>
</div>
  
</main>
    </div>
  </div>
</body>

</html>